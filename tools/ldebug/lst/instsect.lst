     1                                  
     2                                  %if 0
     3                                  
     4                                  instsect.asm - install boot sectors. 2018 by C. Masloch
     5                                  
     6                                  Usage of the works is permitted provided that this
     7                                  instrument is retained with the works, so that any entity
     8                                  that uses the works is notified of this instrument.
     9                                  
    10                                  DISCLAIMER: THE WORKS ARE WITHOUT WARRANTY.
    11                                  
    12                                  %endif
    13                                  
    14                                  
    15                                  %include "lmacros3.mac"
     1                              <1> [list -]
    14                              <2> [list -]
    14                              <1> [list -]
    16                                  
    17                                  numdef SYMHINTS, 1
    18                                  %if _SYMHINTS
    19                                  	%imacro symhint_store_string 1+.nolist
    20                                  ..@symhint_store_string_%1:
    21                                  	%endmacro
    22                                  	%imacro symhint_store_and_label 1+.nolist
    23                                  ..@symhint_store_string_%1:
    24                                  %1:
    25                                  	%endmacro
    26                                  %else
    27                                  %idefine symhint_store_string comment
    28                                  	%imacro symhint_store_and_label 1+.nolist
    29                                  %1:
    30                                  	%endmacro
    31                                  %endif
    32                                  
    33                                  numdef DEBUG0
    34                                  numdef DEBUG1
    35                                  numdef DEBUG2
    36                                  numdef DEBUG3
    37                                  numdef DEBUG4
    38                                  numdef DEBUG5
    39                                  %idefine d5 _d 5,
    40                                  numdef VDD,		1	; try to load DEBXXVDD.DLL to use it for L and W sector commands
    41                                  numdef DISPLAY_ALL_NAMES,	0
    42                                  
    43                                  
    44                                  	struc BS
    45 00000000 ??????                  bsJump:	resb 3
    46 00000003 ????????????????        bsOEM:	resb 8
    47                                  bsBPB:
    48                                  	endstruc
    49                                  
    50                                  	struc EBPB		;        BPB sec
    51 00000000 ????                    bpbBytesPerSector:	resw 1	; offset 00h 0Bh
    52 00000002 ??                      bpbSectorsPerCluster:	resb 1	; offset 02h 0Dh
    53 00000003 ????                    bpbReservedSectors:	resw 1	; offset 03h 0Eh
    54 00000005 ??                      bpbNumFATs:		resb 1	; offset 05h 10h
    55 00000006 ????                    bpbNumRootDirEnts:	resw 1	; offset 06h 11h -- 0 for FAT32
    56 00000008 ????                    bpbTotalSectors:	resw 1	; offset 08h 13h
    57 0000000A ??                      bpbMediaID:		resb 1	; offset 0Ah 15h
    58 0000000B ????                    bpbSectorsPerFAT:	resw 1	; offset 0Bh 16h -- 0 for FAT32
    59 0000000D ????                    bpbCHSSectors:		resw 1	; offset 0Dh 18h
    60 0000000F ????                    bpbCHSHeads:		resw 1	; offset 0Fh 1Ah
    61 00000011 ????????                bpbHiddenSectors:	resd 1	; offset 11h 1Ch
    62 00000015 ????????                bpbTotalSectorsLarge:	resd 1	; offset 15h 20h
    63                                  bpbNew:				; offset 19h 24h
    64                                  
    65 00000019 ????????                ebpbSectorsPerFATLarge:	resd 1	; offset 19h 24h
    66 0000001D ????                    ebpbFSFlags:		resw 1	; offset 1Dh 28h
    67 0000001F ????                    ebpbFSVersion:		resw 1	; offset 1Fh 2Ah
    68 00000021 ????????                ebpbRootCluster:	resd 1	; offset 21h 2Ch
    69 00000025 ????                    ebpbFSINFOSector:	resw 1	; offset 25h 30h
    70 00000027 ????                    ebpbBackupSector:	resw 1	; offset 27h 32h
    71 00000029 <res Ch>                ebpbReserved:		resb 12	; offset 29h 34h
    72                                  ebpbNew:			; offset 35h 40h
    73                                  	endstruc
    74                                  
    75                                  	struc BPBN		; ofs B16 S16 B32 S32
    76 00000000 ??                      bpbnBootUnit:		resb 1	; 00h 19h 24h 35h 40h
    77 00000001 ??                      			resb 1	; 01h 1Ah 25h 36h 41h
    78 00000002 ??                      bpbnExtBPBSignature:	resb 1	; 02h 1Bh 26h 37h 42h -- 29h for valid BPBN
    79 00000003 ????????                bpbnSerialNumber:	resd 1	; 03h 1Ch 27h 38h 43h
    80 00000007 <res Bh>                bpbnVolumeLabel:	resb 11	; 07h 20h 2Bh 3Ch 47h
    81 00000012 ????????????????        bpbnFilesystemID:	resb 8	; 12h 2Bh 36h 47h 52h
    82                                  	endstruc		; 1Ah 33h 3Eh 4Fh 5Ah
    83                                  
    84                                  	struc LOADSTACKVARS, -10h
    85 FFFFFFF0 ????????                lsvFirstCluster:	resd 1
    86 FFFFFFF4 ????????                lsvFATSector:		resd 1
    87 FFFFFFF8 ????                    lsvFATSeg:		resw 1
    88 FFFFFFFA ????                    lsvLoadSeg:		resw 1
    89 FFFFFFFC ????????                lsvDataStart:		resd 1
    90                                  	endstruc
    91                                  
    92                                  	struc LOADDATA, LOADSTACKVARS - 10h
    93 FFFFFFE0 ????                    ldMemoryTop:	resw 1
    94 FFFFFFE2 ????                    ldLoadTop:	resw 1
    95 FFFFFFE4 ????                    ldSectorSeg:	resw 1
    96 FFFFFFE6 ??                      ldFATType:	resb 1
    97 FFFFFFE7 ??                      ldHasLBA:	resb 1
    98 FFFFFFE8 ????                    ldClusterSize:	resw 1
    99 FFFFFFEA ????                    ldParaPerSector:resw 1
   100 FFFFFFEC ????                    ldLoadingSeg:	resw 1
   101 FFFFFFEE ????                    ldLoadUntilSeg:	resw 1
   102                                  	endstruc
   103                                  
   104                                  	struc LOADDATA2, LOADDATA - 10h
   105 FFFFFFD0 ????????                ldRootSector:		resd 1
   106 FFFFFFD4 ????                    ldEntriesPerSector:	resw 1
   107 FFFFFFD6 ????                    ldLastAvailableSector:	resw 1
   108 FFFFFFD8 ????                    ldParasLeft:		resw 1
   109 FFFFFFDA ????                    ldParasDone:		resw 1
   110 FFFFFFDC ????                    ldBytesPerSector:	resw 1
   111                                  	endstruc
   112                                  
   113                                  	struc DIRENTRY
   114 00000000 ????????????????        deName:		resb 8
   115 00000008 ??????                  deExt:		resb 3
   116 0000000B ??                      deAttrib:	resb 1
   117 0000000C ????????????????        		resb 8
   118 00000014 ????                    deClusterHigh:	resw 1
   119 00000016 ????                    deTime:		resw 1
   120 00000018 ????                    deDate:		resw 1
   121 0000001A ????                    deClusterLow:	resw 1
   122 0000001C ????????                deSize:		resd 1
   123                                  	endstruc
   124                                  
   125                                  ATTR_READONLY	equ 1
   126                                  ATTR_HIDDEN	equ 2
   127                                  ATTR_SYSTEM	equ 4
   128                                  ATTR_VOLLABEL	equ 8
   129                                  ATTR_DIRECTORY	equ 10h
   130                                  ATTR_ARCHIVE	equ 20h
   131                                  
   132                                  	struc LBAPACKET
   133 00000000 ????                    lpSize:		resw 1
   134 00000002 ????                    lpCount:	resw 1
   135 00000004 ????????                lpBuffer:	resd 1
   136 00000008 ????????????????        lpSector:	resq 1
   137                                  	endstruc
   138                                  
   139                                  	struc PARTINFO
   140 00000000 ??                      piBoot:		resb 1
   141 00000001 ??????                  piStartCHS:	resb 3
   142 00000004 ??                      piType:		resb 1
   143 00000005 ??????                  piEndCHS:	resb 3
   144 00000008 ????????                piStart:	resd 1
   145 0000000C ????????                piLength:	resd 1
   146                                  	endstruc
   147                                  
   148                                  ptEmpty:		equ 0
   149                                  ptFAT12:		equ 1
   150                                  ptFAT16_16BIT_CHS:	equ 4
   151                                  ptExtendedCHS:		equ 5
   152                                  ptFAT16_CHS:		equ 6
   153                                  ptFAT32_CHS:		equ 0Bh
   154                                  ptFAT32:		equ 0Ch
   155                                  ptFAT16:		equ 0Eh
   156                                  ptExtended:		equ 0Fh
   157                                  ptLinux:		equ 83h
   158                                  ptExtendedLinux:	equ 85h
   159                                  
   160                                  	struc FSINFO	; FAT32 FSINFO sector layout
   161 00000000 ????????                .signature1:	resd 1		; 41615252h ("RRaA") for valid FSINFO
   162                                  .signature1_value:	equ 41615252h
   163                                  .reserved1:			; former unused, initialized to zero by FORMAT
   164 00000004 <res 1E0h>              .fsiboot:	resb 480	; now used for FSIBOOT
   165 000001E4 ????????                .signature2:	resd 1		; 61417272h ("rrAa") for valid FSINFO
   166                                  .signature2_value:	equ 61417272h
   167 000001E8 ????????                .numberfree:	resd 1		; FSINFO: number of free clusters or -1
   168 000001EC ????????                .nextfree:	resd 1		; FSINFO: first free cluster or -1
   169 000001F0 <res Ch>                .reserved2:	resd 3		; unused, initialized to zero by FORMAT
   170 000001FC ????????                .signature3:	resd 1		; AA550000h for valid FSINFO or FSIBOOT
   171                                  .signature3_value:	equ 0AA550000h
   172                                  	endstruc
   173                                  
   174                                  	struc FSIBOOTG	; FSIBOOT general layout
   175 00000000 ????????????????        .signature:	resq 1		; 8 byte that identify the FSIBOOT type
   176 00000008 <res 1D8h>              .fsicode:	resb 472	; 472 byte FSIBOOT type specific data or code
   177                                  	endstruc
   178                                  
   179                                  %if _VDD
   180                                  ; standard BOPs for communication with DEBXXVDD on NT platforms
   181                                  %macro RegisterModule 0.nolist
   182                                  	db 0C4h, 0C4h, 58h, 0
   183                                  	nop
   184                                  %endmacro
   185                                  %macro UnRegisterModule 0.nolist
   186                                  	db 0C4h, 0C4h, 58h, 1
   187                                  	nop
   188                                  %endmacro
   189                                  %macro DispatchCall 0.nolist
   190                                  	db 0C4h, 0C4h, 58h, 2
   191                                  	nop
   192                                  %endmacro
   193                                  %endif
   194                                  
   195                                  
   196                                  %ifndef _MAP
   197                                  %elifempty _MAP
   198                                  %else	; defined non-empty, str or non-str
   199                                  	[map all _MAP]
   200                                  %endif
   201                                  
   202                                  	cpu 8086
   203                                  	org 256
   204                                  	section PROGRAM align=16
   205                                  	section BUFFERS follows=PROGRAM align=16
   206                                  
   207                                  	numdef FAT12,		1
   208                                  	numdef FAT16,		1
   209                                  	numdef FAT32,		1
   210                                  	strdef PAYLOAD_FAT12,	"boot12.bin"
   211                                  	strdef PAYLOAD_FAT16,	"boot16.bin"
   212                                  	strdef PAYLOAD_FAT32,	"boot32.bin"
   213                                  	numdef NUM_REPLACEMENTS,4
   214                                  	numdef NUM_DETECT_NAMES,4
   215                                  %if _NUM_REPLACEMENTS > _NUM_DETECT_NAMES
   216                                   %error Must detect above-or-equal amount of replacement names
   217                                  %endif
   218                                  
   219                                  
   220                                  	align 16, db 0
   221                                  %if _FAT12
   222 00000000 <bin 200h>              fat12_payload:		incbin _PAYLOAD_FAT12
   223                                  .end:
   224                                  %if (fat12_payload.end - fat12_payload) != 512
   225                                   %error "FAT12 payload isn't 512 bytes sized."
   226                                  %endif
   227                                  %endif
   228                                  %if _FAT16
   229 00000200 <bin 200h>              fat16_payload:		incbin _PAYLOAD_FAT16
   230                                  .end:
   231                                  %if (fat16_payload.end - fat16_payload) != 512
   232                                   %error "FAT16 payload isn't 512 bytes sized."
   233                                  %endif
   234                                  %endif
   235                                  %if _FAT32
   236 00000400 <bin 400h>              fat32_payload:		incbin _PAYLOAD_FAT32
   237                                  .end:
   238                                  %assign fat32_payload.size (fat32_payload.end - fat32_payload)
   239                                  %assign _FAT32_TWO_SECTORS 0
   240                                  %if fat32_payload.size == 512
   241                                  %elif fat32_payload.size == 1024
   242                                   %assign _FAT32_TWO_SECTORS 1
   243                                  %else
   244                                   %error "FAT32 payload isn't 512 or 1024 bytes sized."
   245                                  %endif
   246                                  %else
   247                                   %assign _FAT32_TWO_SECTORS 0
   248                                  %endif
   249                                  
   250                                  
   251                                  	section PROGRAM
   252                                  start:
   253                                  			; This is a simple MS-DOS 1.x detection (8 Byte).
   254 00000000 B44D                    	mov ah, 4Dh		; the only function I found that doesn't need much setup or cleanup
   255 00000002 F9                      	stc			; but that uses MS-DOS 2.x error reporting. clears CF (Int21.30 does not)
   256 00000003 CD21                    	int 21h
   257 00000005 7301                    	jnc .dosgood		; it is MS-DOS 2.x+ or compatible -->
   258 00000007 C3                      	retn			; it isn't so simply terminate
   259                                  
   260                                  .dosgood:
   261 00000008 FC                      	cld
   262 00000009 81FC[805A]              	cmp sp, stack_end
   263 0000000D 730B                    	jae .stackgood
   264 0000000F BA[0F53]                	mov dx, msg.out_of_memory
   265 00000012 E86C43                  	call disp_msg_asciz
   266 00000015 B8FF4C                  	mov ax, 4CFFh
   267 00000018 CD21                    	int 21h
   268                                  
   269                                  .stackgood:
   270 0000001A BA[6343]                	mov dx, i23
   271 0000001D B82325                  	mov ax, 2523h
   272 00000020 CD21                    	int 21h			; set Int23 so that we restore on Ctrl-C as well
   273 00000022 BA[6043]                	mov dx, i24
   274 00000025 B82425                  	mov ax, 2524h
   275 00000028 CD21                    	int 21h			; set Int24 so all hard errors are changed to the soft error
   276                                  
   277 0000002A C606[5A46]FF            	mov byte [drivenumber], -1
   278                                  
   279 0000002F BE8100                  	mov si, 81h
   280                                  .loop:
   281 00000032 AC                      	lodsb
   282                                  .loop_got_byte:
   283 00000033 3C09                    	cmp al, 9
   284 00000035 74FB                    	je .loop
   285 00000037 3C20                    	cmp al, 32
   286 00000039 74F7                    	je .loop
   287 0000003B 7303E98606              	jb cmd_line_end
   288                                  
   289 00000040 3C2D                    	cmp al, '-'
   290 00000042 7428                    	je .switch
   291 00000044 3C2F                    	cmp al, '/'
   292 00000046 7424                    	je .switch
   293                                  
   294 00000048 803C3A                  	cmp byte [si], ':'
   295 0000004B 7403E92C06              	jne .error
   296 00000050 E86A42                  	call uppercase
   297 00000053 2C41                    	sub al, 'A'
   298 00000055 3C20                    	cmp al, 32
   299 00000057 7203E92006              	jae .error
   300 0000005C 803E[5A46]FF            	cmp byte [drivenumber], -1
   301 00000061 7403E91006              	jne .error_multiple_drives
   302 00000066 A2[5A46]                	mov byte [drivenumber], al
   303 00000069 46                      	inc si
   304 0000006A EBC6                    	jmp .loop
   305                                  
   306                                  .switch:
   307 0000006C AC                      	lodsb
   308 0000006D E84D42                  	call uppercase
   309                                  %if _NUM_REPLACEMENTS
   310 00000070 3C46                    	cmp al, 'F'
   311 00000072 7460                    	je .switch_f
   312                                  %endif
   313 00000074 3C4F                    	cmp al, 'O'
   314 00000076 7503E9D600              	je .switch_o
   315 0000007B 3C55                    	cmp al, 'U'
   316 0000007D 7503E9B101              	je .switch_u
   317 00000082 3C50                    	cmp al, 'P'
   318 00000084 7503E9E701              	je .switch_p
   319 00000089 3C51                    	cmp al, 'Q'
   320 0000008B 7503E91402              	je .switch_q
   321 00000090 3C4C                    	cmp al, 'L'
   322 00000092 7503E94102              	je .switch_l
   323 00000097 3C49                    	cmp al, 'I'
   324 00000099 7503E97902              	je .switch_i
   325 0000009E 3C42                    	cmp al, 'B'
   326 000000A0 7503E92103              	je .switch_b
   327 000000A5 3C43                    	cmp al, 'C'
   328 000000A7 7503E99303              	je .switch_c
   329 000000AC 3C53                    	cmp al, 'S'
   330 000000AE 7503E90B04              	je .switch_s
   331 000000B3 3C4D                    	cmp al, 'M'
   332 000000B5 7503E9A704              	je .switch_m
   333                                  
   334 000000BA 3C48                    	cmp al, 'H'
   335 000000BC 740D                    	je .switch_h
   336 000000BE 3C3F                    	cmp al, '?'
   337 000000C0 7409                    	je .switch_h
   338                                  
   339                                  .switch_not_supported:
   340 000000C2 BA[2053]                	mov dx, msg.switch_not_supported
   341                                  disp_error: equ $
   342 000000C5 E8B942                  	call disp_msg_asciz
   343 000000C8 E9BE10                  	jmp exit_error
   344                                  
   345                                  
   346                                  .switch_h:
   347 000000CB BA[7A46]                	mov dx, msg.help
   348 000000CE E8B042                  	call disp_msg_asciz
   349 000000D1 E9C010                  	jmp exit_normal
   350                                  
   351                                  
   352                                  %if _NUM_REPLACEMENTS
   353                                  .switch_f:
   354                                  
   355                                  @@:
   356 000000D4 AC                      	lodsb
   357 000000D5 3C20                    	cmp al, 32
   358 000000D7 74FB                    	je @B
   359 000000D9 3C09                    	cmp al, 9
   360 000000DB 74F7                    	je @B
   361 000000DD 3C3D                    	 cmp al, '='
   362 000000DF 742F                    	 je @FF
   363 000000E1 3C3A                    	 cmp al, ':'
   364 000000E3 742B                    	 je @FF
   365 000000E5 E8E041                  	call get_decimal_literal
   366 000000E8 85DB                    	test bx, bx
   367 000000EA 7403E98D05              	jnz .error
   368 000000EF 85D2                    	test dx, dx
   369 000000F1 7503E98605              	jz .error
   370 000000F6 83FA04                  	cmp dx, _NUM_REPLACEMENTS
   371 000000F9 7603E97E05              	ja .error
   372 000000FE 4A                      	dec dx
   373 000000FF 3C3D                    	cmp al, '='
   374 00000101 7407                    	je @F
   375 00000103 3C3A                    	cmp al, ':'
   376 00000105 7403E97205              	jne .error
   377                                  @@:
   378 0000010A B80C00                  	mov ax, 12
   379 0000010D F7E2                    	mul dx			; ax = 0, 12, 24, 36
   380 0000010F A9                      	db __TEST_IMM16		; (skip xor)
   381                                  @@:
   382 00000110 31C0                    	 xor ax, ax		; if empty number field (al was colon)
   383 00000112 05[A856]                	add ax, msg.name_replacements	; -> name replacement buffer
   384 00000115 97                      	xchg ax, di		; -> buffer
   385                                  
   386 00000116 AC                      	lodsb
   387 00000117 4E                      	dec si
   388 00000118 3C20                    	cmp al, 32
   389 0000011A 742F                    	je @F
   390 0000011C 3C09                    	cmp al, 9
   391 0000011E 742B                    	je @F
   392 00000120 E85D41                  	call iseol?
   393 00000123 7426                    	je @F
   394                                  
   395 00000125 57                      	push di
   396 00000126 E8D340                  	call boot_parse_fn	; parse
   397 00000129 5F                      	pop di
   398 0000012A 7303E94D05              	jc .error		; error out -->
   399 0000012F 3C2F                    	cmp al, '/'
   400 00000131 7503E94605              	je .error
   401 00000136 3C5C                    	cmp al, '\'
   402 00000138 7503E93F05              	je .error		; invalid -->
   403 0000013D 4E                      	dec si
   404 0000013E 56                      	push si
   405 0000013F BE[9C56]                	mov si, load_kernel_name
   406 00000142 B90600                  	mov cx, 12 >> 1
   407 00000145 F3A5                    	rep movsw		; write to buffer
   408 00000147 5E                      	pop si
   409 00000148 E9E7FE                  	jmp .loop
   410                                  
   411                                  @@:
   412 0000014B C60500                  	mov byte [di], 0	; delete replacement name
   413 0000014E E9E1FE                  	jmp .loop
   414                                  %endif
   415                                  
   416                                  
   417                                  .switch_o:
   418 00000151 AC                      	lodsb
   419 00000152 E86841                  	call uppercase
   420 00000155 3C4E                    	cmp al, 'N'
   421 00000157 7508                    	jne @F
   422 00000159 8026[2308]FC            	clropt [cmd_line_flags], clfSetOEMName | clfPreserveOEMName
   423 0000015E E9D1FE                  	jmp .loop
   424                                  
   425                                  @@:
   426 00000161 3C50                    	cmp al, 'P'
   427 00000163 750D                    	jne @F
   428 00000165 800E[2308]02            	setopt [cmd_line_flags], clfPreserveOEMName
   429 0000016A 8026[2308]FE            	clropt [cmd_line_flags], clfSetOEMName
   430 0000016F E9C0FE                  	jmp .loop
   431                                  
   432                                  @@:
   433 00000172 3C3D                    	 cmp al, '='
   434 00000174 7407                    	 je @F
   435 00000176 3C3A                    	 cmp al, ':'
   436 00000178 7403                    	 je @F
   437 0000017A E945FF                  	jmp .switch_not_supported
   438                                  
   439                                  @@:
   440 0000017D 8026[2308]FD            	clropt [cmd_line_flags], clfPreserveOEMName
   441 00000182 800E[2308]01            	setopt [cmd_line_flags], clfSetOEMName
   442 00000187 BF[4846]                	mov di, oemname
   443 0000018A AC                      	lodsb
   444 0000018B 88C4                    	mov ah, al
   445 0000018D 3C22                    	cmp al, '"'
   446 0000018F 7407                    	je .o_quoted
   447 00000191 3C27                    	cmp al, "'"
   448 00000193 7403                    	je .o_quoted
   449 00000195 B400                    	mov ah, 0
   450 00000197 A8                      	db __TEST_IMM8
   451                                  .o_quoted:
   452                                  .o_loop:
   453 00000198 AC                      	lodsb
   454 00000199 38E0                    	cmp al, ah
   455 0000019B 742E                    	je .o_end_lod
   456 0000019D 84E4                    	test ah, ah
   457 0000019F 750C                    	jnz @F
   458 000001A1 3C09                    	cmp al, 9
   459 000001A3 7427                    	je .o_end
   460 000001A5 3C20                    	cmp al, 32
   461 000001A7 7423                    	je .o_end
   462 000001A9 3C0D                    	cmp al, 13
   463 000001AB 741F                    	je .o_end
   464                                  @@:
   465 000001AD 3C0D                    	cmp al, 13
   466 000001AF 7448                    	je .o_error
   467 000001B1 81FF[5046]              	cmp di, oemname + 8
   468 000001B5 7342                    	jae .o_error
   469 000001B7 3C5C                    	cmp al, '\'
   470 000001B9 750D                    	jne .o_store
   471 000001BB AC                      	lodsb
   472 000001BC 3C0D                    	cmp al, 13
   473 000001BE 7439                    	je .o_error
   474 000001C0 3C78                    	cmp al, 'x'
   475 000001C2 743B                    	je .o_x
   476 000001C4 3C58                    	cmp al, 'X'
   477 000001C6 7437                    	je .o_x
   478                                  .o_store:
   479 000001C8 AA                      	stosb
   480 000001C9 EBCD                    	jmp .o_loop
   481                                  
   482                                  .o_end_lod:
   483 000001CB AC                      	lodsb
   484                                  .o_end:
   485 000001CC 89F9                    	mov cx, di
   486 000001CE 81E9[4846]              	sub cx, oemname
   487 000001D2 83F908                  	cmp cx, 8
   488 000001D5 731F                    	jae .o_done
   489 000001D7 56                      	push si
   490 000001D8 50                      	push ax
   491 000001D9 BF[4F46]                	mov di, oemname + 7
   492 000001DC BE[4846]                	mov si, oemname
   493 000001DF 01CE                    	add si, cx
   494 000001E1 4E                      	dec si
   495 000001E2 FD                      	std		; AMD erratum 109 workaround below
   496 000001E3 E303                    	jcxz @FF
   497                                  @@:
   498 000001E5 A4                      	movsb
   499 000001E6 E2FD                    	loop @B
   500                                  @@:
   501                                  	; rep movsb
   502                                  @@:
   503 000001E8 81FF[4846]              	cmp di, oemname
   504 000001EC 7205                    	jb @F
   505 000001EE B020                    	mov al, 32
   506 000001F0 AA                      	stosb
   507 000001F1 EBF5                    	jmp @B
   508                                  @@:
   509 000001F3 FC                      	cld
   510 000001F4 58                      	pop ax
   511 000001F5 5E                      	pop si
   512                                  .o_done:
   513 000001F6 E93AFE                  	jmp .loop_got_byte
   514                                  
   515                                  .o_error:
   516 000001F9 BA[3853]                	mov dx, msg.o_error
   517 000001FC E9C6FE                  	jmp disp_error
   518                                  
   519                                  .o_x:
   520 000001FF AC                      	lodsb
   521 00000200 E82341                  	call getexpression.lit_ishexdigit?
   522 00000203 72F4                    	jc .o_error
   523 00000205 E8B540                  	call uppercase
   524 00000208 2C30                    	sub al, '0'
   525 0000020A 3C09                    	cmp al, 9		; was decimal digit ?
   526 0000020C 7602                    	jbe @F			; yes -->
   527 0000020E 2C07                    	sub al, 'A'-('9'+1)	; else adjust for hexadecimal digit
   528                                  @@:
   529 00000210 88C3                    	mov bl, al
   530 00000212 AC                      	lodsb
   531 00000213 E81041                  	call getexpression.lit_ishexdigit?
   532 00000216 7216                    	jc .o_store_bl_dec_si
   533 00000218 E8A240                  	call uppercase
   534 0000021B 2C30                    	sub al, '0'
   535 0000021D 3C09                    	cmp al, 9		; was decimal digit ?
   536 0000021F 7602                    	jbe @F			; yes -->
   537 00000221 2C07                    	sub al, 'A'-('9'+1)	; else adjust for hexadecimal digit
   538                                  @@:
   539 00000223 00DB                    	add bl, bl
   540 00000225 00DB                    	add bl, bl
   541 00000227 00DB                    	add bl, bl
   542 00000229 00DB                    	add bl, bl
   543 0000022B 00C3                    	add bl, al
   544 0000022D 46                      	inc si
   545                                  .o_store_bl_dec_si:
   546 0000022E 4E                      	dec si
   547 0000022F 88D8                    	mov al, bl
   548 00000231 EB95                    	jmp .o_store
   549                                  
   550                                  .switch_u:
   551                                  @@:
   552 00000233 AC                      	lodsb
   553 00000234 3C20                    	cmp al, 32
   554 00000236 74FB                    	je @B
   555 00000238 3C09                    	cmp al, 9
   556 0000023A 74F7                    	je @B
   557                                  
   558 0000023C BA[6358]                	mov dx, msg.keep
   559 0000023F 4E                      	dec si
   560 00000240 E84440                  	call isstring?
   561 00000243 B8FFFF                  	mov ax, 0FFFFh
   562 00000246 7422                    	je @F
   563 00000248 BA[6858]                	mov dx, msg.auto
   564 0000024B E83940                  	call isstring?
   565 0000024E B800FF                  	mov ax, 0FF00h
   566 00000251 7417                    	je @F
   567 00000253 AC                      	lodsb
   568 00000254 E87940                  	call get_hexadecimal_literal
   569 00000257 85DB                    	test bx, bx
   570 00000259 7403E91E04              	jnz .error
   571 0000025E 81FA0001                	cmp dx, 256
   572 00000262 7203E91504              	jae .error
   573 00000267 89D0                    	mov ax, dx
   574 00000269 4E                      	dec si
   575                                  @@:
   576 0000026A A3[5246]                	mov word [load_unit], ax
   577 0000026D E9C2FD                  	jmp .loop
   578                                  
   579                                  
   580                                  .switch_p:
   581                                  @@:
   582 00000270 AC                      	lodsb
   583 00000271 3C20                    	cmp al, 32
   584 00000273 74FB                    	je @B
   585 00000275 3C09                    	cmp al, 9
   586 00000277 74F7                    	je @B
   587                                  
   588 00000279 BA[6358]                	mov dx, msg.keep
   589 0000027C 4E                      	dec si
   590 0000027D E80740                  	call isstring?
   591 00000280 B8FFFF                  	mov ax, 0FFFFh
   592 00000283 7419                    	je @F
   593 00000285 BA[6858]                	mov dx, msg.auto
   594 00000288 E8FC3F                  	call isstring?
   595 0000028B B800FF                  	mov ax, 0FF00h
   596 0000028E 740E                    	je @F
   597 00000290 BA[7558]                	mov dx, msg.none
   598 00000293 E8F13F                  	call isstring?
   599 00000296 B8FF00                  	mov ax, 00FFh
   600 00000299 7403                    	je @F
   601 0000029B E9DE03                  	jmp .error
   602                                  @@:
   603 0000029E A3[5446]                	mov word [load_use_partinfo], ax
   604 000002A1 E98EFD                  	jmp .loop
   605                                  
   606                                  
   607                                  .switch_q:
   608                                  @@:
   609 000002A4 AC                      	lodsb
   610 000002A5 3C20                    	cmp al, 32
   611 000002A7 74FB                    	je @B
   612 000002A9 3C09                    	cmp al, 9
   613 000002AB 74F7                    	je @B
   614                                  
   615 000002AD BA[6358]                	mov dx, msg.keep
   616 000002B0 4E                      	dec si
   617 000002B1 E8D33F                  	call isstring?
   618 000002B4 B8FFFF                  	mov ax, 0FFFFh
   619 000002B7 7419                    	je @F
   620 000002B9 BA[6858]                	mov dx, msg.auto
   621 000002BC E8C83F                  	call isstring?
   622 000002BF B800FF                  	mov ax, 0FF00h
   623 000002C2 740E                    	je @F
   624 000002C4 BA[7558]                	mov dx, msg.none
   625 000002C7 E8BD3F                  	call isstring?
   626 000002CA B8FF00                  	mov ax, 00FFh
   627 000002CD 7403                    	je @F
   628 000002CF E9AA03                  	jmp .error
   629                                  @@:
   630 000002D2 A3[5646]                	mov word [load_use_query_geometry], ax
   631 000002D5 E95AFD                  	jmp .loop
   632                                  
   633                                  
   634                                  .switch_l:
   635                                  @@:
   636 000002D8 AC                      	lodsb
   637 000002D9 3C20                    	cmp al, 32
   638 000002DB 74FB                    	je @B
   639 000002DD 3C09                    	cmp al, 9
   640 000002DF 74F7                    	je @B
   641                                  
   642 000002E1 BA[6358]                	mov dx, msg.keep
   643 000002E4 4E                      	dec si
   644 000002E5 E89F3F                  	call isstring?
   645 000002E8 B8FFFF                  	mov ax, 0FFFFh
   646 000002EB 7424                    	je @F
   647 000002ED BA[6858]                	mov dx, msg.auto
   648 000002F0 E8943F                  	call isstring?
   649 000002F3 B800FF                  	mov ax, 0FF00h
   650 000002F6 7419                    	je @F
   651 000002F8 BA[6D58]                	mov dx, msg.autohdd
   652 000002FB E8893F                  	call isstring?
   653 000002FE B80001                  	mov ax, 0100h
   654 00000301 740E                    	je @F
   655 00000303 BA[7558]                	mov dx, msg.none
   656 00000306 E87E3F                  	call isstring?
   657 00000309 B8FF00                  	mov ax, 00FFh
   658 0000030C 7403                    	je @F
   659 0000030E E96B03                  	jmp .error
   660                                  @@:
   661 00000311 A3[5846]                	mov word [load_use_lba], ax
   662 00000314 E91BFD                  	jmp .loop
   663                                  
   664                                  
   665                                  .switch_i:
   666 00000317 AC                      	lodsb
   667 00000318 E8A23F                  	call uppercase
   668 0000031B 3C4F                    	cmp al, 'O'
   669 0000031D 750D                    	jne @F
   670 0000031F 8026[2208]9F            	clropt [cmd_line_flags], clfZeroInfo | clfInfoFromCopy
   671 00000324 800E[2208]10            	setopt [cmd_line_flags], clfLeaveInfo
   672                                  .loop_1:
   673 00000329 E906FD                  	jmp .loop
   674                                  
   675                                  @@:
   676 0000032C 3C52                    	cmp al, 'R'
   677 0000032E 7507                    	jne @F
   678 00000330 8026[2208]8F            	clropt [cmd_line_flags], clfLeaveInfo | clfZeroInfo | clfInfoFromCopy
   679 00000335 EBF2                    	jmp .loop_1
   680                                  
   681                                  @@:
   682 00000337 3C5A                    	cmp al, 'Z'
   683 00000339 750C                    	jne @F
   684 0000033B 8026[2208]CF            	clropt [cmd_line_flags], clfLeaveInfo | clfInfoFromCopy
   685 00000340 800E[2208]40            	setopt [cmd_line_flags], clfZeroInfo
   686 00000345 EBE2                    	jmp .loop_1
   687                                  
   688                                  @@:
   689 00000347 3C43                    	cmp al, 'C'
   690 00000349 750C                    	jne @F
   691 0000034B 8026[2208]AF            	clropt [cmd_line_flags], clfLeaveInfo | clfZeroInfo
   692 00000350 800E[2208]20            	setopt [cmd_line_flags], clfInfoFromCopy
   693 00000355 EBD2                    	jmp .loop_1
   694                                  
   695                                  @@:
   696 00000357 3C49                    	cmp al, 'I'
   697 00000359 7507                    	jne @F
   698 0000035B 800E[2108]08            	setopt [cmd_line_flags], clfAllowInvalidInfo
   699 00000360 EBC7                    	jmp .loop_1
   700                                  
   701                                  @@:
   702 00000362 3C56                    	cmp al, 'V'
   703 00000364 7507                    	jne @F
   704 00000366 8026[2108]F7            	clropt [cmd_line_flags], clfAllowInvalidInfo
   705 0000036B EBBC                    	jmp .loop_1
   706                                  
   707                                  @@:
   708 0000036D 3C53                    	cmp al, 'S'
   709 0000036F 750C                    	jne @F
   710 00000371 8026[2008]87            	clropt [cmd_line_flags], clfWriteInfoMask
   711 00000376 800E[2008]20            	setopt [cmd_line_flags], clfWriteInfoToSector
   712 0000037B EBAC                    	jmp .loop_1
   713                                  
   714                                  @@:
   715 0000037D 3C4E                    	cmp al, 'N'
   716 0000037F 750C                    	jne @F
   717 00000381 8026[2008]87            	clropt [cmd_line_flags], clfWriteInfoMask
   718 00000386 800E[2008]08            	setopt [cmd_line_flags], clfDontWriteInfo
   719                                  .loop_2:
   720 0000038B EB9C                    	jmp .loop_1
   721                                  
   722                                  @@:
   723 0000038D 3C3A                    	cmp al, ':'
   724 0000038F 740B                    	je @F
   725 00000391 3C3D                    	cmp al, '='
   726 00000393 7407                    	je @F
   727 00000395 3C42                    	cmp al, 'B'
   728 00000397 7421                    	je .switch_i_b
   729 00000399 E926FD                  	jmp .switch_not_supported
   730                                  
   731                                  @@:
   732 0000039C 8026[2008]87            	clropt [cmd_line_flags], clfWriteInfoMask
   733 000003A1 800E[2008]10            	setopt [cmd_line_flags], clfWriteInfoToFile
   734                                  @@:
   735 000003A6 AC                      	lodsb
   736 000003A7 3C20                    	cmp al, 32
   737 000003A9 74FB                    	je @B
   738 000003AB 3C09                    	cmp al, 9
   739 000003AD 74F7                    	je @B
   740                                  
   741 000003AF 4E                      	dec si
   742 000003B0 8936[3408]              	mov word [cmd_line_info_file.name], si
   743 000003B4 E8CB02                  	call process_switch_filename
   744 000003B7 E979FC                  	jmp .loop_got_byte
   745                                  
   746                                  .switch_i_b:
   747 000003BA 8026[2008]87            	clropt [cmd_line_flags], clfWriteInfoMask
   748 000003BF 800E[2008]40            	setopt [cmd_line_flags], clfWriteInfoToSectorFile
   749 000003C4 EBC5                    	jmp .loop_2
   750                                  
   751                                  
   752                                  .switch_b:
   753 000003C6 AC                      	lodsb
   754 000003C7 E8F33E                  	call uppercase
   755 000003CA 3C4F                    	cmp al, 'O'
   756 000003CC 750C                    	jne @F
   757 000003CE 8026[2208]FD            	clropt [cmd_line_flags], clfSectorFromCopy
   758 000003D3 800E[2208]01            	setopt [cmd_line_flags], clfLeaveSector
   759 000003D8 EBB1                    	jmp .loop_2
   760                                  
   761                                  @@:
   762 000003DA 3C52                    	cmp al, 'R'
   763 000003DC 7507                    	jne @F
   764 000003DE 8026[2208]FC            	clropt [cmd_line_flags], clfLeaveSector | clfSectorFromCopy
   765 000003E3 EBA6                    	jmp .loop_2
   766                                  
   767                                  @@:
   768 000003E5 3C43                    	cmp al, 'C'
   769 000003E7 750C                    	jne @F
   770 000003E9 8026[2208]FE            	clropt [cmd_line_flags], clfLeaveSector
   771 000003EE 800E[2208]02            	setopt [cmd_line_flags], clfSectorFromCopy
   772 000003F3 EB96                    	jmp .loop_2
   773                                  
   774                                  @@:
   775 000003F5 3C53                    	cmp al, 'S'
   776 000003F7 750C                    	jne @F
   777 000003F9 8026[2008]F8            	clropt [cmd_line_flags], clfWriteSectorMask
   778 000003FE 800E[2008]02            	setopt [cmd_line_flags], clfWriteSectorToSector
   779 00000403 EB86                    	jmp .loop_2
   780                                  
   781                                  @@:
   782 00000405 3C4E                    	cmp al, 'N'
   783 00000407 750D                    	jne @F
   784 00000409 8026[2008]F8            	clropt [cmd_line_flags], clfWriteSectorMask
   785 0000040E 800E[2008]04            	setopt [cmd_line_flags], clfDontWriteSector
   786 00000413 E975FF                  	jmp .loop_2
   787                                  
   788                                  @@:
   789 00000416 3C3A                    	cmp al, ':'
   790 00000418 7407                    	je @F
   791 0000041A 3C3D                    	cmp al, '='
   792 0000041C 7403                    	je @F
   793 0000041E E9A1FC                  	jmp .switch_not_supported
   794                                  
   795                                  @@:
   796 00000421 8026[2008]F8            	clropt [cmd_line_flags], clfWriteSectorMask
   797 00000426 800E[2008]01            	setopt [cmd_line_flags], clfWriteSectorToFile
   798                                  @@:
   799 0000042B AC                      	lodsb
   800 0000042C 3C20                    	cmp al, 32
   801 0000042E 74FB                    	je @B
   802 00000430 3C09                    	cmp al, 9
   803 00000432 74F7                    	je @B
   804                                  
   805 00000434 4E                      	dec si
   806 00000435 8936[3008]              	mov word [cmd_line_sector_file.name], si
   807 00000439 E84602                  	call process_switch_filename
   808 0000043C E9F4FB                  	jmp .loop_got_byte
   809                                  
   810                                  
   811                                  .switch_c:
   812 0000043F AC                      	lodsb
   813 00000440 E87A3E                  	call uppercase
   814 00000443 3C42                    	cmp al, 'B'
   815 00000445 750D                    	jne @F
   816 00000447 8026[2108]DF            	clropt [cmd_line_flags], clfWriteCopySectorIfSector
   817 0000044C 800E[2108]10            	setopt [cmd_line_flags], clfWriteCopySector
   818 00000451 E937FF                  	jmp .loop_2
   819                                  
   820                                  @@:
   821 00000454 3C49                    	cmp al, 'I'
   822 00000456 750D                    	jne @F
   823 00000458 8026[2108]7F            	clropt [cmd_line_flags], clfWriteCopyInfoIfSector
   824 0000045D 800E[2108]40            	setopt [cmd_line_flags], clfWriteCopyInfo
   825 00000462 E926FF                  	jmp .loop_2
   826                                  
   827                                  @@:
   828 00000465 3C4E                    	cmp al, 'N'
   829 00000467 751D                    	jne @F
   830 00000469 AC                      	lodsb
   831 0000046A E8503E                  	call uppercase
   832 0000046D 3C49                    	cmp al, 'I'
   833 0000046F 740D                    	je .switch_cni
   834 00000471 8026[2108]CF            	clropt [cmd_line_flags], 		clfWriteCopySectorIfSector | clfWriteCopySector
   836 00000476 3C42                    	cmp al, 'B'
   837 00000478 7503E90EFF              	je .loop_2
   838 0000047D 4E                      	dec si
   839                                  .switch_cn:
   840                                  .switch_cni:
   841 0000047E 8026[2108]3F            	clropt [cmd_line_flags], 		clfWriteCopyInfoIfSector | clfWriteCopyInfo
   843 00000483 E905FF                  	jmp .loop_2
   844                                  
   845                                  @@:
   846 00000486 3C53                    	cmp al, 'S'
   847 00000488 7527                    	jne @F
   848 0000048A AC                      	lodsb
   849 0000048B E82F3E                  	call uppercase
   850 0000048E 3C49                    	cmp al, 'I'
   851 00000490 7412                    	je .switch_csi
   852 00000492 8026[2108]EF            	clropt [cmd_line_flags], clfWriteCopySector
   853 00000497 800E[2108]20            	setopt [cmd_line_flags], clfWriteCopySectorIfSector
   854 0000049C 3C42                    	cmp al, 'B'
   855 0000049E 7503E9E8FE              	je .loop_2
   856 000004A3 4E                      	dec si
   857                                  .switch_cs:
   858                                  .switch_csi:
   859 000004A4 8026[2108]BF            	clropt [cmd_line_flags], clfWriteCopyInfo
   860 000004A9 800E[2108]80            	setopt [cmd_line_flags], clfWriteCopyInfoIfSector
   861 000004AE E9DAFE                  	jmp .loop_2
   862                                  
   863                                  @@:
   864 000004B1 8026[2108]5F            	clropt [cmd_line_flags], clfWriteCopySectorIfSector | clfWriteCopyInfoIfSector
   865 000004B6 800E[2108]50            	setopt [cmd_line_flags], clfWriteCopySector | clfWriteCopyInfo
   866 000004BB E9CDFE                  	jmp .loop_2
   867                                  
   868                                  
   869                                  .switch_s:
   870 000004BE AC                      	lodsb
   871 000004BF E8FB3D                  	call uppercase
   872                                  
   873 000004C2 3C56                    	cmp al, 'V'
   874 000004C4 7508                    	jne @F
   875 000004C6 8026[2108]FB            	clropt [cmd_line_flags], clfAllowInvalidSector
   876 000004CB E9BDFE                  	jmp .loop_2
   877                                  
   878                                  @@:
   879 000004CE 3C4E                    	cmp al, 'N'
   880 000004D0 7508                    	jne @F
   881 000004D2 800E[2108]04            	setopt [cmd_line_flags], clfAllowInvalidSector
   882 000004D7 E9B1FE                  	jmp .loop_2
   883                                  
   884                                  @@:
   885 000004DA 3C52                    	cmp al, 'R'
   886 000004DC 7509                    	jne @F
   887 000004DE 8126[2008]7FFC          	clropt [cmd_line_flags], clfReadSectorFile12 | clfReadSectorFile16 | clfReadSectorFile32, 1
   888 000004E4 E9A4FE                  	jmp .loop_2
   889                                  
   890                                  @@:
   891 000004E7 31FF                    	xor di, di
   892 000004E9 BA8003                  	mov dx, clfReadSectorFile12 | clfReadSectorFile16 | clfReadSectorFile32
   893 000004EC 3C3A                    	cmp al, ':'
   894 000004EE 7449                    	je @F
   895 000004F0 3C3D                    	cmp al, '='
   896 000004F2 7445                    	je @F
   897                                  
   898 000004F4 86C4                    	xchg al, ah
   899 000004F6 AC                      	lodsb
   900 000004F7 86C4                    	xchg al, ah
   901 000004F9 BF[2408]                	mov di, cmd_line_readsector12_file.name
   902 000004FC BA8000                  	mov dx, clfReadSectorFile12
   903 000004FF 3D3132                  	cmp ax, "12"
   904 00000502 7422                    	je .switch_s_check_equals
   905 00000504 BF[2808]                	mov di, cmd_line_readsector16_file.name
   906 00000507 BA0001                  	mov dx, clfReadSectorFile16
   907 0000050A 3D3136                  	cmp ax, "16"
   908 0000050D 7417                    	je .switch_s_check_equals
   909 0000050F BF[2C08]                	mov di, cmd_line_readsector32_file.name
   910 00000512 BA0002                  	mov dx, clfReadSectorFile32
   911 00000515 3D3332                  	cmp ax, "32"
   912 00000518 740C                    	je .switch_s_check_equals
   913                                  
   914 0000051A E9A5FB                  	jmp .switch_not_supported
   915                                  
   916                                  
   917                                  .switch_s_r_type:
   918 0000051D F7D2                    	not dx
   919 0000051F 2116[2008]              	and [cmd_line_flags], dx
   920 00000523 E965FE                  	jmp .loop_2
   921                                  
   922                                  
   923                                  .switch_s_check_equals:
   924 00000526 AC                      	lodsb
   925 00000527 E8933D                  	call uppercase
   926 0000052A 3C52                    	cmp al, 'R'
   927 0000052C 74EF                    	je .switch_s_r_type
   928 0000052E 3C3A                    	cmp al, ':'
   929 00000530 7407                    	je @F
   930 00000532 3C3D                    	cmp al, '='
   931 00000534 7403                    	je @F
   932                                  
   933 00000536 E989FB                  	jmp .switch_not_supported
   934                                  
   935                                  
   936                                  @@:
   937 00000539 0916[2008]              	or word [cmd_line_flags], dx
   938                                  @@:
   939 0000053D AC                      	lodsb
   940 0000053E 3C20                    	cmp al, 32
   941 00000540 74FB                    	je @B
   942 00000542 3C09                    	cmp al, 9
   943 00000544 74F7                    	je @B
   944                                  
   945 00000546 4E                      	dec si
   946 00000547 85FF                    	test di, di
   947 00000549 7404                    	jz @F
   948 0000054B 8935                    	mov word [di], si
   949 0000054D EB0C                    	jmp @FF
   950                                  
   951                                  @@:
   952 0000054F 8936[2408]              	mov word [cmd_line_readsector12_file.name], si
   953 00000553 8936[2808]              	mov word [cmd_line_readsector16_file.name], si
   954 00000557 8936[2C08]              	mov word [cmd_line_readsector32_file.name], si
   955                                  @@:
   956 0000055B E82401                  	call process_switch_filename
   957 0000055E E9D2FA                  	jmp .loop_got_byte
   958                                  
   959                                  
   960                                  .switch_m:
   961 00000561 AC                      	lodsb
   962 00000562 E8583D                  	call uppercase
   963 00000565 3C4E                    	cmp al, 'N'
   964 00000567 7427                    	je .switch_mn
   965 00000569 3C53                    	cmp al, 'S'
   966 0000056B 742B                    	je .switch_ms
   967 0000056D 3C4F                    	cmp al, 'O'
   968 0000056F 747B                    	je .switch_mo
   969 00000571 3C3A                    	cmp al, ':'
   970 00000573 7407                    	je @F
   971 00000575 3C3D                    	cmp al, '='
   972 00000577 7403                    	je @F
   973 00000579 E946FB                  	jmp .switch_not_supported
   974                                  
   975                                  @@:
   976 0000057C AC                      	lodsb
   977 0000057D 3C20                    	cmp al, 32
   978 0000057F 74FB                    	je @B
   979 00000581 3C09                    	cmp al, 9
   980 00000583 74F7                    	je @B
   981 00000585 4E                      	dec si
   982 00000586 8936[3808]              	mov word [cmd_line_image_file.name], si
   983 0000058A E8F500                  	call process_switch_filename
   984 0000058D E9A3FA                  	jmp .loop_got_byte
   985                                  
   986                                  .switch_mn:
   987 00000590 8326[3808]00            	and word [cmd_line_image_file.name], 0
   988 00000595 E99AFA                  	jmp .loop
   989                                  
   990                                  .switch_ms:
   991 00000598 AC                      	lodsb
   992 00000599 3C3A                    	cmp al, ':'
   993 0000059B 7407                    	je @F
   994 0000059D 3C3D                    	cmp al, '='
   995 0000059F 7403                    	je @F
   996 000005A1 E9D800                  	jmp .error
   997                                  
   998                                  @@:
   999 000005A4 AC                      	lodsb
  1000 000005A5 3C30                    	cmp al, '0'
  1001 000005A7 750B                    	jne @F
  1002 000005A9 AC                      	lodsb
  1003 000005AA E8103D                  	call uppercase
  1004 000005AD 3C58                    	cmp al, 'X'
  1005 000005AF 7408                    	je .switch_ms.hex
  1006 000005B1 4E                      	dec si
  1007 000005B2 4E                      	dec si
  1008 000005B3 AC                      	lodsb
  1009                                  @@:
  1010 000005B4 E8113D                  	call get_decimal_literal
  1011 000005B7 EB03                    	jmp @F
  1012                                  
  1013                                  .switch_ms.hex:
  1014 000005B9 E8143D                  	call get_hexadecimal_literal
  1015                                  @@:
  1016 000005BC 85DB                    	test bx, bx
  1017 000005BE 7403E9B900              	jnz .error
  1018 000005C3 81FA0020                	cmp dx, 8192
  1019 000005C7 7403E9B000              	jne .error
  1020 000005CC BB2000                  	mov bx, 32
  1021 000005CF 39DA                    	cmp dx, bx
  1022 000005D1 7303E9A600              	jb .error
  1023                                  @@:
  1024 000005D6 39DA                    	cmp dx, bx
  1025 000005D8 740B                    	je @F
  1026 000005DA 01DB                    	add bx, bx
  1027 000005DC 81FB0020                	cmp bx, 8192
  1028 000005E0 76F4                    	jbe @B
  1029 000005E2 E99700                  	jmp .error
  1030                                  
  1031                                  @@:
  1032 000005E5 8916[1008]              	mov word [m_sector_size], dx
  1033 000005E9 E946FA                  	jmp .loop
  1034                                  
  1035                                  
  1036                                  .switch_mo:
  1037 000005EC AC                      	lodsb
  1038 000005ED E8CD3C                  	call uppercase
  1039 000005F0 3C53                    	cmp al, 'S'
  1040 000005F2 BF[1008]                	mov di, m_sector_size
  1041 000005F5 7412                    	je @F
  1042 000005F7 3C4B                    	cmp al, 'K'
  1043 000005F9 BF[1808]                	mov di, m_1024
  1044 000005FC 740B                    	je @F
  1045 000005FE 3C4D                    	cmp al, 'M'
  1046 00000600 BF[1C08]                	mov di, m_1024_times_1024
  1047 00000603 7404                    	je @F
  1048 00000605 BF[1408]                	mov di, m_1
  1049 00000608 A8                      	db __TEST_IMM8
  1050                                  @@:
  1051 00000609 AC                      	lodsb
  1052 0000060A 3C3A                    	cmp al, ':'
  1053 0000060C 7406                    	je @F
  1054 0000060E 3C3D                    	cmp al, '='
  1055 00000610 7402                    	je @F
  1056 00000612 EB68                    	jmp .error
  1057                                  
  1058                                  @@:
  1059 00000614 57                      	push di
  1060 00000615 AC                      	lodsb
  1061 00000616 3C30                    	cmp al, '0'
  1062 00000618 750B                    	jne @F
  1063 0000061A AC                      	lodsb
  1064 0000061B E89F3C                  	call uppercase
  1065 0000061E 3C58                    	cmp al, 'X'
  1066 00000620 7408                    	je .switch_mo.hex
  1067 00000622 4E                      	dec si
  1068 00000623 4E                      	dec si
  1069 00000624 AC                      	lodsb
  1070                                  @@:
  1071 00000625 E8A03C                  	call get_decimal_literal
  1072 00000628 EB03                    	jmp @F
  1073                                  
  1074                                  .switch_mo.hex:
  1075 0000062A E8A33C                  	call get_hexadecimal_literal
  1076                                  @@:
  1077 0000062D 5F                      	pop di
  1078 0000062E 56                      	push si
  1079 0000062F BE[0808]                	mov si, m_offset
  1080 00000632 87D3                    	xchg dx, bx
  1081 00000634 93                      	xchg ax, bx
  1082 00000635 E80400                  	call multiply_dxax_dword_di_to_qword_si
  1083 00000638 5E                      	pop si
  1084 00000639 E9F6F9                  	jmp .loop
  1085                                  
  1086                                  
  1087                                  multiply_dxax_dword_di_to_qword_si: equ $
  1088 0000063C 50                      	push ax
  1089 0000063D 89D0                    	mov ax, dx
  1090 0000063F 52                      	push dx
  1091 00000640 F76502                  	mul word [di + 2]		; high times high
  1092 00000643 894404                  	mov word [si + 4], ax
  1093 00000646 895406                  	mov word [si + 6], dx
  1094 00000649 58                      	pop ax
  1095 0000064A F725                    	mul word [di]			; high times low
  1096 0000064C 894402                  	mov word [si + 2], ax
  1097 0000064F 015404                  	add word [si + 4], dx
  1098 00000652 83540600                	adc word [si + 6], 0		; (NC)
  1099 00000656 58                      	pop ax
  1100 00000657 50                      	push ax
  1101 00000658 F76502                  	mul word [di + 2]		; low times high
  1102 0000065B 014402                  	add word [si + 2], ax
  1103 0000065E 115404                  	adc word [si + 4], dx
  1104 00000661 83540600                	adc word [si + 6], 0		; (NC)
  1105 00000665 58                      	pop ax
  1106 00000666 F725                    	mul word [di]			; low times low
  1107 00000668 8904                    	mov word [si], ax
  1108 0000066A 015402                  	add word [si + 2], dx
  1109 0000066D 83540400                	adc word [si + 4], 0
  1110 00000671 83540600                	adc word [si + 6], 0		; (NC)
  1111 00000675 C3                      	retn
  1112                                  
  1113                                  
  1114                                  .error_multiple_drives:
  1115 00000676 BA[7F53]                	mov dx, msg.error_multiple_drives
  1116 00000679 E949FA                  	jmp disp_error
  1117                                  
  1118                                  .error:
  1119 0000067C BA[5553]                	mov dx, msg.invalid_argument
  1120 0000067F E943FA                  	jmp disp_error
  1121                                  
  1122                                  
  1123                                  process_switch_filename:
  1124 00000682 89F3                    	mov bx, si		; -> start of name
  1125 00000684 89F7                    	mov di, si		; -> start of name
  1126 00000686 AC                      	lodsb			; load character
  1127 00000687 E8F63B                  	call iseol?
  1128 0000068A 7506                    	jne @F
  1129 0000068C BA[6F5C]                	mov dx, msg.switch_requires_filename
  1130                                  .disp_error_1:
  1131 0000068F E933FA                  	jmp disp_error
  1132                                  
  1133                                  @@:
  1134                                  .unquoted_loop:
  1135 00000692 3C20                    	cmp al, 32		; blank or EOL outside quoted part ?
  1136 00000694 7411                    	je .blank
  1137 00000696 3C09                    	cmp al, 9
  1138 00000698 740D                    	je .blank
  1139 0000069A E8E33B                  	call iseol?
  1140 0000069D 7408                    	je .blank		; yes -->
  1141 0000069F 3C22                    	cmp al, '"'		; starting quote mark ?
  1142 000006A1 7416                    	je .quoted		; yes -->
  1143 000006A3 AA                      	stosb			; store character
  1144                                  .unquote:
  1145 000006A4 AC                      	lodsb			; load character
  1146 000006A5 EBEB                    	jmp .unquoted_loop	; continue in not-quoted loop -->
  1147                                  
  1148                                  .blank:
  1149                                  	; mov byte [si - 1], 0	; terminate (shouldn't be needed)
  1150 000006A7 C60500                  	mov byte [di], 0	; terminate
  1151 000006AA 39FB                    	cmp bx, di		; empty ?
  1152 000006AC 740E                    	je .empty		; yes -->
  1153 000006AE C3                      	retn			; done
  1154                                  
  1155                                  .quoted_loop:
  1156 000006AF E8CE3B                  	call iseol?		; EOL inside quoted part ?
  1157 000006B2 740D                    	je .quoted_eol		; if yes, error -->
  1158 000006B4 3C22                    	cmp al, '"'		; ending quote mark ?
  1159 000006B6 74EC                    	je .unquote		; yes -->
  1160 000006B8 AA                      	stosb			; store character
  1161                                  .quoted:
  1162 000006B9 AC                      	lodsb			; load character
  1163 000006BA EBF3                    	jmp .quoted_loop	; continue in quoted loop -->
  1164                                  
  1165                                  .empty:
  1166 000006BC BA[B55C]                	mov dx, msg.switch_filename_empty
  1167 000006BF EBCE                    	jmp .disp_error_1
  1168                                  
  1169                                  .quoted_eol:
  1170 000006C1 BA[8D5C]                	mov dx, msg.switch_filename_missing_unquote
  1171 000006C4 EBC9                    	jmp .disp_error_1
  1172                                  
  1173                                  
  1174                                  cmd_line_end:
  1175 000006C6 803E[5A46]FF            	cmp byte [drivenumber], -1
  1176 000006CB 750D                    	jne @F
  1177 000006CD 833E[3808]00            	cmp word [cmd_line_image_file.name], 0
  1178 000006D2 7513                    	jne @FF
  1179 000006D4 BA[6953]                	mov dx, msg.no_drive_specified
  1180 000006D7 E9EBF9                  	jmp disp_error
  1181                                  
  1182                                  @@:
  1183 000006DA 833E[3808]00            	cmp word [cmd_line_image_file.name], 0
  1184 000006DF 7406                    	je @F
  1185 000006E1 BA[9C53]                	mov dx, msg.drive_and_image_specified
  1186 000006E4 E9DEF9                  	jmp disp_error
  1187                                  
  1188                                  @@:
  1189 000006E7 F606[2008]40            	testopt [cmd_line_flags], clfWriteInfoToSectorFile
  1190 000006EC 740D                    	jz @F
  1191 000006EE F606[2008]01            	testopt [cmd_line_flags], clfWriteSectorToFile
  1192 000006F3 7506                    	jnz @F
  1193                                  
  1194 000006F5 BA[BC53]                	mov dx, msg.no_sector_file_specified
  1195 000006F8 E9CAF9                  	jmp disp_error
  1196                                  
  1197                                  @@:
  1198                                  
  1199                                  detect_fat_type:
  1200 000006FB BB[8028]                	mov bx, second_sector_buffer	; will be used for ld/lsv/bpb
  1201 000006FE 89DD                    	mov bp, bx
  1202 00000700 53                      	push bx
  1203                                  
  1204 00000701 E8E15F                  	call initialise			; uses first_sector_buffer
  1205                                  					;  for size detection
  1206 00000704 7303E9800A              	jc exit_error
  1207                                  
  1208 00000709 5B                      	pop bx
  1209 0000070A 31C0                    	xor ax, ax
  1210 0000070C 31D2                    	xor dx, dx
  1211 0000070E 8A0E[5A46]              	mov cl, [drivenumber]
  1212 00000712 E8E93E                  	call read_ae_512_bytes		; load partition boot sector
  1213 00000715 7303E96F0A              	jc exit_error
  1214                                  		; 2nd buffer = boot sector original
  1215                                  
  1216 0000071A BA[EC53]                	mov dx, msg.bootfail_sig
  1217 0000071D 81BEFE0155AA            	cmp word [bp + 510], 0AA55h
  1218 00000723 751A                    	jne .disp_error_1
  1219                                  
  1220 00000725 8B5EDC                  	mov bx, [bp + ldBytesPerSector]
  1221 00000728 3B5E0B                  	cmp bx, [bp + bsBPB + bpbBytesPerSector]
  1222 0000072B BA[7F54]                	mov dx, msg.bootfail_secsizediffer
  1223 0000072E 750F                    	jne .disp_error_1
  1224                                  
  1225 00000730 81FB0002                	cmp bx, 512
  1226 00000734 7618                    	jbe @FF
  1227 00000736 81FB0004                	cmp bx, 1024
  1228 0000073A 7306                    	jae @F
  1229 0000073C BA[5054]                	mov dx, msg.bootfail_secsizeinvalid
  1230                                  .disp_error_1:
  1231 0000073F E983F9                  	jmp disp_error
  1232                                  @@:
  1233 00000742 89DF                    	mov di, bx
  1234 00000744 817BFE55AA              	cmp word [bp + di - 2], 0AA55h
  1235 00000749 BA[1C54]                	mov dx, msg.bootfail_sig2
  1236 0000074C 75F1                    	jne .disp_error_1
  1237                                  @@:
  1238                                  
  1239 0000074E BE[8028]                	mov si, second_sector_buffer
  1240 00000751 BF[8048]                	mov di, third_sector_buffer_512_bytes
  1241 00000754 B90001                  	mov cx, 512 >> 1
  1242 00000757 F3A5                    	rep movsw
  1243                                  		; 3rd buffer = copy of first 512 B of 2nd buffer
  1244                                  		;  (boot sector original) prior to BPBN move
  1245                                  
  1246 00000759 31C0                    	xor ax, ax
  1247 0000075B 394616                  	cmp word [bp + bsBPB + bpbSectorsPerFAT], ax
  1248 0000075E 740B                    	je @F					; is FAT32 -->
  1249 00000760 BE[A428]                	mov si, second_sector_buffer + bsBPB + bpbNew
  1250 00000763 BF[C028]                	mov di, second_sector_buffer + bsBPB + ebpbNew
  1251 00000766 B91A00                  	mov cx, BPBN_size
  1252 00000769 F3A4                    	rep movsb				; clone the FAT16 / FAT12 BPBN
  1253                                  						; to where the FAT32 BPBN lives
  1254                                  @@:
  1255                                  		; 2nd buffer = ld/lsv/bpb with BPBN moved
  1256                                  
  1257                                  
  1258                                  ; (boot.asm code starts here)
  1259                                  
  1260 0000076B 31C0                    	xor ax, ax
  1261                                  ; calculate some values that we need:
  1262                                  ; adjusted sectors per cluster (store in a word,
  1263                                  ;  and decode EDR-DOS's special value 0 meaning 256)
  1264 0000076D 8A460D                  	mov al, [bp + bsBPB + bpbSectorsPerCluster]
  1265 00000770 FEC8                    	dec al
  1266 00000772 40                      	inc ax
  1267 00000773 8946E8                  	mov [bp + ldClusterSize], ax
  1268                                  
  1269 00000776 8B46D4                  	mov ax, [bp + ldEntriesPerSector]
  1270                                  
  1271                                  ; number of sectors used for root directory (store in CX)
  1272 00000779 31D2                    	xor dx, dx
  1273 0000077B 89C3                    	mov bx, ax
  1274 0000077D 48                      	dec ax				; rounding up
  1275 0000077E 034611                  	add ax, [bp + bsBPB + bpbNumRootDirEnts]	; (0 iff FAT32)
  1276 00000781 11D2                    	adc dx, dx			; account for overflow (dx was zero)
  1277 00000783 F7F3                    	div bx				; get number of root sectors
  1278 00000785 91                      	xchg ax, cx			; cx = number of root secs
  1279                                  
  1280                                  
  1281                                  ; (iniload.asm code starts here)
  1282                                  
  1283 00000786 51                      	push cx				; number of root secs
  1284 00000787 31C0                    	xor ax, ax
  1285                                  ; first sector of root directory
  1286 00000789 8A4610                  	mov al, [bp + bsBPB + bpbNumFATs]	; ! ah = 0, hence ax = number of FATs
  1287 0000078C 8B4E16                  	mov cx, word [bp + bsBPB + bpbSectorsPerFAT]
  1288 0000078F 31FF                    	xor di, di			; di:cx = sectors per FAT
  1289                                  					;  iff FAT12, FAT16
  1290 00000791 85C9                    	test cx, cx			; is FAT32 ?
  1291 00000793 7506                    	jnz @F				; no -->
  1292 00000795 8B4E24                  	mov cx, word [bp + bsBPB + ebpbSectorsPerFATLarge]
  1293 00000798 8B7E26                  	mov di, word [bp + bsBPB + ebpbSectorsPerFATLarge + 2]	; for FAT32
  1294                                  @@:
  1295 0000079B 50                      	push ax
  1296 0000079C F7E1                    	mul cx
  1297                                  		; ax = low word SpF*nF
  1298                                  		; dx = high word
  1299 0000079E 93                      	xchg bx, ax
  1300 0000079F 87CA                    	xchg cx, dx
  1301                                  		; cx:bx = first mul
  1302 000007A1 58                      	pop ax
  1303 000007A2 F7E7                    	mul di
  1304                                  		; ax = high word adjust
  1305                                  		; dx = third word
  1306 000007A4 85D2                    	test dx, dx
  1307 000007A6 7406                    	jz @F
  1308                                  error_badchain: equ $
  1309 000007A8 BA[C454]                	mov dx, msg.boot_badchain
  1310 000007AB E917F9                  	jmp disp_error
  1311                                  
  1312                                  @@:
  1313 000007AE 92                      	xchg dx, ax
  1314                                  		; dx = high word adjust
  1315 000007AF 01CA                    	add dx, cx
  1316                                  		; dx:bx = result
  1317 000007B1 72F5                    	jc error_badchain
  1318 000007B3 93                      	xchg ax, bx
  1319                                  		; dx:ax = result
  1320 000007B4 72F2                    	jc error_badchain
  1321                                  
  1322 000007B6 03460E                  	add ax, [bp + bsBPB + bpbReservedSectors]
  1323 000007B9 83D200                  	adc dx, byte 0
  1324 000007BC 72EA                    	jc error_badchain
  1325                                  
  1326 000007BE 59                      	pop cx				; number of root sectors
  1327 000007BF 31FF                    	xor di, di
  1328                                  
  1329                                  ; first sector of disk data area:
  1330 000007C1 01C1                    	add cx, ax
  1331 000007C3 11D7                    	adc di, dx
  1332 000007C5 72E1                    	jc error_badchain
  1333 000007C7 894EFC                  	mov [bp + lsvDataStart], cx
  1334 000007CA 897EFE                  	mov [bp + lsvDataStart + 2], di
  1335                                  
  1336 000007CD 8946D0                  	mov [bp + ldRootSector], ax
  1337 000007D0 8956D2                  	mov [bp + ldRootSector + 2], dx
  1338                                  
  1339                                  ; total sectors
  1340 000007D3 31D2                    	xor dx, dx
  1341 000007D5 8B4613                  	mov ax, [bp + bsBPB + bpbTotalSectors]
  1342 000007D8 85C0                    	test ax, ax
  1343 000007DA 7506                    	jnz @F
  1344 000007DC 8B5622                  	mov dx, [bp + bsBPB + bpbTotalSectorsLarge + 2]
  1345 000007DF 8B4620                  	mov ax, [bp + bsBPB + bpbTotalSectorsLarge]
  1346                                  
  1347                                  		; fall through and let it overwrite the field with the
  1348                                  		; already current contents. saves a jump.
  1349                                  @@:
  1350                                  	; mov [bp + bsBPB + bpbTotalSectorsLarge + 2], dx
  1351                                  	; mov [bp + bsBPB + bpbTotalSectorsLarge], ax
  1352                                  		; Do not modify BPB, as we initialise the
  1353                                  		;  sector with this copy eventually.
  1354                                  		;  It is arguably more correct for this to
  1355                                  		;  read zero when not in use. By preserving
  1356                                  		;  the original value this is enabled.
  1357                                  
  1358                                  	; dx:ax = total sectors
  1359                                  
  1360 000007E2 8B5E16                  	mov bx, [bp + bsBPB + bpbSectorsPerFAT]
  1361 000007E5 C646E620                	mov byte [bp + ldFATType], 32
  1362 000007E9 85DB                    	test bx, bx
  1363 000007EB 7439                    	jz .gotfattype
  1364                                  
  1365 000007ED 31C9                    	xor cx, cx
  1366                                  
  1367 000007EF 895E24                  	mov word [bp + bsBPB + ebpbSectorsPerFATLarge], bx
  1368 000007F2 894E26                  	mov word [bp + bsBPB + ebpbSectorsPerFATLarge + 2], cx
  1369 000007F5 894E28                  	mov word [bp + bsBPB + ebpbFSFlags], cx
  1370                                  	; FSVersion, RootCluster, FSINFOSector, BackupSector, Reserved:
  1371                                  	;  uninitialised here (initialised by loaded_all later)
  1372                                  
  1373                                  	; dx:ax = total amount of sectors
  1374 000007F8 2B46FC                  	sub ax, word [bp + lsvDataStart]
  1375 000007FB 1B56FE                  	sbb dx, word [bp + lsvDataStart + 2]
  1376                                  
  1377                                  	; dx:ax = total amount of data sectors
  1378 000007FE 89C3                    	mov bx, ax
  1379 00000800 92                      	xchg ax, dx
  1380 00000801 31D2                    	xor dx, dx
  1381 00000803 F776E8                  	div word [bp + ldClusterSize]
  1382 00000806 93                      	xchg bx, ax
  1383 00000807 F776E8                  	div word [bp + ldClusterSize]
  1384                                  	; bx:ax = quotient, dx = remainder
  1385                                  	; bx:ax = number of clusters
  1386 0000080A 85DB                    	test bx, bx
  1387 0000080C 7406                    	jz @F
  1388                                  .badclusters:
  1389 0000080E BA[AA54]                	mov dx, msg.boot_badclusters
  1390 00000811 E9B1F8                  	jmp disp_error
  1391                                  
  1392                                  @@:
  1393 00000814 83F8F5                  	cmp ax, 0FFF7h - 2
  1394 00000817 77F5                    	ja .badclusters
  1395 00000819 C646E610                	mov byte [bp + ldFATType], 16
  1396 0000081D 3DF50F                  	cmp ax, 0FF7h - 2
  1397 00000820 7704                    	ja .gotfattype
  1398                                  
  1399 00000822 C646E60C                	mov byte [bp + ldFATType], 12
  1400                                  .gotfattype:
  1401                                  
  1402 00000826 BA[6F56]                	mov dx, msg.is_fat16
  1403                                  %if _FAT16
  1404 00000829 BE[0002]                	mov si, fat16_payload
  1405                                  %else
  1406                                  	mov si, 0			; (preserve flags)
  1407                                  %endif
  1408 0000082C 807EE610                	cmp byte [bp + ldFATType], 16
  1409 00000830 740E                    	je @F
  1410 00000832 BA[5A56]                	mov dx, msg.is_fat12
  1411                                  %if _FAT12
  1412 00000835 BE[0000]                	mov si, fat12_payload
  1413                                  %else
  1414                                  	mov si, 0			; (preserve flags)
  1415                                  %endif
  1416 00000838 7206                    	jb @F
  1417 0000083A BA[8456]                	mov dx, msg.is_fat32
  1418                                  %if _FAT32
  1419 0000083D BE[0004]                	mov si, fat32_payload
  1420                                  %else
  1421                                  	mov si, 0			; (preserve flags)
  1422                                  %endif
  1423                                  @@:
  1424 00000840 E83E3B                  	call disp_msg_asciz
  1425                                  
  1426                                  %if !_FAT32 || !_FAT16 || !_FAT12
  1427                                  	test si, si
  1428                                  	jnz @FF
  1429                                  
  1430                                  	testopt [cmd_line_flags], clfLeaveSector | clfSectorFromCopy
  1431                                  	jnz @FF
  1432                                  
  1433                                  	mov dx, clfReadSectorFile12
  1434                                  	cmp byte [bp + ldFATType], 16
  1435                                  	jb @F
  1436                                  	mov dx, clfReadSectorFile16
  1437                                  	je @F
  1438                                  	mov dx, clfReadSectorFile32
  1439                                  @@:
  1440                                  	test word [cmd_line_flags], dx
  1441                                  	jnz @F
  1442                                  
  1443                                  	mov dx, msg.not_supported_fat_type
  1444                                  	jmp disp_error
  1445                                  
  1446                                  @@:
  1447                                  %endif
  1448                                  
  1449                                  
  1450                                  detect_fsinfo_sector_replace:
  1451 00000843 C646E700                	mov byte [bp + ldHasLBA], 0	; 2 clear: not FSINFO
  1452                                  %if _FAT32_TWO_SECTORS
  1453 00000847 81FE[0004]              	cmp si, fat32_payload
  1454 0000084B 7528                    	jne .not_fat32
  1455                                  
  1456 0000084D 804EE704                	or byte [bp + ldHasLBA], 4	; 4 set: large sector
  1457                                  
  1458 00000851 817EDC0004              	cmp word [bp + ldBytesPerSector], 1024
  1459 00000856 731D                    	jae .fat32_larger_sector
  1460                                  		; Because we checked that the sector size is a power of two,
  1461                                  		;  we can assume here that sectors are 512 bytes or less.
  1462                                  
  1463 00000858 BA[A855]                	mov dx, msg.not_yet_non_fsinfo
  1464                                  
  1465 0000085B 81BC00025252            	cmp word [si + 512 + FSINFO.signature1], "RR"
  1466 00000861 7403E95FF8              	jne disp_error
  1467 00000866 81BC02026141            	cmp word [si + 512 + FSINFO.signature1 + 2], "aA"
  1468 0000086C 7403E954F8              	jne disp_error
  1469                                  
  1470 00000871 804EE702                	or byte [bp + ldHasLBA], 2	; 2 set: FSINFO
  1471                                  %endif
  1472                                  .not_fat32:
  1473                                  .fat32_larger_sector:
  1474                                  
  1475                                  
  1476                                  detect_backup:
  1477 00000875 807EE620                	cmp byte [bp + ldFATType], 32
  1478 00000879 722E                    	jb .none
  1479 0000087B BA[645E]                	mov dx, msg.no_backup
  1480 0000087E 31DB                    	xor bx, bx
  1481 00000880 8B4632                  	mov ax, word [bp + bsBPB + ebpbBackupSector]
  1482 00000883 85C0                    	test ax, ax
  1483 00000885 741B                    	jz .done
  1484 00000887 3B460E                  	cmp ax, word [bp + bsBPB + bpbReservedSectors]
  1485 0000088A 7316                    	jae .done
  1486                                  
  1487 0000088C BA[7F5E]                	mov dx, msg.backup_no_info
  1488 0000088F BB1000                  	mov bx, detectedcopysector
  1489 00000892 034630                  	add ax, word [bp + bsBPB + ebpbFSINFOSector]
  1490 00000895 720B                    	jc .done
  1491 00000897 3B460E                  	cmp ax, word [bp + bsBPB + bpbReservedSectors]
  1492 0000089A 7306                    	jae .done
  1493                                  
  1494 0000089C BA[4C5E]                	mov dx, msg.backup
  1495 0000089F BB3000                  	mov bx, detectedcopysector | detectedcopyinfo
  1496                                  .done:
  1497 000008A2 E8DC3A                  	call disp_msg_asciz
  1498 000008A5 091E[4446]              	or word [internalflags], bx
  1499                                  
  1500                                  .none:
  1501                                  
  1502                                  
  1503                                  prepare_sector:
  1504 000008A9 F606[2208]02            	testopt [cmd_line_flags], clfSectorFromCopy
  1505 000008AE 742A                    	jz @F
  1506                                  
  1507 000008B0 F606[4446]10            	testopt [internalflags], detectedcopysector
  1508 000008B5 7506                    	jnz .sector_from_copy
  1509 000008B7 BA[9B5F]                	mov dx, msg.missing_backup_sector
  1510 000008BA E908F8                  	jmp disp_error
  1511                                  
  1512                                  .sector_from_copy:
  1513 000008BD BA[FF5F]                	mov dx, msg.copy_sector
  1514 000008C0 E8BE3A                  	call disp_msg_asciz
  1515 000008C3 31D2                    	xor dx, dx
  1516 000008C5 BB[4008]                	mov bx, first_sector_buffer
  1517 000008C8 8B4632                  	mov ax, word [bp + bsBPB + ebpbBackupSector]
  1518 000008CB 8A0E[5A46]              	mov cl, [drivenumber]
  1519 000008CF E82C3D                  	call read_ae_512_bytes		; load boot sector from backup copy
  1520 000008D2 7303E9B208              	jc exit_error
  1521 000008D7 E90301                  	jmp .got_sector_buffer
  1522                                  
  1523                                  @@:
  1524 000008DA F606[2208]01            	testopt [cmd_line_flags], clfLeaveSector
  1525 000008DF 742A                    	jz @F
  1526                                  
  1527 000008E1 BA[2960]                	mov dx, msg.leave_sector
  1528 000008E4 E89A3A                  	call disp_msg_asciz
  1529                                  		; Copy over original 512-byte sector buffer content.
  1530 000008E7 B90002                  	mov cx, 512
  1531 000008EA BF[4008]                	mov di, first_sector_buffer
  1532 000008ED BE[8048]                	mov si, third_sector_buffer_512_bytes
  1533 000008F0 B90001                  	mov cx, 512 >> 1
  1534 000008F3 F3A5                    	rep movsw
  1535                                  		; 1st buffer = copy of 3rd buffer
  1536                                  		;  (first 512 B of boot sector original)
  1537                                  
  1538                                  		; Copy over big sector excess from buffer.
  1539 000008F5 BE[802A]                	mov si, second_sector_buffer + 512
  1540 000008F8 8B4EDC                  	mov cx, [bp + ldBytesPerSector]
  1541 000008FB 81E90002                	sub cx, 512
  1542 000008FF 7703E9D900              	jbe .got_sector_buffer
  1543 00000904 D1E9                    	shr cx, 1
  1544 00000906 F3A5                    	rep movsw
  1545                                  		; 1st buffer = boot sector original
  1546 00000908 E9D200                  	jmp .got_sector_buffer
  1547                                  
  1548                                  @@:
  1549 0000090B BF[2408]                	mov di, cmd_line_readsector12_file
  1550 0000090E BA8000                  	mov dx, clfReadSectorFile12
  1551 00000911 807EE610                	cmp byte [bp + ldFATType], 16
  1552 00000915 720E                    	jb @F
  1553 00000917 BF[2808]                	mov di, cmd_line_readsector16_file
  1554 0000091A BA0001                  	mov dx, clfReadSectorFile16
  1555 0000091D 7406                    	je @F
  1556 0000091F BF[2C08]                	mov di, cmd_line_readsector32_file
  1557 00000922 BA0002                  	mov dx, clfReadSectorFile32
  1558                                  @@:
  1559 00000925 8516[2008]              	test word [cmd_line_flags], dx
  1560 00000929 7503E9A100              	jz .replace_internal
  1561 0000092E BA[6660]                	mov dx, msg.replace_sector_file
  1562 00000931 E84D3A                  	call disp_msg_asciz
  1563                                  
  1564                                  		; di -> file structure
  1565 00000934 E86808                  	call open_file_read
  1566 00000937 7303E94D08              	jc exit_error
  1567                                  
  1568 0000093C B80242                  	mov ax, 4202h
  1569 0000093F 31C9                    	xor cx, cx
  1570 00000941 31D2                    	xor dx, dx
  1571 00000943 CD21                    	int 21h
  1572 00000945 7309                    	jnc @F
  1573 00000947 BA[A861]                	mov dx, msg.error_file_seek
  1574 0000094A E83509                  	call disp_dos_error
  1575 0000094D E93908                  	jmp exit_error
  1576                                  
  1577                                  @@:
  1578 00000950 85D2                    	test dx, dx
  1579 00000952 7510                    	jnz .wrong_size
  1580 00000954 3D0002                  	cmp ax, 512
  1581 00000957 7411                    	je .ok_size
  1582 00000959 3D0004                  	cmp ax, 1024
  1583 0000095C 7506                    	jne .wrong_size
  1584 0000095E 807EE620                	cmp byte [bp + ldFATType], 32
  1585 00000962 7406                    	je .ok_size
  1586                                  
  1587                                  .wrong_size:
  1588 00000964 BA[E355]                	mov dx, msg.wrong_size
  1589 00000967 E95BF7                  	jmp disp_error
  1590                                  
  1591                                  
  1592                                  .ok_size:
  1593 0000096A 50                      	push ax
  1594                                  
  1595 0000096B B80042                  	mov ax, 4200h
  1596 0000096E 31C9                    	xor cx, cx
  1597 00000970 31D2                    	xor dx, dx
  1598 00000972 CD21                    	int 21h
  1599 00000974 7309                    	jnc @F
  1600 00000976 BA[A861]                	mov dx, msg.error_file_seek
  1601 00000979 E80609                  	call disp_dos_error
  1602 0000097C E90A08                  	jmp exit_error
  1603                                  
  1604                                  @@:
  1605 0000097F 59                      	pop cx
  1606 00000980 BA[4008]                	mov dx, first_sector_buffer
  1607 00000983 89D6                    	mov si, dx
  1608 00000985 B43F                    	mov ah, 3Fh
  1609 00000987 CD21                    	int 21h			; read file
  1610 00000989 7207                    	jc @F
  1611 0000098B 39C8                    	cmp ax, cx
  1612 0000098D B8FFFF                  	mov ax, -1
  1613 00000990 7409                    	je @FF			; (NC) -->
  1614                                  @@:
  1615 00000992 BA[9361]                	mov dx, msg.error_file_read
  1616 00000995 E8EA08                  	call disp_dos_error
  1617 00000998 E9EE07                  	jmp exit_error
  1618                                  
  1619                                  @@:
  1620 0000099B C646E700                	mov byte [bp + ldHasLBA], 0	; 2 and 4 clear: not FSINFO, no large
  1621                                  
  1622 0000099F 81F90004                	cmp cx, 1024
  1623 000009A3 7228                    	jb .not_fat32_two_sectors
  1624                                  
  1625 000009A5 804EE704                	or byte [bp + ldHasLBA], 4	; 4 set: large sector
  1626                                  
  1627 000009A9 817EDC0004              	cmp word [bp + ldBytesPerSector], 1024
  1628 000009AE 731D                    	jae .fat32_larger_sector
  1629                                  		; Because we checked that the sector size is a power of two,
  1630                                  		;  we can assume here that sectors are 512 bytes or less.
  1631                                  
  1632 000009B0 BA[A855]                	mov dx, msg.not_yet_non_fsinfo
  1633                                  
  1634 000009B3 81BC00025252            	cmp word [si + 512 + FSINFO.signature1], "RR"
  1635 000009B9 7403E907F7              	jne disp_error
  1636 000009BE 81BC02026141            	cmp word [si + 512 + FSINFO.signature1 + 2], "aA"
  1637 000009C4 7403E9FCF6              	jne disp_error
  1638                                  
  1639 000009C9 804EE702                	or byte [bp + ldHasLBA], 2	; 2 set: FSINFO
  1640                                  
  1641                                  .fat32_larger_sector:
  1642                                  .not_fat32_two_sectors:
  1643 000009CD EB0E                    	jmp .replace_common
  1644                                  
  1645                                  
  1646                                  		; Copy over two sectors into the first_sector_buffer,
  1647                                  		;  for the case of FAT32 with two-sector loader and
  1648                                  		;  a sector size >= 1 KiB.
  1649                                  .replace_internal:
  1650 000009CF BA[4B60]                	mov dx, msg.replace_sector
  1651 000009D2 E8AC39                  	call disp_msg_asciz
  1652                                  
  1653 000009D5 B90002                  	mov cx, 1024 >> 1
  1654 000009D8 BF[4008]                	mov di, first_sector_buffer
  1655 000009DB F3A5                    	rep movsw
  1656                                  		; 1st buffer = 1024 bytes from internal replacement
  1657                                  
  1658                                  .replace_common:
  1659                                  .got_sector_buffer:
  1660                                  
  1661                                  
  1662                                  check_valid_sector:
  1663 000009DD BA[2758]                	mov dx, msg.sector_invalid_no_id
  1664 000009E0 BE[7857]                	mov si, msg.fat12sig
  1665 000009E3 BF[7608]                	mov di, first_sector_buffer + bsBPB + bpbNew + bpbnFilesystemID
  1666 000009E6 807EE610                	cmp byte [bp + ldFATType], 16
  1667 000009EA 720B                    	jb @F
  1668 000009EC BE[8057]                	mov si, msg.fat16sig
  1669 000009EF 7406                    	je @F
  1670 000009F1 BE[8857]                	mov si, msg.fat32sig
  1671 000009F4 BF[9208]                	mov di, first_sector_buffer + bsBPB + ebpbNew + bpbnFilesystemID
  1672                                  @@:
  1673 000009F7 B90400                  	mov cx, 4
  1674 000009FA F3A7                    	repe cmpsw
  1675 000009FC 7540                    	jne .invalid
  1676                                  
  1677 000009FE BA[9057]                	mov dx, msg.sector_invalid_no_jump
  1678 00000A01 BF[4008]                	mov di, first_sector_buffer
  1679 00000A04 8B4501                  	mov ax, word [di + 1]
  1680 00000A07 8D5D03                  	lea bx, [di + 3]
  1681 00000A0A 803DE9                  	cmp byte [di], 0E9h
  1682 00000A0D 740C                    	je .rel16
  1683 00000A0F 803DE8                  	cmp byte [di], 0E8h
  1684 00000A12 7407                    	je .rel16
  1685 00000A14 803DEB                  	cmp byte [di], 0EBh
  1686 00000A17 7525                    	jne .invalid
  1687                                  .rel8:
  1688 00000A19 4B                      	dec bx
  1689 00000A1A 98                      	cbw
  1690                                  .rel16:
  1691 00000A1B 01C3                    	add bx, ax
  1692 00000A1D BF[7E08]                	mov di, first_sector_buffer + bsBPB + bpbNew + BPBN_size
  1693 00000A20 807EE610                	cmp byte [bp + ldFATType], 16
  1694 00000A24 7603                    	jbe @F
  1695 00000A26 BF[9A08]                	mov di, first_sector_buffer + bsBPB + ebpbNew + BPBN_size
  1696                                  @@:
  1697 00000A29 BA[B757]                	mov dx, msg.sector_invalid_too_short_jump
  1698 00000A2C 39FB                    	cmp bx, di
  1699 00000A2E 720E                    	jb .invalid
  1700 00000A30 BA[D957]                	mov dx, msg.sector_invalid_too_long_jump
  1701 00000A33 81FB[3E0A]              	cmp bx, first_sector_buffer + 510
  1702 00000A37 7305                    	jae .invalid
  1703                                  
  1704 00000A39 BA[FA57]                	mov dx, msg.sector_valid
  1705 00000A3C EB12                    	jmp .valid
  1706                                  
  1707                                  .invalid:
  1708 00000A3E F606[2108]04            	testopt [cmd_line_flags], clfAllowInvalidSector
  1709 00000A43 7503E97DF6              	jz disp_error
  1710                                  
  1711 00000A48 52                      	push dx
  1712 00000A49 BA[4958]                	mov dx, msg.allowing_sector_invalid
  1713 00000A4C E83239                  	call disp_msg_asciz
  1714 00000A4F 5A                      	pop dx
  1715                                  
  1716                                  .valid:
  1717 00000A50 E82E39                  	call disp_msg_asciz
  1718                                  
  1719                                  
  1720                                  write_sector_oem:
  1721 00000A53 BE[4846]                	mov si, oemname
  1722 00000A56 BF[4308]                	mov di, first_sector_buffer + bsOEM
  1723 00000A59 B90400                  	mov cx, 4
  1724 00000A5C F606[2308]01            	testopt [cmd_line_flags], clfSetOEMName
  1725 00000A61 750B                    	jnz @F
  1726 00000A63 BE[8328]                	mov si, second_sector_buffer + bsOEM
  1727 00000A66 F606[2308]02            	testopt [cmd_line_flags], clfPreserveOEMName
  1728 00000A6B 7501                    	jnz @F
  1729 00000A6D A9                      	db __TEST_IMM16				; skip rep movsw
  1730                                  @@:
  1731 00000A6E F3A5                    	rep movsw
  1732                                  
  1733                                  
  1734                                  write_sector_bpb:
  1735 00000A70 BE[8B28]                	mov si, second_sector_buffer + bsBPB
  1736 00000A73 BF[4B08]                	mov di, first_sector_buffer + bsBPB
  1737 00000A76 807EE610                	cmp byte [bp + ldFATType], 16
  1738 00000A7A 7607                    	jbe @F					; if FAT12/FAT16 -->
  1739 00000A7C B93500                  	mov cx, ebpbNew
  1740 00000A7F F3A4                    	rep movsb				; move EBPB (minus BPBN)
  1741 00000A81 EB08                    	jmp @FF					; si -> BPBN
  1742                                  @@:
  1743 00000A83 B91900                  	mov cx, bpbNew				; move BPB
  1744 00000A86 F3A4                    	rep movsb
  1745 00000A88 83C61C                  	add si, ebpbNew - bpbNew		; si -> BPBN
  1746                                  @@:
  1747 00000A8B B91A00                  	mov cx, BPBN_size
  1748 00000A8E F3A4                    	rep movsb
  1749                                  		; 1st buffer = sector from whatever source plus
  1750                                  		;  the (E)BPB and BPBN from fs
  1751                                  
  1752                                  
  1753                                  prepare_fsinfo:
  1754 00000A90 F646E702                	test byte [bp + ldHasLBA], 2
  1755 00000A94 7503E9D900              	jz .no_fsinfo
  1756                                  
  1757 00000A99 8B4630                  	mov ax, word [bp + bsBPB + ebpbFSINFOSector]
  1758                                  
  1759 00000A9C BA[8E55]                	mov dx, msg.no_fsinfo
  1760 00000A9F 85C0                    	test ax, ax
  1761 00000AA1 7503E91FF6              	jz disp_error
  1762 00000AA6 3B460E                  	cmp ax, word [bp + bsBPB + bpbReservedSectors]
  1763 00000AA9 7203E917F6              	jae disp_error
  1764                                  
  1765 00000AAE 31D2                    	xor dx, dx
  1766 00000AB0 BB[802A]                	mov bx, second_sector_buffer + 512
  1767 00000AB3 8A0E[5A46]              	mov cl, [drivenumber]
  1768 00000AB7 E8443B                  	call read_ae_512_bytes		; load FSINFO sector
  1769 00000ABA 7303E9CA06              	jc exit_error
  1770                                  		; 2nd buffer 2nd 512 B has original FSINFO
  1771                                  
  1772 00000ABF F606[2208]20            	testopt [cmd_line_flags], clfInfoFromCopy
  1773 00000AC4 742D                    	jz @F
  1774                                  
  1775 00000AC6 F606[4446]20            	testopt [internalflags], detectedcopyinfo
  1776 00000ACB 7506                    	jnz .info_from_copy
  1777 00000ACD BA[CD5F]                	mov dx, msg.missing_backup_info
  1778 00000AD0 E9F2F5                  	jmp disp_error
  1779                                  
  1780                                  .info_from_copy:
  1781 00000AD3 BA[8B60]                	mov dx, msg.copy_info
  1782 00000AD6 E8A838                  	call disp_msg_asciz
  1783 00000AD9 31D2                    	xor dx, dx
  1784 00000ADB BB[400A]                	mov bx, first_sector_buffer + 512
  1785 00000ADE 8B4632                  	mov ax, word [bp + bsBPB + ebpbBackupSector]
  1786 00000AE1 034630                  	add ax, word [bp + bsBPB + ebpbFSINFOSector]
  1787 00000AE4 8A0E[5A46]              	mov cl, [drivenumber]
  1788 00000AE8 E8133B                  	call read_ae_512_bytes		; load FSINFO sector from backup copy
  1789 00000AEB 7303E99906              	jc exit_error
  1790 00000AF0 E97F00                  	jmp .no_fsinfo
  1791                                  
  1792                                  @@:
  1793                                  
  1794 00000AF3 F606[2208]40            	testopt [cmd_line_flags], clfZeroInfo
  1795 00000AF8 7433                    	jz @F
  1796                                  
  1797 00000AFA BA[AE60]                	mov dx, msg.zero_info
  1798 00000AFD E88138                  	call disp_msg_asciz
  1799                                  
  1800 00000B00 BF[400A]                	mov di, first_sector_buffer + 512
  1801 00000B03 B90001                  	mov cx, 512 >> 1
  1802 00000B06 31C0                    	xor ax, ax
  1803 00000B08 F3AB                    	rep stosw				; zero entire sector
  1804                                  
  1805 00000B0A BE[802A]                	mov si, second_sector_buffer + 512 + FSINFO.signature1
  1806 00000B0D B90200                  	mov cx, 4 >> 1
  1807 00000B10 BF[400A]                	mov di, first_sector_buffer + 512
  1808 00000B13 F3A5                    	rep movsw				; copy over first signature
  1809                                  
  1810 00000B15 BE[642C]                	mov si, second_sector_buffer + 512 + FSINFO.signature2
  1811 00000B18 BF[240C]                	mov di, first_sector_buffer + 512 + FSINFO.signature2
  1812 00000B1B B90600                  	mov cx, (FSINFO.reserved2 - FSINFO.signature2) >> 1
  1813 00000B1E F3A5                    	rep movsw				; copy signature and entries
  1814                                  
  1815 00000B20 BE[7C2C]                	mov si, second_sector_buffer + 512 + FSINFO.signature3
  1816 00000B23 BF[3C0C]                	mov di, first_sector_buffer + 512 + FSINFO.signature3
  1817 00000B26 B90200                  	mov cx, 4 >> 1
  1818 00000B29 F3A5                    	rep movsw				; copy final signature
  1819 00000B2B EB45                    	jmp .no_fsinfo
  1820                                  
  1821                                  @@:
  1822                                  
  1823 00000B2D F606[2208]10            	testopt [cmd_line_flags], clfLeaveInfo
  1824 00000B32 7413                    	jz @F
  1825                                  
  1826 00000B34 BA[D060]                	mov dx, msg.leave_info
  1827 00000B37 E84738                  	call disp_msg_asciz
  1828                                  
  1829                                  		; Copy over original FSINFO sector content.
  1830 00000B3A BE[802A]                	mov si, second_sector_buffer + 512
  1831 00000B3D BF[400A]                	mov di, first_sector_buffer + 512
  1832 00000B40 B90001                  	mov cx, 512 >> 1
  1833 00000B43 F3A5                    	rep movsw
  1834 00000B45 EB2B                    	jmp .no_fsinfo
  1835                                  
  1836                                  @@:
  1837 00000B47 BA8000                  	mov dx, clfReadSectorFile12
  1838 00000B4A 807EE610                	cmp byte [bp + ldFATType], 16
  1839 00000B4E 7208                    	jb @F
  1840 00000B50 BA0001                  	mov dx, clfReadSectorFile16
  1841 00000B53 7403                    	je @F
  1842 00000B55 BA0002                  	mov dx, clfReadSectorFile32
  1843                                  @@:
  1844 00000B58 8516[2008]              	test word [cmd_line_flags], dx
  1845 00000B5C BA[EB60]                	mov dx, msg.replace_info
  1846 00000B5F 7403                    	jz @F
  1847 00000B61 BA[0061]                	mov dx, msg.replace_info_file
  1848                                  @@:
  1849 00000B64 E81A38                  	call disp_msg_asciz
  1850                                  
  1851                                  		; Copy over actual FSINFO structure from original.
  1852                                  		;  (Leaves FSIBOOT as written from our image.)
  1853 00000B67 BE[642C]                	mov si, second_sector_buffer + 512 + FSINFO.signature2
  1854 00000B6A BF[240C]                	mov di, first_sector_buffer + 512 + FSINFO.signature2
  1855 00000B6D B90E00                  	mov cx, (FSINFO_size - FSINFO.signature2) >> 1
  1856 00000B70 F3A5                    	rep movsw				; copy over FSINFO
  1857                                  .no_fsinfo:
  1858                                  		; 1st buffer second 512 B = FSINFO with FSIBOOT
  1859                                  
  1860                                  
  1861                                  prepare_sector_final:
  1862 00000B72 BE[7E2A]                	mov si, second_sector_buffer + 510
  1863 00000B75 BF[3E0A]                	mov di, first_sector_buffer + 510
  1864 00000B78 A5                      	movsw
  1865                                  		; 1st buffer signature set from original
  1866                                  
  1867 00000B79 8B4EDC                  	mov cx, word [bp + ldBytesPerSector]
  1868 00000B7C F646E706                	 test byte [bp + ldHasLBA], 2 | 4
  1869 00000B80 740E                    	 jz @F
  1870 00000B82 81C60002                	add si, 512				; -> second_sector_buffer +1024
  1871 00000B86 81C70002                	add di, 512				; -> behind buffer for FSIBOOT
  1872 00000B8A 81E90002                	sub cx, 512
  1873 00000B8E 7608                    	jbe @FF
  1874                                  @@:
  1875 00000B90 81E90002                	sub cx, 512
  1876 00000B94 7602                    	jbe @F
  1877 00000B96 F3A4                    	rep movsb
  1878                                  @@:
  1879                                  		; 1st buffer = up to 8 KiB for us to write
  1880                                  		;  (for FAT32 either 1024+ bytes including
  1881                                  		;  our FSIBOOT or 512 B primary plus another
  1882                                  		;  512 B of FSINFO)
  1883                                  
  1884                                  
  1885                                  %if _NUM_DETECT_NAMES
  1886                                  listnames:
  1887 00000B98 BB[F056]                	mov bx, msg.names
  1888 00000B9B BE[7E08]                	mov si, first_sector_buffer + bsBPB + bpbNew + BPBN_size
  1889 00000B9E B9C001                  	mov cx, 512 - (bsBPB + bpbNew + BPBN_size) - 2
  1890                                  						; -2 = AA55h sig
  1891 00000BA1 807EE610                	cmp byte [bp + ldFATType], 16
  1892 00000BA5 7606                    	jbe @F
  1893 00000BA7 BE[9A08]                	mov si, first_sector_buffer + bsBPB + ebpbNew + BPBN_size
  1894 00000BAA B9A401                  	mov cx, 512 - (bsBPB + ebpbNew + BPBN_size) - 2
  1895                                  @@:
  1896                                  
  1897                                  %if _DISPLAY_ALL_NAMES
  1898                                  .nextname:
  1899                                  	call findname
  1900                                  	 lahf
  1901                                  	mov dx, [bx]
  1902                                  	call disp_msg_asciz
  1903                                  	mov dx, msg.name_before
  1904                                  	call disp_msg_asciz
  1905                                  	 sahf
  1906                                  	 jc @F		; skip quote if no name -->
  1907                                  	 mov dx, msg.name_quote
  1908                                  	 call disp_msg_asciz
  1909                                  @@:
  1910                                  	mov dx, msg.foundname
  1911                                  	call disp_msg_asciz
  1912                                  	 sahf
  1913                                  	 jc @F		; skip quote if no name -->
  1914                                  	 mov dx, msg.name_quote
  1915                                  	 call disp_msg_asciz
  1916                                  @@:
  1917                                  	mov dx, msg.name_after
  1918                                  	call disp_msg_asciz
  1919                                  	 sahf
  1920                                  	 mov ax, 0
  1921                                  	 jc @F		; set to zero if no name -->
  1922                                  	 lea ax, [si - 11]	; -> name in buffer
  1923                                  @@:
  1924                                  	 mov word [bx + 2], ax	; -> name in buffer, or 0
  1925                                  	add bx, 4
  1926                                  	cmp word [bx], 0
  1927                                  	jne .nextname
  1928                                  %else
  1929                                  		; First name: Special, if none found display a message.
  1930 00000BAD E8AC35                  	call findname
  1931 00000BB0 730D                    	jnc @F
  1932 00000BB2 BA[2E57]                	mov dx, msg.name_none
  1933 00000BB5 E8C937                  	call disp_msg_asciz
  1934 00000BB8 EB36                    	jmp @FF
  1935                                  
  1936                                  .nextname:
  1937 00000BBA E89F35                  	call findname
  1938 00000BBD 7231                    	jc @FF
  1939                                  @@:
  1940 00000BBF 8B17                    	mov dx, [bx]
  1941 00000BC1 E8BD37                  	call disp_msg_asciz
  1942 00000BC4 BA[2657]                	mov dx, msg.name_before
  1943 00000BC7 E8B737                  	call disp_msg_asciz
  1944 00000BCA BA[2957]                	 mov dx, msg.name_quote
  1945 00000BCD E8B137                  	 call disp_msg_asciz
  1946 00000BD0 BA[D856]                	mov dx, msg.foundname
  1947 00000BD3 E8AB37                  	call disp_msg_asciz
  1948 00000BD6 BA[2957]                	 mov dx, msg.name_quote
  1949 00000BD9 E8A537                  	 call disp_msg_asciz
  1950 00000BDC BA[2B57]                	mov dx, msg.name_after
  1951 00000BDF E89F37                  	call disp_msg_asciz
  1952 00000BE2 8D44F5                  	 lea ax, [si - 11]	; -> name in buffer
  1953 00000BE5 894702                  	 mov word [bx + 2], ax	; -> name in buffer, or 0
  1954 00000BE8 83C304                  	add bx, 4
  1955 00000BEB 833F00                  	cmp word [bx], 0
  1956 00000BEE 75CA                    	jne .nextname
  1957                                  @@:
  1958                                  %endif
  1959                                  
  1960                                  
  1961                                  %if _NUM_REPLACEMENTS
  1962 00000BF0 BE[A856]                	mov si, msg.name_replacements
  1963 00000BF3 BB[F056]                	mov bx, msg.names
  1964 00000BF6 B90400                  	mov cx, _NUM_REPLACEMENTS
  1965                                  .loop:
  1966 00000BF9 803C00                  	cmp byte [si], 0
  1967 00000BFC 7448                    	je .next
  1968 00000BFE 8B7F02                  	mov di, word [bx + 2]
  1969 00000C01 85FF                    	test di, di
  1970 00000C03 7514                    	jnz .replace
  1971 00000C05 BA[4257]                	mov dx, msg.no_name_found_before
  1972 00000C08 E87637                  	call disp_msg_asciz
  1973 00000C0B 8B17                    	mov dx, [bx]
  1974 00000C0D E87137                  	call disp_msg_asciz
  1975 00000C10 BA[4657]                	mov dx, msg.no_name_found_after
  1976 00000C13 E86B37                  	call disp_msg_asciz
  1977 00000C16 E97005                  	jmp exit_error
  1978                                  
  1979                                  .replace:
  1980 00000C19 BA[6057]                	mov dx, msg.replacing_before
  1981 00000C1C E86237                  	call disp_msg_asciz
  1982 00000C1F 8B17                    	mov dx, [bx]
  1983 00000C21 E85D37                  	call disp_msg_asciz
  1984 00000C24 BA[6B57]                	mov dx, msg.replacing_between
  1985 00000C27 E85737                  	call disp_msg_asciz
  1986 00000C2A 51                      	push cx
  1987 00000C2B 56                      	push si
  1988 00000C2C 56                      	 push si
  1989 00000C2D 57                      	 push di
  1990 00000C2E E89735                  	call convert_name_to_asciz
  1991 00000C31 5F                      	 pop di
  1992 00000C32 5E                      	 pop si
  1993 00000C33 BA[D856]                	mov dx, msg.foundname
  1994 00000C36 E84837                  	call disp_msg_asciz
  1995 00000C39 BA[7357]                	mov dx, msg.replacing_after
  1996 00000C3C E84237                  	call disp_msg_asciz
  1997 00000C3F B90B00                  	mov cx, 11
  1998 00000C42 F3A4                    	rep movsb
  1999 00000C44 5E                      	pop si
  2000 00000C45 59                      	pop cx
  2001                                  
  2002                                  .next:
  2003 00000C46 83C304                  	add bx, 4
  2004 00000C49 83C60C                  	add si, 12
  2005 00000C4C 833F00                  	cmp word [bx], 0
  2006 00000C4F E0A8                    	loopnz .loop
  2007                                  %endif
  2008                                  %endif
  2009                                  
  2010                                  
  2011                                  set_unit:
  2012 00000C51 BE[4008]                	mov si, first_sector_buffer
  2013 00000C54 AC                      	lodsb
  2014 00000C55 3CE9                    	cmp al, 0E9h
  2015 00000C57 741B                    	je .nearjmp
  2016 00000C59 3CE8                    	cmp al, 0E8h
  2017 00000C5B 7417                    	je .nearjmp
  2018 00000C5D 3CEB                    	cmp al, 0EBh
  2019 00000C5F 7415                    	je .shortjmp
  2020                                  
  2021                                  .notfound:
  2022 00000C61 BA[A758]                	mov dx, msg.unit_not_found
  2023 00000C64 833E[5246]FF            	cmp word [load_unit], -1
  2024 00000C69 7403E957F4              	jne disp_error
  2025 00000C6E BA[D958]                	mov dx, msg.unit_not_found.keep
  2026 00000C71 E9C400                  	jmp .done_msg
  2027                                  
  2028                                  
  2029                                  .nearjmp:
  2030 00000C74 AD                      	lodsw
  2031 00000C75 A9                      	db __TEST_IMM16		; (skip lodsb, cbw)
  2032                                  .shortjmp:
  2033 00000C76 AC                      	lodsb
  2034 00000C77 98                      	cbw
  2035 00000C78 01C6                    	add si, ax
  2036                                  
  2037 00000C7A BA1000                  	mov dx, 16
  2038 00000C7D BF[CE12]                	mov di, unit_search_strings.mov
  2039 00000C80 B90300                  	mov cx, unit_search_strings.mov_length
  2040                                  @@:
  2041 00000C83 56                      	push si
  2042 00000C84 57                      	push di
  2043 00000C85 51                      	push cx
  2044 00000C86 F3A6                    	repe cmpsb
  2045 00000C88 59                      	pop cx
  2046 00000C89 5F                      	pop di
  2047 00000C8A 5E                      	pop si
  2048 00000C8B 7406                    	je .found_mov
  2049 00000C8D 46                      	inc si
  2050 00000C8E 4A                      	dec dx
  2051 00000C8F 75F2                    	jnz @B
  2052                                  
  2053 00000C91 EBCE                    	jmp .notfound
  2054                                  
  2055                                  .found_mov:
  2056 00000C93 01CE                    	add si, cx
  2057                                  
  2058 00000C95 BA3000                  	mov dx, 48
  2059 00000C98 BB[D412]                	mov bx, unit_search_strings.1612_set_dl
  2060 00000C9B BF[D112]                	mov di, unit_search_strings.1612_set_bpbn
  2061 00000C9E B90300                  	mov cx, unit_search_strings.1612_set_bpbn_length
  2062 00000CA1 807EE610                	cmp byte [bp + ldFATType], 16
  2063 00000CA5 7609                    	jbe @F
  2064 00000CA7 BB[DA12]                	mov bx, unit_search_strings.32_set_dl
  2065 00000CAA BF[D712]                	mov di, unit_search_strings.32_set_bpbn
  2066 00000CAD B90300                  	mov cx, unit_search_strings.32_set_bpbn_length
  2067                                  
  2068                                  @@:
  2069 00000CB0 56                      	push si
  2070 00000CB1 57                      	push di
  2071 00000CB2 51                      	push cx
  2072 00000CB3 F3A6                    	repe cmpsb
  2073 00000CB5 59                      	pop cx
  2074 00000CB6 5F                      	pop di
  2075 00000CB7 5E                      	pop si
  2076 00000CB8 7435                    	je .found_set_bpbn
  2077 00000CBA 87DF                    	xchg bx, di
  2078 00000CBC 56                      	push si
  2079 00000CBD 57                      	push di
  2080 00000CBE 51                      	push cx
  2081 00000CBF F3A6                    	repe cmpsb
  2082 00000CC1 59                      	pop cx
  2083 00000CC2 5F                      	pop di
  2084 00000CC3 5E                      	pop si
  2085 00000CC4 87DF                    	xchg bx, di
  2086 00000CC6 742F                    	je .found_set_dl
  2087 00000CC8 46                      	inc si
  2088 00000CC9 4A                      	dec dx
  2089 00000CCA 75E4                    	jnz @B
  2090                                  
  2091 00000CCC EB93                    	jmp .notfound
  2092                                  
  2093                                  .setup_pointers:
  2094 00000CCE 807EE610                	cmp byte [bp + ldFATType], 16
  2095 00000CD2 760E                    	jbe .1612
  2096                                  .32:
  2097 00000CD4 BB[8008]                	mov bx, first_sector_buffer + bsBPB + ebpbNew + bpbnBootUnit
  2098 00000CD7 B8[D712]                	mov ax, unit_search_strings.32_set_bpbn
  2099 00000CDA BF[DA12]                	mov di, unit_search_strings.32_set_dl
  2100 00000CDD B90300                  	mov cx, unit_search_strings.32_set_dl_length
  2101 00000CE0 EB0C                    	jmp @F
  2102                                  
  2103                                  .1612:
  2104 00000CE2 BB[6408]                	mov bx, first_sector_buffer + bsBPB + bpbNew + bpbnBootUnit
  2105 00000CE5 B8[D112]                	mov ax, unit_search_strings.1612_set_bpbn
  2106 00000CE8 BF[D412]                	mov di, unit_search_strings.1612_set_dl
  2107 00000CEB B90300                  	mov cx, unit_search_strings.1612_set_dl_length
  2108                                  @@:
  2109 00000CEE C3                      	retn
  2110                                  
  2111                                  
  2112                                  .found_set_bpbn:
  2113 00000CEF E8DCFF                  	call .setup_pointers
  2114 00000CF2 BA[1359]                	mov dx, msg.unit_found.set_bpbn
  2115 00000CF5 EB13                    	jmp @F
  2116                                  
  2117                                  .found_set_dl:
  2118 00000CF7 E8D4FF                  	call .setup_pointers
  2119 00000CFA BA[3859]                	mov dx, msg.unit_found.set_dl
  2120 00000CFD E88136                  	call disp_msg_asciz
  2121                                  
  2122 00000D00 50                      	push ax
  2123 00000D01 8A07                    	mov al, [bx]
  2124 00000D03 E89F36                  	call disp_al_hex
  2125 00000D06 58                      	pop ax
  2126                                  
  2127 00000D07 BA[6459]                	mov dx, msg.unit_found.set_dl.after
  2128                                  @@:
  2129 00000D0A E87436                  	call disp_msg_asciz
  2130                                  
  2131 00000D0D BA[6759]                	mov dx, msg.unit_found.keeping
  2132 00000D10 833E[5246]FF            	cmp word [load_unit], -1
  2133 00000D15 7421                    	je .done_msg
  2134                                  
  2135 00000D17 50                      	push ax
  2136 00000D18 A1[5246]                	mov ax, [load_unit]
  2137                                  
  2138 00000D1B 84E4                    	test ah, ah
  2139 00000D1D 7511                    	jnz @F			; if to set auto unit -->
  2140                                  
  2141 00000D1F BA[8C58]                	mov dx, msg.using_fix_unit
  2142 00000D22 E85C36                  	call disp_msg_asciz
  2143                                  
  2144 00000D25 E87D36                  	call disp_al_hex
  2145 00000D28 8807                    	mov byte [bx], al
  2146                                  
  2147 00000D2A BA[A258]                	mov dx, msg.using_fix_unit_after
  2148 00000D2D 58                      	pop ax
  2149 00000D2E EB04                    	jmp @FF			; di -> set dl
  2150                                  
  2151                                  @@:
  2152 00000D30 5F                      	pop di			; di -> set bpbn
  2153 00000D31 BA[7959]                	mov dx, msg.using_auto_unit
  2154                                  @@:
  2155                                  
  2156 00000D34 87F7                    	xchg si, di
  2157 00000D36 F3A4                    	rep movsb		; write to there
  2158                                  
  2159                                  .done_msg:
  2160 00000D38 E84636                  	call disp_msg_asciz
  2161                                  .done:
  2162                                  
  2163                                  
  2164                                  set_partinfo:
  2165 00000D3B BE[4008]                	mov si, first_sector_buffer
  2166 00000D3E AC                      	lodsb
  2167 00000D3F 3CE9                    	cmp al, 0E9h
  2168 00000D41 741A                    	je .nearjmp
  2169 00000D43 3CE8                    	cmp al, 0E8h
  2170 00000D45 7416                    	je .nearjmp
  2171 00000D47 3CEB                    	cmp al, 0EBh
  2172 00000D49 7414                    	je .shortjmp
  2173                                  
  2174                                  .notfound:
  2175 00000D4B BA[A759]                	mov dx, msg.partinfo_not_found
  2176 00000D4E 833E[5446]FF            	cmp word [load_use_partinfo], -1
  2177 00000D53 7403E96DF3              	jne disp_error
  2178 00000D58 BA[D459]                	mov dx, msg.partinfo_not_found.keep
  2179 00000D5B EB6B                    	jmp .done_msg
  2180                                  
  2181                                  
  2182                                  .nearjmp:
  2183 00000D5D AD                      	lodsw
  2184 00000D5E A9                      	db __TEST_IMM16		; (skip lodsb, cbw)
  2185                                  .shortjmp:
  2186 00000D5F AC                      	lodsb
  2187 00000D60 98                      	cbw
  2188 00000D61 01C6                    	add si, ax
  2189                                  
  2190 00000D63 BA8000                  	mov dx, 128
  2191 00000D66 BB[F212]                	mov bx, partinfo_search_strings.keep
  2192 00000D69 BF[DD12]                	mov di, partinfo_search_strings.mov
  2193 00000D6C B91500                  	mov cx, partinfo_search_strings.mov_length
  2194                                  
  2195                                  @@:
  2196 00000D6F 56                      	push si
  2197 00000D70 57                      	push di
  2198 00000D71 51                      	push cx
  2199 00000D72 F3A6                    	repe cmpsb
  2200 00000D74 59                      	pop cx
  2201 00000D75 5F                      	pop di
  2202 00000D76 5E                      	pop si
  2203 00000D77 741E                    	je .found_mov
  2204 00000D79 87DF                    	xchg bx, di
  2205 00000D7B 56                      	push si
  2206 00000D7C 57                      	push di
  2207 00000D7D 51                      	push cx
  2208 00000D7E F3A6                    	repe cmpsb
  2209 00000D80 59                      	pop cx
  2210 00000D81 5F                      	pop di
  2211 00000D82 5E                      	pop si
  2212 00000D83 87DF                    	xchg bx, di
  2213 00000D85 7418                    	je .found_keep
  2214 00000D87 46                      	inc si
  2215 00000D88 4A                      	dec dx
  2216 00000D89 75E4                    	jnz @B
  2217                                  
  2218 00000D8B EBBE                    	jmp .notfound
  2219                                  
  2220                                  .setup_pointers:
  2221 00000D8D B8[DD12]                	mov ax, partinfo_search_strings.mov
  2222 00000D90 BF[F212]                	mov di, partinfo_search_strings.keep
  2223 00000D93 B91500                  	mov cx, partinfo_search_strings.keep_length
  2224 00000D96 C3                      	retn
  2225                                  
  2226                                  
  2227                                  .found_mov:
  2228 00000D97 E8F3FF                  	call .setup_pointers
  2229 00000D9A BA[095A]                	mov dx, msg.partinfo_found.mov
  2230 00000D9D EB06                    	jmp @F
  2231                                  
  2232                                  .found_keep:
  2233 00000D9F E8EBFF                  	call .setup_pointers
  2234 00000DA2 BA[295A]                	mov dx, msg.partinfo_found.keep
  2235                                  %if 0
  2236                                  	call disp_msg_asciz
  2237                                  
  2238                                  	push ax
  2239                                  	mov al, [bx]
  2240                                  	call disp_al_hex
  2241                                  	pop ax
  2242                                  
  2243                                  	mov dx, msg.partinfo_found.keep.after
  2244                                  %endif
  2245                                  @@:
  2246 00000DA5 E8D935                  	call disp_msg_asciz
  2247                                  
  2248 00000DA8 BA[6759]                	mov dx, msg.partinfo_found.keeping
  2249 00000DAB 833E[5446]FF            	cmp word [load_use_partinfo], -1
  2250 00000DB0 7416                    	je .done_msg
  2251                                  
  2252 00000DB2 50                      	push ax
  2253 00000DB3 A1[5446]                	mov ax, [load_use_partinfo]
  2254                                  
  2255 00000DB6 84E4                    	test ah, ah
  2256 00000DB8 7506                    	jnz @F			; if to set auto partinfo -->
  2257                                  
  2258 00000DBA BA[8D59]                	mov dx, msg.using_fix_partinfo
  2259                                  %if 0
  2260                                  	call disp_msg_asciz
  2261                                  
  2262                                  	call disp_al_hex
  2263                                  	mov byte [bx], al
  2264                                  
  2265                                  	mov dx, msg.using_fix_partinfo_after
  2266                                  %endif
  2267 00000DBD 58                      	pop ax
  2268 00000DBE EB04                    	jmp @FF			; di -> keep
  2269                                  
  2270                                  @@:
  2271 00000DC0 5F                      	pop di			; di -> mov
  2272 00000DC1 BA[4A5A]                	mov dx, msg.using_auto_partinfo
  2273                                  @@:
  2274                                  
  2275 00000DC4 87F7                    	xchg si, di
  2276 00000DC6 F3A4                    	rep movsb		; write to there
  2277                                  
  2278                                  .done_msg:
  2279 00000DC8 E8B635                  	call disp_msg_asciz
  2280                                  .done:
  2281                                  
  2282                                  
  2283                                  set_query:
  2284 00000DCB BE[4008]                	mov si, first_sector_buffer
  2285 00000DCE AC                      	lodsb
  2286 00000DCF 3CE9                    	cmp al, 0E9h
  2287 00000DD1 741A                    	je .nearjmp
  2288 00000DD3 3CE8                    	cmp al, 0E8h
  2289 00000DD5 7416                    	je .nearjmp
  2290 00000DD7 3CEB                    	cmp al, 0EBh
  2291 00000DD9 7414                    	je .shortjmp
  2292                                  
  2293                                  .notfound:
  2294 00000DDB BA[7C5A]                	mov dx, msg.query_not_found
  2295 00000DDE 833E[5646]FF            	cmp word [load_use_query_geometry], -1
  2296 00000DE3 7403E9DDF2              	jne disp_error
  2297 00000DE8 BA[AE5A]                	mov dx, msg.query_not_found.keep
  2298 00000DEB EB6B                    	jmp .done_msg
  2299                                  
  2300                                  
  2301                                  .nearjmp:
  2302 00000DED AD                      	lodsw
  2303 00000DEE A9                      	db __TEST_IMM16		; (skip lodsb, cbw)
  2304                                  .shortjmp:
  2305 00000DEF AC                      	lodsb
  2306 00000DF0 98                      	cbw
  2307 00000DF1 01C6                    	add si, ax
  2308                                  
  2309 00000DF3 BA8000                  	mov dx, 128
  2310 00000DF6 BB[1C13]                	mov bx, query_search_strings.keep
  2311 00000DF9 BF[0713]                	mov di, query_search_strings.query
  2312 00000DFC B91500                  	mov cx, query_search_strings.query_length
  2313                                  
  2314                                  @@:
  2315 00000DFF 56                      	push si
  2316 00000E00 57                      	push di
  2317 00000E01 51                      	push cx
  2318 00000E02 F3A6                    	repe cmpsb
  2319 00000E04 59                      	pop cx
  2320 00000E05 5F                      	pop di
  2321 00000E06 5E                      	pop si
  2322 00000E07 741E                    	je .found_query
  2323 00000E09 87DF                    	xchg bx, di
  2324 00000E0B 56                      	push si
  2325 00000E0C 57                      	push di
  2326 00000E0D 51                      	push cx
  2327 00000E0E F3A6                    	repe cmpsb
  2328 00000E10 59                      	pop cx
  2329 00000E11 5F                      	pop di
  2330 00000E12 5E                      	pop si
  2331 00000E13 87DF                    	xchg bx, di
  2332 00000E15 7418                    	je .found_keep
  2333 00000E17 46                      	inc si
  2334 00000E18 4A                      	dec dx
  2335 00000E19 75E4                    	jnz @B
  2336                                  
  2337 00000E1B EBBE                    	jmp .notfound
  2338                                  
  2339                                  .setup_pointers:
  2340 00000E1D B8[0713]                	mov ax, query_search_strings.query
  2341 00000E20 BF[1C13]                	mov di, query_search_strings.keep
  2342 00000E23 B91500                  	mov cx, query_search_strings.keep_length
  2343 00000E26 C3                      	retn
  2344                                  
  2345                                  
  2346                                  .found_query:
  2347 00000E27 E8F3FF                  	call .setup_pointers
  2348 00000E2A BA[E85A]                	mov dx, msg.query_found.query
  2349 00000E2D EB06                    	jmp @F
  2350                                  
  2351                                  .found_keep:
  2352 00000E2F E8EBFF                  	call .setup_pointers
  2353 00000E32 BA[0D5B]                	mov dx, msg.query_found.keep
  2354                                  %if 0
  2355                                  	call disp_msg_asciz
  2356                                  
  2357                                  	push ax
  2358                                  	mov al, [bx]
  2359                                  	call disp_al_hex
  2360                                  	pop ax
  2361                                  
  2362                                  	mov dx, msg.query_found.keep.after
  2363                                  %endif
  2364                                  @@:
  2365 00000E35 E84935                  	call disp_msg_asciz
  2366                                  
  2367 00000E38 BA[6759]                	mov dx, msg.query_found.keeping
  2368 00000E3B 833E[5646]FF            	cmp word [load_use_query_geometry], -1
  2369 00000E40 7416                    	je .done_msg
  2370                                  
  2371 00000E42 50                      	push ax
  2372 00000E43 A1[5646]                	mov ax, [load_use_query_geometry]
  2373                                  
  2374 00000E46 84E4                    	test ah, ah
  2375 00000E48 7506                    	jnz @F			; if to set auto query -->
  2376                                  
  2377 00000E4A BA[635A]                	mov dx, msg.using_fix_query
  2378                                  %if 0
  2379                                  	call disp_msg_asciz
  2380                                  
  2381                                  	call disp_al_hex
  2382                                  	mov byte [bx], al
  2383                                  
  2384                                  	mov dx, msg.using_fix_query_after
  2385                                  %endif
  2386 00000E4D 58                      	pop ax
  2387 00000E4E EB04                    	jmp @FF			; di -> keep
  2388                                  
  2389                                  @@:
  2390 00000E50 5F                      	pop di			; di -> query
  2391 00000E51 BA[3E5B]                	mov dx, msg.using_auto_query
  2392                                  @@:
  2393                                  
  2394 00000E54 87F7                    	xchg si, di
  2395 00000E56 F3A4                    	rep movsb		; write to there
  2396                                  
  2397                                  .done_msg:
  2398 00000E58 E82635                  	call disp_msg_asciz
  2399                                  .done:
  2400                                  
  2401                                  set_lba:
  2402 00000E5B BB[8E2E]                	mov bx, lba_search_metadata
  2403                                  
  2404                                  .looppattern:
  2405 00000E5E BE[4008]                	mov si, first_sector_buffer
  2406 00000E61 BA0002                  	mov dx, 512
  2407 00000E64 8B3F                    	mov di, [bx]
  2408 00000E66 85FF                    	test di, di
  2409 00000E68 744E                    	jz .notfound
  2410 00000E6A 8B4F02                  	mov cx, [bx + 2]
  2411 00000E6D 83C308                  	add bx, 8
  2412                                  
  2413                                  
  2414                                  @@:
  2415 00000E70 8A05                    	mov al, byte [di]	; get first byte
  2416 00000E72 87F7                    	xchg si, di		; es:di -> to search
  2417 00000E74 87D1                    	xchg dx, cx		; cx = count remaining, at least 1
  2418 00000E76 F2AE                    	repne scasb		; scan for byte
  2419 00000E78 87D1                    	xchg dx, cx
  2420 00000E7A 87F7                    	xchg si, di		; restore register setup
  2421 00000E7C 7519                    	jne .nextpattern
  2422                                  
  2423 00000E7E 4E                      	dec si			; scasb left a pointer behind match
  2424 00000E7F 42                      	inc dx			; also fix counter
  2425 00000E80 53                      	push bx
  2426 00000E81 56                      	push si
  2427 00000E82 57                      	push di
  2428 00000E83 51                      	push cx
  2429 00000E84 39D1                    	cmp cx, dx
  2430 00000E86 7705                    	ja .mismatchpattern	; (NZ) if doesn't fit in 512 bytes
  2431 00000E88 E81600                  	call .patchwildcards	; patch potential match candidate's wildcards
  2432 00000E8B F3A6                    	repe cmpsb
  2433                                  .mismatchpattern:
  2434 00000E8D 59                      	pop cx
  2435 00000E8E 5F                      	pop di
  2436 00000E8F 5E                      	pop si
  2437 00000E90 5B                      	pop bx
  2438 00000E91 7438                    	je .foundpattern
  2439 00000E93 46                      	inc si
  2440 00000E94 4A                      	dec dx
  2441 00000E95 75D9                    	jnz @B
  2442                                  
  2443                                  .nextpattern:
  2444                                  %if 1
  2445                                  @@:
  2446 00000E97 833F00                  	cmp word [bx], 0
  2447 00000E9A 8D5F02                  	lea bx, [bx + 2]
  2448 00000E9D 75F8                    	jne @B
  2449                                  %else
  2450                                  		; With the repne scasb optimisation we may get
  2451                                  		;  al = first byte, and .patchwildcards may have
  2452                                  		;  never run for this pattern. So don't use this.
  2453                                  	xchg bx, ax		; get .patchwildcards return
  2454                                  %endif
  2455 00000E9F EBBD                    	jmp .looppattern
  2456                                  
  2457                                  
  2458                                  		; INP:	bx -> wildcard displacement list, zero-terminated
  2459                                  		;	si -> candidate match or match in our loader
  2460                                  		;	di -> pattern to patch with wildcard contents
  2461                                  		; OUT:	ax -> behind zero terminator of list
  2462                                  		; CHG:	none
  2463                                  .patchwildcards:
  2464 00000EA1 53                      	 push bx
  2465                                  .loopwildcard:
  2466 00000EA2 53                      	 push bx
  2467 00000EA3 8B1F                    	 mov bx, [bx]		; = displacement to wildcard byte
  2468 00000EA5 85DB                    	test bx, bx		; zero ?
  2469 00000EA7 7409                    	jz .donewildcard	; yes, done -->
  2470 00000EA9 8A00                    	mov al, byte [si + bx]	; get actual value
  2471 00000EAB 8801                    	mov byte [di + bx], al	; store it in wildcard position
  2472 00000EAD 5B                      	 pop bx
  2473 00000EAE 43                      	 inc bx
  2474 00000EAF 43                      	 inc bx			; -> next wildcard displacement
  2475 00000EB0 EBF0                    	 jmp .loopwildcard
  2476                                  .donewildcard:
  2477 00000EB2 5B                      	 pop bx
  2478 00000EB3 8D4702                  	 lea ax, [bx + 2]
  2479 00000EB6 5B                      	 pop bx			; restore -> start of displacement list
  2480 00000EB7 C3                      	retn
  2481                                  
  2482                                  
  2483                                  .notfound:
  2484 00000EB8 BA[8A5B]                	mov dx, msg.lba_not_found
  2485 00000EBB 833E[5846]FF            	cmp word [load_use_lba], -1
  2486 00000EC0 7403E900F2              	jne disp_error
  2487 00000EC5 BA[B65B]                	mov dx, msg.lba_not_found.keep
  2488 00000EC8 E9C900                  	jmp .done_msg
  2489                                  
  2490                                  
  2491                                  .foundpattern:
  2492 00000ECB 8B57FC                  	mov dx, word [bx - 8 + 4]
  2493 00000ECE E8B034                  	call disp_msg_asciz	; display what we found
  2494                                  
  2495 00000ED1 BA[EA5B]                	mov dx, msg.lba_found_suffix
  2496 00000ED4 E8AA34                  	call disp_msg_asciz
  2497                                  
  2498 00000ED7 BA[6759]                	mov dx, msg.lba_found.keeping
  2499 00000EDA 833E[5846]FF            	cmp word [load_use_lba], -1
  2500 00000EDF 7503E9B000              	je .done_msg		; done, no change -->
  2501                                  
  2502 00000EE4 8B7FF8                  	mov di, word [bx - 8]	; -> what we matched (eg LBA)
  2503                                  
  2504 00000EE7 81FF[2E2E]              	cmp di, lba_search_strings_hdd
  2505 00000EEB 7242                    	jb .nothddmatch
  2506                                  
  2507 00000EED 803E[5946]01            	cmp byte [load_use_lba + 1], 1
  2508 00000EF2 7503E99D00              	je .done_msg
  2509                                  
  2510 00000EF7 8B5FFE                  	mov bx, word [bx - 8 + 6]
  2511 00000EFA 53                      	push bx
  2512 00000EFB 8B5F02                  	mov bx, word [bx + 2]
  2513 00000EFE 8B3F                    	mov di, word [bx]	; -> the other code
  2514 00000F00 83C308                  	add bx, 8
  2515 00000F03 E89BFF                  	call .patchwildcards
  2516 00000F06 5B                      	pop bx
  2517 00000F07 53                      	push bx
  2518 00000F08 8B5F04                  	mov bx, word [bx + 4]
  2519 00000F0B 8B3F                    	mov di, word [bx]	; -> the other code
  2520 00000F0D 83C308                  	add bx, 8
  2521 00000F10 E88EFF                  	call .patchwildcards
  2522 00000F13 5B                      	pop bx
  2523 00000F14 803E[5946]00            	cmp byte [load_use_lba + 1], 0
  2524 00000F19 750A                    	jne .hddsetauto
  2525                                  .hddsetnone:
  2526 00000F1B 8B5F02                  	mov bx, word [bx + 2]
  2527 00000F1E 8B3F                    	mov di, word [bx]
  2528 00000F20 BA[5C5B]                	mov dx, msg.using_none_lba
  2529 00000F23 EB6B                    	jmp .do_patch
  2530                                  
  2531                                  .hddsetauto:
  2532 00000F25 8B5F04                  	mov bx, word [bx + 4]
  2533 00000F28 8B3F                    	mov di, word [bx]
  2534 00000F2A BA[6D5B]                	mov dx, msg.using_auto_lba
  2535 00000F2D EB61                    	jmp .do_patch
  2536                                  
  2537                                  .nothddmatch:
  2538 00000F2F 803E[5946]01            	cmp byte [load_use_lba + 1], 1
  2539 00000F34 752F                    	jne .nothddreplace
  2540 00000F36 83EB08                  	sub bx, 8
  2541 00000F39 BF[7C2E]                	mov di, label_hdd_special
  2542                                  @@:
  2543 00000F3C 833D00                  	cmp word [di], 0
  2544 00000F3F 741E                    	je .hddreplacenotfound
  2545 00000F41 395D02                  	cmp word [di + 2], bx
  2546 00000F44 740A                    	je @F
  2547 00000F46 395D04                  	cmp word [di + 4], bx
  2548 00000F49 7405                    	je @F
  2549 00000F4B 83C706                  	add di, 6
  2550 00000F4E EBEC                    	jmp @B
  2551                                  
  2552                                  @@:
  2553 00000F50 8B1D                    	mov bx, word [di]
  2554 00000F52 8B3F                    	mov di, word [bx]
  2555 00000F54 83C308                  	add bx, 8
  2556 00000F57 E847FF                  	call .patchwildcards
  2557 00000F5A BA[475C]                	mov dx, msg.using_autohdd_lba
  2558 00000F5D EB31                    	jmp .do_patch
  2559                                  
  2560                                  .hddreplacenotfound:
  2561 00000F5F BA[FC5B]                	mov dx, msg.lba_autohdd_not_found
  2562 00000F62 E960F1                  	jmp disp_error
  2563                                  
  2564                                  
  2565                                  .nothddreplace:
  2566 00000F65 57                      	push di
  2567 00000F66 8B5FFE                  	mov bx, word [bx - 8 + 6]
  2568 00000F69 8B3F                    	mov di, word [bx]	; -> the other code
  2569 00000F6B 83C308                  	add bx, 8
  2570 00000F6E E830FF                  	call .patchwildcards	; patch other code in case we use it
  2571 00000F71 89F8                    	mov ax, di		; ax -> the other code
  2572 00000F73 5B                      	pop bx
  2573 00000F74 89DF                    	mov di, bx		; bx = di -> what we matched
  2574 00000F76 50                      	push ax
  2575 00000F77 A1[5846]                	mov ax, [load_use_lba]
  2576                                  
  2577 00000F7A 84E4                    	test ah, ah
  2578 00000F7C 7507                    	jnz @F			; if to set auto LBA -->
  2579                                  
  2580 00000F7E BA[5C5B]                	mov dx, msg.using_none_lba
  2581 00000F81 58                      	pop ax
  2582 00000F82 97                      	xchg ax, di		; di -> what we didn't match (eg CHS)
  2583 00000F83 EB04                    	jmp @FF
  2584                                  
  2585                                  @@:
  2586 00000F85 58                      	pop ax
  2587                                  				; di -> what we matched (eg LBA)
  2588 00000F86 BA[6D5B]                	mov dx, msg.using_auto_lba
  2589                                  @@:
  2590                                  
  2591 00000F89 81FB[E120]              	cmp bx, lba_search_strings_chs
  2592                                  				; matched CHS ? (this checks what we matched)
  2593 00000F8D 7201                    	jb @F			; no -->
  2594 00000F8F 97                      	xchg ax, di		; reverse (we matched CHS instead)
  2595                                  @@:
  2596                                  
  2597                                  .do_patch:
  2598 00000F90 87F7                    	xchg si, di
  2599 00000F92 F3A4                    	rep movsb		; write to there
  2600                                  
  2601                                  .done_msg:
  2602 00000F94 E8EA33                  	call disp_msg_asciz
  2603                                  .done:
  2604                                  
  2605                                  
  2606                                  validate_fsinfo:
  2607 00000F97 F646E702                	test byte [bp + ldHasLBA], 2
  2608 00000F9B 7458                    	jz .no_fsinfo
  2609                                  
  2610 00000F9D BF[400A]                	mov di, first_sector_buffer + 512
  2611 00000FA0 BA[D15C]                	mov dx, msg.info_valid
  2612                                  
  2613 00000FA3 813D5252                	cmp word [di + FSINFO.signature1], FSINFO.signature1_value & 0FFFFh
  2614 00000FA7 7526                    	jne @F
  2615 00000FA9 817D026141              	cmp word [di + FSINFO.signature1 + 2], FSINFO.signature1_value >> 16
  2616 00000FAE 751F                    	jne @F
  2617 00000FB0 81BDE4017272            	cmp word [di + FSINFO.signature2], FSINFO.signature2_value & 0FFFFh
  2618 00000FB6 7517                    	jne @F
  2619 00000FB8 81BDE6014161            	cmp word [di + FSINFO.signature2 + 2], FSINFO.signature2_value >> 16
  2620 00000FBE 750F                    	jne @F
  2621 00000FC0 83BDFC0100              	cmp word [di + FSINFO.signature3], FSINFO.signature3_value & 0FFFFh
  2622 00000FC5 7508                    	jne @F
  2623 00000FC7 81BDFE0155AA            	cmp word [di + FSINFO.signature3 + 2], FSINFO.signature3_value >> 16
  2624 00000FCD 7423                    	je .end
  2625                                  
  2626                                  @@:
  2627 00000FCF BA[F25C]                	mov dx, msg.info_invalid_allowing
  2628 00000FD2 F606[2108]08            	testopt [cmd_line_flags], clfAllowInvalidInfo
  2629 00000FD7 7519                    	jnz .end
  2630                                  
  2631 00000FD9 BA[1F5D]                	mov dx, msg.info_invalid_resetting
  2632 00000FDC BE[5C46]                	mov si, info_reset_struc
  2633 00000FDF B90200                  	mov cx, info_reset_struc.signature1_size >> 1
  2634 00000FE2 F3A5                    	rep movsw
  2635 00000FE4 B106                    	mov cl, info_reset_struc.signature2_plus_entries_size >> 1
  2636 00000FE6 BF[240C]                	mov di, first_sector_buffer + 512 + FSINFO.signature2
  2637 00000FE9 F3A5                    	rep movsw
  2638 00000FEB B102                    	mov cl, info_reset_struc.signature3_size >> 1
  2639 00000FED BF[3C0C]                	mov di, first_sector_buffer + 512 + FSINFO.signature3
  2640 00000FF0 F3A5                    	rep movsw
  2641                                  
  2642                                  .end:
  2643 00000FF2 E88C33                  	call disp_msg_asciz
  2644                                  
  2645                                  .no_fsinfo:
  2646                                  
  2647                                  
  2648                                  write:
  2649                                  
  2650                                  		; If the sector size is <= 512 bytes and there is a second
  2651                                  		;  FAT32 sector which is an FSINFO sector, write it here.
  2652 00000FF5 F646E702                	test byte [bp + ldHasLBA], 2
  2653 00000FF9 7503E9CA00              	jz .no_fsinfo
  2654 00000FFE F606[2008]08            	testopt [cmd_line_flags], clfDontWriteInfo
  2655 00001003 7408                    	jz .write_fsinfo
  2656                                  
  2657 00001005 BA[435D]                	mov dx, msg.info_writing_not
  2658 00001008 E87633                  	call disp_msg_asciz
  2659                                  
  2660 0000100B EB47                    	jmp .write_info_copy_if_forced
  2661                                  
  2662                                  
  2663                                  .write_fsinfo:
  2664 0000100D F606[2008]40            	testopt [cmd_line_flags], clfWriteInfoToSectorFile
  2665 00001012 741D                    	jz .not_info_to_sector_file
  2666                                  
  2667 00001014 BA[595D]                	mov dx, msg.info_writing_sector_file
  2668 00001017 E86733                  	call disp_msg_asciz
  2669 0000101A BF[3008]                	mov di, cmd_line_sector_file
  2670 0000101D E88201                  	call open_file_write
  2671 00001020 7303E96401              	jc exit_error
  2672                                  
  2673 00001025 B80042                  	mov ax, 4200h
  2674 00001028 31C9                    	xor cx, cx
  2675 0000102A BA0002                  	mov dx, 512		; seek offset 512
  2676 0000102D CD21                    	int 21h
  2677                                  
  2678 0000102F EB18                    	jmp @F
  2679                                  
  2680                                  
  2681                                  .not_info_to_sector_file:
  2682 00001031 F606[2008]10            	testopt [cmd_line_flags], clfWriteInfoToFile
  2683 00001036 7425                    	jz .not_info_to_file
  2684                                  
  2685 00001038 BA[7F5D]                	mov dx, msg.info_writing_file
  2686 0000103B E84333                  	call disp_msg_asciz
  2687 0000103E BF[3408]                	mov di, cmd_line_info_file
  2688 00001041 E85E01                  	call open_file_write
  2689 00001044 7303E94001              	jc exit_error
  2690                                  
  2691                                  @@:
  2692 00001049 BA[400A]                	mov dx, first_sector_buffer + 512
  2693 0000104C E85E02                  	call write_file_ae_512_bytes
  2694 0000104F 7303E93501              	jc exit_error
  2695                                  
  2696                                  .write_info_copy_if_forced:
  2697 00001054 F606[2108]40            	testopt [cmd_line_flags], clfWriteCopyInfo
  2698 00001059 7460                    	jz .not_writing_fsinfo_copy
  2699 0000105B EB21                    	jmp .write_copy_info
  2700                                  
  2701                                  
  2702                                  .not_info_to_file:
  2703 0000105D BA[995D]                	mov dx, msg.info_writing_sector
  2704 00001060 E81E33                  	call disp_msg_asciz
  2705 00001063 BB[400A]                	mov bx, first_sector_buffer + 512
  2706 00001066 8B4630                  	mov ax, word [bp + bsBPB + ebpbFSINFOSector]
  2707 00001069 31D2                    	xor dx, dx
  2708 0000106B 8A0E[5A46]              	mov cl, [drivenumber]
  2709 0000106F E87B35                  	call write_ae_512_bytes
  2710 00001072 7303E91201              	jc exit_error
  2711 00001077 F606[2108]C0            	testopt [cmd_line_flags], clfWriteCopyInfo | clfWriteCopyInfoIfSector
  2712 0000107C 743D                    	jz .not_writing_fsinfo_copy
  2713                                  
  2714                                  .write_copy_info:
  2715 0000107E F606[4446]20            	testopt [internalflags], detectedcopyinfo
  2716 00001083 7443                    	jz .no_fsinfo
  2717                                  
  2718 00001085 8B4632                  	mov ax, word [bp + bsBPB + ebpbBackupSector]
  2719 00001088 034630                  	add ax, word [bp + bsBPB + ebpbFSINFOSector]
  2720 0000108B BA[CC5E]                	mov dx, msg.backup_writing_info
  2721 0000108E E8F032                  	call disp_msg_asciz
  2722                                  
  2723                                  		; Invalidate FSINFO entries.
  2724 00001091 830E[280C]FF            	or word [first_sector_buffer + 512 + FSINFO.numberfree], -1
  2725 00001096 830E[2A0C]FF            	or word [first_sector_buffer + 512 + FSINFO.numberfree + 2], -1
  2726 0000109B 830E[2C0C]FF            	or word [first_sector_buffer + 512 + FSINFO.nextfree], -1
  2727 000010A0 830E[2E0C]FF            	or word [first_sector_buffer + 512 + FSINFO.nextfree + 2], -1
  2728                                  
  2729 000010A5 BB[400A]                	mov bx, first_sector_buffer + 512
  2730 000010A8 31D2                    	xor dx, dx
  2731 000010AA 8A0E[5A46]              	mov cl, [drivenumber]
  2732 000010AE E83C35                  	call write_ae_512_bytes
  2733 000010B1 7315                    	jnc .no_fsinfo
  2734 000010B3 BA[6E5F]                	mov dx, msg.backup_error_info
  2735 000010B6 E8C832                  	call disp_msg_asciz
  2736 000010B9 EB0D                    	jmp .no_fsinfo
  2737                                  
  2738                                  .not_writing_fsinfo_copy:
  2739 000010BB F606[4446]20            	testopt [internalflags], detectedcopyinfo
  2740 000010C0 7406                    	jz .no_fsinfo
  2741 000010C2 BA[175F]                	mov dx, msg.backup_not_writing_info
  2742                                  @@:
  2743 000010C5 E8B932                  	call disp_msg_asciz
  2744                                  
  2745                                  .no_fsinfo:
  2746                                  
  2747                                  
  2748 000010C8 F606[2008]04            	testopt [cmd_line_flags], clfDontWriteSector
  2749 000010CD 7408                    	jz .write_sector
  2750                                  
  2751 000010CF BA[B55D]                	mov dx, msg.sector_writing_not
  2752 000010D2 E8AC32                  	call disp_msg_asciz
  2753 000010D5 EB26                    	jmp .write_sector_copy_if_forced
  2754                                  
  2755                                  .write_sector:
  2756 000010D7 F606[2008]01            	testopt [cmd_line_flags], clfWriteSectorToFile
  2757 000010DC 7428                    	jz .not_sector_to_file
  2758                                  
  2759 000010DE BA[D05D]                	mov dx, msg.sector_writing_file
  2760 000010E1 E89D32                  	call disp_msg_asciz
  2761 000010E4 BF[3008]                	mov di, cmd_line_sector_file
  2762 000010E7 E8B800                  	call open_file_write
  2763 000010EA 726C                    	jc exit_error_restore_fsinfo
  2764                                  
  2765 000010EC B80042                  	mov ax, 4200h		; seek from start of file
  2766 000010EF 31C9                    	xor cx, cx
  2767 000010F1 31D2                    	xor dx, dx		; seek offset 0
  2768 000010F3 CD21                    	int 21h			; seek to start of file
  2769                                  
  2770 000010F5 BA[4008]                	mov dx, first_sector_buffer
  2771                                  				; -> buffer
  2772 000010F8 E8B201                  	call write_file_ae_512_bytes
  2773 000010FB 725B                    	jc exit_error_restore_fsinfo
  2774                                  
  2775                                  .write_sector_copy_if_forced:
  2776 000010FD F606[2108]10            	testopt [cmd_line_flags], clfWriteCopySector
  2777 00001102 7445                    	jz .not_writing_sector_copy
  2778 00001104 EB1D                    	jmp .write_copy_sector
  2779                                  
  2780                                  
  2781                                  .not_sector_to_file:
  2782 00001106 BA[EF5D]                	mov dx, msg.sector_writing_sector
  2783 00001109 E87532                  	call disp_msg_asciz
  2784 0000110C BB[4008]                	mov bx, first_sector_buffer
  2785 0000110F 31C0                    	xor ax, ax
  2786 00001111 31D2                    	xor dx, dx
  2787 00001113 8A0E[5A46]              	mov cl, [drivenumber]
  2788                                  		; If sector size is >= 1 KiB, this writes both sectors for
  2789                                  		;  the FAT32 two-sector case.
  2790 00001117 E8D334                  	call write_ae_512_bytes
  2791 0000111A 723C                    	jc exit_error_restore_fsinfo
  2792                                  
  2793 0000111C F606[2108]30            	testopt [cmd_line_flags], clfWriteCopySector | clfWriteCopySectorIfSector
  2794 00001121 7426                    	jz .not_writing_sector_copy
  2795                                  
  2796                                  .write_copy_sector:
  2797 00001123 F606[4446]10            	testopt [internalflags], detectedcopysector
  2798 00001128 746A                    	jz exit_normal
  2799                                  
  2800 0000112A BA[A65E]                	mov dx, msg.backup_writing_sector
  2801 0000112D E85132                  	call disp_msg_asciz
  2802                                  
  2803 00001130 BB[4008]                	mov bx, first_sector_buffer
  2804 00001133 31D2                    	xor dx, dx
  2805 00001135 8B4632                  	mov ax, word [bp + bsBPB + ebpbBackupSector]
  2806 00001138 8A0E[5A46]              	mov cl, [drivenumber]
  2807 0000113C E8AE34                  	call write_ae_512_bytes
  2808 0000113F 7353                    	jnc exit_normal
  2809 00001141 BA[3C5F]                	mov dx, msg.backup_error_sector
  2810 00001144 E83A32                  	call disp_msg_asciz
  2811 00001147 EB4B                    	jmp exit_normal
  2812                                  
  2813                                  .not_writing_sector_copy:
  2814 00001149 F606[4446]10            	testopt [internalflags], detectedcopysector
  2815 0000114E 7444                    	jz exit_normal
  2816 00001150 BA[ED5E]                	mov dx, msg.backup_not_writing_sector
  2817 00001153 E82B32                  	call disp_msg_asciz
  2818 00001156 EB3C                    	jmp exit_normal
  2819                                  
  2820                                  
  2821                                  exit_error_restore_fsinfo:
  2822                                  		; If the boot sector failed to write after FSINFO was
  2823                                  		;  already written, try to restore FSINFO.
  2824 00001158 F646E702                	test byte [bp + ldHasLBA], 2
  2825 0000115C 742B                    	jz @F
  2826                                  		; If haven't written, do not restore.
  2827 0000115E F606[2008]08            	testopt [cmd_line_flags], clfDontWriteInfo
  2828 00001163 7524                    	jnz @F
  2829                                  		; If have written to a file, do not restore.
  2830 00001165 F606[2008]50            	testopt [cmd_line_flags], clfWriteInfoToFile | clfWriteInfoToSectorFile
  2831 0000116A 751D                    	jnz @F
  2832                                  
  2833 0000116C BA[105E]                	mov dx, msg.info_restoring_sector
  2834 0000116F E80F32                  	call disp_msg_asciz
  2835                                  
  2836 00001172 BB[802A]                	mov bx, second_sector_buffer + 512
  2837 00001175 8B4630                  	mov ax, word [bp + bsBPB + ebpbFSINFOSector]
  2838 00001178 31D2                    	xor dx, dx
  2839 0000117A 8A0E[5A46]              	mov cl, [drivenumber]
  2840 0000117E E86C34                  	call write_ae_512_bytes
  2841 00001181 7306                    	jnc @F
  2842                                  
  2843 00001183 BA[3156]                	mov dx, msg.critical_fail_fsinfo_changed
  2844 00001186 E8F831                  	call disp_msg_asciz
  2845                                  @@:
  2846                                  
  2847                                  
  2848                                  exit_error:
  2849 00001189 E8E331                  	call restorestate
  2850 0000118C B8014C                  	mov ax, 4C01h
  2851 0000118F CD21                    	int 21h
  2852                                  
  2853                                  
  2854                                  exit_normal_message:
  2855 00001191 E8ED31                  	call disp_msg_asciz
  2856                                  
  2857                                  exit_normal:
  2858 00001194 E8D831                  	call restorestate
  2859 00001197 B8004C                  	mov ax, 4C00h
  2860 0000119A CD21                    	int 21h
  2861                                  
  2862                                  
  2863                                  		; INP:	ds:di -> cmd_line_file structure
  2864                                  		;		(word pointer to name, word handle)
  2865                                  		; OUT:	NC if success, file opened,
  2866                                  		;	 bx = file handle
  2867                                  		;	CY if error, called disp_dos_error
  2868                                  		; CHG:	ax, bx, cx, dx, si
  2869                                  		; Note:	We never close our files, instead relying on the
  2870                                  		;	 process termination to close them.
  2871                                  open_file_readwrite:
  2872 0000119C B002                    	mov al, 2
  2873 0000119E A9                      	db __TEST_IMM16		; (skip mov al)
  2874                                  open_file_read:
  2875 0000119F B000                    	mov al, 0
  2876 000011A1 A9                      	db __TEST_IMM16		; (skip mov al)
  2877                                  open_file_write:
  2878 000011A2 B001                    	mov al, 1
  2879                                  	lframe near
  2880 000011A4 5589E5                  	lenter
  2881                                  	lvar word,	bit0_wo_bit1_rw
  2882 000011A7 50                      	 push ax
  2883                                  
  2884                                  		; Is it already open ?
  2885 000011A8 8B5D02                  	mov bx, word [di + cmd_line_file_handle_ofs]
  2886 000011AB 83FBFF                  	cmp bx, -1
  2887 000011AE 7405                    	je @F
  2888 000011B0 F8                      	clc
  2889                                  .return:
  2890 000011B1 89EC5D                  	lleave code
  2891 000011B4 C3                      	retn
  2892                                  
  2893                                  @@:
  2894                                  
  2895 000011B5 E8A900                  	call .setup_opencreate			; ds:si -> pathname
  2896 000011B8 B86C71                  	mov ax, 716Ch				; LFN open-create
  2897 000011BB 57                      	push di
  2898 000011BC 31FF                    	xor di, di				; alias hint
  2899 000011BE F9                      	stc
  2900 000011BF CD21                    	int 21h
  2901 000011C1 5F                      	pop di
  2902 000011C2 7378                    	jnc .got		; LFN call succeeded -->
  2903                                  
  2904                                  		; Early case for no-LFN-interface available.
  2905                                  	; cmp ax, 1
  2906                                  	; je .try_sfn
  2907 000011C4 3D0071                  	cmp ax, 7100h
  2908 000011C7 744B                    	je .try_sfn
  2909                                  
  2910                                  		; Only now, we check whether the used drive supports LFNs.
  2911                                  		; If it does, then we treat the error received as an
  2912                                  		; actual error and cancel here. If not, the SFN function
  2913                                  		; is called next as a fallback.
  2914                                  		;
  2915                                  		; We cannot rely on specific error returns like the
  2916                                  		; expected 7100h CY (or 7100h CF-unchanged) or the similar
  2917                                  		; 0001h CY (Invalid function) because no one agrees on what
  2918                                  		; error code to use.
  2919                                  		;
  2920                                  		; dosemu returns 0003h (Path not found) on FATFS and
  2921                                  		; redirected-non-dosemu drives. But may be changed so as to
  2922                                  		; return 0059h (Function not supported on network).
  2923                                  		; MSWindows 98SE returns 0002h (File not found) on
  2924                                  		; DOS-redirected drives.
  2925                                  		; DOSLFN with Fallback mode enabled supports the call (albeit
  2926                                  		; limited to SFNs).
  2927                                  		;
  2928                                  		; To suss out what the error means, check LFN availability.
  2929                                  		;
  2930                                  		; Refer to https://github.com/stsp/dosemu2/issues/770
  2931 000011C9 1E                      	push ds
  2932 000011CA 06                      	push es
  2933 000011CB 57                      	push di
  2934 000011CC 50                      	push ax
  2935                                  	lframe none, nested
  2936                                  	lvar 34, fstype_buffer
  2937                                  	lvar 4, pathname_buffer
  2938 000011CD 5589E58D66DA            	lenter
  2939                                  
  2940 000011D3 AD                      	lodsw			; load first two bytes of pathname
  2941                                  
  2942 000011D4 16                      	push ss
  2943 000011D5 1F                      	pop ds
  2944 000011D6 89E2                    	mov dx, sp		; ds:dx -> ?pathname_buffer
  2945 000011D8 16                      	push ss
  2946 000011D9 07                      	pop es
  2947 000011DA 89E7                    	mov di, sp		; es:di -> ?pathname_buffer
  2948                                  
  2949 000011DC 80FC3A                  	cmp ah, ':'		; starts with drive specifier ?
  2950 000011DF 7408                    	je @F			; yes -->
  2951                                  
  2952 000011E1 B419                    	mov ah, 19h
  2953 000011E3 CD21                    	int 21h			; get current default drive
  2954 000011E5 0441                    	add al, 'A'		; A: = 0, convert to drive letter
  2955 000011E7 B43A                    	mov ah, ':'		; drive specifier
  2956                                  @@:
  2957 000011E9 AB                      	stosw
  2958 000011EA B85C00                  	mov ax, '\'		; backslash and zero terminator
  2959 000011ED AB                      	stosw			; es:di -> ?fstype_buffer
  2960                                  
  2961 000011EE 31C0                    	xor ax, ax
  2962 000011F0 B91100                  	mov cx, 34 >> 1
  2963 000011F3 57                      	push di
  2964 000011F4 F3AB                    	rep stosw		; initialise ?fstype_buffer to all zeros
  2965 000011F6 5F                      	pop di			; -> ?fstype_buffer
  2966                                  
  2967 000011F7 B92000                  	mov cx, 32		; size of ?fstype_buffer
  2968 000011FA 31DB                    	xor bx, bx		; harden, initialise this
  2969 000011FC B8A071                  	mov ax, 71A0h		; get volume information
  2970 000011FF F9                      	stc
  2971 00001200 CD21                    	int 21h
  2972                                  
  2973 00001202 7207                    	jc @F			; if call not supported -->
  2974                                  				; bx = FS flags
  2975 00001204 F6C740                  	test bh, 0100_0000b	; LFN interface available ?
  2976 00001207 F9                      	stc			; if no
  2977 00001208 7401                    	jz @F			; no -->
  2978                                  
  2979 0000120A F8                      	clc			; is available
  2980                                  @@:
  2981                                  
  2982 0000120B 89EC5D                  	lleave
  2983 0000120E 58                      	pop ax			; (restore error code)
  2984 0000120F 5F                      	pop di
  2985 00001210 07                      	pop es
  2986 00001211 1F                      	pop ds
  2987 00001212 7331                    	jnc .error		; if LFN interface is available, actual error
  2988                                  				; if LFN interface is not available, try SFN
  2989                                  
  2990                                  .try_sfn:
  2991 00001214 E84A00                  	call .setup_opencreate
  2992 00001217 B8006C                  	mov ax, 6C00h				; Open-create
  2993 0000121A F9                      	stc
  2994 0000121B CD21                    	int 21h
  2995 0000121D 731D                    	jnc .got
  2996                                  
  2997 0000121F 83F801                  	cmp ax, 1
  2998 00001222 7405                    	je .try_old_open_or_create
  2999 00001224 3D006C                  	cmp ax, 6C00h
  3000 00001227 751C                    	jne .error
  3001                                  
  3002                                  .try_old_open_or_create:
  3003 00001229 B43C                    	mov ah, 3Ch				; Create (Create/Truncate)
  3004 0000122B F646FE01                	test byte [bp + ?bit0_wo_bit1_rw], 1
  3005 0000122F 7504                    	jnz @F					; setup for write -->
  3006 00001231 88D8                    	mov al, bl
  3007 00001233 B43D                    	mov ah, 3Dh				; Open
  3008                                  @@:
  3009 00001235 89F2                    	mov dx, si				; -> filename
  3010                                  						; cx = create attribute
  3011 00001237 F9                      	stc
  3012 00001238 CD21                    	int 21h
  3013 0000123A 7209                    	jc .error
  3014                                  
  3015                                  .got:
  3016 0000123C 89C3                    	mov bx, ax
  3017 0000123E 895D02                  	mov word [di + cmd_line_file_handle_ofs], bx
  3018 00001241 F8                      	clc
  3019 00001242 E96CFF                  	jmp .return
  3020                                  
  3021                                  .error:
  3022 00001245 BA[1F61]                	mov dx, msg.error_file_open_write
  3023 00001248 F646FE01                	test byte [bp + ?bit0_wo_bit1_rw], 1
  3024 0000124C 750C                    	jnz @F					; setup for write -->
  3025 0000124E BA[6161]                	mov dx, msg.error_file_open_readwrite
  3026 00001251 F646FE02                	test byte [bp + ?bit0_wo_bit1_rw], 2
  3027 00001255 7503                    	jnz @F					; setup for rw -->
  3028 00001257 BA[4061]                	mov dx, msg.error_file_open_read
  3029                                  @@:
  3030 0000125A E82500                  	call disp_dos_error
  3031 0000125D F9                      	stc
  3032 0000125E E950FF                  	jmp .return
  3033                                  
  3034                                  .setup_opencreate:
  3035 00001261 8B35                    	mov si, word [di + cmd_line_file_name_ofs]
  3036                                  						; -> filename
  3037 00001263 31C9                    	xor cx, cx				; create attribute
  3038 00001265 F646FE01                	test byte [bp + ?bit0_wo_bit1_rw], 1
  3039 00001269 750D                    	jnz @F					; setup for write -->
  3040 0000126B BB2060                  	mov bx, 0110_0000_0010_0000b		; Auto-commit, no int 24h
  3041                                  						; DENY WRITE, Read-only
  3042 0000126E BA0100                  	mov dx, 0000_0000_0000_0001b		; open
  3043 00001271 F646FE02                	test byte [bp + ?bit0_wo_bit1_rw], 2
  3044 00001275 7508                    	jnz @FF					; setup for rw -->
  3045 00001277 C3                      	retn
  3046                                  
  3047                                  @@:
  3048 00001278 BB2160                  	mov bx, 0110_0000_0010_0001b		; Auto-commit, no int 24h
  3049                                  						; DENY WRITE, Write-only
  3050 0000127B BA1200                  	mov dx, 0000_0000_0001_0010b		; create / open-truncate
  3051 0000127E C3                      	retn
  3052                                  
  3053                                  @@:
  3054 0000127F B322                    	mov bl, 0010_0010b			; DENY WRITE, Read-write
  3055 00001281 C3                      	retn
  3056                                  
  3057                                  	lleave ctx
  3058                                  
  3059                                  
  3060                                  disp_dos_error:
  3061 00001282 E8FC30                  	call disp_msg_asciz
  3062 00001285 BA[BD61]                	mov dx, msg.dos_error_msg_1
  3063 00001288 E8F630                  	call disp_msg_asciz
  3064 0000128B E81031                  	call disp_ax_hex
  3065 0000128E BA[C861]                	mov dx, msg.dos_error_msg_2
  3066 00001291 E8ED30                  	call disp_msg_asciz
  3067 00001294 BA[8464]                	mov dx, msg.dos_error_unknown
  3068 00001297 83F828                  	cmp ax, dos_error_table.after_last
  3069 0000129A 7308                    	jae @F
  3070 0000129C 89C3                    	mov bx, ax
  3071 0000129E D1E3                    	shl bx, 1
  3072 000012A0 8B97[9264]              	mov dx, word [dos_error_table + bx]
  3073                                  @@:
  3074 000012A4 E8DA30                  	call disp_msg_asciz
  3075 000012A7 BA[CC61]                	mov dx, msg.dos_error_msg_3
  3076 000012AA E9D430                  	jmp disp_msg_asciz
  3077                                  
  3078                                  
  3079                                  		; INP:	ds:dx -> buffer
  3080                                  		;	bx = handle
  3081                                  		; OUT:	NC if success
  3082                                  		;	CY if error, disp_dos_error called
  3083                                  write_file_ae_512_bytes:
  3084 000012AD 8B4EDC                  	mov cx, word [bp + ldBytesPerSector]
  3085 000012B0 81F90002                	cmp cx, 512		; more than 512 bytes ?
  3086 000012B4 7703                    	ja @F			; yes -->
  3087 000012B6 B90002                  	mov cx, 512		; fix sector size
  3088                                  @@:
  3089 000012B9 B440                    	mov ah, 40h
  3090 000012BB CD21                    	int 21h			; write file
  3091 000012BD 7207                    	jc @F
  3092 000012BF 39C8                    	cmp ax, cx
  3093 000012C1 B8FFFF                  	mov ax, -1
  3094 000012C4 7407                    	je @FF			; (NC) -->
  3095                                  @@:
  3096 000012C6 BA[7E61]                	mov dx, msg.error_file_write
  3097 000012C9 E8B6FF                  	call disp_dos_error
  3098 000012CC F9                      	stc
  3099                                  @@:
  3100 000012CD C3                      	retn
  3101                                  
  3102                                  
  3103                                  unit_search_strings:
  3104 000012CE BD007C                  .mov:	mov bp, 7C00h
  3105                                  .mov_length: equ $ - .mov
  3106 000012D1 885624                  .1612_set_bpbn:		mov byte [bp + bsBPB + bpbNew + bpbnBootUnit], dl
  3107                                  .1612_set_bpbn_length:	equ $ - .1612_set_bpbn
  3108 000012D4 8A5624                  .1612_set_dl:		mov dl, byte [bp + bsBPB + bpbNew + bpbnBootUnit]
  3109                                  .1612_set_dl_length:	equ $ - .1612_set_dl
  3110                                  %if .1612_set_bpbn_length != .1612_set_dl_length
  3111                                   %error Unit fixing replacement string not same length!
  3112                                  %endif
  3113                                  
  3114 000012D7 885640                  .32_set_bpbn:		mov byte [bp + bsBPB + ebpbNew + bpbnBootUnit], dl
  3115                                  .32_set_bpbn_length:	equ $ - .32_set_bpbn
  3116 000012DA 8A5640                  .32_set_dl:		mov dl, byte [bp + bsBPB + ebpbNew + bpbnBootUnit]
  3117                                  .32_set_dl_length:	equ $ - .32_set_dl
  3118                                  %if .32_set_bpbn_length != .32_set_dl_length
  3119                                   %error Unit fixing replacement string not same length!
  3120                                  %endif
  3121                                  
  3122                                  
  3123                                  partinfo_search_strings:
  3124                                  .mov:
  3125 000012DD 84D2                    	test dl, dl		; floppy ?
  3126 000012DF 7911                    	jns @F			; don't attempt detection -->
  3127                                  ; Check whether an MBR left us partition information.
  3128                                  ; byte[ds:si] bit 7 means active and must be set if valid.
  3129 000012E1 380C                    	cmp byte [si], cl	; flags for xx-00h (result is xx), SF = bit 7
  3130 000012E3 790D                    	jns @F			; xx < 80h, ie info invalid -->
  3131                                  ; byte[ds:si+4] is the file system type. Check for valid one.
  3132 000012E5 384C04                  	cmp byte [si+4], cl	; is it zero?
  3133 000012E8 7408                    	je @F			; yes, info invalid -->
  3134                                  ; Info valid, trust their hidden sectors over hardcoded.
  3135                                  ; Assume the movsw instructions won't run with si = FFFFh.
  3136 000012EA BF1C7C                  	mov di, 7C00h + bsBPB + bpbHiddenSectors
  3137                                  				; -> BPB field
  3138 000012ED 83C608                  	add si, 8		; -> partition start sector in info
  3139 000012F0 A5                      	movsw
  3140 000012F1 A5                      	movsw			; overwrite BPB field with value from info
  3141                                  @@:
  3142                                  .mov_length:	equ $ - .mov
  3143                                  .keep:
  3144 000012F2 84D2                    	test dl, dl		; floppy ?
  3145 000012F4 7911                    	jns @F			; don't attempt detection -->
  3146                                  ; Check whether an MBR left us partition information.
  3147                                  ; byte[ds:si] bit 7 means active and must be set if valid.
  3148 000012F6 380C                    	cmp byte [si], cl	; flags for xx-00h (result is xx), SF = bit 7
  3149 000012F8 790D                    	jns @F			; xx < 80h, ie info invalid -->
  3150                                  ; byte[ds:si+4] is the file system type. Check for valid one.
  3151 000012FA 384C04                  	cmp byte [si+4], cl	; is it zero?
  3152 000012FD 7408                    	je @F			; yes, info invalid -->
  3153                                  ; Info valid, trust their hidden sectors over hardcoded.
  3154                                  ; Assume the movsw instructions won't run with si = FFFFh.
  3155 000012FF BF1C7C                  	mov di, 7C00h + bsBPB + bpbHiddenSectors
  3156                                  				; -> BPB field
  3157 00001302 83C608                  	add si, 8		; -> partition start sector in info
  3158                                  
  3159                                  		; Patched out movsw twice
  3160 00001305 90                      	nop
  3161 00001306 90                      	nop			; overwrite BPB field with value from info
  3162                                  @@:
  3163                                  .keep_length:	equ $ - .keep
  3164                                  %if .mov_length != .keep_length
  3165                                   %error Partinfo fixing replacement string not same length!
  3166                                  %endif
  3167                                  
  3168                                  
  3169                                  query_search_strings:
  3170                                  .query:
  3171                                  ;	test dl, dl		; floppy?
  3172                                  ;	jns @F			; don't attempt query, might fail -->
  3173                                  	; Note that while the original PC BIOS doesn't support this function
  3174                                  	;  (for its diskettes), it does properly return the error code 01h.
  3175                                  	; https://sites.google.com/site/pcdosretro/ibmpcbios (IBM PC version 1)
  3176 00001307 B408                    	mov ah, 08h
  3177                                  	; xor cx, cx		; initialise cl to 0
  3178                                  	; Already from prologue cx = 0.
  3179 00001309 F9                      	stc			; initialise to CY
  3180 0000130A CD13                    	int 13h			; query drive geometry
  3181 0000130C 720E                    	jc @F			; apparently failed -->
  3182 0000130E 83E13F                  	and cx, 3Fh		; get sectors
  3183 00001311 7409                    	jz @F			; invalid (S is 1-based), don't use -->
  3184 00001313 894E18                  	mov [bp + bsBPB + bpbCHSSectors], cx
  3185 00001316 88F1                    	mov cl, dh		; cx = maximum head number
  3186 00001318 41                      	inc cx			; cx = number of heads (H is 0-based)
  3187 00001319 894E1A                  	mov [bp + bsBPB + bpbCHSHeads], cx
  3188                                  @@:
  3189                                  .query_length:	equ $ - .query
  3190                                  .keep:
  3191                                  ;	test dl, dl		; floppy?
  3192                                  ;	jns @F			; don't attempt query, might fail -->
  3193                                  	; Note that while the original PC BIOS doesn't support this function
  3194                                  	;  (for its diskettes), it does properly return the error code 01h.
  3195                                  	; https://sites.google.com/site/pcdosretro/ibmpcbios (IBM PC version 1)
  3196 0000131C B408                    	mov ah, 08h
  3197                                  	; xor cx, cx		; initialise cl to 0
  3198                                  	; Already from prologue cx = 0.
  3199 0000131E F9                      	stc			; initialise to CY
  3200                                  
  3201                                  		; Patched out int 13h
  3202 0000131F 90                      	nop
  3203 00001320 90                      	nop
  3204                                  
  3205 00001321 720E                    	jc @F			; apparently failed -->
  3206 00001323 83E13F                  	and cx, 3Fh		; get sectors
  3207 00001326 7409                    	jz @F			; invalid (S is 1-based), don't use -->
  3208 00001328 894E18                  	mov [bp + bsBPB + bpbCHSSectors], cx
  3209 0000132B 88F1                    	mov cl, dh		; cx = maximum head number
  3210 0000132D 41                      	inc cx			; cx = number of heads (H is 0-based)
  3211 0000132E 894E1A                  	mov [bp + bsBPB + bpbCHSHeads], cx
  3212                                  @@:
  3213                                  .keep_length:	equ $ - .keep
  3214                                  %if .query_length != .keep_length
  3215                                   %error Query geometry fixing replacement string not same length!
  3216                                  %endif
  3217                                  
  3218                                  
  3219                                  %define SEARCHES dw ""
  3220                                  	%macro search_wildcard 1-2 0
  3221                                  %assign %%wc $ + %2 - %1
  3222                                  %if %%wc == 0
  3223                                   %error Wildcard at beginning of search string is not allowed
  3224                                  %endif
  3225                                  %xdefine WILDCARDS WILDCARDS, dw %%wc
  3226                                  	%endmacro
  3227                                  
  3228                                  	%macro ldosboot_lba_search_string 9
  3229                                  %define WILDCARDS dw ""
  3230                                  %assign _FORCE_CHS %2
  3231                                  %assign _LBA_SKIP_CHECK %3
  3232                                  %assign _LBA_SKIP_CY %4
  3233                                  %assign _LBA_SKIP_LBA_RETRY %5
  3234                                  %assign _LBA_SKIP_ANY %6
  3235                                  %assign _RETRY_RESET %7
  3236                                  %assign _LBA_RETRY %8
  3237                                  %assign _CHS 1
  3238                                  %assign _LDOSBOOT32 %9
  3239                                  
  3240                                  
  3241                                  %if _FORCE_CHS
  3242                                   %define %%identifier label_%1_chs
  3243                                   %define %%other label_%1_lba
  3244                                  %else
  3245                                   %define %%identifier label_%1_lba
  3246                                   %define %%other label_%1_chs
  3247                                  %endif
  3248                                  
  3249                                  %%start:
  3250                                  %[%%identifier %+ _search_string]:
  3251                                  
  3252                                   %if _LBA_SKIP_CHECK		; -14 bytes
  3253                                  	mov dl, [bp + 127]
  3254                                  search_wildcard %%start, -1
  3255                                   %else
  3256                                  	mov ah, 41h
  3257                                  	mov dl, [bp + 127]
  3258                                  search_wildcard %%start, -1
  3259                                  	mov bx, 55AAh
  3260                                  	stc
  3261                                  %if _FORCE_CHS
  3262                                  	nop
  3263                                  	nop
  3264                                  %else
  3265                                  	int 13h		; 13.41.bx=55AA extensions installation check
  3266                                  %endif
  3267                                  	jc .no_lba
  3268                                  search_wildcard %%start, -1
  3269                                  	cmp bx, 0AA55h
  3270                                  	jne .no_lba
  3271                                  search_wildcard %%start, -1
  3272                                  	shr cl, 1	; support bitmap bit 0
  3273                                  	jnc .no_lba
  3274                                  search_wildcard %%start, -1
  3275                                   %endif
  3276                                  
  3277                                  %if _LBA_RETRY
  3278                                   %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                                  	stc
  3280                                   %endif
  3281                                  	mov ah, 42h
  3282                                  %if _FORCE_CHS
  3283                                  	nop
  3284                                  	stc
  3285                                  %else
  3286                                  	int 13h		; 13.42 extensions read
  3287                                  %endif
  3288                                  	jnc .lba_done
  3289                                  search_wildcard %%start, -1
  3290                                  
  3291                                   %if _RETRY_RESET
  3292                                  	xor ax, ax
  3293                                  	int 13h		; reset disk
  3294                                   %endif
  3295                                  
  3296                                  		; have to reset the LBAPACKET's lpCount, as the handler may
  3297                                  		;  set it to "the number of blocks successfully transferred".
  3298                                  		; (in any case, the high byte is still zero.)
  3299                                  	mov byte [si + 2], 1
  3300                                  %endif
  3301                                  
  3302                                   %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                                  	stc
  3304                                   %endif
  3305                                  %if _FORCE_CHS
  3306                                  	mov ah, 01h
  3307                                  	nop
  3308                                  	stc
  3309                                  %else
  3310                                  	mov ah, 42h
  3311                                  	int 13h
  3312                                  %endif
  3313                                   %if _LBA_SKIP_CHECK && _CHS
  3314                                   %if _LDOSBOOT32
  3315                                    %if _LBA_SKIP_ANY
  3316                                  	jc .no_lba
  3317                                  search_wildcard %%start, -1
  3318                                    %else
  3319                                  	jnc .lba_done
  3320                                  search_wildcard %%start, -1
  3321                                  	cmp ah, 1	; invalid function?
  3322                                  	je .no_lba	; try CHS instead -->
  3323                                  search_wildcard %%start, -1
  3324                                    %endif
  3325                                   %else
  3326                                    %if _LBA_SKIP_ANY
  3327                                  	jc .no_lba
  3328                                  search_wildcard %%start, -1
  3329                                    %else
  3330                                  	jc .lba_check_error_1
  3331                                  search_wildcard %%start, -1
  3332                                    %endif
  3333                                   %endif
  3334                                   %else
  3335                                  .cy_err:
  3336                                  	jc .lba_error
  3337                                  search_wildcard %%start, -1
  3338                                   %endif
  3339                                  
  3340                                  .lba_error:
  3341                                  .lba_check_error_1:
  3342                                  .lba_done:
  3343                                  .no_lba:
  3344                                  %%end:
  3345                                  
  3346                                  %if _FORCE_CHS
  3347                                   %define %%message lba_search_msg.forcechs
  3348                                  %else
  3349                                   %if _LBA_SKIP_CHECK
  3350                                    %define %%message lba_search_msg.autoskip
  3351                                   %else
  3352                                    %define %%message lba_search_msg.auto
  3353                                   %endif
  3354                                  %endif
  3355                                  %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, 	 dw %%message, dw %%other, WILDCARDS, dw 0
  3357                                  %[%%identifier %+ _length]: equ %%end - %%start
  3358                                  %if _FORCE_CHS
  3359                                   %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                                    %error Expected same length of replacement
  3361                                   %endif
  3362                                  %endif
  3363                                  	%endmacro
  3364                                  
  3365                                  	%macro freedos_lba_search_string 4
  3366                                  %define WILDCARDS dw ""
  3367                                  %assign _FORCE_CHS %2
  3368                                  %assign _OEM_BOOT %3
  3369                                  %assign _FORCE_CHS_DISKETTE %4
  3370                                  
  3371                                  
  3372                                  %if _FORCE_CHS_DISKETTE
  3373                                   %define %%identifier label_%1_chs_diskette
  3374                                   %define %%other label_%1_special
  3375                                  %elif _FORCE_CHS
  3376                                   %define %%identifier label_%1_chs
  3377                                   %define %%other label_%1_lba
  3378                                  %else
  3379                                   %define %%identifier label_%1_lba
  3380                                   %define %%other label_%1_chs
  3381                                  %endif
  3382                                  
  3383                                  %%start:
  3384                                  %[%%identifier %+ _search_string]:
  3385                                  
  3386                                  	mov ah, 41h
  3387                                  	mov bx, 55AAh
  3388                                  	mov dl, [bp + 127]
  3389                                  search_wildcard %%start, -1
  3390                                  
  3391                                  %if _FORCE_CHS
  3392                                  	xor dl, dl
  3393                                  	jz @F
  3394                                  %elif _FORCE_CHS_DISKETTE
  3395                                  	test dl, dl
  3396                                  	jz @F
  3397                                  %else
  3398                                  	test dl, dl
  3399                                  	nop
  3400                                  	nop
  3401                                  %endif
  3402                                  	int 13h
  3403                                  	jc @F
  3404                                  	shr cx, 1
  3405                                  	sbb bx, 0AA55h - 1
  3406                                  	jne @F
  3407                                  
  3408                                  %if _OEM_BOOT
  3409                                  	lea si, [bp + 1023]
  3410                                  search_wildcard %%start, -2
  3411                                  search_wildcard %%start, -1
  3412                                  	mov word [bp + 1023], bx
  3413                                  search_wildcard %%start, -2
  3414                                  search_wildcard %%start, -1
  3415                                  	mov word [bp + 1023], bx
  3416                                  search_wildcard %%start, -2
  3417                                  search_wildcard %%start, -1
  3418                                  %else
  3419                                  	lea si, [bp - 128]
  3420                                  search_wildcard %%start, -1
  3421                                  	mov word [bp - 128], bx
  3422                                  search_wildcard %%start, -1
  3423                                  	mov word [bp - 128], bx
  3424                                  search_wildcard %%start, -1
  3425                                  %endif
  3426                                  	mov ah, 42h
  3427                                  	jmp strict short @F
  3428                                  search_wildcard %%start, -1
  3429                                  @@:
  3430                                  %%end:
  3431                                  
  3432                                  
  3433                                  %if _FORCE_CHS
  3434                                   %define %%message lba_search_msg.forcechs
  3435                                  %else
  3436                                   %if _FORCE_CHS_DISKETTE
  3437                                    %define %%message lba_search_msg.autohdd
  3438                                   %else
  3439                                    %define %%message lba_search_msg.auto
  3440                                   %endif
  3441                                  %endif
  3442                                  %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, 	 dw %%message, dw %%other, WILDCARDS, dw 0
  3444                                  %[%%identifier %+ _length]: equ %%end - %%start
  3445                                  %if _FORCE_CHS
  3446                                   %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                                    %error Expected same length of replacement
  3448                                   %endif
  3449                                  %endif
  3450                                  	%endmacro
  3451                                  
  3452                                  
  3453                                  lba_search_msg:
  3454 00001331 4175746F204C424120-     .auto:		asciz "Auto LBA detection"
  3454 0000133A 646574656374696F6E-
  3454 00001343 00                 
  3455 00001344 4175746F204C424120-     .autohdd:	asciz "Auto LBA detection (HDD only)"
  3455 0000134D 646574656374696F6E-
  3455 00001356 2028484444206F6E6C-
  3455 0000135F 792900             
  3456 00001362 4175746F204C424120-     .autoskip:	asciz "Auto LBA detection (skip check)"
  3456 0000136B 646574656374696F6E-
  3456 00001374 2028736B6970206368-
  3456 0000137D 65636B2900         
  3457 00001382 466F72636564204348-     .forcechs:	asciz "Forced CHS access"
  3457 0000138B 532061636365737300 
  3458                                  
  3459                                  lba_search_strings_lba:
  3460                                  	freedos_lba_search_string freedos, 0, 0, 0
  3366                              <1> %define WILDCARDS dw ""
  3367                              <1> %assign _FORCE_CHS %2
  3368                              <1> %assign _OEM_BOOT %3
  3369                              <1> %assign _FORCE_CHS_DISKETTE %4
  3370                              <1> 
  3371                              <1> 
  3372                              <1> %if _FORCE_CHS_DISKETTE
  3373                              <1>  %define %%identifier label_%1_chs_diskette
  3374                              <1>  %define %%other label_%1_special
  3375                              <1> %elif _FORCE_CHS
  3376                              <1>  %define %%identifier label_%1_chs
  3377                              <1>  %define %%other label_%1_lba
  3378                              <1> %else
  3379                              <1>  %define %%identifier label_%1_lba
  3380                              <1>  %define %%other label_%1_chs
  3381                              <1> %endif
  3382                              <1> 
  3383                              <1> %%start:
  3384                              <1> %[%%identifier %+ _search_string]:
  3385                              <1> 
  3386 00001394 B441                <1>  mov ah, 41h
  3387 00001396 BBAA55              <1>  mov bx, 55AAh
  3388 00001399 8A567F              <1>  mov dl, [bp + 127]
  3389                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <1> 
  3391                              <1> %if _FORCE_CHS
  3392                              <1>  xor dl, dl
  3393                              <1>  jz @F
  3394                              <1> %elif _FORCE_CHS_DISKETTE
  3395                              <1>  test dl, dl
  3396                              <1>  jz @F
  3397                              <1> %else
  3398 0000139C 84D2                <1>  test dl, dl
  3399 0000139E 90                  <1>  nop
  3400 0000139F 90                  <1>  nop
  3401                              <1> %endif
  3402 000013A0 CD13                <1>  int 13h
  3403 000013A2 7215                <1>  jc @F
  3404 000013A4 D1E9                <1>  shr cx, 1
  3405 000013A6 81DB54AA            <1>  sbb bx, 0AA55h - 1
  3406 000013AA 750D                <1>  jne @F
  3407                              <1> 
  3408                              <1> %if _OEM_BOOT
  3409                              <1>  lea si, [bp + 1023]
  3410                              <1> search_wildcard %%start, -2
  3411                              <1> search_wildcard %%start, -1
  3412                              <1>  mov word [bp + 1023], bx
  3413                              <1> search_wildcard %%start, -2
  3414                              <1> search_wildcard %%start, -1
  3415                              <1>  mov word [bp + 1023], bx
  3416                              <1> search_wildcard %%start, -2
  3417                              <1> search_wildcard %%start, -1
  3418                              <1> %else
  3419 000013AC 8D7680              <1>  lea si, [bp - 128]
  3420                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3421 000013AF 895E80              <1>  mov word [bp - 128], bx
  3422                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3423 000013B2 895E80              <1>  mov word [bp - 128], bx
  3424                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3425                              <1> %endif
  3426 000013B5 B442                <1>  mov ah, 42h
  3427 000013B7 EB00                <1>  jmp strict short @F
  3428                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <1> @@:
  3430                              <1> %%end:
  3431                              <1> 
  3432                              <1> 
  3433                              <1> %if _FORCE_CHS
  3434                              <1>  %define %%message lba_search_msg.forcechs
  3435                              <1> %else
  3436                              <1>  %if _FORCE_CHS_DISKETTE
  3437                              <1>  %define %%message lba_search_msg.autohdd
  3438                              <1>  %else
  3439                              <1>  %define %%message lba_search_msg.auto
  3440                              <1>  %endif
  3441                              <1> %endif
  3442                              <1> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <1> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <1> %if _FORCE_CHS
  3446                              <1>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <1>  %error Expected same length of replacement
  3448                              <1>  %endif
  3449                              <1> %endif
  3461                                  	freedos_lba_search_string freedos_oem, 0, 1, 0
  3366                              <1> %define WILDCARDS dw ""
  3367                              <1> %assign _FORCE_CHS %2
  3368                              <1> %assign _OEM_BOOT %3
  3369                              <1> %assign _FORCE_CHS_DISKETTE %4
  3370                              <1> 
  3371                              <1> 
  3372                              <1> %if _FORCE_CHS_DISKETTE
  3373                              <1>  %define %%identifier label_%1_chs_diskette
  3374                              <1>  %define %%other label_%1_special
  3375                              <1> %elif _FORCE_CHS
  3376                              <1>  %define %%identifier label_%1_chs
  3377                              <1>  %define %%other label_%1_lba
  3378                              <1> %else
  3379                              <1>  %define %%identifier label_%1_lba
  3380                              <1>  %define %%other label_%1_chs
  3381                              <1> %endif
  3382                              <1> 
  3383                              <1> %%start:
  3384                              <1> %[%%identifier %+ _search_string]:
  3385                              <1> 
  3386 000013B9 B441                <1>  mov ah, 41h
  3387 000013BB BBAA55              <1>  mov bx, 55AAh
  3388 000013BE 8A567F              <1>  mov dl, [bp + 127]
  3389                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <1> 
  3391                              <1> %if _FORCE_CHS
  3392                              <1>  xor dl, dl
  3393                              <1>  jz @F
  3394                              <1> %elif _FORCE_CHS_DISKETTE
  3395                              <1>  test dl, dl
  3396                              <1>  jz @F
  3397                              <1> %else
  3398 000013C1 84D2                <1>  test dl, dl
  3399 000013C3 90                  <1>  nop
  3400 000013C4 90                  <1>  nop
  3401                              <1> %endif
  3402 000013C5 CD13                <1>  int 13h
  3403 000013C7 7218                <1>  jc @F
  3404 000013C9 D1E9                <1>  shr cx, 1
  3405 000013CB 81DB54AA            <1>  sbb bx, 0AA55h - 1
  3406 000013CF 7510                <1>  jne @F
  3407                              <1> 
  3408                              <1> %if _OEM_BOOT
  3409 000013D1 8DB6FF03            <1>  lea si, [bp + 1023]
  3410                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3411                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3412 000013D5 899EFF03            <1>  mov word [bp + 1023], bx
  3413                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3414                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3415 000013D9 899EFF03            <1>  mov word [bp + 1023], bx
  3416                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3417                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3418                              <1> %else
  3419                              <1>  lea si, [bp - 128]
  3420                              <1> search_wildcard %%start, -1
  3421                              <1>  mov word [bp - 128], bx
  3422                              <1> search_wildcard %%start, -1
  3423                              <1>  mov word [bp - 128], bx
  3424                              <1> search_wildcard %%start, -1
  3425                              <1> %endif
  3426 000013DD B442                <1>  mov ah, 42h
  3427 000013DF EB00                <1>  jmp strict short @F
  3428                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <1> @@:
  3430                              <1> %%end:
  3431                              <1> 
  3432                              <1> 
  3433                              <1> %if _FORCE_CHS
  3434                              <1>  %define %%message lba_search_msg.forcechs
  3435                              <1> %else
  3436                              <1>  %if _FORCE_CHS_DISKETTE
  3437                              <1>  %define %%message lba_search_msg.autohdd
  3438                              <1>  %else
  3439                              <1>  %define %%message lba_search_msg.auto
  3440                              <1>  %endif
  3441                              <1> %endif
  3442                              <1> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <1> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <1> %if _FORCE_CHS
  3446                              <1>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <1>  %error Expected same length of replacement
  3448                              <1>  %endif
  3449                              <1> %endif
  3462                                  %assign variant 0
  3463                                  %rep 256
  3464                                   %if variant == 128
  3465                                  lba_search_strings_chs:
  3466                                  	freedos_lba_search_string freedos, 1, 0, 0
  3467                                  	freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                                   %endif
  3469                                   %assign identifier variant & ~128
  3470                                  	ldosboot_lba_search_string 	 identifier, 	 variant & 128, 	 variant & 1, 	 variant & 2, 	 variant & 4, 	 variant & 8, 	 variant & 16, 	 variant & 32, 	 variant & 64
  3480                                   %assign variant variant + 1
  3481                                  %endrep
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000013E1 B441                <2>  mov ah, 41h
  3257 000013E3 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000013E6 BBAA55              <2>  mov bx, 55AAh
  3260 000013E9 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000013EA CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000013EC 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000013EE 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000013F2 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000013F4 D0E9                <2>  shr cl, 1
  3273 000013F6 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000013F8 B442                <2>  mov ah, 42h
  3311 000013FA CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000013FC 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000013FE 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001401 B442                <2>  mov ah, 42h
  3311 00001403 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001405 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001407 B441                <2>  mov ah, 41h
  3257 00001409 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000140C BBAA55              <2>  mov bx, 55AAh
  3260 0000140F F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001410 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001412 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001414 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001418 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000141A D0E9                <2>  shr cl, 1
  3273 0000141C 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000141E B442                <2>  mov ah, 42h
  3311 00001420 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001422 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001424 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001427 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001428 B442                <2>  mov ah, 42h
  3311 0000142A CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 0000142C 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000142E B441                <2>  mov ah, 41h
  3257 00001430 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001433 BBAA55              <2>  mov bx, 55AAh
  3260 00001436 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001437 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001439 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000143B 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000143F 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001441 D0E9                <2>  shr cl, 1
  3273 00001443 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001445 B442                <2>  mov ah, 42h
  3311 00001447 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001449 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000144B 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000144E B442                <2>  mov ah, 42h
  3311 00001450 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001452 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001454 B441                <2>  mov ah, 41h
  3257 00001456 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001459 BBAA55              <2>  mov bx, 55AAh
  3260 0000145C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000145D CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000145F 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001461 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001465 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001467 D0E9                <2>  shr cl, 1
  3273 00001469 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000146B B442                <2>  mov ah, 42h
  3311 0000146D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000146F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001471 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001474 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001475 B442                <2>  mov ah, 42h
  3311 00001477 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001479 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000147B B441                <2>  mov ah, 41h
  3257 0000147D 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001480 BBAA55              <2>  mov bx, 55AAh
  3260 00001483 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001484 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001486 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001488 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000148C 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000148E D0E9                <2>  shr cl, 1
  3273 00001490 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001492 B442                <2>  mov ah, 42h
  3311 00001494 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001496 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001498 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000149B B442                <2>  mov ah, 42h
  3311 0000149D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000149F 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000014A1 B441                <2>  mov ah, 41h
  3257 000014A3 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000014A6 BBAA55              <2>  mov bx, 55AAh
  3260 000014A9 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000014AA CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000014AC 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000014AE 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000014B2 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000014B4 D0E9                <2>  shr cl, 1
  3273 000014B6 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000014B8 B442                <2>  mov ah, 42h
  3311 000014BA CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000014BC 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000014BE 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000014C1 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000014C2 B442                <2>  mov ah, 42h
  3311 000014C4 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000014C6 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000014C8 B441                <2>  mov ah, 41h
  3257 000014CA 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000014CD BBAA55              <2>  mov bx, 55AAh
  3260 000014D0 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000014D1 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000014D3 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000014D5 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000014D9 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000014DB D0E9                <2>  shr cl, 1
  3273 000014DD 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000014DF B442                <2>  mov ah, 42h
  3311 000014E1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000014E3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000014E5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000014E8 B442                <2>  mov ah, 42h
  3311 000014EA CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000014EC 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000014EE B441                <2>  mov ah, 41h
  3257 000014F0 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000014F3 BBAA55              <2>  mov bx, 55AAh
  3260 000014F6 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000014F7 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000014F9 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000014FB 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000014FF 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001501 D0E9                <2>  shr cl, 1
  3273 00001503 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001505 B442                <2>  mov ah, 42h
  3311 00001507 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001509 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000150B 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000150E F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000150F B442                <2>  mov ah, 42h
  3311 00001511 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00001513 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001515 B441                <2>  mov ah, 41h
  3257 00001517 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000151A BBAA55              <2>  mov bx, 55AAh
  3260 0000151D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000151E CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001520 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001522 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001526 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001528 D0E9                <2>  shr cl, 1
  3273 0000152A 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000152C B442                <2>  mov ah, 42h
  3311 0000152E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001530 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001532 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001535 B442                <2>  mov ah, 42h
  3311 00001537 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001539 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000153B B441                <2>  mov ah, 41h
  3257 0000153D 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001540 BBAA55              <2>  mov bx, 55AAh
  3260 00001543 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001544 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001546 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001548 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000154C 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000154E D0E9                <2>  shr cl, 1
  3273 00001550 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001552 B442                <2>  mov ah, 42h
  3311 00001554 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001556 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001558 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000155B F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000155C B442                <2>  mov ah, 42h
  3311 0000155E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001560 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001562 B441                <2>  mov ah, 41h
  3257 00001564 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001567 BBAA55              <2>  mov bx, 55AAh
  3260 0000156A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000156B CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000156D 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000156F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001573 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001575 D0E9                <2>  shr cl, 1
  3273 00001577 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001579 B442                <2>  mov ah, 42h
  3311 0000157B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000157D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000157F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001582 B442                <2>  mov ah, 42h
  3311 00001584 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001586 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001588 B441                <2>  mov ah, 41h
  3257 0000158A 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000158D BBAA55              <2>  mov bx, 55AAh
  3260 00001590 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001591 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001593 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001595 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001599 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000159B D0E9                <2>  shr cl, 1
  3273 0000159D 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000159F B442                <2>  mov ah, 42h
  3311 000015A1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000015A3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000015A5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000015A8 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000015A9 B442                <2>  mov ah, 42h
  3311 000015AB CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000015AD 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000015AF B441                <2>  mov ah, 41h
  3257 000015B1 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000015B4 BBAA55              <2>  mov bx, 55AAh
  3260 000015B7 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000015B8 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000015BA 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000015BC 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000015C0 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000015C2 D0E9                <2>  shr cl, 1
  3273 000015C4 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000015C6 B442                <2>  mov ah, 42h
  3311 000015C8 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000015CA 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000015CC 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000015CF B442                <2>  mov ah, 42h
  3311 000015D1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000015D3 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000015D5 B441                <2>  mov ah, 41h
  3257 000015D7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000015DA BBAA55              <2>  mov bx, 55AAh
  3260 000015DD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000015DE CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000015E0 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000015E2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000015E6 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000015E8 D0E9                <2>  shr cl, 1
  3273 000015EA 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000015EC B442                <2>  mov ah, 42h
  3311 000015EE CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000015F0 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000015F2 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000015F5 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000015F6 B442                <2>  mov ah, 42h
  3311 000015F8 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000015FA 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000015FC B441                <2>  mov ah, 41h
  3257 000015FE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001601 BBAA55              <2>  mov bx, 55AAh
  3260 00001604 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001605 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001607 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001609 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000160D 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000160F D0E9                <2>  shr cl, 1
  3273 00001611 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001613 B442                <2>  mov ah, 42h
  3311 00001615 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001617 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001619 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000161C B442                <2>  mov ah, 42h
  3311 0000161E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00001620 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001622 B441                <2>  mov ah, 41h
  3257 00001624 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001627 BBAA55              <2>  mov bx, 55AAh
  3260 0000162A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000162B CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000162D 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000162F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001633 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001635 D0E9                <2>  shr cl, 1
  3273 00001637 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001639 B442                <2>  mov ah, 42h
  3311 0000163B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000163D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000163F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001642 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001643 B442                <2>  mov ah, 42h
  3311 00001645 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00001647 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001649 B441                <2>  mov ah, 41h
  3257 0000164B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000164E BBAA55              <2>  mov bx, 55AAh
  3260 00001651 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001652 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001654 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001656 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000165A 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000165C D0E9                <2>  shr cl, 1
  3273 0000165E 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001660 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001662 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001664 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001666 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000166A B442                <2>  mov ah, 42h
  3311 0000166C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000166E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001670 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001673 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001675 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001677 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001679 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000167D B442                <2>  mov ah, 42h
  3311 0000167F CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001681 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001683 B441                <2>  mov ah, 41h
  3257 00001685 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001688 BBAA55              <2>  mov bx, 55AAh
  3260 0000168B F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000168C CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000168E 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001690 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001694 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001696 D0E9                <2>  shr cl, 1
  3273 00001698 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000169A B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000169C CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000169E 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000016A0 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000016A4 B442                <2>  mov ah, 42h
  3311 000016A6 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000016A8 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000016AA 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000016AD F9                  <2>  stc
  3280                              <2>  %endif
  3281 000016AE B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000016B0 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000016B2 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000016B4 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000016B8 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000016B9 B442                <2>  mov ah, 42h
  3311 000016BB CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000016BD 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000016BF B441                <2>  mov ah, 41h
  3257 000016C1 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000016C4 BBAA55              <2>  mov bx, 55AAh
  3260 000016C7 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000016C8 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000016CA 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000016CC 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000016D0 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000016D2 D0E9                <2>  shr cl, 1
  3273 000016D4 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000016D6 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000016D8 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000016DA 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000016DC C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000016E0 B442                <2>  mov ah, 42h
  3311 000016E2 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000016E4 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000016E6 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000016E9 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000016EB CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000016ED 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000016EF C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000016F3 B442                <2>  mov ah, 42h
  3311 000016F5 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000016F7 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000016F9 B441                <2>  mov ah, 41h
  3257 000016FB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000016FE BBAA55              <2>  mov bx, 55AAh
  3260 00001701 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001702 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001704 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001706 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000170A 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000170C D0E9                <2>  shr cl, 1
  3273 0000170E 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001710 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001712 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001714 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001716 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000171A B442                <2>  mov ah, 42h
  3311 0000171C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000171E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001720 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001723 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001724 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001726 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001728 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000172A C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000172E F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000172F B442                <2>  mov ah, 42h
  3311 00001731 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001733 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001735 B441                <2>  mov ah, 41h
  3257 00001737 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000173A BBAA55              <2>  mov bx, 55AAh
  3260 0000173D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000173E CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001740 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001742 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001746 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001748 D0E9                <2>  shr cl, 1
  3273 0000174A 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000174C B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000174E CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001750 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001752 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001756 B442                <2>  mov ah, 42h
  3311 00001758 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000175A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000175C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000175F B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001761 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001763 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001765 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001769 B442                <2>  mov ah, 42h
  3311 0000176B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000176D 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000176F B441                <2>  mov ah, 41h
  3257 00001771 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001774 BBAA55              <2>  mov bx, 55AAh
  3260 00001777 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001778 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000177A 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000177C 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001780 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001782 D0E9                <2>  shr cl, 1
  3273 00001784 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001786 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001788 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000178A 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000178C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001790 B442                <2>  mov ah, 42h
  3311 00001792 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001794 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001796 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001799 F9                  <2>  stc
  3280                              <2>  %endif
  3281 0000179A B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000179C CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000179E 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000017A0 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000017A4 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000017A5 B442                <2>  mov ah, 42h
  3311 000017A7 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000017A9 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000017AB B441                <2>  mov ah, 41h
  3257 000017AD 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000017B0 BBAA55              <2>  mov bx, 55AAh
  3260 000017B3 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000017B4 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000017B6 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000017B8 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000017BC 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000017BE D0E9                <2>  shr cl, 1
  3273 000017C0 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000017C2 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000017C4 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000017C6 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000017C8 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000017CC B442                <2>  mov ah, 42h
  3311 000017CE CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000017D0 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000017D2 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000017D5 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000017D7 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000017D9 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000017DB C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000017DF B442                <2>  mov ah, 42h
  3311 000017E1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000017E3 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000017E5 B441                <2>  mov ah, 41h
  3257 000017E7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000017EA BBAA55              <2>  mov bx, 55AAh
  3260 000017ED F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000017EE CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000017F0 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000017F2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000017F6 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000017F8 D0E9                <2>  shr cl, 1
  3273 000017FA 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000017FC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000017FE CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001800 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001802 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001806 B442                <2>  mov ah, 42h
  3311 00001808 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000180A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000180C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 0000180F F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001810 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001812 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001814 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001816 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000181A F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000181B B442                <2>  mov ah, 42h
  3311 0000181D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000181F 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001821 B441                <2>  mov ah, 41h
  3257 00001823 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001826 BBAA55              <2>  mov bx, 55AAh
  3260 00001829 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000182A CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000182C 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000182E 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001832 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001834 D0E9                <2>  shr cl, 1
  3273 00001836 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001838 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000183A CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000183C 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000183E 31C0                <2>  xor ax, ax
  3293 00001840 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001842 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001846 B442                <2>  mov ah, 42h
  3311 00001848 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000184A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000184C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000184F B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001851 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001853 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001855 31C0                <2>  xor ax, ax
  3293 00001857 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001859 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000185D B442                <2>  mov ah, 42h
  3311 0000185F CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00001861 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001863 B441                <2>  mov ah, 41h
  3257 00001865 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001868 BBAA55              <2>  mov bx, 55AAh
  3260 0000186B F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 0000186C CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000186E 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001870 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001874 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001876 D0E9                <2>  shr cl, 1
  3273 00001878 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000187A B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000187C CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000187E 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001880 31C0                <2>  xor ax, ax
  3293 00001882 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001884 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001888 B442                <2>  mov ah, 42h
  3311 0000188A CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000188C 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000188E 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001891 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001892 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001894 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001896 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001898 31C0                <2>  xor ax, ax
  3293 0000189A CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000189C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000018A0 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000018A1 B442                <2>  mov ah, 42h
  3311 000018A3 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000018A5 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000018A7 B441                <2>  mov ah, 41h
  3257 000018A9 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000018AC BBAA55              <2>  mov bx, 55AAh
  3260 000018AF F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000018B0 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000018B2 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000018B4 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000018B8 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000018BA D0E9                <2>  shr cl, 1
  3273 000018BC 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000018BE B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000018C0 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000018C2 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000018C4 31C0                <2>  xor ax, ax
  3293 000018C6 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000018C8 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000018CC B442                <2>  mov ah, 42h
  3311 000018CE CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000018D0 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000018D2 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000018D5 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000018D7 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000018D9 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000018DB 31C0                <2>  xor ax, ax
  3293 000018DD CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000018DF C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000018E3 B442                <2>  mov ah, 42h
  3311 000018E5 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000018E7 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000018E9 B441                <2>  mov ah, 41h
  3257 000018EB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000018EE BBAA55              <2>  mov bx, 55AAh
  3260 000018F1 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000018F2 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000018F4 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000018F6 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000018FA 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000018FC D0E9                <2>  shr cl, 1
  3273 000018FE 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001900 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001902 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001904 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001906 31C0                <2>  xor ax, ax
  3293 00001908 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000190A C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000190E B442                <2>  mov ah, 42h
  3311 00001910 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001912 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001914 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001917 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001918 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000191A CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000191C 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000191E 31C0                <2>  xor ax, ax
  3293 00001920 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001922 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001926 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001927 B442                <2>  mov ah, 42h
  3311 00001929 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 0000192B 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000192D B441                <2>  mov ah, 41h
  3257 0000192F 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001932 BBAA55              <2>  mov bx, 55AAh
  3260 00001935 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001936 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001938 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000193A 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000193E 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001940 D0E9                <2>  shr cl, 1
  3273 00001942 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001944 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001946 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001948 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000194A 31C0                <2>  xor ax, ax
  3293 0000194C CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000194E C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001952 B442                <2>  mov ah, 42h
  3311 00001954 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001956 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001958 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000195B B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000195D CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000195F 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001961 31C0                <2>  xor ax, ax
  3293 00001963 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001965 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001969 B442                <2>  mov ah, 42h
  3311 0000196B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000196D 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000196F B441                <2>  mov ah, 41h
  3257 00001971 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001974 BBAA55              <2>  mov bx, 55AAh
  3260 00001977 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001978 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 0000197A 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000197C 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001980 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001982 D0E9                <2>  shr cl, 1
  3273 00001984 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001986 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001988 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000198A 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000198C 31C0                <2>  xor ax, ax
  3293 0000198E CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001990 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001994 B442                <2>  mov ah, 42h
  3311 00001996 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001998 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000199A 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 0000199D F9                  <2>  stc
  3280                              <2>  %endif
  3281 0000199E B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000019A0 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000019A2 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000019A4 31C0                <2>  xor ax, ax
  3293 000019A6 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000019A8 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000019AC F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000019AD B442                <2>  mov ah, 42h
  3311 000019AF CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000019B1 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000019B3 B441                <2>  mov ah, 41h
  3257 000019B5 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000019B8 BBAA55              <2>  mov bx, 55AAh
  3260 000019BB F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000019BC CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000019BE 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000019C0 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000019C4 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000019C6 D0E9                <2>  shr cl, 1
  3273 000019C8 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000019CA B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000019CC CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000019CE 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000019D0 31C0                <2>  xor ax, ax
  3293 000019D2 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000019D4 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000019D8 B442                <2>  mov ah, 42h
  3311 000019DA CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000019DC 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000019DE 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000019E1 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000019E3 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000019E5 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000019E7 31C0                <2>  xor ax, ax
  3293 000019E9 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000019EB C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000019EF B442                <2>  mov ah, 42h
  3311 000019F1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000019F3 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000019F5 B441                <2>  mov ah, 41h
  3257 000019F7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000019FA BBAA55              <2>  mov bx, 55AAh
  3260 000019FD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000019FE CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001A00 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001A02 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001A06 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001A08 D0E9                <2>  shr cl, 1
  3273 00001A0A 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001A0C B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001A0E CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001A10 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001A12 31C0                <2>  xor ax, ax
  3293 00001A14 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001A16 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A1A B442                <2>  mov ah, 42h
  3311 00001A1C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001A1E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001A20 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001A23 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001A24 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001A26 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001A28 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001A2A 31C0                <2>  xor ax, ax
  3293 00001A2C CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001A2E C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001A32 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A33 B442                <2>  mov ah, 42h
  3311 00001A35 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00001A37 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001A39 B441                <2>  mov ah, 41h
  3257 00001A3B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001A3E BBAA55              <2>  mov bx, 55AAh
  3260 00001A41 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001A42 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001A44 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001A46 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001A4A 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001A4C D0E9                <2>  shr cl, 1
  3273 00001A4E 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A50 B442                <2>  mov ah, 42h
  3311 00001A52 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001A54 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001A56 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A59 B442                <2>  mov ah, 42h
  3311 00001A5B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001A5D 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001A5F 80FC01              <2>  cmp ah, 1
  3322 00001A62 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001A64 B441                <2>  mov ah, 41h
  3257 00001A66 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001A69 BBAA55              <2>  mov bx, 55AAh
  3260 00001A6C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001A6D CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001A6F 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001A71 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001A75 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001A77 D0E9                <2>  shr cl, 1
  3273 00001A79 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A7B B442                <2>  mov ah, 42h
  3311 00001A7D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001A7F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001A81 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001A84 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001A85 B442                <2>  mov ah, 42h
  3311 00001A87 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001A89 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001A8B 80FC01              <2>  cmp ah, 1
  3322 00001A8E 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001A90 B441                <2>  mov ah, 41h
  3257 00001A92 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001A95 BBAA55              <2>  mov bx, 55AAh
  3260 00001A98 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001A99 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001A9B 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001A9D 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001AA1 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001AA3 D0E9                <2>  shr cl, 1
  3273 00001AA5 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001AA7 B442                <2>  mov ah, 42h
  3311 00001AA9 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001AAB 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001AAD 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001AB0 B442                <2>  mov ah, 42h
  3311 00001AB2 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001AB4 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001AB6 80FC01              <2>  cmp ah, 1
  3322 00001AB9 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001ABB B441                <2>  mov ah, 41h
  3257 00001ABD 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001AC0 BBAA55              <2>  mov bx, 55AAh
  3260 00001AC3 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001AC4 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001AC6 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001AC8 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001ACC 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001ACE D0E9                <2>  shr cl, 1
  3273 00001AD0 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001AD2 B442                <2>  mov ah, 42h
  3311 00001AD4 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001AD6 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001AD8 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001ADB F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001ADC B442                <2>  mov ah, 42h
  3311 00001ADE CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001AE0 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001AE2 80FC01              <2>  cmp ah, 1
  3322 00001AE5 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001AE7 B441                <2>  mov ah, 41h
  3257 00001AE9 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001AEC BBAA55              <2>  mov bx, 55AAh
  3260 00001AEF F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001AF0 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001AF2 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001AF4 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001AF8 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001AFA D0E9                <2>  shr cl, 1
  3273 00001AFC 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001AFE B442                <2>  mov ah, 42h
  3311 00001B00 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001B02 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001B04 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B07 B442                <2>  mov ah, 42h
  3311 00001B09 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001B0B 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001B0D B441                <2>  mov ah, 41h
  3257 00001B0F 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001B12 BBAA55              <2>  mov bx, 55AAh
  3260 00001B15 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001B16 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001B18 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001B1A 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001B1E 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001B20 D0E9                <2>  shr cl, 1
  3273 00001B22 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B24 B442                <2>  mov ah, 42h
  3311 00001B26 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001B28 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001B2A 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001B2D F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B2E B442                <2>  mov ah, 42h
  3311 00001B30 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001B32 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001B34 B441                <2>  mov ah, 41h
  3257 00001B36 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001B39 BBAA55              <2>  mov bx, 55AAh
  3260 00001B3C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001B3D CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001B3F 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001B41 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001B45 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001B47 D0E9                <2>  shr cl, 1
  3273 00001B49 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B4B B442                <2>  mov ah, 42h
  3311 00001B4D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001B4F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001B51 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B54 B442                <2>  mov ah, 42h
  3311 00001B56 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001B58 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001B5A B441                <2>  mov ah, 41h
  3257 00001B5C 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001B5F BBAA55              <2>  mov bx, 55AAh
  3260 00001B62 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001B63 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001B65 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001B67 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001B6B 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001B6D D0E9                <2>  shr cl, 1
  3273 00001B6F 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B71 B442                <2>  mov ah, 42h
  3311 00001B73 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001B75 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001B77 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001B7A F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B7B B442                <2>  mov ah, 42h
  3311 00001B7D CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001B7F 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001B81 B441                <2>  mov ah, 41h
  3257 00001B83 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001B86 BBAA55              <2>  mov bx, 55AAh
  3260 00001B89 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001B8A CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001B8C 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001B8E 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001B92 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001B94 D0E9                <2>  shr cl, 1
  3273 00001B96 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001B98 B442                <2>  mov ah, 42h
  3311 00001B9A CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001B9C 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001B9E 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001BA1 B442                <2>  mov ah, 42h
  3311 00001BA3 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001BA5 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001BA7 80FC01              <2>  cmp ah, 1
  3322 00001BAA 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001BAC B441                <2>  mov ah, 41h
  3257 00001BAE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001BB1 BBAA55              <2>  mov bx, 55AAh
  3260 00001BB4 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001BB5 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001BB7 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001BB9 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001BBD 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001BBF D0E9                <2>  shr cl, 1
  3273 00001BC1 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001BC3 B442                <2>  mov ah, 42h
  3311 00001BC5 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001BC7 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001BC9 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001BCC F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001BCD B442                <2>  mov ah, 42h
  3311 00001BCF CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001BD1 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001BD3 80FC01              <2>  cmp ah, 1
  3322 00001BD6 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001BD8 B441                <2>  mov ah, 41h
  3257 00001BDA 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001BDD BBAA55              <2>  mov bx, 55AAh
  3260 00001BE0 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001BE1 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001BE3 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001BE5 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001BE9 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001BEB D0E9                <2>  shr cl, 1
  3273 00001BED 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001BEF B442                <2>  mov ah, 42h
  3311 00001BF1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001BF3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001BF5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001BF8 B442                <2>  mov ah, 42h
  3311 00001BFA CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001BFC 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001BFE 80FC01              <2>  cmp ah, 1
  3322 00001C01 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001C03 B441                <2>  mov ah, 41h
  3257 00001C05 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001C08 BBAA55              <2>  mov bx, 55AAh
  3260 00001C0B F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001C0C CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001C0E 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001C10 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001C14 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001C16 D0E9                <2>  shr cl, 1
  3273 00001C18 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C1A B442                <2>  mov ah, 42h
  3311 00001C1C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001C1E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001C20 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001C23 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C24 B442                <2>  mov ah, 42h
  3311 00001C26 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001C28 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001C2A 80FC01              <2>  cmp ah, 1
  3322 00001C2D 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001C2F B441                <2>  mov ah, 41h
  3257 00001C31 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001C34 BBAA55              <2>  mov bx, 55AAh
  3260 00001C37 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001C38 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001C3A 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001C3C 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001C40 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001C42 D0E9                <2>  shr cl, 1
  3273 00001C44 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C46 B442                <2>  mov ah, 42h
  3311 00001C48 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001C4A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001C4C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C4F B442                <2>  mov ah, 42h
  3311 00001C51 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001C53 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001C55 B441                <2>  mov ah, 41h
  3257 00001C57 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001C5A BBAA55              <2>  mov bx, 55AAh
  3260 00001C5D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001C5E CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001C60 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001C62 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001C66 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001C68 D0E9                <2>  shr cl, 1
  3273 00001C6A 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C6C B442                <2>  mov ah, 42h
  3311 00001C6E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001C70 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001C72 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001C75 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C76 B442                <2>  mov ah, 42h
  3311 00001C78 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001C7A 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001C7C B441                <2>  mov ah, 41h
  3257 00001C7E 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001C81 BBAA55              <2>  mov bx, 55AAh
  3260 00001C84 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001C85 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001C87 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001C89 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001C8D 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001C8F D0E9                <2>  shr cl, 1
  3273 00001C91 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C93 B442                <2>  mov ah, 42h
  3311 00001C95 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001C97 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001C99 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001C9C B442                <2>  mov ah, 42h
  3311 00001C9E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001CA0 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001CA2 B441                <2>  mov ah, 41h
  3257 00001CA4 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001CA7 BBAA55              <2>  mov bx, 55AAh
  3260 00001CAA F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001CAB CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001CAD 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001CAF 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001CB3 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001CB5 D0E9                <2>  shr cl, 1
  3273 00001CB7 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001CB9 B442                <2>  mov ah, 42h
  3311 00001CBB CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001CBD 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001CBF 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001CC2 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001CC3 B442                <2>  mov ah, 42h
  3311 00001CC5 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001CC7 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001CC9 B441                <2>  mov ah, 41h
  3257 00001CCB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001CCE BBAA55              <2>  mov bx, 55AAh
  3260 00001CD1 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001CD2 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001CD4 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001CD6 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001CDA 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001CDC D0E9                <2>  shr cl, 1
  3273 00001CDE 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001CE0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001CE2 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001CE4 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001CE6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001CEA B442                <2>  mov ah, 42h
  3311 00001CEC CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001CEE 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001CF0 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001CF3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001CF5 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001CF7 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001CF9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001CFD B442                <2>  mov ah, 42h
  3311 00001CFF CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001D01 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001D03 80FC01              <2>  cmp ah, 1
  3322 00001D06 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001D08 B441                <2>  mov ah, 41h
  3257 00001D0A 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001D0D BBAA55              <2>  mov bx, 55AAh
  3260 00001D10 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001D11 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001D13 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001D15 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001D19 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001D1B D0E9                <2>  shr cl, 1
  3273 00001D1D 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001D1F B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001D21 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001D23 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001D25 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001D29 B442                <2>  mov ah, 42h
  3311 00001D2B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001D2D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001D2F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001D32 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001D33 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001D35 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001D37 7310                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001D39 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001D3D F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001D3E B442                <2>  mov ah, 42h
  3311 00001D40 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001D42 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001D44 80FC01              <2>  cmp ah, 1
  3322 00001D47 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001D49 B441                <2>  mov ah, 41h
  3257 00001D4B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001D4E BBAA55              <2>  mov bx, 55AAh
  3260 00001D51 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001D52 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001D54 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001D56 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001D5A 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001D5C D0E9                <2>  shr cl, 1
  3273 00001D5E 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001D60 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001D62 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001D64 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001D66 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001D6A B442                <2>  mov ah, 42h
  3311 00001D6C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001D6E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001D70 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001D73 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001D75 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001D77 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001D79 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001D7D B442                <2>  mov ah, 42h
  3311 00001D7F CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001D81 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001D83 80FC01              <2>  cmp ah, 1
  3322 00001D86 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001D88 B441                <2>  mov ah, 41h
  3257 00001D8A 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001D8D BBAA55              <2>  mov bx, 55AAh
  3260 00001D90 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001D91 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001D93 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001D95 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001D99 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001D9B D0E9                <2>  shr cl, 1
  3273 00001D9D 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001D9F B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001DA1 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001DA3 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001DA5 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001DA9 B442                <2>  mov ah, 42h
  3311 00001DAB CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001DAD 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001DAF 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001DB2 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001DB3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001DB5 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001DB7 7310                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001DB9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001DBD F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001DBE B442                <2>  mov ah, 42h
  3311 00001DC0 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001DC2 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001DC4 80FC01              <2>  cmp ah, 1
  3322 00001DC7 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001DC9 B441                <2>  mov ah, 41h
  3257 00001DCB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001DCE BBAA55              <2>  mov bx, 55AAh
  3260 00001DD1 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001DD2 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001DD4 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001DD6 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001DDA 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001DDC D0E9                <2>  shr cl, 1
  3273 00001DDE 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001DE0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001DE2 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001DE4 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001DE6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001DEA B442                <2>  mov ah, 42h
  3311 00001DEC CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001DEE 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001DF0 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001DF3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001DF5 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001DF7 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001DF9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001DFD B442                <2>  mov ah, 42h
  3311 00001DFF CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001E01 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001E03 B441                <2>  mov ah, 41h
  3257 00001E05 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001E08 BBAA55              <2>  mov bx, 55AAh
  3260 00001E0B F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001E0C CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001E0E 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001E10 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001E14 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001E16 D0E9                <2>  shr cl, 1
  3273 00001E18 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001E1A B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001E1C CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001E1E 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001E20 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001E24 B442                <2>  mov ah, 42h
  3311 00001E26 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001E28 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001E2A 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001E2D F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001E2E B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001E30 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001E32 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001E34 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001E38 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001E39 B442                <2>  mov ah, 42h
  3311 00001E3B CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001E3D 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001E3F B441                <2>  mov ah, 41h
  3257 00001E41 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001E44 BBAA55              <2>  mov bx, 55AAh
  3260 00001E47 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001E48 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001E4A 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001E4C 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001E50 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001E52 D0E9                <2>  shr cl, 1
  3273 00001E54 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001E56 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001E58 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001E5A 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001E5C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001E60 B442                <2>  mov ah, 42h
  3311 00001E62 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001E64 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001E66 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001E69 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001E6B CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001E6D 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001E6F C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001E73 B442                <2>  mov ah, 42h
  3311 00001E75 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001E77 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001E79 B441                <2>  mov ah, 41h
  3257 00001E7B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001E7E BBAA55              <2>  mov bx, 55AAh
  3260 00001E81 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001E82 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001E84 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001E86 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001E8A 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001E8C D0E9                <2>  shr cl, 1
  3273 00001E8E 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001E90 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001E92 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001E94 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001E96 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001E9A B442                <2>  mov ah, 42h
  3311 00001E9C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001E9E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001EA0 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001EA3 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001EA4 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001EA6 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001EA8 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001EAA C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001EAE F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001EAF B442                <2>  mov ah, 42h
  3311 00001EB1 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00001EB3 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001EB5 B441                <2>  mov ah, 41h
  3257 00001EB7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001EBA BBAA55              <2>  mov bx, 55AAh
  3260 00001EBD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001EBE CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001EC0 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001EC2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001EC6 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001EC8 D0E9                <2>  shr cl, 1
  3273 00001ECA 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001ECC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001ECE CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001ED0 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001ED2 31C0                <2>  xor ax, ax
  3293 00001ED4 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001ED6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001EDA B442                <2>  mov ah, 42h
  3311 00001EDC CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001EDE 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001EE0 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001EE3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001EE5 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001EE7 7313                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001EE9 31C0                <2>  xor ax, ax
  3293 00001EEB CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001EED C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001EF1 B442                <2>  mov ah, 42h
  3311 00001EF3 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001EF5 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001EF7 80FC01              <2>  cmp ah, 1
  3322 00001EFA 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001EFC B441                <2>  mov ah, 41h
  3257 00001EFE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001F01 BBAA55              <2>  mov bx, 55AAh
  3260 00001F04 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001F05 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001F07 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001F09 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001F0D 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001F0F D0E9                <2>  shr cl, 1
  3273 00001F11 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001F13 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001F15 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001F17 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001F19 31C0                <2>  xor ax, ax
  3293 00001F1B CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001F1D C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001F21 B442                <2>  mov ah, 42h
  3311 00001F23 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001F25 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001F27 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001F2A F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001F2B B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001F2D CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001F2F 7314                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001F31 31C0                <2>  xor ax, ax
  3293 00001F33 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001F35 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001F39 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001F3A B442                <2>  mov ah, 42h
  3311 00001F3C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001F3E 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001F40 80FC01              <2>  cmp ah, 1
  3322 00001F43 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001F45 B441                <2>  mov ah, 41h
  3257 00001F47 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001F4A BBAA55              <2>  mov bx, 55AAh
  3260 00001F4D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001F4E CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001F50 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001F52 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001F56 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001F58 D0E9                <2>  shr cl, 1
  3273 00001F5A 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001F5C B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001F5E CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001F60 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001F62 31C0                <2>  xor ax, ax
  3293 00001F64 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001F66 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001F6A B442                <2>  mov ah, 42h
  3311 00001F6C CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001F6E 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001F70 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001F73 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001F75 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001F77 7313                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001F79 31C0                <2>  xor ax, ax
  3293 00001F7B CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001F7D C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001F81 B442                <2>  mov ah, 42h
  3311 00001F83 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001F85 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001F87 80FC01              <2>  cmp ah, 1
  3322 00001F8A 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001F8C B441                <2>  mov ah, 41h
  3257 00001F8E 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001F91 BBAA55              <2>  mov bx, 55AAh
  3260 00001F94 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001F95 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001F97 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001F99 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001F9D 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001F9F D0E9                <2>  shr cl, 1
  3273 00001FA1 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001FA3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001FA5 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001FA7 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001FA9 31C0                <2>  xor ax, ax
  3293 00001FAB CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001FAD C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001FB1 B442                <2>  mov ah, 42h
  3311 00001FB3 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001FB5 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00001FB7 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00001FBA F9                  <2>  stc
  3280                              <2>  %endif
  3281 00001FBB B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001FBD CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001FBF 7314                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001FC1 31C0                <2>  xor ax, ax
  3293 00001FC3 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001FC5 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00001FC9 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001FCA B442                <2>  mov ah, 42h
  3311 00001FCC CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00001FCE 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00001FD0 80FC01              <2>  cmp ah, 1
  3322 00001FD3 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00001FD5 B441                <2>  mov ah, 41h
  3257 00001FD7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00001FDA BBAA55              <2>  mov bx, 55AAh
  3260 00001FDD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00001FDE CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00001FE0 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00001FE2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00001FE6 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00001FE8 D0E9                <2>  shr cl, 1
  3273 00001FEA 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00001FEC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00001FEE CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00001FF0 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00001FF2 31C0                <2>  xor ax, ax
  3293 00001FF4 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00001FF6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00001FFA B442                <2>  mov ah, 42h
  3311 00001FFC CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00001FFE 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002000 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002003 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00002005 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00002007 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002009 31C0                <2>  xor ax, ax
  3293 0000200B CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000200D C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00002011 B442                <2>  mov ah, 42h
  3311 00002013 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002015 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002017 B441                <2>  mov ah, 41h
  3257 00002019 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000201C BBAA55              <2>  mov bx, 55AAh
  3260 0000201F F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00002020 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00002022 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002024 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002028 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000202A D0E9                <2>  shr cl, 1
  3273 0000202C 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000202E B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00002030 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00002032 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002034 31C0                <2>  xor ax, ax
  3293 00002036 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002038 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 0000203C B442                <2>  mov ah, 42h
  3311 0000203E CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002040 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002042 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002045 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002046 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00002048 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000204A 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000204C 31C0                <2>  xor ax, ax
  3293 0000204E CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002050 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002054 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00002055 B442                <2>  mov ah, 42h
  3311 00002057 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002059 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000205B B441                <2>  mov ah, 41h
  3257 0000205D 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002060 BBAA55              <2>  mov bx, 55AAh
  3260 00002063 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 00002064 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 00002066 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002068 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000206C 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000206E D0E9                <2>  shr cl, 1
  3273 00002070 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002072 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 00002074 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 00002076 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002078 31C0                <2>  xor ax, ax
  3293 0000207A CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000207C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00002080 B442                <2>  mov ah, 42h
  3311 00002082 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002084 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002086 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002089 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 0000208B CD13                <2>  int 13h
  3287                              <2> %endif
  3288 0000208D 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000208F 31C0                <2>  xor ax, ax
  3293 00002091 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002093 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 00002097 B442                <2>  mov ah, 42h
  3311 00002099 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 0000209B 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000209D B441                <2>  mov ah, 41h
  3257 0000209F 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000020A2 BBAA55              <2>  mov bx, 55AAh
  3260 000020A5 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265 000020A6 CD13                <2>  int 13h
  3266                              <2> %endif
  3267 000020A8 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000020AA 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000020AE 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000020B0 D0E9                <2>  shr cl, 1
  3273 000020B2 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000020B4 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000020B6 CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000020B8 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000020BA 31C0                <2>  xor ax, ax
  3293 000020BC CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000020BE C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000020C2 B442                <2>  mov ah, 42h
  3311 000020C4 CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000020C6 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000020C8 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000020CB F9                  <2>  stc
  3280                              <2>  %endif
  3281 000020CC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286 000020CE CD13                <2>  int 13h
  3287                              <2> %endif
  3288 000020D0 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000020D2 31C0                <2>  xor ax, ax
  3293 000020D4 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000020D6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000020DA F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306                              <2>  mov ah, 01h
  3307                              <2>  nop
  3308                              <2>  stc
  3309                              <2> %else
  3310 000020DB B442                <2>  mov ah, 42h
  3311 000020DD CD13                <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000020DF 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3366                              <2> %define WILDCARDS dw ""
  3367                              <2> %assign _FORCE_CHS %2
  3368                              <2> %assign _OEM_BOOT %3
  3369                              <2> %assign _FORCE_CHS_DISKETTE %4
  3370                              <2> 
  3371                              <2> 
  3372                              <2> %if _FORCE_CHS_DISKETTE
  3373                              <2>  %define %%identifier label_%1_chs_diskette
  3374                              <2>  %define %%other label_%1_special
  3375                              <2> %elif _FORCE_CHS
  3376                              <2>  %define %%identifier label_%1_chs
  3377                              <2>  %define %%other label_%1_lba
  3378                              <2> %else
  3379                              <2>  %define %%identifier label_%1_lba
  3380                              <2>  %define %%other label_%1_chs
  3381                              <2> %endif
  3382                              <2> 
  3383                              <2> %%start:
  3384                              <2> %[%%identifier %+ _search_string]:
  3385                              <2> 
  3386 000020E1 B441                <2>  mov ah, 41h
  3387 000020E3 BBAA55              <2>  mov bx, 55AAh
  3388 000020E6 8A567F              <2>  mov dl, [bp + 127]
  3389                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <2> 
  3391                              <2> %if _FORCE_CHS
  3392 000020E9 30D2                <2>  xor dl, dl
  3393 000020EB 7419                <2>  jz @F
  3394                              <2> %elif _FORCE_CHS_DISKETTE
  3395                              <2>  test dl, dl
  3396                              <2>  jz @F
  3397                              <2> %else
  3398                              <2>  test dl, dl
  3399                              <2>  nop
  3400                              <2>  nop
  3401                              <2> %endif
  3402 000020ED CD13                <2>  int 13h
  3403 000020EF 7215                <2>  jc @F
  3404 000020F1 D1E9                <2>  shr cx, 1
  3405 000020F3 81DB54AA            <2>  sbb bx, 0AA55h - 1
  3406 000020F7 750D                <2>  jne @F
  3407                              <2> 
  3408                              <2> %if _OEM_BOOT
  3409                              <2>  lea si, [bp + 1023]
  3410                              <2> search_wildcard %%start, -2
  3411                              <2> search_wildcard %%start, -1
  3412                              <2>  mov word [bp + 1023], bx
  3413                              <2> search_wildcard %%start, -2
  3414                              <2> search_wildcard %%start, -1
  3415                              <2>  mov word [bp + 1023], bx
  3416                              <2> search_wildcard %%start, -2
  3417                              <2> search_wildcard %%start, -1
  3418                              <2> %else
  3419 000020F9 8D7680              <2>  lea si, [bp - 128]
  3420                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3421 000020FC 895E80              <2>  mov word [bp - 128], bx
  3422                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3423 000020FF 895E80              <2>  mov word [bp - 128], bx
  3424                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3425                              <2> %endif
  3426 00002102 B442                <2>  mov ah, 42h
  3427 00002104 EB00                <2>  jmp strict short @F
  3428                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <2> @@:
  3430                              <2> %%end:
  3431                              <2> 
  3432                              <2> 
  3433                              <2> %if _FORCE_CHS
  3434                              <2>  %define %%message lba_search_msg.forcechs
  3435                              <2> %else
  3436                              <2>  %if _FORCE_CHS_DISKETTE
  3437                              <2>  %define %%message lba_search_msg.autohdd
  3438                              <2>  %else
  3439                              <2>  %define %%message lba_search_msg.auto
  3440                              <2>  %endif
  3441                              <2> %endif
  3442                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <2> %if _FORCE_CHS
  3446                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <2>  %error Expected same length of replacement
  3448                              <2>  %endif
  3449                              <2> %endif
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3366                              <2> %define WILDCARDS dw ""
  3367                              <2> %assign _FORCE_CHS %2
  3368                              <2> %assign _OEM_BOOT %3
  3369                              <2> %assign _FORCE_CHS_DISKETTE %4
  3370                              <2> 
  3371                              <2> 
  3372                              <2> %if _FORCE_CHS_DISKETTE
  3373                              <2>  %define %%identifier label_%1_chs_diskette
  3374                              <2>  %define %%other label_%1_special
  3375                              <2> %elif _FORCE_CHS
  3376                              <2>  %define %%identifier label_%1_chs
  3377                              <2>  %define %%other label_%1_lba
  3378                              <2> %else
  3379                              <2>  %define %%identifier label_%1_lba
  3380                              <2>  %define %%other label_%1_chs
  3381                              <2> %endif
  3382                              <2> 
  3383                              <2> %%start:
  3384                              <2> %[%%identifier %+ _search_string]:
  3385                              <2> 
  3386 00002106 B441                <2>  mov ah, 41h
  3387 00002108 BBAA55              <2>  mov bx, 55AAh
  3388 0000210B 8A567F              <2>  mov dl, [bp + 127]
  3389                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <2> 
  3391                              <2> %if _FORCE_CHS
  3392 0000210E 30D2                <2>  xor dl, dl
  3393 00002110 741C                <2>  jz @F
  3394                              <2> %elif _FORCE_CHS_DISKETTE
  3395                              <2>  test dl, dl
  3396                              <2>  jz @F
  3397                              <2> %else
  3398                              <2>  test dl, dl
  3399                              <2>  nop
  3400                              <2>  nop
  3401                              <2> %endif
  3402 00002112 CD13                <2>  int 13h
  3403 00002114 7218                <2>  jc @F
  3404 00002116 D1E9                <2>  shr cx, 1
  3405 00002118 81DB54AA            <2>  sbb bx, 0AA55h - 1
  3406 0000211C 7510                <2>  jne @F
  3407                              <2> 
  3408                              <2> %if _OEM_BOOT
  3409 0000211E 8DB6FF03            <2>  lea si, [bp + 1023]
  3410                              <2> search_wildcard %%start, -2
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3411                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3412 00002122 899EFF03            <2>  mov word [bp + 1023], bx
  3413                              <2> search_wildcard %%start, -2
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3414                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3415 00002126 899EFF03            <2>  mov word [bp + 1023], bx
  3416                              <2> search_wildcard %%start, -2
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3417                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3418                              <2> %else
  3419                              <2>  lea si, [bp - 128]
  3420                              <2> search_wildcard %%start, -1
  3421                              <2>  mov word [bp - 128], bx
  3422                              <2> search_wildcard %%start, -1
  3423                              <2>  mov word [bp - 128], bx
  3424                              <2> search_wildcard %%start, -1
  3425                              <2> %endif
  3426 0000212A B442                <2>  mov ah, 42h
  3427 0000212C EB00                <2>  jmp strict short @F
  3428                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <2> @@:
  3430                              <2> %%end:
  3431                              <2> 
  3432                              <2> 
  3433                              <2> %if _FORCE_CHS
  3434                              <2>  %define %%message lba_search_msg.forcechs
  3435                              <2> %else
  3436                              <2>  %if _FORCE_CHS_DISKETTE
  3437                              <2>  %define %%message lba_search_msg.autohdd
  3438                              <2>  %else
  3439                              <2>  %define %%message lba_search_msg.auto
  3440                              <2>  %endif
  3441                              <2> %endif
  3442                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <2> %if _FORCE_CHS
  3446                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <2>  %error Expected same length of replacement
  3448                              <2>  %endif
  3449                              <2> %endif
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000212E B441                <2>  mov ah, 41h
  3257 00002130 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002133 BBAA55              <2>  mov bx, 55AAh
  3260 00002136 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002137 90                  <2>  nop
  3263 00002138 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002139 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000213B 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000213F 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002141 D0E9                <2>  shr cl, 1
  3273 00002143 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002145 B401                <2>  mov ah, 01h
  3307 00002147 90                  <2>  nop
  3308 00002148 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002149 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000214B 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000214E B401                <2>  mov ah, 01h
  3307 00002150 90                  <2>  nop
  3308 00002151 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002152 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002154 B441                <2>  mov ah, 41h
  3257 00002156 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002159 BBAA55              <2>  mov bx, 55AAh
  3260 0000215C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000215D 90                  <2>  nop
  3263 0000215E 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000215F 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002161 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002165 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002167 D0E9                <2>  shr cl, 1
  3273 00002169 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000216B B401                <2>  mov ah, 01h
  3307 0000216D 90                  <2>  nop
  3308 0000216E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000216F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002171 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002174 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002175 B401                <2>  mov ah, 01h
  3307 00002177 90                  <2>  nop
  3308 00002178 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002179 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000217B B441                <2>  mov ah, 41h
  3257 0000217D 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002180 BBAA55              <2>  mov bx, 55AAh
  3260 00002183 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002184 90                  <2>  nop
  3263 00002185 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002186 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002188 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000218C 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000218E D0E9                <2>  shr cl, 1
  3273 00002190 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002192 B401                <2>  mov ah, 01h
  3307 00002194 90                  <2>  nop
  3308 00002195 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002196 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002198 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000219B B401                <2>  mov ah, 01h
  3307 0000219D 90                  <2>  nop
  3308 0000219E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 0000219F 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000021A1 B441                <2>  mov ah, 41h
  3257 000021A3 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000021A6 BBAA55              <2>  mov bx, 55AAh
  3260 000021A9 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000021AA 90                  <2>  nop
  3263 000021AB 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000021AC 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000021AE 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000021B2 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000021B4 D0E9                <2>  shr cl, 1
  3273 000021B6 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000021B8 B401                <2>  mov ah, 01h
  3307 000021BA 90                  <2>  nop
  3308 000021BB F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000021BC 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000021BE 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000021C1 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000021C2 B401                <2>  mov ah, 01h
  3307 000021C4 90                  <2>  nop
  3308 000021C5 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000021C6 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000021C8 B441                <2>  mov ah, 41h
  3257 000021CA 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000021CD BBAA55              <2>  mov bx, 55AAh
  3260 000021D0 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000021D1 90                  <2>  nop
  3263 000021D2 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000021D3 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000021D5 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000021D9 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000021DB D0E9                <2>  shr cl, 1
  3273 000021DD 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000021DF B401                <2>  mov ah, 01h
  3307 000021E1 90                  <2>  nop
  3308 000021E2 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000021E3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000021E5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000021E8 B401                <2>  mov ah, 01h
  3307 000021EA 90                  <2>  nop
  3308 000021EB F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000021EC 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000021EE B441                <2>  mov ah, 41h
  3257 000021F0 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000021F3 BBAA55              <2>  mov bx, 55AAh
  3260 000021F6 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000021F7 90                  <2>  nop
  3263 000021F8 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000021F9 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000021FB 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000021FF 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002201 D0E9                <2>  shr cl, 1
  3273 00002203 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002205 B401                <2>  mov ah, 01h
  3307 00002207 90                  <2>  nop
  3308 00002208 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002209 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000220B 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000220E F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000220F B401                <2>  mov ah, 01h
  3307 00002211 90                  <2>  nop
  3308 00002212 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002213 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002215 B441                <2>  mov ah, 41h
  3257 00002217 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000221A BBAA55              <2>  mov bx, 55AAh
  3260 0000221D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000221E 90                  <2>  nop
  3263 0000221F 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002220 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002222 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002226 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002228 D0E9                <2>  shr cl, 1
  3273 0000222A 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000222C B401                <2>  mov ah, 01h
  3307 0000222E 90                  <2>  nop
  3308 0000222F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002230 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002232 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002235 B401                <2>  mov ah, 01h
  3307 00002237 90                  <2>  nop
  3308 00002238 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002239 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000223B B441                <2>  mov ah, 41h
  3257 0000223D 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002240 BBAA55              <2>  mov bx, 55AAh
  3260 00002243 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002244 90                  <2>  nop
  3263 00002245 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002246 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002248 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000224C 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000224E D0E9                <2>  shr cl, 1
  3273 00002250 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002252 B401                <2>  mov ah, 01h
  3307 00002254 90                  <2>  nop
  3308 00002255 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002256 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002258 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000225B F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000225C B401                <2>  mov ah, 01h
  3307 0000225E 90                  <2>  nop
  3308 0000225F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002260 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002262 B441                <2>  mov ah, 41h
  3257 00002264 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002267 BBAA55              <2>  mov bx, 55AAh
  3260 0000226A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000226B 90                  <2>  nop
  3263 0000226C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000226D 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000226F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002273 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002275 D0E9                <2>  shr cl, 1
  3273 00002277 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002279 B401                <2>  mov ah, 01h
  3307 0000227B 90                  <2>  nop
  3308 0000227C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000227D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000227F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002282 B401                <2>  mov ah, 01h
  3307 00002284 90                  <2>  nop
  3308 00002285 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002286 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002288 B441                <2>  mov ah, 41h
  3257 0000228A 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000228D BBAA55              <2>  mov bx, 55AAh
  3260 00002290 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002291 90                  <2>  nop
  3263 00002292 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002293 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002295 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002299 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000229B D0E9                <2>  shr cl, 1
  3273 0000229D 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000229F B401                <2>  mov ah, 01h
  3307 000022A1 90                  <2>  nop
  3308 000022A2 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000022A3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000022A5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000022A8 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000022A9 B401                <2>  mov ah, 01h
  3307 000022AB 90                  <2>  nop
  3308 000022AC F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000022AD 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000022AF B441                <2>  mov ah, 41h
  3257 000022B1 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000022B4 BBAA55              <2>  mov bx, 55AAh
  3260 000022B7 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000022B8 90                  <2>  nop
  3263 000022B9 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000022BA 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000022BC 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000022C0 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000022C2 D0E9                <2>  shr cl, 1
  3273 000022C4 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000022C6 B401                <2>  mov ah, 01h
  3307 000022C8 90                  <2>  nop
  3308 000022C9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000022CA 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000022CC 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000022CF B401                <2>  mov ah, 01h
  3307 000022D1 90                  <2>  nop
  3308 000022D2 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000022D3 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000022D5 B441                <2>  mov ah, 41h
  3257 000022D7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000022DA BBAA55              <2>  mov bx, 55AAh
  3260 000022DD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000022DE 90                  <2>  nop
  3263 000022DF 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000022E0 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000022E2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000022E6 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000022E8 D0E9                <2>  shr cl, 1
  3273 000022EA 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000022EC B401                <2>  mov ah, 01h
  3307 000022EE 90                  <2>  nop
  3308 000022EF F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000022F0 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000022F2 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000022F5 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000022F6 B401                <2>  mov ah, 01h
  3307 000022F8 90                  <2>  nop
  3308 000022F9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000022FA 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000022FC B441                <2>  mov ah, 41h
  3257 000022FE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002301 BBAA55              <2>  mov bx, 55AAh
  3260 00002304 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002305 90                  <2>  nop
  3263 00002306 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002307 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002309 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000230D 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000230F D0E9                <2>  shr cl, 1
  3273 00002311 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002313 B401                <2>  mov ah, 01h
  3307 00002315 90                  <2>  nop
  3308 00002316 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002317 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002319 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000231C B401                <2>  mov ah, 01h
  3307 0000231E 90                  <2>  nop
  3308 0000231F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002320 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002322 B441                <2>  mov ah, 41h
  3257 00002324 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002327 BBAA55              <2>  mov bx, 55AAh
  3260 0000232A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000232B 90                  <2>  nop
  3263 0000232C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000232D 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000232F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002333 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002335 D0E9                <2>  shr cl, 1
  3273 00002337 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002339 B401                <2>  mov ah, 01h
  3307 0000233B 90                  <2>  nop
  3308 0000233C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000233D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000233F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002342 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002343 B401                <2>  mov ah, 01h
  3307 00002345 90                  <2>  nop
  3308 00002346 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002347 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002349 B441                <2>  mov ah, 41h
  3257 0000234B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000234E BBAA55              <2>  mov bx, 55AAh
  3260 00002351 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002352 90                  <2>  nop
  3263 00002353 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002354 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002356 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000235A 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000235C D0E9                <2>  shr cl, 1
  3273 0000235E 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002360 B401                <2>  mov ah, 01h
  3307 00002362 90                  <2>  nop
  3308 00002363 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002364 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002366 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002369 B401                <2>  mov ah, 01h
  3307 0000236B 90                  <2>  nop
  3308 0000236C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000236D 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000236F B441                <2>  mov ah, 41h
  3257 00002371 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002374 BBAA55              <2>  mov bx, 55AAh
  3260 00002377 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002378 90                  <2>  nop
  3263 00002379 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000237A 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000237C 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002380 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002382 D0E9                <2>  shr cl, 1
  3273 00002384 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002386 B401                <2>  mov ah, 01h
  3307 00002388 90                  <2>  nop
  3308 00002389 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000238A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000238C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000238F F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002390 B401                <2>  mov ah, 01h
  3307 00002392 90                  <2>  nop
  3308 00002393 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002394 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002396 B441                <2>  mov ah, 41h
  3257 00002398 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000239B BBAA55              <2>  mov bx, 55AAh
  3260 0000239E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000239F 90                  <2>  nop
  3263 000023A0 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000023A1 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000023A3 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000023A7 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000023A9 D0E9                <2>  shr cl, 1
  3273 000023AB 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000023AD B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000023AF 90                  <2>  nop
  3284 000023B0 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000023B1 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000023B3 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000023B7 B401                <2>  mov ah, 01h
  3307 000023B9 90                  <2>  nop
  3308 000023BA F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000023BB 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000023BD 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000023C0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000023C2 90                  <2>  nop
  3284 000023C3 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000023C4 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000023C6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000023CA B401                <2>  mov ah, 01h
  3307 000023CC 90                  <2>  nop
  3308 000023CD F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000023CE 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000023D0 B441                <2>  mov ah, 41h
  3257 000023D2 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000023D5 BBAA55              <2>  mov bx, 55AAh
  3260 000023D8 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000023D9 90                  <2>  nop
  3263 000023DA 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000023DB 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000023DD 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000023E1 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000023E3 D0E9                <2>  shr cl, 1
  3273 000023E5 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000023E7 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000023E9 90                  <2>  nop
  3284 000023EA F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000023EB 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000023ED C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000023F1 B401                <2>  mov ah, 01h
  3307 000023F3 90                  <2>  nop
  3308 000023F4 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000023F5 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000023F7 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000023FA F9                  <2>  stc
  3280                              <2>  %endif
  3281 000023FB B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000023FD 90                  <2>  nop
  3284 000023FE F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000023FF 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002401 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002405 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002406 B401                <2>  mov ah, 01h
  3307 00002408 90                  <2>  nop
  3308 00002409 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 0000240A 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000240C B441                <2>  mov ah, 41h
  3257 0000240E 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002411 BBAA55              <2>  mov bx, 55AAh
  3260 00002414 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002415 90                  <2>  nop
  3263 00002416 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002417 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002419 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000241D 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000241F D0E9                <2>  shr cl, 1
  3273 00002421 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002423 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002425 90                  <2>  nop
  3284 00002426 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002427 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002429 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000242D B401                <2>  mov ah, 01h
  3307 0000242F 90                  <2>  nop
  3308 00002430 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002431 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002433 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002436 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002438 90                  <2>  nop
  3284 00002439 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000243A 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000243C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002440 B401                <2>  mov ah, 01h
  3307 00002442 90                  <2>  nop
  3308 00002443 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002444 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002446 B441                <2>  mov ah, 41h
  3257 00002448 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000244B BBAA55              <2>  mov bx, 55AAh
  3260 0000244E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000244F 90                  <2>  nop
  3263 00002450 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002451 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002453 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002457 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002459 D0E9                <2>  shr cl, 1
  3273 0000245B 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000245D B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000245F 90                  <2>  nop
  3284 00002460 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002461 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002463 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002467 B401                <2>  mov ah, 01h
  3307 00002469 90                  <2>  nop
  3308 0000246A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000246B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000246D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002470 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002471 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002473 90                  <2>  nop
  3284 00002474 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002475 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002477 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000247B F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000247C B401                <2>  mov ah, 01h
  3307 0000247E 90                  <2>  nop
  3308 0000247F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002480 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002482 B441                <2>  mov ah, 41h
  3257 00002484 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002487 BBAA55              <2>  mov bx, 55AAh
  3260 0000248A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000248B 90                  <2>  nop
  3263 0000248C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000248D 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000248F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002493 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002495 D0E9                <2>  shr cl, 1
  3273 00002497 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002499 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000249B 90                  <2>  nop
  3284 0000249C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000249D 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000249F C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000024A3 B401                <2>  mov ah, 01h
  3307 000024A5 90                  <2>  nop
  3308 000024A6 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000024A7 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000024A9 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000024AC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000024AE 90                  <2>  nop
  3284 000024AF F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000024B0 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000024B2 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000024B6 B401                <2>  mov ah, 01h
  3307 000024B8 90                  <2>  nop
  3308 000024B9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000024BA 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000024BC B441                <2>  mov ah, 41h
  3257 000024BE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000024C1 BBAA55              <2>  mov bx, 55AAh
  3260 000024C4 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000024C5 90                  <2>  nop
  3263 000024C6 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000024C7 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000024C9 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000024CD 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000024CF D0E9                <2>  shr cl, 1
  3273 000024D1 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000024D3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000024D5 90                  <2>  nop
  3284 000024D6 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000024D7 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000024D9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000024DD B401                <2>  mov ah, 01h
  3307 000024DF 90                  <2>  nop
  3308 000024E0 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000024E1 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000024E3 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000024E6 F9                  <2>  stc
  3280                              <2>  %endif
  3281 000024E7 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000024E9 90                  <2>  nop
  3284 000024EA F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000024EB 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000024ED C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000024F1 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000024F2 B401                <2>  mov ah, 01h
  3307 000024F4 90                  <2>  nop
  3308 000024F5 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000024F6 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000024F8 B441                <2>  mov ah, 41h
  3257 000024FA 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000024FD BBAA55              <2>  mov bx, 55AAh
  3260 00002500 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002501 90                  <2>  nop
  3263 00002502 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002503 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002505 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002509 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000250B D0E9                <2>  shr cl, 1
  3273 0000250D 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000250F B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002511 90                  <2>  nop
  3284 00002512 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002513 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002515 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002519 B401                <2>  mov ah, 01h
  3307 0000251B 90                  <2>  nop
  3308 0000251C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000251D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000251F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002522 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002524 90                  <2>  nop
  3284 00002525 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002526 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002528 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000252C B401                <2>  mov ah, 01h
  3307 0000252E 90                  <2>  nop
  3308 0000252F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002530 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002532 B441                <2>  mov ah, 41h
  3257 00002534 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002537 BBAA55              <2>  mov bx, 55AAh
  3260 0000253A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000253B 90                  <2>  nop
  3263 0000253C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000253D 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000253F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002543 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002545 D0E9                <2>  shr cl, 1
  3273 00002547 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002549 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000254B 90                  <2>  nop
  3284 0000254C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000254D 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000254F C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002553 B401                <2>  mov ah, 01h
  3307 00002555 90                  <2>  nop
  3308 00002556 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002557 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002559 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 0000255C F9                  <2>  stc
  3280                              <2>  %endif
  3281 0000255D B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000255F 90                  <2>  nop
  3284 00002560 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002561 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002563 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002567 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002568 B401                <2>  mov ah, 01h
  3307 0000256A 90                  <2>  nop
  3308 0000256B F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 0000256C 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000256E B441                <2>  mov ah, 41h
  3257 00002570 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002573 BBAA55              <2>  mov bx, 55AAh
  3260 00002576 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002577 90                  <2>  nop
  3263 00002578 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002579 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000257B 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000257F 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002581 D0E9                <2>  shr cl, 1
  3273 00002583 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002585 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002587 90                  <2>  nop
  3284 00002588 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002589 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000258B 31C0                <2>  xor ax, ax
  3293 0000258D CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000258F C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002593 B401                <2>  mov ah, 01h
  3307 00002595 90                  <2>  nop
  3308 00002596 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002597 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002599 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000259C B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000259E 90                  <2>  nop
  3284 0000259F F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000025A0 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000025A2 31C0                <2>  xor ax, ax
  3293 000025A4 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000025A6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000025AA B401                <2>  mov ah, 01h
  3307 000025AC 90                  <2>  nop
  3308 000025AD F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000025AE 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000025B0 B441                <2>  mov ah, 41h
  3257 000025B2 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000025B5 BBAA55              <2>  mov bx, 55AAh
  3260 000025B8 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000025B9 90                  <2>  nop
  3263 000025BA 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000025BB 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000025BD 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000025C1 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000025C3 D0E9                <2>  shr cl, 1
  3273 000025C5 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000025C7 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000025C9 90                  <2>  nop
  3284 000025CA F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000025CB 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000025CD 31C0                <2>  xor ax, ax
  3293 000025CF CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000025D1 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000025D5 B401                <2>  mov ah, 01h
  3307 000025D7 90                  <2>  nop
  3308 000025D8 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000025D9 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000025DB 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000025DE F9                  <2>  stc
  3280                              <2>  %endif
  3281 000025DF B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000025E1 90                  <2>  nop
  3284 000025E2 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000025E3 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000025E5 31C0                <2>  xor ax, ax
  3293 000025E7 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000025E9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000025ED F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000025EE B401                <2>  mov ah, 01h
  3307 000025F0 90                  <2>  nop
  3308 000025F1 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 000025F2 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000025F4 B441                <2>  mov ah, 41h
  3257 000025F6 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000025F9 BBAA55              <2>  mov bx, 55AAh
  3260 000025FC F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000025FD 90                  <2>  nop
  3263 000025FE 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000025FF 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002601 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002605 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002607 D0E9                <2>  shr cl, 1
  3273 00002609 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000260B B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000260D 90                  <2>  nop
  3284 0000260E F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000260F 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002611 31C0                <2>  xor ax, ax
  3293 00002613 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002615 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002619 B401                <2>  mov ah, 01h
  3307 0000261B 90                  <2>  nop
  3308 0000261C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000261D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000261F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002622 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002624 90                  <2>  nop
  3284 00002625 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002626 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002628 31C0                <2>  xor ax, ax
  3293 0000262A CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000262C C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002630 B401                <2>  mov ah, 01h
  3307 00002632 90                  <2>  nop
  3308 00002633 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002634 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002636 B441                <2>  mov ah, 41h
  3257 00002638 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000263B BBAA55              <2>  mov bx, 55AAh
  3260 0000263E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000263F 90                  <2>  nop
  3263 00002640 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002641 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002643 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002647 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002649 D0E9                <2>  shr cl, 1
  3273 0000264B 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000264D B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000264F 90                  <2>  nop
  3284 00002650 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002651 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002653 31C0                <2>  xor ax, ax
  3293 00002655 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002657 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000265B B401                <2>  mov ah, 01h
  3307 0000265D 90                  <2>  nop
  3308 0000265E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000265F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002661 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002664 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002665 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002667 90                  <2>  nop
  3284 00002668 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002669 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000266B 31C0                <2>  xor ax, ax
  3293 0000266D CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000266F C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002673 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002674 B401                <2>  mov ah, 01h
  3307 00002676 90                  <2>  nop
  3308 00002677 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330 00002678 7200                <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000267A B441                <2>  mov ah, 41h
  3257 0000267C 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000267F BBAA55              <2>  mov bx, 55AAh
  3260 00002682 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002683 90                  <2>  nop
  3263 00002684 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002685 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002687 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000268B 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000268D D0E9                <2>  shr cl, 1
  3273 0000268F 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002691 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002693 90                  <2>  nop
  3284 00002694 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002695 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002697 31C0                <2>  xor ax, ax
  3293 00002699 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000269B C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000269F B401                <2>  mov ah, 01h
  3307 000026A1 90                  <2>  nop
  3308 000026A2 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000026A3 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000026A5 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000026A8 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000026AA 90                  <2>  nop
  3284 000026AB F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000026AC 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000026AE 31C0                <2>  xor ax, ax
  3293 000026B0 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000026B2 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000026B6 B401                <2>  mov ah, 01h
  3307 000026B8 90                  <2>  nop
  3308 000026B9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000026BA 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000026BC B441                <2>  mov ah, 41h
  3257 000026BE 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000026C1 BBAA55              <2>  mov bx, 55AAh
  3260 000026C4 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000026C5 90                  <2>  nop
  3263 000026C6 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000026C7 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000026C9 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000026CD 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000026CF D0E9                <2>  shr cl, 1
  3273 000026D1 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 000026D3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000026D5 90                  <2>  nop
  3284 000026D6 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000026D7 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000026D9 31C0                <2>  xor ax, ax
  3293 000026DB CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000026DD C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000026E1 B401                <2>  mov ah, 01h
  3307 000026E3 90                  <2>  nop
  3308 000026E4 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000026E5 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000026E7 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 000026EA F9                  <2>  stc
  3280                              <2>  %endif
  3281 000026EB B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 000026ED 90                  <2>  nop
  3284 000026EE F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 000026EF 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 000026F1 31C0                <2>  xor ax, ax
  3293 000026F3 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 000026F5 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000026F9 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000026FA B401                <2>  mov ah, 01h
  3307 000026FC 90                  <2>  nop
  3308 000026FD F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 000026FE 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002700 B441                <2>  mov ah, 41h
  3257 00002702 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002705 BBAA55              <2>  mov bx, 55AAh
  3260 00002708 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002709 90                  <2>  nop
  3263 0000270A 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000270B 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000270D 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002711 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002713 D0E9                <2>  shr cl, 1
  3273 00002715 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002717 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002719 90                  <2>  nop
  3284 0000271A F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000271B 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000271D 31C0                <2>  xor ax, ax
  3293 0000271F CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002721 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002725 B401                <2>  mov ah, 01h
  3307 00002727 90                  <2>  nop
  3308 00002728 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002729 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000272B 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 0000272E B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002730 90                  <2>  nop
  3284 00002731 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002732 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002734 31C0                <2>  xor ax, ax
  3293 00002736 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002738 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000273C B401                <2>  mov ah, 01h
  3307 0000273E 90                  <2>  nop
  3308 0000273F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002740 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002742 B441                <2>  mov ah, 41h
  3257 00002744 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002747 BBAA55              <2>  mov bx, 55AAh
  3260 0000274A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000274B 90                  <2>  nop
  3263 0000274C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000274D 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000274F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002753 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002755 D0E9                <2>  shr cl, 1
  3273 00002757 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002759 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 0000275B 90                  <2>  nop
  3284 0000275C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 0000275D 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 0000275F 31C0                <2>  xor ax, ax
  3293 00002761 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002763 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002767 B401                <2>  mov ah, 01h
  3307 00002769 90                  <2>  nop
  3308 0000276A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000276B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000276D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002770 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002771 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002773 90                  <2>  nop
  3284 00002774 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002775 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002777 31C0                <2>  xor ax, ax
  3293 00002779 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 0000277B C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000277F F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002780 B401                <2>  mov ah, 01h
  3307 00002782 90                  <2>  nop
  3308 00002783 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327 00002784 7200                <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002786 B441                <2>  mov ah, 41h
  3257 00002788 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000278B BBAA55              <2>  mov bx, 55AAh
  3260 0000278E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000278F 90                  <2>  nop
  3263 00002790 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002791 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002793 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002797 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002799 D0E9                <2>  shr cl, 1
  3273 0000279B 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000279D B401                <2>  mov ah, 01h
  3307 0000279F 90                  <2>  nop
  3308 000027A0 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000027A1 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000027A3 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000027A6 B401                <2>  mov ah, 01h
  3307 000027A8 90                  <2>  nop
  3308 000027A9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 000027AA 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 000027AC 80FC01              <2>  cmp ah, 1
  3322 000027AF 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000027B1 B441                <2>  mov ah, 41h
  3257 000027B3 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000027B6 BBAA55              <2>  mov bx, 55AAh
  3260 000027B9 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000027BA 90                  <2>  nop
  3263 000027BB 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000027BC 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000027BE 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000027C2 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000027C4 D0E9                <2>  shr cl, 1
  3273 000027C6 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000027C8 B401                <2>  mov ah, 01h
  3307 000027CA 90                  <2>  nop
  3308 000027CB F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000027CC 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000027CE 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000027D1 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000027D2 B401                <2>  mov ah, 01h
  3307 000027D4 90                  <2>  nop
  3308 000027D5 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 000027D6 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 000027D8 80FC01              <2>  cmp ah, 1
  3322 000027DB 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000027DD B441                <2>  mov ah, 41h
  3257 000027DF 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000027E2 BBAA55              <2>  mov bx, 55AAh
  3260 000027E5 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000027E6 90                  <2>  nop
  3263 000027E7 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000027E8 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000027EA 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000027EE 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000027F0 D0E9                <2>  shr cl, 1
  3273 000027F2 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000027F4 B401                <2>  mov ah, 01h
  3307 000027F6 90                  <2>  nop
  3308 000027F7 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000027F8 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000027FA 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000027FD B401                <2>  mov ah, 01h
  3307 000027FF 90                  <2>  nop
  3308 00002800 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002801 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002803 80FC01              <2>  cmp ah, 1
  3322 00002806 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002808 B441                <2>  mov ah, 41h
  3257 0000280A 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000280D BBAA55              <2>  mov bx, 55AAh
  3260 00002810 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002811 90                  <2>  nop
  3263 00002812 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002813 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002815 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002819 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000281B D0E9                <2>  shr cl, 1
  3273 0000281D 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000281F B401                <2>  mov ah, 01h
  3307 00002821 90                  <2>  nop
  3308 00002822 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002823 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002825 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002828 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002829 B401                <2>  mov ah, 01h
  3307 0000282B 90                  <2>  nop
  3308 0000282C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 0000282D 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 0000282F 80FC01              <2>  cmp ah, 1
  3322 00002832 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002834 B441                <2>  mov ah, 41h
  3257 00002836 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002839 BBAA55              <2>  mov bx, 55AAh
  3260 0000283C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000283D 90                  <2>  nop
  3263 0000283E 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000283F 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002841 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002845 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002847 D0E9                <2>  shr cl, 1
  3273 00002849 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000284B B401                <2>  mov ah, 01h
  3307 0000284D 90                  <2>  nop
  3308 0000284E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000284F 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002851 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002854 B401                <2>  mov ah, 01h
  3307 00002856 90                  <2>  nop
  3308 00002857 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002858 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000285A B441                <2>  mov ah, 41h
  3257 0000285C 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000285F BBAA55              <2>  mov bx, 55AAh
  3260 00002862 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002863 90                  <2>  nop
  3263 00002864 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002865 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002867 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000286B 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000286D D0E9                <2>  shr cl, 1
  3273 0000286F 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002871 B401                <2>  mov ah, 01h
  3307 00002873 90                  <2>  nop
  3308 00002874 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002875 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002877 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 0000287A F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000287B B401                <2>  mov ah, 01h
  3307 0000287D 90                  <2>  nop
  3308 0000287E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 0000287F 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002881 B441                <2>  mov ah, 41h
  3257 00002883 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002886 BBAA55              <2>  mov bx, 55AAh
  3260 00002889 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000288A 90                  <2>  nop
  3263 0000288B 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000288C 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000288E 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002892 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002894 D0E9                <2>  shr cl, 1
  3273 00002896 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002898 B401                <2>  mov ah, 01h
  3307 0000289A 90                  <2>  nop
  3308 0000289B F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000289C 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000289E 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000028A1 B401                <2>  mov ah, 01h
  3307 000028A3 90                  <2>  nop
  3308 000028A4 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000028A5 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000028A7 B441                <2>  mov ah, 41h
  3257 000028A9 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000028AC BBAA55              <2>  mov bx, 55AAh
  3260 000028AF F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000028B0 90                  <2>  nop
  3263 000028B1 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000028B2 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000028B4 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000028B8 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000028BA D0E9                <2>  shr cl, 1
  3273 000028BC 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000028BE B401                <2>  mov ah, 01h
  3307 000028C0 90                  <2>  nop
  3308 000028C1 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000028C2 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000028C4 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000028C7 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000028C8 B401                <2>  mov ah, 01h
  3307 000028CA 90                  <2>  nop
  3308 000028CB F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000028CC 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000028CE B441                <2>  mov ah, 41h
  3257 000028D0 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000028D3 BBAA55              <2>  mov bx, 55AAh
  3260 000028D6 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000028D7 90                  <2>  nop
  3263 000028D8 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000028D9 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000028DB 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000028DF 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000028E1 D0E9                <2>  shr cl, 1
  3273 000028E3 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000028E5 B401                <2>  mov ah, 01h
  3307 000028E7 90                  <2>  nop
  3308 000028E8 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000028E9 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000028EB 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000028EE B401                <2>  mov ah, 01h
  3307 000028F0 90                  <2>  nop
  3308 000028F1 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 000028F2 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 000028F4 80FC01              <2>  cmp ah, 1
  3322 000028F7 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000028F9 B441                <2>  mov ah, 41h
  3257 000028FB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000028FE BBAA55              <2>  mov bx, 55AAh
  3260 00002901 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002902 90                  <2>  nop
  3263 00002903 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002904 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002906 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000290A 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000290C D0E9                <2>  shr cl, 1
  3273 0000290E 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002910 B401                <2>  mov ah, 01h
  3307 00002912 90                  <2>  nop
  3308 00002913 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002914 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002916 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002919 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000291A B401                <2>  mov ah, 01h
  3307 0000291C 90                  <2>  nop
  3308 0000291D F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 0000291E 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002920 80FC01              <2>  cmp ah, 1
  3322 00002923 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002925 B441                <2>  mov ah, 41h
  3257 00002927 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 0000292A BBAA55              <2>  mov bx, 55AAh
  3260 0000292D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 0000292E 90                  <2>  nop
  3263 0000292F 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002930 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002932 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002936 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002938 D0E9                <2>  shr cl, 1
  3273 0000293A 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000293C B401                <2>  mov ah, 01h
  3307 0000293E 90                  <2>  nop
  3308 0000293F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002940 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002942 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002945 B401                <2>  mov ah, 01h
  3307 00002947 90                  <2>  nop
  3308 00002948 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002949 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 0000294B 80FC01              <2>  cmp ah, 1
  3322 0000294E 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002950 B441                <2>  mov ah, 41h
  3257 00002952 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002955 BBAA55              <2>  mov bx, 55AAh
  3260 00002958 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002959 90                  <2>  nop
  3263 0000295A 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 0000295B 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 0000295D 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002961 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002963 D0E9                <2>  shr cl, 1
  3273 00002965 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002967 B401                <2>  mov ah, 01h
  3307 00002969 90                  <2>  nop
  3308 0000296A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 0000296B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 0000296D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002970 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002971 B401                <2>  mov ah, 01h
  3307 00002973 90                  <2>  nop
  3308 00002974 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002975 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002977 80FC01              <2>  cmp ah, 1
  3322 0000297A 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 0000297C B441                <2>  mov ah, 41h
  3257 0000297E 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002981 BBAA55              <2>  mov bx, 55AAh
  3260 00002984 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002985 90                  <2>  nop
  3263 00002986 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002987 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002989 81FB55AA            <2>  cmp bx, 0AA55h
  3270 0000298D 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 0000298F D0E9                <2>  shr cl, 1
  3273 00002991 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002993 B401                <2>  mov ah, 01h
  3307 00002995 90                  <2>  nop
  3308 00002996 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002997 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002999 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 0000299C B401                <2>  mov ah, 01h
  3307 0000299E 90                  <2>  nop
  3308 0000299F F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000029A0 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000029A2 B441                <2>  mov ah, 41h
  3257 000029A4 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000029A7 BBAA55              <2>  mov bx, 55AAh
  3260 000029AA F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000029AB 90                  <2>  nop
  3263 000029AC 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000029AD 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000029AF 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000029B3 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000029B5 D0E9                <2>  shr cl, 1
  3273 000029B7 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000029B9 B401                <2>  mov ah, 01h
  3307 000029BB 90                  <2>  nop
  3308 000029BC F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000029BD 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000029BF 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 000029C2 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000029C3 B401                <2>  mov ah, 01h
  3307 000029C5 90                  <2>  nop
  3308 000029C6 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000029C7 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000029C9 B441                <2>  mov ah, 41h
  3257 000029CB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000029CE BBAA55              <2>  mov bx, 55AAh
  3260 000029D1 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000029D2 90                  <2>  nop
  3263 000029D3 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000029D4 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000029D6 81FB55AA            <2>  cmp bx, 0AA55h
  3270 000029DA 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 000029DC D0E9                <2>  shr cl, 1
  3273 000029DE 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000029E0 B401                <2>  mov ah, 01h
  3307 000029E2 90                  <2>  nop
  3308 000029E3 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 000029E4 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 000029E6 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 000029E9 B401                <2>  mov ah, 01h
  3307 000029EB 90                  <2>  nop
  3308 000029EC F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 000029ED 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 000029EF B441                <2>  mov ah, 41h
  3257 000029F1 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 000029F4 BBAA55              <2>  mov bx, 55AAh
  3260 000029F7 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 000029F8 90                  <2>  nop
  3263 000029F9 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 000029FA 7210                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 000029FC 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002A00 750A                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002A02 D0E9                <2>  shr cl, 1
  3273 00002A04 7306                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A06 B401                <2>  mov ah, 01h
  3307 00002A08 90                  <2>  nop
  3308 00002A09 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002A0A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002A0C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281                              <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283                              <2>  nop
  3284                              <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288                              <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299                              <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002A0F F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A10 B401                <2>  mov ah, 01h
  3307 00002A12 90                  <2>  nop
  3308 00002A13 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002A14 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002A16 B441                <2>  mov ah, 41h
  3257 00002A18 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002A1B BBAA55              <2>  mov bx, 55AAh
  3260 00002A1E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002A1F 90                  <2>  nop
  3263 00002A20 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002A21 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002A23 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002A27 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002A29 D0E9                <2>  shr cl, 1
  3273 00002A2B 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002A2D B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002A2F 90                  <2>  nop
  3284 00002A30 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002A31 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002A33 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A37 B401                <2>  mov ah, 01h
  3307 00002A39 90                  <2>  nop
  3308 00002A3A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002A3B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002A3D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002A40 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002A42 90                  <2>  nop
  3284 00002A43 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002A44 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002A46 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A4A B401                <2>  mov ah, 01h
  3307 00002A4C 90                  <2>  nop
  3308 00002A4D F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002A4E 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002A50 80FC01              <2>  cmp ah, 1
  3322 00002A53 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002A55 B441                <2>  mov ah, 41h
  3257 00002A57 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002A5A BBAA55              <2>  mov bx, 55AAh
  3260 00002A5D F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002A5E 90                  <2>  nop
  3263 00002A5F 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002A60 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002A62 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002A66 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002A68 D0E9                <2>  shr cl, 1
  3273 00002A6A 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002A6C B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002A6E 90                  <2>  nop
  3284 00002A6F F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002A70 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002A72 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A76 B401                <2>  mov ah, 01h
  3307 00002A78 90                  <2>  nop
  3308 00002A79 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002A7A 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002A7C 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002A7F F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002A80 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002A82 90                  <2>  nop
  3284 00002A83 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002A84 7310                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002A86 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002A8A F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002A8B B401                <2>  mov ah, 01h
  3307 00002A8D 90                  <2>  nop
  3308 00002A8E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002A8F 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002A91 80FC01              <2>  cmp ah, 1
  3322 00002A94 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002A96 B441                <2>  mov ah, 41h
  3257 00002A98 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002A9B BBAA55              <2>  mov bx, 55AAh
  3260 00002A9E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002A9F 90                  <2>  nop
  3263 00002AA0 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002AA1 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002AA3 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002AA7 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002AA9 D0E9                <2>  shr cl, 1
  3273 00002AAB 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002AAD B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002AAF 90                  <2>  nop
  3284 00002AB0 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002AB1 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002AB3 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002AB7 B401                <2>  mov ah, 01h
  3307 00002AB9 90                  <2>  nop
  3308 00002ABA F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002ABB 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002ABD 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002AC0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002AC2 90                  <2>  nop
  3284 00002AC3 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002AC4 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002AC6 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002ACA B401                <2>  mov ah, 01h
  3307 00002ACC 90                  <2>  nop
  3308 00002ACD F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002ACE 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002AD0 80FC01              <2>  cmp ah, 1
  3322 00002AD3 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002AD5 B441                <2>  mov ah, 41h
  3257 00002AD7 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002ADA BBAA55              <2>  mov bx, 55AAh
  3260 00002ADD F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002ADE 90                  <2>  nop
  3263 00002ADF 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002AE0 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002AE2 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002AE6 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002AE8 D0E9                <2>  shr cl, 1
  3273 00002AEA 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002AEC B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002AEE 90                  <2>  nop
  3284 00002AEF F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002AF0 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002AF2 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002AF6 B401                <2>  mov ah, 01h
  3307 00002AF8 90                  <2>  nop
  3308 00002AF9 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002AFA 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002AFC 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002AFF F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002B00 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002B02 90                  <2>  nop
  3284 00002B03 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002B04 7310                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002B06 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002B0A F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002B0B B401                <2>  mov ah, 01h
  3307 00002B0D 90                  <2>  nop
  3308 00002B0E F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002B0F 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002B11 80FC01              <2>  cmp ah, 1
  3322 00002B14 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002B16 B441                <2>  mov ah, 41h
  3257 00002B18 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002B1B BBAA55              <2>  mov bx, 55AAh
  3260 00002B1E F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002B1F 90                  <2>  nop
  3263 00002B20 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002B21 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002B23 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002B27 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002B29 D0E9                <2>  shr cl, 1
  3273 00002B2B 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002B2D B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002B2F 90                  <2>  nop
  3284 00002B30 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002B31 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002B33 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002B37 B401                <2>  mov ah, 01h
  3307 00002B39 90                  <2>  nop
  3308 00002B3A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002B3B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002B3D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002B40 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002B42 90                  <2>  nop
  3284 00002B43 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002B44 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002B46 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002B4A B401                <2>  mov ah, 01h
  3307 00002B4C 90                  <2>  nop
  3308 00002B4D F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002B4E 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002B50 B441                <2>  mov ah, 41h
  3257 00002B52 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002B55 BBAA55              <2>  mov bx, 55AAh
  3260 00002B58 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002B59 90                  <2>  nop
  3263 00002B5A 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002B5B 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002B5D 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002B61 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002B63 D0E9                <2>  shr cl, 1
  3273 00002B65 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002B67 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002B69 90                  <2>  nop
  3284 00002B6A F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002B6B 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002B6D C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002B71 B401                <2>  mov ah, 01h
  3307 00002B73 90                  <2>  nop
  3308 00002B74 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002B75 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002B77 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002B7A F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002B7B B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002B7D 90                  <2>  nop
  3284 00002B7E F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002B7F 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002B81 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002B85 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002B86 B401                <2>  mov ah, 01h
  3307 00002B88 90                  <2>  nop
  3308 00002B89 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002B8A 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002B8C B441                <2>  mov ah, 41h
  3257 00002B8E 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002B91 BBAA55              <2>  mov bx, 55AAh
  3260 00002B94 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002B95 90                  <2>  nop
  3263 00002B96 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002B97 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002B99 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002B9D 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002B9F D0E9                <2>  shr cl, 1
  3273 00002BA1 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002BA3 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002BA5 90                  <2>  nop
  3284 00002BA6 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002BA7 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002BA9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002BAD B401                <2>  mov ah, 01h
  3307 00002BAF 90                  <2>  nop
  3308 00002BB0 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002BB1 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002BB3 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002BB6 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002BB8 90                  <2>  nop
  3284 00002BB9 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002BBA 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002BBC C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002BC0 B401                <2>  mov ah, 01h
  3307 00002BC2 90                  <2>  nop
  3308 00002BC3 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002BC4 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002BC6 B441                <2>  mov ah, 41h
  3257 00002BC8 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002BCB BBAA55              <2>  mov bx, 55AAh
  3260 00002BCE F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002BCF 90                  <2>  nop
  3263 00002BD0 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002BD1 721A                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002BD3 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002BD7 7514                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002BD9 D0E9                <2>  shr cl, 1
  3273 00002BDB 7310                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002BDD B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002BDF 90                  <2>  nop
  3284 00002BE0 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002BE1 730A                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002BE3 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002BE7 B401                <2>  mov ah, 01h
  3307 00002BE9 90                  <2>  nop
  3308 00002BEA F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002BEB 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002BED 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002BF0 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002BF1 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002BF3 90                  <2>  nop
  3284 00002BF4 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002BF5 730B                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292                              <2>  xor ax, ax
  3293                              <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002BF7 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002BFB F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002BFC B401                <2>  mov ah, 01h
  3307 00002BFE 90                  <2>  nop
  3308 00002BFF F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002C00 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002C02 B441                <2>  mov ah, 41h
  3257 00002C04 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002C07 BBAA55              <2>  mov bx, 55AAh
  3260 00002C0A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002C0B 90                  <2>  nop
  3263 00002C0C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002C0D 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002C0F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002C13 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002C15 D0E9                <2>  shr cl, 1
  3273 00002C17 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002C19 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002C1B 90                  <2>  nop
  3284 00002C1C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002C1D 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002C1F 31C0                <2>  xor ax, ax
  3293 00002C21 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002C23 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002C27 B401                <2>  mov ah, 01h
  3307 00002C29 90                  <2>  nop
  3308 00002C2A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002C2B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002C2D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002C30 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002C32 90                  <2>  nop
  3284 00002C33 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002C34 7313                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002C36 31C0                <2>  xor ax, ax
  3293 00002C38 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002C3A C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002C3E B401                <2>  mov ah, 01h
  3307 00002C40 90                  <2>  nop
  3308 00002C41 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002C42 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002C44 80FC01              <2>  cmp ah, 1
  3322 00002C47 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002C49 B441                <2>  mov ah, 41h
  3257 00002C4B 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002C4E BBAA55              <2>  mov bx, 55AAh
  3260 00002C51 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002C52 90                  <2>  nop
  3263 00002C53 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002C54 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002C56 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002C5A 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002C5C D0E9                <2>  shr cl, 1
  3273 00002C5E 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002C60 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002C62 90                  <2>  nop
  3284 00002C63 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002C64 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002C66 31C0                <2>  xor ax, ax
  3293 00002C68 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002C6A C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002C6E B401                <2>  mov ah, 01h
  3307 00002C70 90                  <2>  nop
  3308 00002C71 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002C72 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002C74 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002C77 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002C78 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002C7A 90                  <2>  nop
  3284 00002C7B F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002C7C 7314                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002C7E 31C0                <2>  xor ax, ax
  3293 00002C80 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002C82 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002C86 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002C87 B401                <2>  mov ah, 01h
  3307 00002C89 90                  <2>  nop
  3308 00002C8A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002C8B 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002C8D 80FC01              <2>  cmp ah, 1
  3322 00002C90 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002C92 B441                <2>  mov ah, 41h
  3257 00002C94 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002C97 BBAA55              <2>  mov bx, 55AAh
  3260 00002C9A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002C9B 90                  <2>  nop
  3263 00002C9C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002C9D 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002C9F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002CA3 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002CA5 D0E9                <2>  shr cl, 1
  3273 00002CA7 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002CA9 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002CAB 90                  <2>  nop
  3284 00002CAC F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002CAD 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002CAF 31C0                <2>  xor ax, ax
  3293 00002CB1 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002CB3 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002CB7 B401                <2>  mov ah, 01h
  3307 00002CB9 90                  <2>  nop
  3308 00002CBA F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002CBB 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002CBD 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002CC0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002CC2 90                  <2>  nop
  3284 00002CC3 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002CC4 7313                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002CC6 31C0                <2>  xor ax, ax
  3293 00002CC8 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002CCA C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002CCE B401                <2>  mov ah, 01h
  3307 00002CD0 90                  <2>  nop
  3308 00002CD1 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002CD2 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002CD4 80FC01              <2>  cmp ah, 1
  3322 00002CD7 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002CD9 B441                <2>  mov ah, 41h
  3257 00002CDB 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002CDE BBAA55              <2>  mov bx, 55AAh
  3260 00002CE1 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002CE2 90                  <2>  nop
  3263 00002CE3 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002CE4 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002CE6 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002CEA 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002CEC D0E9                <2>  shr cl, 1
  3273 00002CEE 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002CF0 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002CF2 90                  <2>  nop
  3284 00002CF3 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002CF4 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002CF6 31C0                <2>  xor ax, ax
  3293 00002CF8 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002CFA C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002CFE B401                <2>  mov ah, 01h
  3307 00002D00 90                  <2>  nop
  3308 00002D01 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002D02 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002D04 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002D07 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002D08 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002D0A 90                  <2>  nop
  3284 00002D0B F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002D0C 7314                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002D0E 31C0                <2>  xor ax, ax
  3293 00002D10 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002D12 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002D16 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002D17 B401                <2>  mov ah, 01h
  3307 00002D19 90                  <2>  nop
  3308 00002D1A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319 00002D1B 7305                <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3321 00002D1D 80FC01              <2>  cmp ah, 1
  3322 00002D20 7400                <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002D22 B441                <2>  mov ah, 41h
  3257 00002D24 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002D27 BBAA55              <2>  mov bx, 55AAh
  3260 00002D2A F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002D2B 90                  <2>  nop
  3263 00002D2C 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002D2D 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002D2F 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002D33 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002D35 D0E9                <2>  shr cl, 1
  3273 00002D37 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002D39 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002D3B 90                  <2>  nop
  3284 00002D3C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002D3D 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002D3F 31C0                <2>  xor ax, ax
  3293 00002D41 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002D43 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002D47 B401                <2>  mov ah, 01h
  3307 00002D49 90                  <2>  nop
  3308 00002D4A F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002D4B 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002D4D 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002D50 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002D52 90                  <2>  nop
  3284 00002D53 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002D54 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002D56 31C0                <2>  xor ax, ax
  3293 00002D58 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002D5A C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002D5E B401                <2>  mov ah, 01h
  3307 00002D60 90                  <2>  nop
  3308 00002D61 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002D62 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002D64 B441                <2>  mov ah, 41h
  3257 00002D66 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002D69 BBAA55              <2>  mov bx, 55AAh
  3260 00002D6C F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002D6D 90                  <2>  nop
  3263 00002D6E 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002D6F 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002D71 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002D75 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002D77 D0E9                <2>  shr cl, 1
  3273 00002D79 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002D7B B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002D7D 90                  <2>  nop
  3284 00002D7E F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002D7F 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002D81 31C0                <2>  xor ax, ax
  3293 00002D83 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002D85 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002D89 B401                <2>  mov ah, 01h
  3307 00002D8B 90                  <2>  nop
  3308 00002D8C F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002D8D 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002D8F 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002D92 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002D93 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002D95 90                  <2>  nop
  3284 00002D96 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002D97 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002D99 31C0                <2>  xor ax, ax
  3293 00002D9B CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002D9D C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002DA1 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002DA2 B401                <2>  mov ah, 01h
  3307 00002DA4 90                  <2>  nop
  3308 00002DA5 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002DA6 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002DA8 B441                <2>  mov ah, 41h
  3257 00002DAA 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002DAD BBAA55              <2>  mov bx, 55AAh
  3260 00002DB0 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002DB1 90                  <2>  nop
  3263 00002DB2 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002DB3 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002DB5 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002DB9 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002DBB D0E9                <2>  shr cl, 1
  3273 00002DBD 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002DBF B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002DC1 90                  <2>  nop
  3284 00002DC2 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002DC3 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002DC5 31C0                <2>  xor ax, ax
  3293 00002DC7 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002DC9 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002DCD B401                <2>  mov ah, 01h
  3307 00002DCF 90                  <2>  nop
  3308 00002DD0 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002DD1 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002DD3 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002DD6 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002DD8 90                  <2>  nop
  3284 00002DD9 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002DDA 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002DDC 31C0                <2>  xor ax, ax
  3293 00002DDE CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002DE0 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002DE4 B401                <2>  mov ah, 01h
  3307 00002DE6 90                  <2>  nop
  3308 00002DE7 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002DE8 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253                              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3255                              <2>  %else
  3256 00002DEA B441                <2>  mov ah, 41h
  3257 00002DEC 8A567F              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3259 00002DEF BBAA55              <2>  mov bx, 55AAh
  3260 00002DF2 F9                  <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262 00002DF3 90                  <2>  nop
  3263 00002DF4 90                  <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267 00002DF5 721E                <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3269 00002DF7 81FB55AA            <2>  cmp bx, 0AA55h
  3270 00002DFB 7518                <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3272 00002DFD D0E9                <2>  shr cl, 1
  3273 00002DFF 7314                <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279                              <2>  stc
  3280                              <2>  %endif
  3281 00002E01 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002E03 90                  <2>  nop
  3284 00002E04 F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002E05 730E                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002E07 31C0                <2>  xor ax, ax
  3293 00002E09 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002E0B C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303                              <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002E0F B401                <2>  mov ah, 01h
  3307 00002E11 90                  <2>  nop
  3308 00002E12 F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316                              <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336 00002E13 7200                <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3464                              <1>  %if variant == 128
  3465                              <1> lba_search_strings_chs:
  3466                              <1>  freedos_lba_search_string freedos, 1, 0, 0
  3467                              <1>  freedos_lba_search_string freedos_oem, 1, 1, 0
  3468                              <1>  %endif
  3469                              <1>  %assign identifier variant & ~128
  3470                              <1>  ldosboot_lba_search_string identifier, variant & 128, variant & 1, variant & 2, variant & 4, variant & 8, variant & 16, variant & 32, variant & 64
  3229                              <2> %define WILDCARDS dw ""
  3230                              <2> %assign _FORCE_CHS %2
  3231                              <2> %assign _LBA_SKIP_CHECK %3
  3232                              <2> %assign _LBA_SKIP_CY %4
  3233                              <2> %assign _LBA_SKIP_LBA_RETRY %5
  3234                              <2> %assign _LBA_SKIP_ANY %6
  3235                              <2> %assign _RETRY_RESET %7
  3236                              <2> %assign _LBA_RETRY %8
  3237                              <2> %assign _CHS 1
  3238                              <2> %assign _LDOSBOOT32 %9
  3239                              <2> 
  3240                              <2> 
  3241                              <2> %if _FORCE_CHS
  3242                              <2>  %define %%identifier label_%1_chs
  3243                              <2>  %define %%other label_%1_lba
  3244                              <2> %else
  3245                              <2>  %define %%identifier label_%1_lba
  3246                              <2>  %define %%other label_%1_chs
  3247                              <2> %endif
  3248                              <2> 
  3249                              <2> %%start:
  3250                              <2> %[%%identifier %+ _search_string]:
  3251                              <2> 
  3252                              <2>  %if _LBA_SKIP_CHECK
  3253 00002E15 8A567F              <2>  mov dl, [bp + 127]
  3254                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3255                              <2>  %else
  3256                              <2>  mov ah, 41h
  3257                              <2>  mov dl, [bp + 127]
  3258                              <2> search_wildcard %%start, -1
  3259                              <2>  mov bx, 55AAh
  3260                              <2>  stc
  3261                              <2> %if _FORCE_CHS
  3262                              <2>  nop
  3263                              <2>  nop
  3264                              <2> %else
  3265                              <2>  int 13h
  3266                              <2> %endif
  3267                              <2>  jc .no_lba
  3268                              <2> search_wildcard %%start, -1
  3269                              <2>  cmp bx, 0AA55h
  3270                              <2>  jne .no_lba
  3271                              <2> search_wildcard %%start, -1
  3272                              <2>  shr cl, 1
  3273                              <2>  jnc .no_lba
  3274                              <2> search_wildcard %%start, -1
  3275                              <2>  %endif
  3276                              <2> 
  3277                              <2> %if _LBA_RETRY
  3278                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3279 00002E18 F9                  <2>  stc
  3280                              <2>  %endif
  3281 00002E19 B442                <2>  mov ah, 42h
  3282                              <2> %if _FORCE_CHS
  3283 00002E1B 90                  <2>  nop
  3284 00002E1C F9                  <2>  stc
  3285                              <2> %else
  3286                              <2>  int 13h
  3287                              <2> %endif
  3288 00002E1D 730F                <2>  jnc .lba_done
  3289                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3290                              <2> 
  3291                              <2>  %if _RETRY_RESET
  3292 00002E1F 31C0                <2>  xor ax, ax
  3293 00002E21 CD13                <2>  int 13h
  3294                              <2>  %endif
  3295                              <2> 
  3296                              <2> 
  3297                              <2> 
  3298                              <2> 
  3299 00002E23 C6440201            <2>  mov byte [si + 2], 1
  3300                              <2> %endif
  3301                              <2> 
  3302                              <2>  %if _LBA_SKIP_CHECK && _LBA_SKIP_CY
  3303 00002E27 F9                  <2>  stc
  3304                              <2>  %endif
  3305                              <2> %if _FORCE_CHS
  3306 00002E28 B401                <2>  mov ah, 01h
  3307 00002E2A 90                  <2>  nop
  3308 00002E2B F9                  <2>  stc
  3309                              <2> %else
  3310                              <2>  mov ah, 42h
  3311                              <2>  int 13h
  3312                              <2> %endif
  3313                              <2>  %if _LBA_SKIP_CHECK && _CHS
  3314                              <2>  %if _LDOSBOOT32
  3315                              <2>  %if _LBA_SKIP_ANY
  3316 00002E2C 7200                <2>  jc .no_lba
  3317                              <2> search_wildcard %%start, -1
  3221                              <3> %assign %%wc $ + %2 - %1
  3222                              <3> %if %%wc == 0
  3223                              <3>  %error Wildcard at beginning of search string is not allowed
  3224                              <3> %endif
  3225                              <3> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3318                              <2>  %else
  3319                              <2>  jnc .lba_done
  3320                              <2> search_wildcard %%start, -1
  3321                              <2>  cmp ah, 1
  3322                              <2>  je .no_lba
  3323                              <2> search_wildcard %%start, -1
  3324                              <2>  %endif
  3325                              <2>  %else
  3326                              <2>  %if _LBA_SKIP_ANY
  3327                              <2>  jc .no_lba
  3328                              <2> search_wildcard %%start, -1
  3329                              <2>  %else
  3330                              <2>  jc .lba_check_error_1
  3331                              <2> search_wildcard %%start, -1
  3332                              <2>  %endif
  3333                              <2>  %endif
  3334                              <2>  %else
  3335                              <2> .cy_err:
  3336                              <2>  jc .lba_error
  3337                              <2> search_wildcard %%start, -1
  3338                              <2>  %endif
  3339                              <2> 
  3340                              <2> .lba_error:
  3341                              <2> .lba_check_error_1:
  3342                              <2> .lba_done:
  3343                              <2> .no_lba:
  3344                              <2> %%end:
  3345                              <2> 
  3346                              <2> %if _FORCE_CHS
  3347                              <2>  %define %%message lba_search_msg.forcechs
  3348                              <2> %else
  3349                              <2>  %if _LBA_SKIP_CHECK
  3350                              <2>  %define %%message lba_search_msg.autoskip
  3351                              <2>  %else
  3352                              <2>  %define %%message lba_search_msg.auto
  3353                              <2>  %endif
  3354                              <2> %endif
  3355                              <2> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3357                              <2> %[%%identifier %+ _length]: equ %%end - %%start
  3358                              <2> %if _FORCE_CHS
  3359                              <2>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3360                              <2>  %error Expected same length of replacement
  3361                              <2>  %endif
  3362                              <2> %endif
  3480                              <1>  %assign variant variant + 1
  3482                                  
  3483                                  lba_search_strings_hdd:
  3484                                  	freedos_lba_search_string freedos_hdd, 0, 0, 1
  3366                              <1> %define WILDCARDS dw ""
  3367                              <1> %assign _FORCE_CHS %2
  3368                              <1> %assign _OEM_BOOT %3
  3369                              <1> %assign _FORCE_CHS_DISKETTE %4
  3370                              <1> 
  3371                              <1> 
  3372                              <1> %if _FORCE_CHS_DISKETTE
  3373                              <1>  %define %%identifier label_%1_chs_diskette
  3374                              <1>  %define %%other label_%1_special
  3375                              <1> %elif _FORCE_CHS
  3376                              <1>  %define %%identifier label_%1_chs
  3377                              <1>  %define %%other label_%1_lba
  3378                              <1> %else
  3379                              <1>  %define %%identifier label_%1_lba
  3380                              <1>  %define %%other label_%1_chs
  3381                              <1> %endif
  3382                              <1> 
  3383                              <1> %%start:
  3384                              <1> %[%%identifier %+ _search_string]:
  3385                              <1> 
  3386 00002E2E B441                <1>  mov ah, 41h
  3387 00002E30 BBAA55              <1>  mov bx, 55AAh
  3388 00002E33 8A567F              <1>  mov dl, [bp + 127]
  3389                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <1> 
  3391                              <1> %if _FORCE_CHS
  3392                              <1>  xor dl, dl
  3393                              <1>  jz @F
  3394                              <1> %elif _FORCE_CHS_DISKETTE
  3395 00002E36 84D2                <1>  test dl, dl
  3396 00002E38 7419                <1>  jz @F
  3397                              <1> %else
  3398                              <1>  test dl, dl
  3399                              <1>  nop
  3400                              <1>  nop
  3401                              <1> %endif
  3402 00002E3A CD13                <1>  int 13h
  3403 00002E3C 7215                <1>  jc @F
  3404 00002E3E D1E9                <1>  shr cx, 1
  3405 00002E40 81DB54AA            <1>  sbb bx, 0AA55h - 1
  3406 00002E44 750D                <1>  jne @F
  3407                              <1> 
  3408                              <1> %if _OEM_BOOT
  3409                              <1>  lea si, [bp + 1023]
  3410                              <1> search_wildcard %%start, -2
  3411                              <1> search_wildcard %%start, -1
  3412                              <1>  mov word [bp + 1023], bx
  3413                              <1> search_wildcard %%start, -2
  3414                              <1> search_wildcard %%start, -1
  3415                              <1>  mov word [bp + 1023], bx
  3416                              <1> search_wildcard %%start, -2
  3417                              <1> search_wildcard %%start, -1
  3418                              <1> %else
  3419 00002E46 8D7680              <1>  lea si, [bp - 128]
  3420                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3421 00002E49 895E80              <1>  mov word [bp - 128], bx
  3422                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3423 00002E4C 895E80              <1>  mov word [bp - 128], bx
  3424                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3425                              <1> %endif
  3426 00002E4F B442                <1>  mov ah, 42h
  3427 00002E51 EB00                <1>  jmp strict short @F
  3428                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <1> @@:
  3430                              <1> %%end:
  3431                              <1> 
  3432                              <1> 
  3433                              <1> %if _FORCE_CHS
  3434                              <1>  %define %%message lba_search_msg.forcechs
  3435                              <1> %else
  3436                              <1>  %if _FORCE_CHS_DISKETTE
  3437                              <1>  %define %%message lba_search_msg.autohdd
  3438                              <1>  %else
  3439                              <1>  %define %%message lba_search_msg.auto
  3440                              <1>  %endif
  3441                              <1> %endif
  3442                              <1> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <1> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <1> %if _FORCE_CHS
  3446                              <1>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <1>  %error Expected same length of replacement
  3448                              <1>  %endif
  3449                              <1> %endif
  3485                                  	freedos_lba_search_string freedos_hdd_oem, 0, 1, 1
  3366                              <1> %define WILDCARDS dw ""
  3367                              <1> %assign _FORCE_CHS %2
  3368                              <1> %assign _OEM_BOOT %3
  3369                              <1> %assign _FORCE_CHS_DISKETTE %4
  3370                              <1> 
  3371                              <1> 
  3372                              <1> %if _FORCE_CHS_DISKETTE
  3373                              <1>  %define %%identifier label_%1_chs_diskette
  3374                              <1>  %define %%other label_%1_special
  3375                              <1> %elif _FORCE_CHS
  3376                              <1>  %define %%identifier label_%1_chs
  3377                              <1>  %define %%other label_%1_lba
  3378                              <1> %else
  3379                              <1>  %define %%identifier label_%1_lba
  3380                              <1>  %define %%other label_%1_chs
  3381                              <1> %endif
  3382                              <1> 
  3383                              <1> %%start:
  3384                              <1> %[%%identifier %+ _search_string]:
  3385                              <1> 
  3386 00002E53 B441                <1>  mov ah, 41h
  3387 00002E55 BBAA55              <1>  mov bx, 55AAh
  3388 00002E58 8A567F              <1>  mov dl, [bp + 127]
  3389                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3390                              <1> 
  3391                              <1> %if _FORCE_CHS
  3392                              <1>  xor dl, dl
  3393                              <1>  jz @F
  3394                              <1> %elif _FORCE_CHS_DISKETTE
  3395 00002E5B 84D2                <1>  test dl, dl
  3396 00002E5D 741C                <1>  jz @F
  3397                              <1> %else
  3398                              <1>  test dl, dl
  3399                              <1>  nop
  3400                              <1>  nop
  3401                              <1> %endif
  3402 00002E5F CD13                <1>  int 13h
  3403 00002E61 7218                <1>  jc @F
  3404 00002E63 D1E9                <1>  shr cx, 1
  3405 00002E65 81DB54AA            <1>  sbb bx, 0AA55h - 1
  3406 00002E69 7510                <1>  jne @F
  3407                              <1> 
  3408                              <1> %if _OEM_BOOT
  3409 00002E6B 8DB6FF03            <1>  lea si, [bp + 1023]
  3410                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3411                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3412 00002E6F 899EFF03            <1>  mov word [bp + 1023], bx
  3413                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3414                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3415 00002E73 899EFF03            <1>  mov word [bp + 1023], bx
  3416                              <1> search_wildcard %%start, -2
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3417                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3418                              <1> %else
  3419                              <1>  lea si, [bp - 128]
  3420                              <1> search_wildcard %%start, -1
  3421                              <1>  mov word [bp - 128], bx
  3422                              <1> search_wildcard %%start, -1
  3423                              <1>  mov word [bp - 128], bx
  3424                              <1> search_wildcard %%start, -1
  3425                              <1> %endif
  3426 00002E77 B442                <1>  mov ah, 42h
  3427 00002E79 EB00                <1>  jmp strict short @F
  3428                              <1> search_wildcard %%start, -1
  3221                              <2> %assign %%wc $ + %2 - %1
  3222                              <2> %if %%wc == 0
  3223                              <2>  %error Wildcard at beginning of search string is not allowed
  3224                              <2> %endif
  3225                              <2> %xdefine WILDCARDS WILDCARDS, dw %%wc
  3429                              <1> @@:
  3430                              <1> %%end:
  3431                              <1> 
  3432                              <1> 
  3433                              <1> %if _FORCE_CHS
  3434                              <1>  %define %%message lba_search_msg.forcechs
  3435                              <1> %else
  3436                              <1>  %if _FORCE_CHS_DISKETTE
  3437                              <1>  %define %%message lba_search_msg.autohdd
  3438                              <1>  %else
  3439                              <1>  %define %%message lba_search_msg.auto
  3440                              <1>  %endif
  3441                              <1> %endif
  3442                              <1> %xdefine SEARCHES SEARCHES, %%identifier:, dw %%start, dw %%end - %%start, dw %%message, dw %%other, WILDCARDS, dw 0
  3444                              <1> %[%%identifier %+ _length]: equ %%end - %%start
  3445                              <1> %if _FORCE_CHS
  3446                              <1>  %if %[%%identifier %+ _length] != %[%%other %+ _length]
  3447                              <1>  %error Expected same length of replacement
  3448                              <1>  %endif
  3449                              <1> %endif
  3486                                  lba_search_strings_end:
  3487                                  
  3488                                  %ifn label_freedos_chs_length == label_freedos_hdd_chs_diskette_length
  3489                                    %error Expected same length of replacement
  3490                                  %endif
  3491                                  %ifn label_freedos_lba_length == label_freedos_hdd_chs_diskette_length
  3492                                    %error Expected same length of replacement
  3493                                  %endif
  3494                                  %ifn label_freedos_oem_chs_length == label_freedos_hdd_oem_chs_diskette_length
  3495                                    %error Expected same length of replacement
  3496                                  %endif
  3497                                  %ifn label_freedos_oem_lba_length == label_freedos_hdd_oem_chs_diskette_length
  3498                                    %error Expected same length of replacement
  3499                                  %endif
  3500                                  
  3501                                  
  3502 00002E7B 00                      	align 2, db 0
  3503                                  label_hdd_special:
  3504                                  
  3505                                  label_freedos_hdd_special:
  3506 00002E7C [2A41]                  	dw label_freedos_hdd_chs_diskette
  3507 00002E7E [DC37]                  	dw label_freedos_chs
  3508 00002E80 [8E2E]                  	dw label_freedos_lba
  3509                                  
  3510                                  label_freedos_hdd_oem_special:
  3511 00002E82 [3E41]                  	dw label_freedos_hdd_oem_chs_diskette
  3512 00002E84 [F037]                  	dw label_freedos_oem_chs
  3513 00002E86 [A22E]                  	dw label_freedos_oem_lba
  3514                                  
  3515 00002E88 000000000000            	dw 0,0,0
  3516                                  
  3517                                  
  3518                                  	%macro dumpsearches 1-*
  3519                                  %rep %0
  3520                                   %1
  3521                                   %rotate 1
  3522                                  %endrep
  3523                                  	%endmacro
  3524                                  
  3525                                  	align 2, db 0
  3526                                  lba_search_metadata:
  3527                                  dumpsearches SEARCHES
  3519                              <1> %rep %0
  3520                              <1>  %1
  3521                              <1>  %rotate 1
  3522                              <1> %endrep
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E8E [9413]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E90 2500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E92 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E94 [DC37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E96 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E98 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E9A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E9C 2000                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002E9E 2400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EA0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EA2 [B913]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EA4 2800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EA6 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EA8 [F037]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EAA 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EAC 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EAE 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EB0 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EB2 1F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EB4 2200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EB6 2300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EB8 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EBA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EBC [E113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EBE 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EC0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EC2 [0A38]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EC4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EC6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EC8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ECA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ECC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ECE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ED0 [FE13]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ED2 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ED4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ED6 [1E38]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002ED8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EDA 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EDC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EDE [0714]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EE0 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EE2 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EE4 [2C38]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EE6 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EE8 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EEA 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EEC 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EEE 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EF0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EF2 [2414]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EF4 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EF6 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EF8 [4038]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EFA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EFC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002EFE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F00 [2E14]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F02 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F04 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F06 [4E38]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F08 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F0A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F0C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F0E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F10 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F12 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F14 [4B14]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F16 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F18 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F1A [6238]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F1C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F1E 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F20 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F22 [5414]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F24 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F26 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F28 [7038]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F2A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F2C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F2E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F30 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F32 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F34 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F36 [7114]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F38 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F3A [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F3C [8438]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F3E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F40 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F42 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F44 [7B14]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F46 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F48 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F4A [9238]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F4C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F4E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F50 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F52 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F54 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F56 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F58 [9814]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F5A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F5C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F5E [A638]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F60 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F62 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F64 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F66 [A114]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F68 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F6A [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F6C [B438]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F6E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F70 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F72 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F74 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F76 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F78 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F7A [BE14]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F7C 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F7E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F80 [C838]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F82 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F84 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F86 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F88 [C814]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F8A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F8C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F8E [D638]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F90 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F92 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F94 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F96 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F98 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F9A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F9C [E514]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002F9E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FA0 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FA2 [EA38]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FA4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FA6 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FA8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FAA [EE14]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FAC 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FAE [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FB0 [F838]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FB2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FB4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FB6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FB8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FBA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FBC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FBE [0B15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FC0 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FC2 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FC4 [0C39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FC6 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FC8 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FCA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FCC [1515]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FCE 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FD0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FD2 [1A39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FD4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FD6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FD8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FDA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FDC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FDE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FE0 [3215]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FE2 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FE4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FE6 [2E39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FE8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FEA 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FEC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FEE [3B15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FF0 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FF2 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FF4 [3C39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FF6 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FF8 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FFA 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FFC 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00002FFE 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003000 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003002 [5815]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003004 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003006 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003008 [5039]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000300A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000300C 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000300E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003010 [6215]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003012 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003014 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003016 [5E39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003018 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000301A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000301C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000301E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003020 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003022 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003024 [7F15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003026 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003028 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000302A [7239]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000302C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000302E 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003030 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003032 [8815]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003034 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003036 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003038 [8039]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000303A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000303C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000303E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003040 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003042 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003044 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003046 [A515]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003048 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000304A [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000304C [9439]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000304E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003050 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003052 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003054 [AF15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003056 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003058 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000305A [A239]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000305C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000305E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003060 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003062 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003064 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003066 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003068 [CC15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000306A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000306C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000306E [B639]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003070 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003072 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003074 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003076 [D515]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003078 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000307A [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000307C [C439]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000307E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003080 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003082 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003084 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003086 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003088 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000308A [F215]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000308C 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000308E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003090 [D839]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003092 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003094 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003096 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003098 [FC15]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000309A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000309C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000309E [E639]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030A0 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030A2 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030A4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030A6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030A8 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030AA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030AC [1916]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030AE 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030B0 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030B2 [FA39]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030B4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030B6 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030B8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030BA [2216]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030BC 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030BE [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030C0 [083A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030C2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030C4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030C6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030C8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030CA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030CC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030CE [3F16]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030D0 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030D2 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030D4 [1C3A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030D6 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030D8 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030DA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030DC [4916]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030DE 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030E0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030E2 [2A3A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030E4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030E6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030E8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030EA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030EC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030EE 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030F0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030F2 [7016]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030F4 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030F6 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030F8 [403A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000030FA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030FC 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000030FE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003100 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003102 [8316]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003104 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003106 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003108 [503A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000310A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000310C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000310E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003110 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003112 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003114 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003116 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003118 [AA16]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000311A 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000311C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000311E [663A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003120 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003122 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003124 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003126 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003128 [BF16]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000312A 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000312C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000312E [763A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003130 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003132 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003134 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003136 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003138 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000313A 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000313C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000313E [E616]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003140 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003142 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003144 [8C3A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003146 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003148 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000314A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000314C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000314E [F916]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003150 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003152 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003154 [9C3A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003156 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003158 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000315A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000315C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000315E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003160 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003162 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003164 [2017]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003166 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003168 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000316A [B23A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000316C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000316E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003170 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003172 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003174 [3517]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003176 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003178 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000317A [C23A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000317C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000317E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003180 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003182 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003184 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003186 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003188 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000318A [5C17]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000318C 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000318E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003190 [D83A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003192 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003194 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003196 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003198 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000319A [6F17]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000319C 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000319E [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031A0 [E83A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031A2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031A4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031A6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031A8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031AA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031AC 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031AE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031B0 [9617]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031B2 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031B4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031B6 [FE3A]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031B8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031BA 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031BC 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031BE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031C0 [AB17]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031C2 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031C4 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031C6 [0E3B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031C8 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031CA 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031CC 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031CE 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031D0 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031D2 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031D4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031D6 [D217]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031D8 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031DA [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031DC [243B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031DE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031E0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031E2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031E4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031E6 [E517]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031E8 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031EA [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031EC [343B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031EE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031F0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031F2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031F4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031F6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031F8 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000031FA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031FC [0C18]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000031FE 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003200 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003202 [4A3B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003204 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003206 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003208 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000320A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000320C [2118]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000320E 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003210 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003212 [5A3B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003214 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003216 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003218 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000321A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000321C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000321E 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003220 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003222 [4C18]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003224 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003226 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003228 [703B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000322A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000322C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000322E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003230 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003232 [6318]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003234 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003236 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003238 [803B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000323A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000323C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000323E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003240 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003242 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003244 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003246 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003248 [8E18]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000324A 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000324C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000324E [963B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003250 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003252 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003254 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003256 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003258 [A718]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000325A 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000325C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000325E [A63B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003260 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003262 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003264 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003266 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003268 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000326A 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000326C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000326E [D218]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003270 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003272 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003274 [BC3B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003276 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003278 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000327A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000327C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000327E [E918]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003280 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003282 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003284 [CC3B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003286 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003288 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000328A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000328C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000328E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003290 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003292 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003294 [1419]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003296 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003298 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000329A [E23B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000329C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000329E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032A0 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032A2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032A4 [2D19]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032A6 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032A8 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032AA [F23B]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032AC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032AE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032B0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032B2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032B4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032B6 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032B8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032BA [5819]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032BC 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032BE [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032C0 [083C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032C2 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032C4 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032C6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032C8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032CA [6F19]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032CC 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032CE [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032D0 [183C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032D2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032D4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032D6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032D8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032DA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032DC 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032DE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032E0 [9A19]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032E2 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032E4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032E6 [2E3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032E8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032EA 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032EC 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032EE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032F0 [B319]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032F2 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032F4 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032F6 [3E3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000032F8 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032FA 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032FC 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000032FE 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003300 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003302 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003304 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003306 [DE19]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003308 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000330A [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000330C [543C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000330E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003310 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003312 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003314 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003316 [F519]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003318 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000331A [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000331C [643C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000331E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003320 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003322 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003324 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003326 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003328 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000332A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000332C [201A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000332E 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003330 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003332 [7A3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003334 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003336 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003338 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000333A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000333C [391A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000333E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003340 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003342 [8A3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003344 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003346 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003348 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000334A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000334C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000334E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003350 [561A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003352 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003354 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003356 [9E3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003358 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000335A 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000335C 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000335E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003360 [641A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003362 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003364 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003366 [AE3C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003368 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000336A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000336C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000336E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003370 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003372 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003374 [811A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003376 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003378 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000337A [C23C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000337C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000337E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003380 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003382 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003384 [901A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003386 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003388 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000338A [D23C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000338C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000338E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003390 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003392 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003394 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003396 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003398 [AD1A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000339A 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000339C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000339E [E63C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033A0 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033A2 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033A4 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033A6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033A8 [BB1A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033AA 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033AC [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033AE [F63C]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033B0 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033B2 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033B4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033B6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033B8 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033BA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033BC [D81A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033BE 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033C0 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033C2 [0A3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033C4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033C6 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033C8 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033CA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033CC [E71A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033CE 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033D0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033D2 [1A3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033D4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033D6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033D8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033DA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033DC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033DE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033E0 [041B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033E2 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033E4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033E6 [2E3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033E8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033EA 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033EC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033EE [0D1B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033F0 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033F2 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033F4 [3C3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000033F6 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033F8 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033FA 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033FC 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000033FE 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003400 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003402 [2A1B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003404 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003406 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003408 [503D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000340A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000340C 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000340E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003410 [341B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003412 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003414 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003416 [5E3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003418 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000341A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000341C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000341E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003420 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003422 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003424 [511B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003426 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003428 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000342A [723D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000342C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000342E 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003430 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003432 [5A1B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003434 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003436 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003438 [803D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000343A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000343C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000343E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003440 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003442 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003444 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003446 [771B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003448 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000344A [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000344C [943D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000344E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003450 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003452 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003454 [811B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003456 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003458 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000345A [A23D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000345C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000345E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003460 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003462 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003464 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003466 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003468 [9E1B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000346A 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000346C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000346E [B63D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003470 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003472 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003474 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003476 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003478 [AC1B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000347A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000347C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000347E [C63D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003480 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003482 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003484 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003486 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003488 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000348A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000348C [C91B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000348E 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003490 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003492 [DA3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003494 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003496 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003498 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000349A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000349C [D81B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000349E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034A0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034A2 [EA3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034A4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034A6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034A8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034AA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034AC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034AE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034B0 [F51B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034B2 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034B4 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034B6 [FE3D]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034B8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034BA 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034BC 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034BE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034C0 [031C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034C2 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034C4 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034C6 [0E3E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034C8 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034CA 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034CC 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034CE 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034D0 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034D2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034D4 [201C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034D6 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034D8 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034DA [223E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034DC 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034DE 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034E0 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034E2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034E4 [2F1C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034E6 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034E8 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034EA [323E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034EC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034EE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034F0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034F2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034F4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034F6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034F8 [4C1C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034FA 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000034FC [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000034FE [463E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003500 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003502 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003504 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003506 [551C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003508 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000350A [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000350C [543E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000350E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003510 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003512 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003514 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003516 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003518 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000351A [721C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000351C 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000351E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003520 [683E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003522 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003524 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003526 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003528 [7C1C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000352A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000352C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000352E [763E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003530 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003532 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003534 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003536 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003538 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000353A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000353C [991C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000353E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003540 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003542 [8A3E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003544 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003546 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003548 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000354A [A21C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000354C 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000354E [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003550 [983E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003552 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003554 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003556 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003558 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000355A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000355C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000355E [BF1C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003560 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003562 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003564 [AC3E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003566 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003568 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000356A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000356C [C91C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000356E 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003570 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003572 [BA3E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003574 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003576 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003578 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000357A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000357C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000357E 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003580 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003582 [F01C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003584 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003586 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003588 [D03E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000358A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000358C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000358E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003590 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003592 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003594 [081D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003596 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003598 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000359A [E23E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000359C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000359E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035A0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035A2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035A4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035A6 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035A8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035AA [2F1D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035AC 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035AE [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035B0 [F83E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035B2 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035B4 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035B6 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035B8 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035BA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035BC [491D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035BE 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035C0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035C2 [0A3F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035C4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035C6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035C8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035CA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035CC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035CE 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035D0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035D2 [701D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035D4 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035D6 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035D8 [203F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035DA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035DC 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035DE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035E0 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035E2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035E4 [881D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035E6 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035E8 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035EA [323F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035EC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035EE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035F0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035F2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035F4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035F6 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035F8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035FA [AF1D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000035FC 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000035FE [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003600 [483F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003602 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003604 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003606 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003608 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000360A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000360C [C91D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000360E 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003610 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003612 [5A3F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003614 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003616 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003618 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000361A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000361C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000361E 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003620 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003622 [F01D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003624 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003626 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003628 [703F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000362A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000362C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000362E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003630 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003632 [031E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003634 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003636 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003638 [803F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000363A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000363C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000363E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003640 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003642 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003644 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003646 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003648 [2A1E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000364A 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000364C [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000364E [963F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003650 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003652 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003654 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003656 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003658 [3F1E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000365A 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000365C [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000365E [A63F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003660 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003662 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003664 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003666 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003668 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000366A 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000366C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000366E [661E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003670 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003672 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003674 [BC3F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003676 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003678 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000367A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000367C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000367E [791E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003680 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003682 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003684 [CC3F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003686 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003688 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000368A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000368C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000368E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003690 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003692 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003694 [A01E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003696 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003698 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000369A [E23F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000369C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000369E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036A0 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036A2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036A4 [B51E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036A6 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036A8 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036AA [F23F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036AC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036AE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036B0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036B2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036B4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036B6 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036B8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036BA [E01E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036BC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036BE [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036C0 [0840]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036C2 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036C4 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036C6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036C8 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036CA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036CC [FC1E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036CE 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036D0 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036D2 [1A40]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036D4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036D6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036D8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036DA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036DC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036DE 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036E0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036E2 [271F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036E4 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036E6 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036E8 [3040]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036EA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036EC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036EE 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036F0 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036F2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036F4 [451F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036F6 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036F8 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036FA [4240]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000036FC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000036FE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003700 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003702 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003704 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003706 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003708 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000370A [701F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000370C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000370E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003710 [5840]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003712 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003714 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003716 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003718 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000371A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000371C [8C1F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000371E 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003720 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003722 [6A40]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003724 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003726 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003728 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000372A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000372C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000372E 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003730 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003732 [B71F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003734 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003736 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003738 [8040]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000373A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000373C 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000373E 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003740 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003742 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003744 [D51F]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003746 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003748 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000374A [9240]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000374C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000374E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003750 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003752 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003754 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003756 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003758 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000375A [0020]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000375C 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000375E [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003760 [A840]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003762 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003764 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003766 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003768 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000376A [1720]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000376C 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000376E [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003770 [B840]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003772 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003774 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003776 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003778 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000377A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000377C 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000377E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003780 [4220]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003782 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003784 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003786 [CE40]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003788 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000378A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000378C 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000378E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003790 [5B20]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003792 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003794 [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003796 [DE40]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003798 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000379A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000379C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000379E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037A0 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037A2 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037A4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037A6 [8620]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037A8 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037AA [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037AC [F440]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037AE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037B0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037B2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037B4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037B6 [9D20]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037B8 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037BA [3113]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037BC [0441]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037BE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037C0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037C2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037C4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037C6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037C8 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037CA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037CC [C820]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037CE 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037D0 [6213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037D2 [1A41]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037D4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037D6 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037D8 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037DA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037DC [E120]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037DE 2500                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037E0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037E2 [8E2E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037E4 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037E6 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037E8 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037EA 2000                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037EC 2400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037EE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037F0 [0621]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037F2 2800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037F4 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037F6 [A22E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000037F8 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037FA 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037FC 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000037FE 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003800 1F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003802 2200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003804 2300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003806 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003808 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000380A [2E21]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000380C 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000380E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003810 [BC2E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003812 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003814 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003816 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003818 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000381A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000381C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000381E [4B21]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003820 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003822 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003824 [D02E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003826 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003828 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000382A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000382C [5421]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000382E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003830 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003832 [DE2E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003834 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003836 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003838 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000383A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000383C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000383E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003840 [7121]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003842 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003844 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003846 [F22E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003848 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000384A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000384C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000384E [7B21]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003850 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003852 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003854 [002F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003856 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003858 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000385A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000385C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000385E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003860 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003862 [9821]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003864 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003866 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003868 [142F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000386A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000386C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000386E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003870 [A121]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003872 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003874 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003876 [222F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003878 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000387A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000387C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000387E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003880 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003882 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003884 [BE21]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003886 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003888 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000388A [362F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000388C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000388E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003890 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003892 [C821]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003894 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003896 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003898 [442F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000389A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000389C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000389E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038A0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038A2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038A4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038A6 [E521]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038A8 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038AA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038AC [582F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038AE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038B0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038B2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038B4 [EE21]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038B6 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038B8 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038BA [662F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038BC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038BE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038C0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038C2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038C4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038C6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038C8 [0B22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038CA 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038CC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038CE [7A2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038D0 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038D2 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038D4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038D6 [1522]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038D8 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038DA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038DC [882F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038DE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038E0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038E2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038E4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038E6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038E8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038EA [3222]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038EC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038EE [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038F0 [9C2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038F2 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038F4 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038F6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038F8 [3B22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038FA 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000038FC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000038FE [AA2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003900 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003902 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003904 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003906 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003908 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000390A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000390C [5822]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000390E 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003910 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003912 [BE2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003914 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003916 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003918 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000391A [6222]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000391C 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000391E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003920 [CC2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003922 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003924 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003926 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003928 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000392A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000392C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000392E [7F22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003930 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003932 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003934 [E02F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003936 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003938 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000393A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000393C [8822]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000393E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003940 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003942 [EE2F]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003944 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003946 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003948 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000394A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000394C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000394E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003950 [A522]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003952 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003954 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003956 [0230]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003958 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000395A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000395C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000395E [AF22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003960 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003962 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003964 [1030]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003966 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003968 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000396A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000396C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000396E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003970 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003972 [CC22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003974 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003976 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003978 [2430]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000397A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000397C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000397E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003980 [D522]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003982 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003984 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003986 [3230]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003988 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000398A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000398C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000398E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003990 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003992 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003994 [F222]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003996 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003998 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000399A [4630]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000399C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000399E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039A0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039A2 [FC22]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039A4 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039A6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039A8 [5430]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039AA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039AC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039AE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039B0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039B2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039B4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039B6 [1923]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039B8 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039BA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039BC [6830]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039BE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039C0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039C2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039C4 [2223]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039C6 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039C8 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039CA [7630]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039CC 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039CE 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039D0 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039D2 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039D4 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039D6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039D8 [3F23]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039DA 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039DC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039DE [8A30]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039E0 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039E2 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039E4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039E6 [4923]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039E8 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039EA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039EC [9830]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039EE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039F0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039F2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039F4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039F6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039F8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039FA [6623]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000039FC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000039FE [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A00 [AC30]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A02 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A04 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A06 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A08 [6F23]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A0A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A0C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A0E [BA30]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A10 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A12 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A14 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A16 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A18 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A1A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A1C [8C23]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A1E 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A20 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A22 [CE30]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A24 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A26 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A28 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A2A [9623]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A2C 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A2E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A30 [DC30]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A32 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A34 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A36 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A38 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A3A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A3C 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A3E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A40 [BD23]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A42 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A44 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A46 [F230]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A48 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A4A 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A4C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A4E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A50 [D023]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A52 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A54 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A56 [0231]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A58 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A5A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A5C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A5E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A60 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A62 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A64 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A66 [F723]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A68 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A6A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A6C [1831]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A6E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A70 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A72 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A74 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A76 [0C24]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A78 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A7A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A7C [2831]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A7E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A80 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A82 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A84 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A86 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A88 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A8A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A8C [3324]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A8E 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A90 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A92 [3E31]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A94 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A96 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A98 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A9A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A9C [4624]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003A9E 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AA0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AA2 [4E31]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AA4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AA6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AA8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AAA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AAC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AAE 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AB0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AB2 [6D24]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AB4 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AB6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AB8 [6431]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ABA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ABC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ABE 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AC0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AC2 [8224]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AC4 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AC6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AC8 [7431]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ACA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ACC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ACE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AD0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AD2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AD4 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AD6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AD8 [A924]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ADA 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ADC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ADE [8A31]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AE0 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AE2 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AE4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AE6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AE8 [BC24]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AEA 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AEC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AEE [9A31]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AF0 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AF2 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AF4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AF6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AF8 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AFA 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AFC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003AFE [E324]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B00 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B02 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B04 [B031]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B06 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B08 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B0A 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B0C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B0E [F824]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B10 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B12 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B14 [C031]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B16 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B18 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B1A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B1C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B1E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B20 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B22 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B24 [1F25]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B26 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B28 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B2A [D631]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B2C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B2E 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B30 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B32 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B34 [3225]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B36 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B38 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B3A [E631]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B3C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B3E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B40 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B42 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B44 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B46 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B48 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B4A [5925]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B4C 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B4E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B50 [FC31]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B52 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B54 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B56 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B58 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B5A [6E25]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B5C 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B5E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B60 [0C32]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B62 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B64 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B66 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B68 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B6A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B6C 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B6E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B70 [9925]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B72 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B74 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B76 [2232]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B78 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B7A 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B7C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B7E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B80 [B025]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B82 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B84 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B86 [3232]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B88 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B8A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B8C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B8E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B90 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B92 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B94 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B96 [DB25]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B98 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B9A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B9C [4832]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003B9E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BA0 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BA2 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BA4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BA6 [F425]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BA8 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BAA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BAC [5832]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BAE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BB0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BB2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BB4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BB6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BB8 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BBA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BBC [1F26]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BBE 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BC0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BC2 [6E32]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BC4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BC6 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BC8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BCA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BCC [3626]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BCE 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BD0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BD2 [7E32]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BD4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BD6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BD8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BDA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BDC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BDE 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BE0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BE2 [6126]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BE4 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BE6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BE8 [9432]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BEA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BEC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BEE 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BF0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BF2 [7A26]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BF4 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BF6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BF8 [A432]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BFA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BFC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003BFE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C00 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C02 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C04 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C06 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C08 [A526]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C0A 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C0C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C0E [BA32]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C10 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C12 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C14 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C16 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C18 [BC26]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C1A 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C1C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C1E [CA32]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C20 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C22 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C24 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C26 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C28 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C2A 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C2C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C2E [E726]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C30 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C32 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C34 [E032]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C36 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C38 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C3A 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C3C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C3E [0027]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C40 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C42 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C44 [F032]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C46 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C48 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C4A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C4C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C4E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C50 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C52 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C54 [2B27]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C56 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C58 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C5A [0633]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C5C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C5E 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C60 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C62 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C64 [4227]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C66 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C68 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C6A [1633]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C6C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C6E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C70 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C72 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C74 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C76 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C78 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C7A [6D27]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C7C 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C7E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C80 [2C33]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C82 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C84 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C86 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C88 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C8A [8627]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C8C 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C8E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C90 [3C33]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C92 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C94 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C96 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C98 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C9A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C9C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003C9E [A327]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CA0 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CA2 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CA4 [5033]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CA6 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CA8 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CAA 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CAC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CAE [B127]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CB0 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CB2 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CB4 [6033]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CB6 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CB8 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CBA 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CBC 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CBE 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CC0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CC2 [CE27]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CC4 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CC6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CC8 [7433]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CCA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CCC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CCE 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CD0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CD2 [DD27]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CD4 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CD6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CD8 [8433]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CDA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CDC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CDE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CE0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CE2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CE4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CE6 [FA27]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CE8 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CEA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CEC [9833]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CEE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CF0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CF2 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CF4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CF6 [0828]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CF8 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CFA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CFC [A833]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003CFE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D00 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D02 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D04 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D06 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D08 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D0A [2528]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D0C 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D0E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D10 [BC33]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D12 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D14 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D16 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D18 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D1A [3428]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D1C 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D1E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D20 [CC33]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D22 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D24 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D26 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D28 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D2A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D2C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D2E [5128]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D30 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D32 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D34 [E033]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D36 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D38 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D3A 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D3C [5A28]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D3E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D40 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D42 [EE33]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D44 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D46 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D48 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D4A 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D4C 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D4E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D50 [7728]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D52 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D54 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D56 [0234]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D58 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D5A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D5C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D5E [8128]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D60 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D62 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D64 [1034]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D66 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D68 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D6A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D6C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D6E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D70 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D72 [9E28]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D74 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D76 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D78 [2434]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D7A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D7C 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D7E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D80 [A728]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D82 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D84 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D86 [3234]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D88 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D8A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D8C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D8E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D90 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D92 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D94 [C428]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D96 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D98 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D9A [4634]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D9C 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003D9E 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DA0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DA2 [CE28]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DA4 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DA6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DA8 [5434]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DAA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DAC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DAE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DB0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DB2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DB4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DB6 [EB28]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DB8 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DBA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DBC [6834]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DBE 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DC0 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DC2 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DC4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DC6 [F928]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DC8 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DCA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DCC [7834]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DCE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DD0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DD2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DD4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DD6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DD8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DDA [1629]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DDC 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DDE [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DE0 [8C34]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DE2 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DE4 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DE6 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DE8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DEA [2529]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DEC 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DEE [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DF0 [9C34]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DF2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DF4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DF6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DF8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DFA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DFC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003DFE [4229]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E00 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E02 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E04 [B034]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E06 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E08 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E0A 0D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E0C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E0E [5029]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E10 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E12 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E14 [C034]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E16 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E18 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E1A 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E1C 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E1E 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E20 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E22 [6D29]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E24 0F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E26 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E28 [D434]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E2A 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E2C 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E2E 0E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E30 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E32 [7C29]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E34 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E36 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E38 [E434]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E3A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E3C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E3E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E40 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E42 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E44 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E46 [9929]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E48 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E4A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E4C [F834]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E4E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E50 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E52 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E54 [A229]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E56 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E58 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E5A [0635]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E5C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E5E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E60 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E62 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E64 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E66 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E68 [BF29]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E6A 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E6C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E6E [1A35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E70 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E72 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E74 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E76 [C929]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E78 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E7A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E7C [2835]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E7E 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E80 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E82 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E84 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E86 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E88 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E8A [E629]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E8C 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E8E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E90 [3C35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E92 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E94 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E96 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E98 [EF29]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E9A 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E9C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003E9E [4A35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EA0 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EA2 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EA4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EA6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EA8 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EAA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EAC [0C2A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EAE 0A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EB0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EB2 [5E35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EB4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EB6 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EB8 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EBA [162A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EBC 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EBE [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EC0 [6C35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EC2 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EC4 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EC6 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EC8 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ECA 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ECC 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ECE 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ED0 [3D2A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ED2 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ED4 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ED6 [8235]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003ED8 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EDA 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EDC 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EDE 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EE0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EE2 [552A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EE4 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EE6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EE8 [9435]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EEA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EEC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EEE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EF0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EF2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EF4 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EF6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EF8 [7C2A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EFA 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EFC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003EFE [AA35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F00 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F02 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F04 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F06 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F08 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F0A [962A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F0C 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F0E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F10 [BC35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F12 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F14 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F16 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F18 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F1A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F1C 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F1E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F20 [BD2A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F22 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F24 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F26 [D235]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F28 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F2A 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F2C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F2E 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F30 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F32 [D52A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F34 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F36 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F38 [E435]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F3A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F3C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F3E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F40 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F42 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F44 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F46 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F48 [FC2A]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F4A 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F4C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F4E [FA35]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F50 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F52 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F54 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F56 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F58 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F5A [162B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F5C 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F5E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F60 [0C36]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F62 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F64 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F66 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F68 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F6A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F6C 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F6E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F70 [3D2B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F72 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F74 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F76 [2236]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F78 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F7A 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F7C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F7E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F80 [502B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F82 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F84 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F86 [3236]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F88 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F8A 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F8C 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F8E 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F90 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F92 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F94 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F96 [772B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F98 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F9A [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F9C [4836]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003F9E 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FA0 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FA2 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FA4 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FA6 [8C2B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FA8 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FAA [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FAC [5836]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FAE 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FB0 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FB2 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FB4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FB6 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FB8 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FBA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FBC [B32B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FBE 1300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FC0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FC2 [6E36]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FC4 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FC6 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FC8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FCA 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FCC [C62B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FCE 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FD0 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FD2 [7E36]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FD4 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FD6 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FD8 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FDA 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FDC 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FDE 2600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FE0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FE2 [ED2B]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FE4 1500                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FE6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FE8 [9436]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FEA 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FEC 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FEE 1400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FF0 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FF2 [022C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FF4 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FF6 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FF8 [A436]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FFA 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FFC 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00003FFE 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004000 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004002 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004004 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004006 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004008 [2D2C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000400A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000400C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000400E [BA36]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004010 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004012 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004014 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004016 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004018 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000401A [492C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000401C 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000401E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004020 [CC36]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004022 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004024 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004026 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004028 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000402A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000402C 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000402E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004030 [742C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004032 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004034 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004036 [E236]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004038 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000403A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000403C 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000403E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004040 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004042 [922C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004044 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004046 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004048 [F436]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000404A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000404C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000404E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004050 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004052 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004054 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004056 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004058 [BD2C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000405A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000405C [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000405E [0A37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004060 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004062 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004064 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004066 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004068 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000406A [D92C]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000406C 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000406E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004070 [1C37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004072 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004074 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004076 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004078 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000407A 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000407C 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000407E 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004080 [042D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004082 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004084 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004086 [3237]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004088 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000408A 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000408C 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000408E 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004090 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004092 [222D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004094 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004096 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004098 [4437]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000409A 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000409C 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000409E 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040A0 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040A2 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040A4 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040A6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040A8 [4D2D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040AA 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040AC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040AE [5A37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040B0 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040B2 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040B4 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040B6 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040B8 [642D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040BA 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040BC [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040BE [6A37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040C0 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040C2 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040C4 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040C6 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040C8 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040CA 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040CC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040CE [8F2D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040D0 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040D2 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040D4 [8037]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040D6 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040D8 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040DA 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040DC 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040DE [A82D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040E0 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040E2 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040E4 [9037]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040E6 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040E8 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040EA 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040EC 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040EE 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040F0 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040F2 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040F4 [D32D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040F6 1700                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040F8 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040FA [A637]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 000040FC 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 000040FE 0800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004100 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004102 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004104 [EA2D]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004106 2B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004108 [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000410A [B637]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000410C 0400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000410E 0C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004110 1200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004112 1600                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004114 1C00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004116 2A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004118 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000411A [152E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000411C 1900                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000411E [8213]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004120 [CC37]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004122 0200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004124 0900                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004126 1800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004128 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000412A [2E2E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000412C 2500                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000412E [4413]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004130 [7C2E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004132 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004134 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004136 1D00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004138 2000                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000413A 2400                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000413C 0000                <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 0000413E [532E]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004140 2800                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004142 [4413]              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004144 [822E]              <2>  %1
  3521                              <2>  %rotate 1
  3520                              <2>  %1
  3521                              <2>  %rotate 1
  3520 00004146 0700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004148 1A00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000414A 1B00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000414C 1E00                <2>  %1
  3521                              <2>  %rotate 1
  3520 0000414E 1F00                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004150 2200                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004152 2300                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004154 2700                <2>  %1
  3521                              <2>  %rotate 1
  3520 00004156 0000                <2>  %1
  3521                              <2>  %rotate 1
  3528 00004158 00000000                	dw 0,0
  3529                                  
  3530                                  
  3531                                  %if _NUM_DETECT_NAMES
  3532                                  		; INP:	ds:si -> first byte to check for name
  3533                                  		;	cx = number of bytes left
  3534                                  		; OUT:	(8+1+3+1)bytes[msg.foundname] = found name,
  3535                                  		;	 converted to 8.3 ASCIZ format,
  3536                                  		;	 "(None)" if none
  3537                                  		;	CY if no filename found,
  3538                                  		;	 si = INP:si + INP:cx
  3539                                  		;	 cx = 0
  3540                                  		;	NC if filename found,
  3541                                  		;	 si -> byte behind the name, thus (si-11)-> name
  3542                                  		;	 cx = number of bytes left
  3543                                  		; CHG:	di, ax
  3544                                  		; STT:	ds = es
  3545                                  findname:
  3546                                  .:
  3547 0000415C 83F90B                  	cmp cx, 11		; enough for another name ?
  3548 0000415F 7254                    	jb .none		; no -->
  3549                                  				; (cx == 0 jumps here too)
  3550                                  .check:
  3551 00004161 51                      	push cx
  3552 00004162 56                      	push si
  3553 00004163 B90B00                  	mov cx, 11
  3554 00004166 AC                      	lodsb
  3555 00004167 88C4                    	mov ah, al		; check for same char in all 11 places
  3556 00004169 3C20                    	cmp al, 32		; first character must not be blank
  3557 0000416B 740D                    	je .check_fail		; if it is -->
  3558                                  ;	cmp al, 5		; first character may be 05h to indicate 0E5h
  3559                                  ;	je .check_pass
  3560 0000416D A8                      	db __TEST_IMM8		; (skip lodsb)
  3561                                  .check_loop_same:
  3562 0000416E AC                      	lodsb
  3563 0000416F 38C4                    	cmp ah, al
  3564 00004171 752E                    	jne .check_loop_differs
  3565 00004173 E80A00                  	call .check_character
  3566 00004176 7202                    	jc .check_fail
  3567 00004178 E2F4                    	loop .check_loop_same
  3568                                  		; if we arrive here, all characters (while valid) are the
  3569                                  		;  same character repeated 11 times. we disallow this in case
  3570                                  		;  that the padding character is an allowed one (eg '&' 26h).
  3571                                  .check_fail:
  3572 0000417A 5E                      	pop si
  3573 0000417B 59                      	pop cx
  3574 0000417C 49                      	dec cx			; lessen the counter
  3575 0000417D 46                      	inc si			; -> next position to check
  3576 0000417E EBDC                    	jmp .
  3577                                  
  3578                                  .check_character:
  3579 00004180 3C20                    	cmp al, 32
  3580 00004182 7218                    	jb .check_character_fail
  3581 00004184 3C7F                    	cmp al, 127
  3582                                  ;	je .check_character_fail
  3583 00004186 7314                    	jae .check_character_fail
  3584                                  		; note: with all characters >= 128 allowed,
  3585                                  		;  we get false positives in our sectors.
  3586 00004188 3C2E                    	cmp al, '.'
  3587 0000418A 7410                    	je .check_character_fail
  3588 0000418C 3C2F                    	cmp al, '/'
  3589 0000418E 740C                    	je .check_character_fail
  3590 00004190 3C5C                    	cmp al, '\'
  3591 00004192 7408                    	je .check_character_fail
  3592 00004194 3C61                    	cmp al, 'a'
  3593 00004196 7206                    	jb .check_character_pass
  3594 00004198 3C7A                    	cmp al, 'z'
  3595 0000419A 7702                    	ja .check_character_pass
  3596                                  .check_character_fail:
  3597 0000419C F9                      	stc
  3598 0000419D C3                      	retn
  3599                                  
  3600                                  .check_character_pass:
  3601 0000419E F8                      	clc
  3602 0000419F C3                      	retn
  3603                                  
  3604                                  .check_loop:
  3605 000041A0 AC                      	lodsb
  3606                                  .check_loop_differs:
  3607 000041A1 E8DCFF                  	call .check_character
  3608 000041A4 72D4                    	jc .check_fail
  3609                                  .check_pass:
  3610 000041A6 E2F8                    	loop .check_loop
  3611                                  
  3612 000041A8 58                      	pop ax			; (discard si)
  3613 000041A9 83EE0B                  	sub si, 11		; -> at name
  3614                                  
  3615 000041AC E81900                  	call convert_name_to_asciz
  3616                                  				; si -> behind name
  3617 000041AF 59                      	pop cx
  3618 000041B0 83E90B                  	sub cx, 11		; lessen the counter
  3619 000041B3 F8                      	clc
  3620 000041B4 C3                      	retn
  3621                                  
  3622                                  .none:
  3623 000041B5 01CE                    	 add si, cx
  3624 000041B7 BF[D856]                	mov di, msg.foundname
  3625 000041BA 56                      	 push si
  3626 000041BB BE[E656]                	mov si, msg.foundname_none
  3627 000041BE B90400                  	mov cx, (msg.foundname_none_size + 1) >> 1
  3628 000041C1 F3A5                    	rep movsw
  3629 000041C3 5E                      	 pop si
  3630 000041C4 31C9                    	 xor cx, cx
  3631 000041C6 F9                      	stc
  3632 000041C7 C3                      	retn
  3633                                  
  3634                                  
  3635                                  		; INP:	si -> 11-byte blank-padded name
  3636                                  		;	msg.foundname -> (8+1+3+1)-byte buffer
  3637                                  		; OUT:	si -> behind 11-byte blank-padded name
  3638                                  		;	msg.foundname filled
  3639                                  		; CHG:	cx, di, ax
  3640                                  convert_name_to_asciz:
  3641 000041C8 BF[D856]                	mov di, msg.foundname
  3642 000041CB B90800                  	mov cx, 8
  3643 000041CE F3A4                    	rep movsb		; copy over base name, si -> extension
  3644 000041D0 807DF805                	cmp byte [di - 8], 05h	; is it 05h ?
  3645 000041D4 7504                    	jne @F			; no -->
  3646 000041D6 C645F8E5                	mov byte [di - 8], 0E5h	; yes, convert to 0E5h
  3647                                  @@:
  3648                                  
  3649 000041DA A8                      	db __TEST_IMM8		; (skip dec)
  3650                                  @@:
  3651 000041DB 4F                      	dec di			; decrement -> at previous trailing blank
  3652 000041DC 807DFF20                	cmp byte [di - 1], 32	; trailing blank ?
  3653 000041E0 74F9                    	je @B			; yes -->
  3654                                  
  3655 000041E2 B02E                    	mov al, '.'
  3656 000041E4 AA                      	stosb			; store dot (if needed)
  3657 000041E5 B103                    	mov cl, 3
  3658 000041E7 F3A4                    	rep movsb		; copy over extension, si -> behind name
  3659                                  
  3660 000041E9 A8                      	db __TEST_IMM8		; (skip dec)
  3661                                  @@:
  3662 000041EA 4F                      	dec di			; decrement -> at previous trailing blank
  3663 000041EB 807DFF20                	cmp byte [di - 1], 32	; trailing blank ?
  3664 000041EF 74F9                    	je @B			; yes -->
  3665                                  
  3666 000041F1 807DFF2E                	cmp byte [di - 1], '.'	; trailing dot ? (only occurs if all-blank ext)
  3667 000041F5 7501                    	jne @F			; no -->
  3668 000041F7 4F                      	dec di			; -> at the dot
  3669                                  @@:
  3670 000041F8 B000                    	mov al, 0
  3671 000041FA AA                      	stosb			; store filename terminator
  3672 000041FB C3                      	retn
  3673                                  
  3674                                  
  3675                                  		; INP:	ds:si-> first letter of name
  3676                                  		;	es:load_kernel_name-> 12-byte buffer (for fn + 0)
  3677                                  		; CHG:	ax, cx, di
  3678                                  		; OUT:	NC if valid name,
  3679                                  		;	 al = first character after name (EOL, blank, or slash)
  3680                                  		;	 si -> next character
  3681                                  		;	CY else
  3682                                  		; STT:	es = ds
  3683                                  boot_parse_fn:
  3684 000041FC B020                    	mov al, 32
  3685 000041FE BF[9C56]                	mov di, load_kernel_name
  3686 00004201 B90B00                  	mov cx, 11
  3687 00004204 F3AA                    	rep stosb		; initialise to empty
  3688                                  
  3689 00004206 BF[9C56]                	mov di, load_kernel_name
  3690 00004209 B90900                  	mov cx, 9
  3691                                  .loop_name:
  3692 0000420C AC                      	lodsb
  3693 0000420D E8AD00                  	call uppercase
  3694 00004210 3C22                    	cmp al, '"'
  3695 00004212 741C                    	je .invalid
  3696 00004214 E86900                  	call iseol?
  3697 00004217 744F                    	je .loop_name_done
  3698 00004219 3C20                    	cmp al, 32
  3699 0000421B 744B                    	je .loop_name_done
  3700 0000421D 3C09                    	cmp al, 9
  3701 0000421F 7447                    	je .loop_name_done
  3702 00004221 3C2F                    	cmp al, '/'
  3703 00004223 7443                    	je .loop_name_done
  3704 00004225 3C5C                    	cmp al, '\'
  3705 00004227 743F                    	je .loop_name_done
  3706 00004229 3C2E                    	cmp al, '.'
  3707 0000422B 7405                    	je .loop_name_ext
  3708 0000422D AA                      	stosb
  3709 0000422E E2DC                    	loop .loop_name
  3710                                  .invalid:
  3711 00004230 F9                      	stc
  3712 00004231 C3                      	retn
  3713                                  
  3714                                  .loop_name_ext:
  3715 00004232 83F909                  	cmp cx, 9
  3716 00004235 74F9                    	je .invalid
  3717 00004237 B90400                  	mov cx, 4
  3718 0000423A BF[A456]                	mov di, load_kernel_name + 8
  3719                                  .loop_ext:
  3720 0000423D AC                      	lodsb
  3721 0000423E E87C00                  	call uppercase
  3722 00004241 3C22                    	cmp al, '"'
  3723 00004243 74EB                    	je .invalid
  3724 00004245 E83800                  	call iseol?
  3725 00004248 7419                    	je .loop_ext_done
  3726 0000424A 3C20                    	cmp al, 32
  3727 0000424C 7415                    	je .loop_ext_done
  3728 0000424E 3C09                    	cmp al, 9
  3729 00004250 7411                    	je .loop_ext_done
  3730 00004252 3C2F                    	cmp al, '/'
  3731 00004254 740D                    	je .loop_ext_done
  3732 00004256 3C5C                    	cmp al, '\'
  3733 00004258 7409                    	je .loop_ext_done
  3734 0000425A 3C2E                    	cmp al, '.'
  3735 0000425C 74D2                    	je .invalid
  3736 0000425E AA                      	stosb
  3737 0000425F E2DC                    	loop .loop_ext
  3738 00004261 EBCD                    	jmp .invalid
  3739                                  
  3740                                  .loop_ext_done:
  3741 00004263 83F904                  	cmp cx, 4
  3742 00004266 74C8                    	je .invalid
  3743                                  .loop_name_done:
  3744 00004268 83F909                  	cmp cx, 9
  3745 0000426B 74C3                    	je .invalid
  3746 0000426D C606[A756]00            	mov byte [load_kernel_name + 11], 0
  3747 00004272 803E[9C56]E5            	cmp byte [load_kernel_name], 0E5h
  3748 00004277 7505                    	jne @F
  3749 00004279 C606[9C56]05            	mov byte [load_kernel_name], 05h
  3750                                  @@:
  3751 0000427E F8                      	clc
  3752 0000427F C3                      	retn
  3753                                  %endif
  3754                                  
  3755                                  
  3756                                  iseol?:
  3757 00004280 3C0D                    	cmp al, 13
  3758 00004282 7402                    	je .ret
  3759                                  ;	cmp al, ';'
  3760                                  ;	je .ret
  3761 00004284 3C00                    	cmp al, 0
  3762                                  .ret:
  3763 00004286 C3                      	retn
  3764                                  
  3765                                  
  3766                                  		; Check for given string (cap-insensitive)
  3767                                  		;
  3768                                  		; INP:	si-> input string to check (either cap),
  3769                                  		;	 terminated by CR (13), space, tab, comma
  3770                                  		;	dx-> ASCIZ string to check (all-caps)
  3771                                  		; OUT:	Iff string matches,
  3772                                  		;	 si-> at separator that terminates the keyword
  3773                                  		;	else,
  3774                                  		;	 si = input si
  3775                                  		; STT:	ds = es = ss
  3776                                  		; CHG:	dx, ax
  3777                                  isstring?:
  3778 00004287 56                      	push si
  3779 00004288 87D7                    	xchg dx, di
  3780                                  .loop:
  3781 0000428A AC                      	lodsb
  3782 0000428B E82F00                  	call uppercase
  3783 0000428E AE                      	scasb
  3784 0000428F 7506                    	jne .mismatch
  3785 00004291 84C0                    	test al, al
  3786 00004293 75F5                    	jne .loop
  3787 00004295 EB20                    	jmp .matched_zr
  3788                                  
  3789                                  .mismatch:
  3790 00004297 E8E6FF                  	call iseol?
  3791 0000429A 7414                    	je .checkend
  3792 0000429C 3C20                    	cmp al, 32
  3793 0000429E 7410                    	je .checkend
  3794 000042A0 3C09                    	cmp al, 9
  3795 000042A2 740C                    	je .checkend
  3796 000042A4 3C2C                    	cmp al, ','
  3797 000042A6 7408                    	je .checkend
  3798 000042A8 3C3D                    	cmp al, '='
  3799 000042AA 7404                    	je .checkend
  3800                                  .ret_nz:
  3801                                  		; NZ
  3802 000042AC 5E                      	pop si
  3803                                  .ret:
  3804 000042AD 87D7                    	xchg dx, di
  3805 000042AF C3                      	retn
  3806                                  
  3807                                  .checkend:
  3808 000042B0 26807DFF00              	cmp byte [es:di - 1], 0
  3809 000042B5 75F5                    	jne .ret_nz
  3810                                  .matched_zr:	; ZR
  3811 000042B7 58                      	pop ax			; (discard)
  3812 000042B8 8D74FF                  	lea si, [si - 1]	; -> separator
  3813 000042BB EBF0                    	jmp .ret
  3814                                  
  3815                                  
  3816                                  uppercase:
  3817 000042BD 3C61                    	cmp al, 'a'
  3818 000042BF 7206                    	jb @F
  3819 000042C1 3C7A                    	cmp al, 'z'
  3820 000042C3 7702                    	ja @F
  3821 000042C5 24DF                    	and al, ~20h
  3822                                  @@:
  3823 000042C7 C3                      	retn
  3824                                  
  3825                                  
  3826                                  		; INP:	al = first character
  3827                                  		;	si -> next
  3828                                  		; OUT:	doesn't return if error
  3829                                  		;	bx:dx = number read
  3830                                  		;	al = character after the number
  3831                                  		;	si -> next
  3832                                  		; CHG:	cx, ax, di
  3833                                  get_decimal_literal:
  3834 000042C8 BA0A00                  	mov dx, 10		; set base: decimal
  3835                                  %if 1
  3836 000042CB B93940                  	mov cx, '9' | (('A'-10-1 + 10) << 8)
  3837                                  %else
  3838                                  	mov cl, dl
  3839                                  	add cl, '0'-1
  3840                                  	cmp cl, '9'
  3841                                  	jbe .lit_basebelow11
  3842                                  	mov cl, '9'
  3843                                  .lit_basebelow11:		; cl = highest decimal digit for base ('1'..'9')
  3844                                  	mov ch, dl
  3845                                  	add ch, 'A'-10-1	; ch = highest letter for base ('A'-x..'Z')
  3846                                  %endif
  3847 000042CE EB06                    	jmp @F
  3848                                  
  3849                                  
  3850                                  get_hexadecimal_literal:
  3851 000042D0 BA1000                  	mov dx, 16		; set base: hexadecimal
  3852                                  %if 1
  3853 000042D3 B93946                  	mov cx, '9' | (('A'-10-1 + 16) << 8)
  3854                                  %else
  3855                                  	mov cl, dl
  3856                                  	add cl, '0'-1
  3857                                  	cmp cl, '9'
  3858                                  	jbe .lit_basebelow11
  3859                                  	mov cl, '9'
  3860                                  .lit_basebelow11:		; cl = highest decimal digit for base ('1'..'9')
  3861                                  	mov ch, dl
  3862                                  	add ch, 'A'-10-1	; ch = highest letter for base ('A'-x..'Z')
  3863                                  %endif
  3864                                  
  3865                                  @@:
  3866 000042D6 B400                    	mov ah, 0
  3867 000042D8 31DB                    	xor bx, bx
  3868 000042DA 89D7                    	mov di, dx		; di = base
  3869                                  
  3870 000042DC E84A00                  	call getexpression.lit_isdigit?	; first character must be a digit
  3871 000042DF 723F                    	jc .err2
  3872 000042E1 31D2                    	xor dx, dx		; initialize value
  3873                                  .lit_loopdigit:
  3874 000042E3 3C5F                    	cmp al, '_'
  3875 000042E5 7430                    	je .lit_skip
  3876 000042E7 E83F00                  	call getexpression.lit_isdigit?	; was last character ?
  3877 000042EA 722E                    	jc .lit_end		; yes -->
  3878 000042EC E8CEFF                  	call uppercase
  3879 000042EF 2C30                    	sub al, '0'
  3880 000042F1 3C09                    	cmp al, 9		; was decimal digit ?
  3881 000042F3 7602                    	jbe .lit_decimaldigit	; yes -->
  3882 000042F5 2C07                    	sub al, 'A'-('9'+1)	; else adjust for hexadecimal digit
  3883                                  .lit_decimaldigit:
  3884 000042F7 50                      	push ax
  3885 000042F8 89D0                    	mov ax, dx
  3886 000042FA 53                      	push bx
  3887 000042FB F7E7                    	mul di			; multiply low word with base
  3888 000042FD 89D3                    	mov bx, dx
  3889 000042FF 89C2                    	mov dx, ax
  3890 00004301 58                      	pop ax
  3891 00004302 52                      	push dx
  3892 00004303 F7E7                    	mul di			; multiply high word with base
  3893 00004305 85D2                    	test dx, dx
  3894 00004307 5A                      	pop dx
  3895 00004308 7516                    	jnz .err2		; overflow -->
  3896 0000430A 01C3                    	add bx, ax		; add them
  3897 0000430C 58                      	pop ax
  3898 0000430D 7211                    	jc .err2		; overflow -->
  3899 0000430F 00C2                    	add dl, al		; add in the new digit
  3900 00004311 80D600                  	adc dh, 0
  3901 00004314 83D300                  	adc bx, byte 0
  3902                                  .lit_skip:
  3903 00004317 AC                      	lodsb
  3904 00004318 EBC9                    	jmp short .lit_loopdigit
  3905                                  
  3906                                  .lit_end:
  3907 0000431A E82600                  	call isseparator?	; after the number, there must be a separator
  3908 0000431D 7501                    	jne .err2		; none here -->
  3909 0000431F C3                      	retn
  3910                                  
  3911                                  .err2:
  3912 00004320 BA[7A58]                	mov dx, msg.error_invalid_number
  3913 00004323 E99FBD                  	jmp disp_error
  3914                                  
  3915                                  
  3916                                  symhint_store_string getexpression
  3917                                  getexpression.lit_ishexdigit?:
  3918 00004326 B93946                  	mov cx, "9F"
  3919                                  getexpression.lit_isdigit?:
  3920 00004329 3C30                    	cmp al, '0'
  3921 0000432B 7214                    	jb .no
  3922 0000432D 38C8                    	cmp al, cl
  3923 0000432F 760D                    	jbe .yes
  3924 00004331 50                      	push ax
  3925 00004332 E888FF                  	call uppercase
  3926 00004335 38E8                    	cmp al, ch
  3927 00004337 7707                    	ja .no_p
  3928 00004339 3C41                    	cmp al, 'A'
  3929 0000433B 7203                    	jb .no_p
  3930 0000433D 58                      	pop ax
  3931                                  .yes:
  3932 0000433E F8                      	clc
  3933 0000433F C3                      	retn
  3934                                  
  3935                                  .no_p:
  3936 00004340 58                      	pop ax
  3937                                  .no:
  3938 00004341 F9                      	stc
  3939 00004342 C3                      	retn
  3940                                  
  3941                                  
  3942                                  		; INP:	al = character
  3943                                  		; OUT:	al = capitalised character
  3944                                  		;	ZR, NC if a separator
  3945                                  		;	NZ if no separator
  3946                                  isseparator?:
  3947 00004343 E877FF                  	call uppercase
  3948 00004346 51                      	push cx
  3949                                  %if 0	; _EXPRESSIONS
  3950                                  	call isoperator?	; normal operators are separators (also handles equality sign)
  3951                                  	je .yes			; if match --> (ZR, NC)
  3952                                  %endif
  3953 00004347 57                      	push di
  3954 00004348 BF[5443]                	mov di, separators
  3955 0000434B 8B0D                    	mov cx, word [di]
  3956 0000434D AF                      	scasw
  3957 0000434E F2AE                    	repne scasb		; ZR, NC on match, NZ else
  3958 00004350 5F                      	pop di
  3959                                  .yes:
  3960 00004351 59                      	pop cx
  3961 00004352 C3                      	retn
  3962                                  
  3963 00004353 00                      	align 2, db 0
  3964                                  %if 0	; _EXPRESSIONS
  3965                                  separators:	countedw 32,9,13,",L;]:=)",0
  3966                                  %else
  3967 00004354 0A0020090D2C4C3B5D-     separators:	countedw 32,9,13,",L;]:=",0
  3967 0000435D 3A3D00             
  3968                                  %endif
  3969                                  
  3970                                  
  3971                                  i24:
  3972 00004360 B003                    	mov al, 3			; always return fail, to handle the error as a soft one
  3973 00004362 CF                      	iret
  3974                                  
  3975                                  i23:
  3976 00004363 2EC706[6343]EB08        	mov word [ cs:$ ], (__JMP_REL8|__REL16__(.return)<<8)	; don't reenter
  3977 0000436A E80200                  	call restorestate
  3978                                  .return:
  3979 0000436D F9                      	stc				; always abort program (what default DOS handler also does)
  3980 0000436E CB                      	retf
  3981                                  
  3982                                  		; Restore modified DOS data
  3983                                  		;
  3984                                  		; CHG:	-
  3985                                  restorestate:
  3986 0000436F 50                      	push ax
  3987                                  %if _VDD
  3988                                  		; Release the registered VDD.
  3989 00004370 F606[4446]04            	testopt [internalflags], ntpacket
  3990 00004375 7408                    	jz .novdd
  3991 00004377 A1[5046]                	mov ax, word [hVdd]
  3992 0000437A C4C4580190              	UnRegisterModule
  3993                                  .novdd:
  3994                                  %endif
  3995 0000437F 58                      	pop ax
  3996 00004380 C3                      	retn
  3997                                  
  3998                                  
  3999                                  		; INP: es:dx = ds:dx -> 0-terminated message
  4000                                  disp_msg_asciz:
  4001 00004381 50                      	push ax
  4002 00004382 53                      	push bx
  4003 00004383 51                      	push cx
  4004 00004384 57                      	push di
  4005 00004385 BB0100                  	mov bx, 1
  4006 00004388 B80040                  	mov ax, 4000h
  4007 0000438B 89D7                    	mov di, dx
  4008 0000438D B9FFFF                  	mov cx, -1
  4009 00004390 F2AE                    	repne scasb	; -> after nul
  4010 00004392 4F                      	dec di		; -> at nul
  4011 00004393 29D7                    	sub di, dx	; size
  4012 00004395 89F9                    	mov cx, di
  4013 00004397 CD21                    	int 21h
  4014 00004399 5F                      	pop di
  4015 0000439A 59                      	pop cx
  4016 0000439B 5B                      	pop bx
  4017 0000439C 58                      	pop ax
  4018 0000439D C3                      	retn
  4019                                  
  4020                                  
  4021                                  disp_ax_hex:
  4022 0000439E 86C4                    		xchg al, ah
  4023 000043A0 E80200                  		call disp_al_hex
  4024 000043A3 86C4                    		xchg al, ah
  4025                                  disp_al_hex:
  4026 000043A5 51                      		push cx
  4027 000043A6 B104                    		mov cl, 4
  4028 000043A8 D2C8                    		ror al, cl
  4029 000043AA E80300                  		call .nibble
  4030 000043AD D2C8                    		ror al, cl
  4031 000043AF 59                      		pop cx
  4032                                  .nibble:
  4033 000043B0 50                      		push ax
  4034 000043B1 240F                    		and al, 0Fh
  4035 000043B3 0430                    		add al, '0'
  4036 000043B5 3C39                    		cmp al, '9'
  4037 000043B7 7602                    		jbe .isdigit
  4038 000043B9 0407                    		add al, 'A'-('9'+1)
  4039                                  .isdigit:
  4040 000043BB 52                      		push dx
  4041 000043BC 86D0                    		xchg dl, al
  4042 000043BE B402                    		mov ah, 02h
  4043 000043C0 CD21                    		int 21h
  4044 000043C2 5A                      		pop dx
  4045 000043C3 58                      		pop ax
  4046 000043C4 C3                      		retn
  4047                                  
  4048                                  
  4049                                  	; Following call: Display number in ax decimal
  4050                                  	; all registers preserved except dx
  4051                                  disp_ax_dec:			; ax (no leading zeros)
  4052                                  	; In: number in ax
  4053                                  	; Out: displayed
  4054 000043C5 53                      		push bx
  4055 000043C6 31DB                    		xor bx, bx
  4056                                  .pushax:
  4057 000043C8 50                      		push ax
  4058                                  .pushend:
  4059 000043C9 08DB                    		or bl, bl
  4060 000043CB 7405                    		jz .nobl
  4061 000043CD 80EB05                  		sub bl, 5
  4062 000043D0 F6DB                    		neg bl
  4063                                  .nobl:
  4064 000043D2 51                      		push cx
  4065 000043D3 B91027                  		mov cx, 10000
  4066 000043D6 E81D00                  		call .divide_out
  4067 000043D9 B9E803                  		mov cx, 1000
  4068 000043DC E81700                  		call .divide_out
  4069 000043DF B96400                  		mov cx, 100
  4070 000043E2 E81100                  		call .divide_out
  4071 000043E5 B10A                    		mov cl, 10
  4072 000043E7 E80C00                  		call .divide_out
  4073                                  							; (Divisor 1 is useless)
  4074 000043EA 0430                    		add al, '0'
  4075 000043EC 86D0                    		xchg dl, al
  4076 000043EE B402                    		mov ah, 02h
  4077 000043F0 CD21                    		int 21h
  4078 000043F2 59                      		pop cx
  4079 000043F3 58                      		pop ax
  4080 000043F4 5B                      		pop bx					; Caller's register
  4081 000043F5 C3                      		retn
  4082                                  
  4083                                  .divide_out:
  4084                                  	; In: ax = number
  4085                                  	;     cx = divisor
  4086                                  	; Out: ax = remainder of operation
  4087                                  	;      result displayed
  4088 000043F6 52                      		push dx
  4089 000043F7 31D2                    		xor dx, dx
  4090 000043F9 F7F1                    		div cx				; 0:ax / cx
  4091 000043FB 52                      		push dx				; remainder
  4092 000043FC FECB                    		dec bl
  4093 000043FE 7503                    		jnz .nobl2
  4094 00004400 80CF01                  		or bh, 1
  4095                                  .nobl2:
  4096 00004403 08C7                    		or bh, al
  4097 00004405 7408                    		jz .leadingzero
  4098 00004407 0430                    		add al, '0'
  4099 00004409 86D0                    		xchg dl, al
  4100 0000440B B402                    		mov ah, 02h
  4101 0000440D CD21                    		int 21h				; display result
  4102                                   .leadingzero:
  4103 0000440F 58                      		pop ax				; remainder
  4104 00004410 5A                      		pop dx
  4105 00004411 C3                      		retn
  4106                                  
  4107                                  
  4108                                  		; INP:	dx:ax = sector to write
  4109                                  		;	cl = drive to write to (0 = A:)
  4110                                  		;	ds:bx -> buffer
  4111                                  		; STT:	ds = ss
  4112                                  		; OUT:	CY if failure, error message displayed to stdout
  4113                                  		;	NC if success
  4114                                  		;	dx:ax = incremented
  4115                                  		;	ds:bx -> behind buffer
  4116                                  		;	(bx += word[bp + ldBytesPerSector]
  4117                                  symhint_store_and_label write_sector
  4118 00004412 50                      	push ax
  4119 00004413 52                      	push dx
  4120 00004414 53                      	push bx
  4121 00004415 51                      	push cx
  4122 00004416 56                      	push si
  4123                                  .plw1:
  4124 00004417 833E[3808]00            	cmp word [cmd_line_image_file.name], 0
  4125 0000441C 7432                    	je .drive
  4126                                  
  4127 0000441E 57                      	push di
  4128 0000441F 53                      	push bx
  4129 00004420 E87E01                  	call image_seek
  4130 00004423 5A                      	pop dx
  4131 00004424 5F                      	pop di
  4132 00004425 7220                    	jc .image_fail_seek
  4133                                  
  4134 00004427 8B0E[1008]              	mov cx, word [m_sector_size]
  4135 0000442B B440                    	mov ah, 40h
  4136 0000442D F9                      	stc
  4137 0000442E CD21                    	int 21h
  4138 00004430 7309                    	jnc @F
  4139 00004432 BA[D954]                	mov dx, msg.image_fail.write
  4140 00004435 E84ACE                  	call disp_dos_error
  4141 00004438 E9A600                  	jmp write_sector.ww3_error
  4142                                  
  4143                                  @@:
  4144 0000443B 39C8                    	cmp ax, cx
  4145 0000443D 7503E9A000              	je write_sector.ww3		; (NC)
  4146 00004442 BA[F454]                	mov dx, msg.image_fail_enough.write
  4147 00004445 EB03                    	jmp @F
  4148                                  
  4149                                  .image_fail_seek:
  4150 00004447 BA[2155]                	mov dx, msg.image_fail_seek.write
  4151                                  @@:
  4152 0000444A E834FF                  	call disp_msg_asciz
  4153 0000444D E99100                  	jmp write_sector.ww3_error
  4154                                  
  4155                                  .drive:
  4156 00004450 51                      	push cx
  4157 00004451 80C141                  	add cl, 'A'
  4158 00004454 880E[C165]              	mov byte [driveno], cl
  4159 00004458 59                      	pop cx
  4160 00004459 F606[4446]07            	testopt [internalflags], oldpacket| newpacket| ntpacket
  4161 0000445E 7513                    	jnz .plw3		; if using a packet -->
  4162 00004460 85D2                    	test dx, dx
  4163 00004462 755B                    	jnz .error_sector_not_found
  4164 00004464 92                      	xchg ax, dx		; dx = sector to write
  4165 00004465 91                      	xchg ax, cx		; al = drive number
  4166 00004466 B90100                  	mov cx, 1
  4167                                  .oldint:
  4168 00004469 55                      	push bp
  4169 0000446A 57                      	push di
  4170 0000446B CD26                    	int 26h
  4171 0000446D 44                      	inc sp
  4172 0000446E 44                      	inc sp
  4173 0000446F 5F                      	pop di
  4174 00004470 5D                      	pop bp
  4175 00004471 EB4E                    	jmp .done
  4176                                  
  4177                                  		; disk I/O packet for Int25/Int26, Int21.7305, VDD
  4178                                  .plw3:
  4179 00004473 53                      	push bx
  4180 00004474 BB[7046]                	mov bx, packet
  4181 00004477 8907                    	mov word [bx+0], ax	; LoWord sector number
  4182 00004479 895702                  	mov word [bx+2], dx	; HiWord sector number
  4183 0000447C C747040100              	mov word [bx+4], 1	; number of sectors
  4184 00004481 88C8                    	mov al, cl
  4185 00004483 8F4706                  	pop word [bx+6]		; transfer address ofs
  4186 00004486 8C5F08                  	mov word [bx+8], ds	; transfer address seg
  4187 00004489 B9FFFF                  	mov cx, -1
  4188                                  
  4189 0000448C 36F606[4446]06          	testopt [ss:internalflags], newpacket| ntpacket
  4190 00004492 74D5                    	jz .oldint
  4191 00004494 88C2                    	mov dl, al		; A: = 0, ...
  4192 00004496 BE0100                  	mov si, 0001h		; write, assume "unknown data"
  4193                                  %if _VDD
  4194 00004499 F606[4446]04            	testopt [internalflags], ntpacket
  4195 0000449E 7512                    	jnz .vdd
  4196                                  %endif
  4197 000044A0 FEC2                    	inc dl			; A: = 1, ...
  4198 000044A2 E86A01                  	call lockdrive
  4199 000044A5 B80573                  	mov ax, 7305h		; ds:(e)bx-> packet
  4200 000044A8 F9                      	stc
  4201 000044A9 CD21                    	int 21h
  4202 000044AB 9C                      	pushf
  4203 000044AC E87A01                  	call unlockdrive
  4204 000044AF 9D                      	popf
  4205 000044B0 EB0F                    	jmp short .done
  4206                                  %if _VDD
  4207                                  .vdd:
  4208 000044B2 A1[5046]                	mov ax, word [hVdd]
  4209 000044B5 B90500                  	mov cx, 5
  4210 000044B8 C4C4580290              	DispatchCall
  4211 000044BD EB02                    	jmp short .done
  4212                                  %endif
  4213                                  .error_sector_not_found:
  4214 000044BF B008                    	mov al, 8		; "sector not found"
  4215                                  .done:
  4216 000044C1 BA[B165]                	mov dx, writing
  4217                                  .ww1:
  4218 000044C4 731C                    	jnc .ww3		; if no error
  4219 000044C6 3C0C                    	cmp al, dskerrs.after_last - 1
  4220 000044C8 7602                    	jbe .ww2		; if in range
  4221 000044CA B00C                    	mov al, dskerrs.after_last - 1
  4222                                  .ww2:
  4223 000044CC 98                      	cbw			; ah = 0
  4224 000044CD BB[E264]                	mov bx, dskerrs		; -> byte table
  4225 000044D0 D7                      	xlatb			; get offset from dskerrs
  4226 000044D1 01D8                    	add ax, bx		; -> message
  4227 000044D3 92                      	xchg ax, dx		; dx-> diskerrs message
  4228 000044D4 E8AAFE                  	call disp_msg_asciz
  4229 000044D7 92                      	xchg ax, dx		; dx-> writing/reading
  4230 000044D8 E8A6FE                  	call disp_msg_asciz
  4231 000044DB BA[B765]                	mov dx, drive		; dx-> "ing drive _"
  4232 000044DE E8A0FE                  	call disp_msg_asciz
  4233                                  .ww3_error:
  4234 000044E1 F9                      	stc
  4235                                  .ww3:
  4236 000044E2 5E                      	pop si
  4237 000044E3 59                      	pop cx
  4238 000044E4 5B                      	pop bx
  4239 000044E5 5A                      	pop dx
  4240 000044E6 58                      	pop ax
  4241 000044E7 9C                      	 pushf
  4242 000044E8 40                      	inc ax
  4243 000044E9 7501                    	jnz @F
  4244 000044EB 42                      	inc dx
  4245                                  @@:
  4246 000044EC 035EDC                  	add bx, word [bp + ldBytesPerSector]
  4247 000044EF 9D                      	 popf
  4248 000044F0 C3                      	retn
  4249                                  
  4250                                  
  4251                                  		; INP:	dx:ax = sector to read
  4252                                  		;	cl = drive to read from (0 = A:)
  4253                                  		;	ds:bx -> buffer
  4254                                  		; STT:	ds = ss
  4255                                  		; OUT:	CY if failure, error message displayed to stdout
  4256                                  		;	NC if success
  4257                                  		;	dx:ax = incremented
  4258                                  		;	ds:bx -> behind buffer
  4259                                  		;	(bx += word[bp + ldBytesPerSector]
  4260                                  read_sector:
  4261 000044F1 50                      	push ax
  4262 000044F2 52                      	push dx
  4263 000044F3 53                      	push bx
  4264 000044F4 51                      	push cx
  4265 000044F5 56                      	push si
  4266                                  .plw1:
  4267 000044F6 833E[3808]00            	cmp word [cmd_line_image_file.name], 0
  4268 000044FB 742D                    	je .drive
  4269                                  
  4270 000044FD 57                      	push di
  4271 000044FE 53                      	push bx
  4272 000044FF E89F00                  	call image_seek
  4273 00004502 5A                      	pop dx
  4274 00004503 5F                      	pop di
  4275 00004504 721C                    	jc .image_fail_seek
  4276                                  
  4277 00004506 8B0E[1008]              	mov cx, word [m_sector_size]
  4278 0000450A B43F                    	mov ah, 3Fh
  4279 0000450C F9                      	stc
  4280 0000450D CD21                    	int 21h
  4281 0000450F 7308                    	jnc @F
  4282 00004511 BA[4555]                	mov dx, msg.image_fail.read
  4283 00004514 E86BCD                  	call disp_dos_error
  4284 00004517 EBC8                    	jmp write_sector.ww3_error
  4285                                  
  4286                                  @@:
  4287 00004519 39C8                    	cmp ax, cx
  4288 0000451B 74C5                    	je write_sector.ww3		; (NC)
  4289 0000451D BA[6055]                	mov dx, msg.image_fail_enough.read
  4290 00004520 EB03                    	jmp @F
  4291                                  
  4292                                  .image_fail_seek:
  4293 00004522 BA[2155]                	mov dx, msg.image_fail_seek.read
  4294                                  @@:
  4295 00004525 E859FE                  	call disp_msg_asciz
  4296 00004528 EBB7                    	jmp write_sector.ww3_error
  4297                                  
  4298                                  .drive:
  4299 0000452A 51                      	push cx
  4300 0000452B 80C141                  	add cl, 'A'
  4301 0000452E 880E[C165]              	mov byte [driveno], cl
  4302 00004532 59                      	pop cx
  4303 00004533 F606[4446]07            	testopt [internalflags], oldpacket| newpacket| ntpacket
  4304 00004538 7513                    	jnz .plw3		; if using a packet -->
  4305 0000453A 85D2                    	test dx, dx
  4306 0000453C 755B                    	jnz .error_sector_not_found
  4307 0000453E 92                      	xchg ax, dx		; dx = sector to read
  4308 0000453F 91                      	xchg ax, cx		; al = drive number
  4309 00004540 B90100                  	mov cx, 1
  4310                                  .oldint:
  4311 00004543 55                      	push bp
  4312 00004544 57                      	push di
  4313 00004545 CD25                    	int 25h
  4314 00004547 44                      	inc sp
  4315 00004548 44                      	inc sp
  4316 00004549 5F                      	pop di
  4317 0000454A 5D                      	pop bp
  4318 0000454B EB4E                    	jmp .done
  4319                                  
  4320                                  		; disk I/O packet for Int25/Int26, Int21.7305, VDD
  4321                                  .plw3:
  4322 0000454D 53                      	push bx
  4323 0000454E BB[7046]                	mov bx, packet
  4324 00004551 8907                    	mov word [bx+0], ax	; LoWord sector number
  4325 00004553 895702                  	mov word [bx+2], dx	; HiWord sector number
  4326 00004556 C747040100              	mov word [bx+4], 1	; number of sectors
  4327 0000455B 88C8                    	mov al, cl
  4328 0000455D 8F4706                  	pop word [bx+6]		; transfer address ofs
  4329 00004560 8C5F08                  	mov word [bx+8], ds	; transfer address seg
  4330 00004563 B9FFFF                  	mov cx, -1
  4331                                  
  4332 00004566 36F606[4446]06          	testopt [ss:internalflags], newpacket| ntpacket
  4333 0000456C 74D5                    	jz .oldint
  4334 0000456E 88C2                    	mov dl, al		; A: = 0, ...
  4335 00004570 BE0000                  	mov si, 0000h		; read, assume "unknown data"
  4336                                  %if _VDD
  4337 00004573 F606[4446]04            	testopt [internalflags], ntpacket
  4338 00004578 7512                    	jnz .vdd
  4339                                  %endif
  4340 0000457A FEC2                    	inc dl			; A: = 1, ...
  4341 0000457C E89000                  	call lockdrive
  4342 0000457F B80573                  	mov ax, 7305h		; ds:(e)bx-> packet
  4343 00004582 F9                      	stc
  4344 00004583 CD21                    	int 21h
  4345 00004585 9C                      	pushf
  4346 00004586 E8A000                  	call unlockdrive
  4347 00004589 9D                      	popf
  4348 0000458A EB0F                    	jmp short .done
  4349                                  %if _VDD
  4350                                  .vdd:
  4351 0000458C A1[5046]                	mov ax, word [hVdd]
  4352 0000458F B90500                  	mov cx, 5
  4353 00004592 C4C4580290              	DispatchCall
  4354 00004597 EB02                    	jmp short .done
  4355                                  %endif
  4356                                  .error_sector_not_found:
  4357 00004599 B008                    	mov al, 8		; "sector not found"
  4358                                  .done:
  4359 0000459B BA[AB65]                	mov dx, reading
  4360 0000459E E923FF                  	jmp write_sector.ww1
  4361                                  
  4362                                  
  4363                                  image_seek:
  4364 000045A1 BE[0008]                	mov si, m_seek
  4365 000045A4 BF[1008]                	mov di, m_sector_size
  4366 000045A7 E892C0                  	call multiply_dxax_dword_di_to_qword_si
  4367 000045AA BFF8FF                  	mov di, -8
  4368 000045AD F8                      	clc
  4369                                  @@:
  4370 000045AE 8B85[1008]              	mov ax, word [m_offset + 8 + di]
  4371 000045B2 1185[0808]              	adc word [m_seek + 8 + di], ax
  4372 000045B6 47                      	inc di
  4373 000045B7 47                      	inc di
  4374 000045B8 75F4                    	jnz @B
  4375 000045BA 722F                    	jc .image_fail_seek
  4376                                  
  4377 000045BC BF[3808]                	mov di, cmd_line_image_file
  4378 000045BF 56                      	push si
  4379 000045C0 E8D9CB                  	call open_file_readwrite
  4380 000045C3 5E                      	pop si
  4381 000045C4 7225                    	jc .image_fail_seek
  4382                                  
  4383 000045C6 B84271                  	mov ax, 7142h
  4384 000045C9 89F2                    	mov dx, si
  4385 000045CB B100                    	mov cl, 0
  4386 000045CD F9                      	stc
  4387 000045CE CD21                    	int 21h
  4388 000045D0 7318                    	jnc .image_seek_done
  4389 000045D2 837C0400                	cmp word [si + 4], 0
  4390 000045D6 7513                    	jnz .image_fail_seek
  4391 000045D8 837C0600                	cmp word [si + 6], 0
  4392 000045DC 750D                    	jnz .image_fail_seek
  4393 000045DE 8B14                    	mov dx, word [si]
  4394 000045E0 8B4C02                  	mov cx, word [si + 2]
  4395 000045E3 B80042                  	mov ax, 4200h
  4396 000045E6 CD21                    	int 21h
  4397 000045E8 7201                    	jc .image_fail_seek
  4398                                  .image_seek_done:
  4399 000045EA A8                      	db __TEST_IMM8		; (NC, skip stc)
  4400                                  .image_fail_seek:
  4401 000045EB F9                      	stc
  4402 000045EC C3                      	retn
  4403                                  
  4404                                  
  4405                                  		; INP:	dx:ax = first sector
  4406                                  		;	ds:bx -> buffer
  4407                                  		;	cl = drive number
  4408                                  		; OUT:	dx:ax = sector number after last written
  4409                                  		;	ds:bx -> buffer after last read
  4410                                  		; CHG:	-
  4411                                  		; STT:	ds = ss
  4412                                  symhint_store_and_label write_ae_512_bytes
  4413 000045ED 57                      	push di
  4414 000045EE BF0002                  	mov di, 512
  4415                                  .loop:
  4416 000045F1 E81EFE                  	call write_sector
  4417 000045F4 7206                    	jc .error
  4418 000045F6 2B7EDC                  	sub di, word [bp + ldBytesPerSector]
  4419 000045F9 77F6                    	ja .loop
  4420 000045FB F8                      	clc
  4421                                  .error:
  4422 000045FC 5F                      	pop di
  4423 000045FD C3                      	retn
  4424                                  
  4425                                  		; INP:	dx:ax = first sector
  4426                                  		;	ds:bx -> buffer
  4427                                  		;	cl = drive number
  4428                                  		; OUT:	dx:ax = sector number after last read
  4429                                  		;	ds:bx -> buffer after last written
  4430                                  		; CHG:	-
  4431                                  		; STT:	ds = ss
  4432                                  read_ae_512_bytes:
  4433 000045FE 57                      	push di
  4434 000045FF BF0002                  	mov di, 512
  4435                                  .loop:
  4436 00004602 E8ECFE                  	call read_sector
  4437 00004605 7206                    	jc .error
  4438 00004607 2B7EDC                  	sub di, word [bp + ldBytesPerSector]
  4439 0000460A 77F6                    	ja .loop
  4440 0000460C F8                      	clc
  4441                                  .error:
  4442 0000460D 5F                      	pop di
  4443 0000460E C3                      	retn
  4444                                  
  4445                                  
  4446                                  lockdrive:
  4447 0000460F 50                      	push ax
  4448 00004610 53                      	push bx
  4449 00004611 51                      	push cx
  4450 00004612 52                      	push dx
  4451 00004613 88C3                    	mov bl, al
  4452 00004615 FEC3                    	inc bl
  4453 00004617 B700                    	mov bh, 0
  4454 00004619 B94A08                  	mov cx, 084Ah
  4455 0000461C BA0100                  	mov dx, 0001h
  4456 0000461F B80D44                  	mov ax, 440Dh
  4457 00004622 CD21                    	int 21h
  4458 00004624 5A                      	pop dx
  4459 00004625 59                      	pop cx
  4460 00004626 5B                      	pop bx
  4461 00004627 58                      	pop ax
  4462 00004628 C3                      	retn
  4463                                  
  4464                                  unlockdrive:
  4465 00004629 50                      	push ax
  4466 0000462A 53                      	push bx
  4467 0000462B 51                      	push cx
  4468 0000462C 52                      	push dx
  4469 0000462D 88C3                    	mov bl, al
  4470 0000462F FEC3                    	inc bl
  4471 00004631 B700                    	mov bh, 0
  4472 00004633 B96A08                  	mov cx, 086Ah
  4473 00004636 BA0100                  	mov dx, 0001h
  4474 00004639 B80D44                  	mov ax, 440Dh
  4475 0000463C CD21                    	int 21h
  4476 0000463E 5A                      	pop dx
  4477 0000463F 59                      	pop cx
  4478 00004640 5B                      	pop bx
  4479 00004641 58                      	pop ax
  4480 00004642 C3                      	retn
  4481                                  
  4482                                  
  4483 00004643 00                      	align 4, db 0
  4484 00004644 00000000                internalflags:	dd 0
  4485                                  oldpacket	equ	  1	; Int25/Int26 packet method available (L, W)
  4486                                  newpacket	equ	  2	; Int21.7305 packet method available (L, W)
  4487                                  ntpacket	equ	  4	; VDD registered and usable (L, W)
  4488                                  runningnt	equ   20000h	; running in NTVDM
  4489                                  detectedcopysector	equ 10h
  4490                                  detectedcopyinfo	equ 20h
  4491                                  
  4492                                  	align 2, db 0
  4493 00004648 00<rep 8h>              oemname:	times 8 db 0
  4494 00004650 0000                    hVdd:		dw 0
  4495 00004652 FFFF                    load_unit:	dw -1
  4496 00004654 FFFF                    load_use_partinfo:	dw -1
  4497 00004656 FFFF                    load_use_query_geometry:dw -1
  4498 00004658 FFFF                    load_use_lba:		dw -1
  4499 0000465A 00                      drivenumber:	db 0
  4500                                  
  4501 0000465B 00                      	align 4, db 0
  4502                                  info_reset_struc:
  4503                                  .signature1:
  4504 0000465C 52526141                	dd FSINFO.signature1_value
  4505                                  .signature1_size: equ $ - .signature1
  4506                                  .signature2_plus_entries:
  4507 00004660 72724161                	dd FSINFO.signature2_value
  4508 00004664 FFFFFFFF                	dd -1
  4509 00004668 FFFFFFFF                	dd -1
  4510                                  .signature2_plus_entries_size: equ $ - .signature2_plus_entries
  4511                                  .signature3:
  4512 0000466C 000055AA                	dd FSINFO.signature3_value
  4513                                  .signature3_size: equ $ - .signature3
  4514                                  
  4515                                  	align 4, db 0
  4516 00004670 00000000                packet:	dd 0		; sector number
  4517 00004674 0000                    	dw 0		; number of sectors to read
  4518 00004676 00000000                	dd 0		; transfer address Segm:OOOO
  4519                                  
  4520                                  
  4521                                  msg:
  4522 0000467A 494E5354534543543A-     .help:	db "INSTSECT: Install boot sectors. 2018 by C. Masloch",13,10
  4522 00004683 20496E7374616C6C20-
  4522 0000468C 626F6F742073656374-
  4522 00004695 6F72732E2032303138-
  4522 0000469E 20627920432E204D61-
  4522 000046A7 736C6F63680D0A     
  4523 000046AE 0D0A                    	db 13,10
  4524 000046B0 5573616765206F6620-     	db "Usage of the works is permitted provided that this",13,10
  4524 000046B9 74686520776F726B73-
  4524 000046C2 206973207065726D69-
  4524 000046CB 747465642070726F76-
  4524 000046D4 696465642074686174-
  4524 000046DD 20746869730D0A     
  4525 000046E4 696E737472756D656E-     	db "instrument is retained with the works, so that any entity",13,10
  4525 000046ED 742069732072657461-
  4525 000046F6 696E65642077697468-
  4525 000046FF 2074686520776F726B-
  4525 00004708 732C20736F20746861-
  4525 00004711 7420616E7920656E74-
  4525 0000471A 6974790D0A         
  4526 0000471F 746861742075736573-     	db "that uses the works is notified of this instrument.",13,10
  4526 00004728 2074686520776F726B-
  4526 00004731 73206973206E6F7469-
  4526 0000473A 66696564206F662074-
  4526 00004743 68697320696E737472-
  4526 0000474C 756D656E742E0D0A   
  4527 00004754 0D0A                    	db 13,10
  4528 00004756 444953434C41494D45-     	db "DISCLAIMER: THE WORKS ARE WITHOUT WARRANTY.",13,10
  4528 0000475F 523A2054484520574F-
  4528 00004768 524B53204152452057-
  4528 00004771 4954484F5554205741-
  4528 0000477A 5252414E54592E0D0A 
  4529 00004783 0D0A                    	db 13,10
  4530 00004785 4F7074696F6E733A0D-     	db "Options:",13,10
  4530 0000478E 0A                 
  4531 0000478F 09613A09096C6F6164-     	db 9,"a:",9,9,"load or update boot sectors of specified drive",13,10
  4531 00004798 206F72207570646174-
  4531 000047A1 6520626F6F74207365-
  4531 000047AA 63746F7273206F6620-
  4531 000047B3 737065636966696564-
  4531 000047BC 2064726976650D0A   
  4532 000047C4 092F4D3D66696C656E-     	db 9,"/M=filename",9,"operate on FS image file instead of drive",13,10
  4532 000047CD 616D65096F70657261-
  4532 000047D6 7465206F6E20465320-
  4532 000047DF 696D6167652066696C-
  4532 000047E8 6520696E7374656164-
  4532 000047F1 206F66206472697665-
  4532 000047FA 0D0A               
  4533 000047FC 092F4D4E09096F7065-     	db 9,"/MN",9,9,"operate on drive instead of image file (default)",13,10
  4533 00004805 72617465206F6E2064-
  4533 0000480E 7269766520696E7374-
  4533 00004817 656164206F6620696D-
  4533 00004820 6167652066696C6520-
  4533 00004829 2864656661756C7429-
  4533 00004832 0D0A               
  4534 00004834 092F4D533D6E756D62-     	db 9,"/MS=number",9,"set sector size of FS image file (default 512)",13,10
  4534 0000483D 657209736574207365-
  4534 00004846 63746F722073697A65-
  4534 0000484F 206F6620465320696D-
  4534 00004858 6167652066696C6520-
  4534 00004861 2864656661756C7420-
  4534 0000486A 353132290D0A       
  4535 00004870 092F4D4F3D6E756D62-     	db 9,"/MO=number",9,"set offset in image file in bytes (default 0)",13,10
  4535 00004879 657209736574206F66-
  4535 00004882 6673657420696E2069-
  4535 0000488B 6D6167652066696C65-
  4535 00004894 20696E206279746573-
  4535 0000489D 202864656661756C74-
  4535 000048A6 2030290D0A         
  4536 000048AB 092F4D4F783D6E756D-     	db 9,"/MOx=number",9,"set offset (x = S sectors, K 1024, M 1024 * 1024)",13,10
  4536 000048B4 62657209736574206F-
  4536 000048BD 666673657420287820-
  4536 000048C6 3D205320736563746F-
  4536 000048CF 72732C204B20313032-
  4536 000048D8 342C204D2031303234-
  4536 000048E1 202A2031303234290D-
  4536 000048EA 0A                 
  4537 000048EB 0D0A                    	db 13,10
  4538                                  %if _NUM_REPLACEMENTS
  4539                                  	_autodigitsstrdef DEF, _NUM_REPLACEMENTS
  4540 000048ED 092F46783D66696C65-     	db 9,"/Fx=filename",9,"replace Xth name in the boot sector, X = 1 to ",_DEF,13,10
  4540 000048F6 6E616D65097265706C-
  4540 000048FF 61636520587468206E-
  4540 00004908 616D6520696E207468-
  4540 00004911 6520626F6F74207365-
  4540 0000491A 63746F722C2058203D-
  4540 00004923 203120746F20340D0A 
  4541 0000492C 092F463D66696C656E-     	db 9,"/F=filename",9,"alias to /F1=filename",13,10
  4541 00004935 616D6509616C696173-
  4541 0000493E 20746F202F46313D66-
  4541 00004947 696C656E616D650D0A 
  4542 00004950 0D0A                    	db 13,10
  4543                                  %endif
  4544 00004952 092F55204B45455009-     	db 9,"/U KEEP",9,9,"keep default/current boot unit handling (default)",13,10
  4544 0000495B 096B65657020646566-
  4544 00004964 61756C742F63757272-
  4544 0000496D 656E7420626F6F7420-
  4544 00004976 756E69742068616E64-
  4544 0000497F 6C696E672028646566-
  4544 00004988 61756C74290D0A     
  4545 0000498F 092F55204155544F09-     	db 9,"/U AUTO",9,9,"patch boot loader to use auto boot unit handling",13,10
  4545 00004998 09706174636820626F-
  4545 000049A1 6F74206C6F61646572-
  4545 000049AA 20746F207573652061-
  4545 000049B3 75746F20626F6F7420-
  4545 000049BC 756E69742068616E64-
  4545 000049C5 6C696E670D0A       
  4546 000049CB 092F55207878090970-     	db 9,"/U xx",9,9,"patch boot loader to use XXh as a fixed unit",13,10
  4546 000049D4 6174636820626F6F74-
  4546 000049DD 206C6F616465722074-
  4546 000049E6 6F2075736520585868-
  4546 000049EF 206173206120666978-
  4546 000049F8 656420756E69740D0A 
  4547 00004A01 0D0A                    	db 13,10
  4548 00004A03 092F50204B45455009-     	db 9,"/P KEEP",9,9,"keep default/current part info handling (default)",13,10
  4548 00004A0C 096B65657020646566-
  4548 00004A15 61756C742F63757272-
  4548 00004A1E 656E74207061727420-
  4548 00004A27 696E666F2068616E64-
  4548 00004A30 6C696E672028646566-
  4548 00004A39 61756C74290D0A     
  4549 00004A40 092F50204155544F09-     	db 9,"/P AUTO",9,9,"patch boot loader to use auto part info handling",13,10
  4549 00004A49 09706174636820626F-
  4549 00004A52 6F74206C6F61646572-
  4549 00004A5B 20746F207573652061-
  4549 00004A64 75746F207061727420-
  4549 00004A6D 696E666F2068616E64-
  4549 00004A76 6C696E670D0A       
  4550 00004A7C 092F50204E4F4E4509-     	db 9,"/P NONE",9,9,"patch boot loader to use fixed part info",13,10
  4550 00004A85 09706174636820626F-
  4550 00004A8E 6F74206C6F61646572-
  4550 00004A97 20746F207573652066-
  4550 00004AA0 697865642070617274-
  4550 00004AA9 20696E666F0D0A     
  4551 00004AB0 0D0A                    	db 13,10
  4552 00004AB2 092F51204B45455009-     	db 9,"/Q KEEP",9,9,"keep default/current query geometry handling (default)",13,10
  4552 00004ABB 096B65657020646566-
  4552 00004AC4 61756C742F63757272-
  4552 00004ACD 656E74207175657279-
  4552 00004AD6 2067656F6D65747279-
  4552 00004ADF 2068616E646C696E67-
  4552 00004AE8 202864656661756C74-
  4552 00004AF1 290D0A             
  4553 00004AF4 092F51204155544F09-     	db 9,"/Q AUTO",9,9,"patch boot loader to use auto query geometry handling",13,10
  4553 00004AFD 09706174636820626F-
  4553 00004B06 6F74206C6F61646572-
  4553 00004B0F 20746F207573652061-
  4553 00004B18 75746F207175657279-
  4553 00004B21 2067656F6D65747279-
  4553 00004B2A 2068616E646C696E67-
  4553 00004B33 0D0A               
  4554 00004B35 092F51204E4F4E4509-     	db 9,"/Q NONE",9,9,"patch boot loader to use fixed geometry",13,10
  4554 00004B3E 09706174636820626F-
  4554 00004B47 6F74206C6F61646572-
  4554 00004B50 20746F207573652066-
  4554 00004B59 697865642067656F6D-
  4554 00004B62 657472790D0A       
  4555 00004B68 0D0A                    	db 13,10
  4556 00004B6A 092F4C204B45455009-     	db 9,"/L KEEP",9,9,"keep default/current LBA handling (default)",13,10
  4556 00004B73 096B65657020646566-
  4556 00004B7C 61756C742F63757272-
  4556 00004B85 656E74204C42412068-
  4556 00004B8E 616E646C696E672028-
  4556 00004B97 64656661756C74290D-
  4556 00004BA0 0A                 
  4557 00004BA1 092F4C204155544F09-     	db 9,"/L AUTO",9,9,"patch boot loader to use auto LBA handling",13,10
  4557 00004BAA 09706174636820626F-
  4557 00004BB3 6F74206C6F61646572-
  4557 00004BBC 20746F207573652061-
  4557 00004BC5 75746F204C42412068-
  4557 00004BCE 616E646C696E670D0A 
  4558 00004BD7 092F4C204155544F48-     	db 9,"/L AUTOHDD",9,"patch boot loader to use auto LBA (HDD-only) handling",13,10
  4558 00004BE0 444409706174636820-
  4558 00004BE9 626F6F74206C6F6164-
  4558 00004BF2 657220746F20757365-
  4558 00004BFB 206175746F204C4241-
  4558 00004C04 20284844442D6F6E6C-
  4558 00004C0D 79292068616E646C69-
  4558 00004C16 6E670D0A           
  4559 00004C1A 092F4C204E4F4E4509-     	db 9,"/L NONE",9,9,"patch boot loader to use only CHS",13,10
  4559 00004C23 09706174636820626F-
  4559 00004C2C 6F74206C6F61646572-
  4559 00004C35 20746F20757365206F-
  4559 00004C3E 6E6C79204348530D0A 
  4560 00004C47 0D0A                    	db 13,10
  4561 00004C49 092F53520909646F20-     	db 9,"/SR",9,9,"do not read boot sector from source file (default)",13,10
  4561 00004C52 6E6F74207265616420-
  4561 00004C5B 626F6F742073656374-
  4561 00004C64 6F722066726F6D2073-
  4561 00004C6D 6F757263652066696C-
  4561 00004C76 65202864656661756C-
  4561 00004C7F 74290D0A           
  4562 00004C83 092F533D66696C656E-     	db 9,"/S=filename",9,"read boot sector loader from source file",13,10
  4562 00004C8C 616D65097265616420-
  4562 00004C95 626F6F742073656374-
  4562 00004C9E 6F72206C6F61646572-
  4562 00004CA7 2066726F6D20736F75-
  4562 00004CB0 7263652066696C650D-
  4562 00004CB9 0A                 
  4563 00004CBA 092F5331323D66696C-     	db 9,"/S12=filename",9,"as /S=filename but only for FAT12 (also /S16, /S32)",13,10
  4563 00004CC3 656E616D6509617320-
  4563 00004CCC 2F533D66696C656E61-
  4563 00004CD5 6D6520627574206F6E-
  4563 00004CDE 6C7920666F72204641-
  4563 00004CE7 5431322028616C736F-
  4563 00004CF0 202F5331362C202F53-
  4563 00004CF9 3332290D0A         
  4564 00004CFE 092F5356090976616C-     	db 9,"/SV",9,9,"validate boot sector jump and FS ID (default)",13,10
  4564 00004D07 696461746520626F6F-
  4564 00004D10 7420736563746F7220-
  4564 00004D19 6A756D7020616E6420-
  4564 00004D22 465320494420286465-
  4564 00004D2B 6661756C74290D0A   
  4565 00004D33 092F534E0909646F20-     	db 9,"/SN",9,9,"do not validate boot sector jump and FS ID",13,10
  4565 00004D3C 6E6F742076616C6964-
  4565 00004D45 61746520626F6F7420-
  4565 00004D4E 736563746F72206A75-
  4565 00004D57 6D7020616E64204653-
  4565 00004D60 2049440D0A         
  4566 00004D65 0D0A                    	db 13,10
  4567 00004D67 092F42530909777269-     	db 9,"/BS",9,9,"write boot sector to drive's boot sector (default)",13,10
  4567 00004D70 746520626F6F742073-
  4567 00004D79 6563746F7220746F20-
  4567 00004D82 647269766527732062-
  4567 00004D8B 6F6F7420736563746F-
  4567 00004D94 72202864656661756C-
  4567 00004D9D 74290D0A           
  4568 00004DA1 092F423D66696C656E-     	db 9,"/B=filename",9,"write boot sector to file, not to drive",13,10
  4568 00004DAA 616D65097772697465-
  4568 00004DB3 20626F6F7420736563-
  4568 00004DBC 746F7220746F206669-
  4568 00004DC5 6C652C206E6F742074-
  4568 00004DCE 6F2064726976650D0A 
  4569 00004DD7 092F424E0909646F20-     	db 9,"/BN",9,9,"do not write boot sector",13,10
  4569 00004DE0 6E6F74207772697465-
  4569 00004DE9 20626F6F7420736563-
  4569 00004DF2 746F720D0A         
  4570 00004DF7 092F42520909726570-     	db 9,"/BR",9,9,"replace boot sector loader with built-in one (default)",13,10
  4570 00004E00 6C61636520626F6F74-
  4570 00004E09 20736563746F72206C-
  4570 00004E12 6F6164657220776974-
  4570 00004E1B 68206275696C742D69-
  4570 00004E24 6E206F6E6520286465-
  4570 00004E2D 6661756C74290D0A   
  4571 00004E35 092F424F09096B6565-     	db 9,"/BO",9,9,"keep original boot sector",13,10
  4571 00004E3E 70206F726967696E61-
  4571 00004E47 6C20626F6F74207365-
  4571 00004E50 63746F720D0A       
  4572                                  %if _FAT32
  4573 00004E56 092F42430909726573-     	db 9,"/BC",9,9,"restore boot sector from backup copy",13,10
  4573 00004E5F 746F726520626F6F74-
  4573 00004E68 20736563746F722066-
  4573 00004E71 726F6D206261636B75-
  4573 00004E7A 7020636F70790D0A   
  4574 00004E82 0D0A                    	db 13,10
  4575 00004E84 4F6E6C79206170706C-     	db "Only applicable for FAT32 with sector size below or equal to 512 bytes:",13,10
  4575 00004E8D 696361626C6520666F-
  4575 00004E96 722046415433322077-
  4575 00004E9F 69746820736563746F-
  4575 00004EA8 722073697A65206265-
  4575 00004EB1 6C6F77206F72206571-
  4575 00004EBA 75616C20746F203531-
  4575 00004EC3 322062797465733A0D-
  4575 00004ECC 0A                 
  4576 00004ECD 092F49530909777269-     	db 9,"/IS",9,9,"write FSIBOOT to drive's FSINFO sector (default)",13,10
  4576 00004ED6 746520465349424F4F-
  4576 00004EDF 5420746F2064726976-
  4576 00004EE8 652773204653494E46-
  4576 00004EF1 4F20736563746F7220-
  4576 00004EFA 2864656661756C7429-
  4576 00004F03 0D0A               
  4577 00004F05 092F493D66696C656E-     	db 9,"/I=filename",9,"write FSIBOOT to file, not to drive",13,10
  4577 00004F0E 616D65097772697465-
  4577 00004F17 20465349424F4F5420-
  4577 00004F20 746F2066696C652C20-
  4577 00004F29 6E6F7420746F206472-
  4577 00004F32 6976650D0A         
  4578 00004F37 092F49420909777269-     	db 9,"/IB",9,9,"write FSIBOOT to boot sector file (see /B=filename)",13,10
  4578 00004F40 746520465349424F4F-
  4578 00004F49 5420746F20626F6F74-
  4578 00004F52 20736563746F722066-
  4578 00004F5B 696C65202873656520-
  4578 00004F64 2F423D66696C656E61-
  4578 00004F6D 6D65290D0A         
  4579 00004F72 092F494E0909646F20-     	db 9,"/IN",9,9,"do not write FSIBOOT",13,10
  4579 00004F7B 6E6F74207772697465-
  4579 00004F84 20465349424F4F540D-
  4579 00004F8D 0A                 
  4580 00004F8E 092F49520909726570-     	db 9,"/IR",9,9,"replace reserved field with built-in FSIBOOT (default)",13,10
  4580 00004F97 6C6163652072657365-
  4580 00004FA0 72766564206669656C-
  4580 00004FA9 642077697468206275-
  4580 00004FB2 696C742D696E204653-
  4580 00004FBB 49424F4F5420286465-
  4580 00004FC4 6661756C74290D0A   
  4581 00004FCC 092F494F09096B6565-     	db 9,"/IO",9,9,"keep original reserved fields (including FSIBOOT area)",13,10
  4581 00004FD5 70206F726967696E61-
  4581 00004FDE 6C2072657365727665-
  4581 00004FE7 64206669656C647320-
  4581 00004FF0 28696E636C7564696E-
  4581 00004FF9 6720465349424F4F54-
  4581 00005002 2061726561290D0A   
  4582 0000500A 092F49430909726573-     	db 9,"/IC",9,9,"restore FSINFO from backup copy",13,10
  4582 00005013 746F7265204653494E-
  4582 0000501C 464F2066726F6D2062-
  4582 00005025 61636B757020636F70-
  4582 0000502E 790D0A             
  4583 00005031 092F495A09097A6572-     	db 9,"/IZ",9,9,"zero out reserved fields (including FSIBOOT area)",13,10
  4583 0000503A 6F206F757420726573-
  4583 00005043 657276656420666965-
  4583 0000504C 6C64732028696E636C-
  4583 00005055 7564696E6720465349-
  4583 0000505E 424F4F542061726561-
  4583 00005067 290D0A             
  4584 0000506A 092F494909096C6561-     	db 9,"/II",9,9,"leave invalid FSINFO structure",13,10
  4584 00005073 766520696E76616C69-
  4584 0000507C 64204653494E464F20-
  4584 00005085 737472756374757265-
  4584 0000508E 0D0A               
  4585 00005090 092F495609096D616B-     	db 9,"/IV",9,9,"make valid FSINFO if there is none (default)",13,10
  4585 00005099 652076616C69642046-
  4585 000050A2 53494E464F20696620-
  4585 000050AB 746865726520697320-
  4585 000050B4 6E6F6E652028646566-
  4585 000050BD 61756C74290D0A     
  4586 000050C4 0D0A                    	db 13,10
  4587 000050C6 4F6E6C79206170706C-     	db "Only applicable for FAT32:",13,10
  4587 000050CF 696361626C6520666F-
  4587 000050D8 722046415433323A0D-
  4587 000050E1 0A                 
  4588 000050E2 092F430909666F7263-     	db 9,"/C",9,9,"force writing to backup copies",13,10
  4588 000050EB 652077726974696E67-
  4588 000050F4 20746F206261636B75-
  4588 000050FD 7020636F706965730D-
  4588 00005106 0A                 
  4589 00005107 092F43420909666F72-     	db 9,"/CB",9,9,"force writing sector to backup copy",13,10
  4589 00005110 63652077726974696E-
  4589 00005119 6720736563746F7220-
  4589 00005122 746F206261636B7570-
  4589 0000512B 20636F70790D0A     
  4590 00005132 092F43490909666F72-     	db 9,"/CI",9,9,"force writing info to backup copy",13,10
  4590 0000513B 63652077726974696E-
  4590 00005144 6720696E666F20746F-
  4590 0000514D 206261636B75702063-
  4590 00005156 6F70790D0A         
  4591 0000515B 092F434E0909646973-     	db 9,"/CN",9,9,"disable writing to backup copies",13,10
  4591 00005164 61626C652077726974-
  4591 0000516D 696E6720746F206261-
  4591 00005176 636B757020636F7069-
  4591 0000517F 65730D0A           
  4592 00005183 092F434E4209096469-     	db 9,"/CNB",9,9,"disable writing sector to backup copy",13,10
  4592 0000518C 7361626C6520777269-
  4592 00005195 74696E672073656374-
  4592 0000519E 6F7220746F20626163-
  4592 000051A7 6B757020636F70790D-
  4592 000051B0 0A                 
  4593 000051B1 092F434E4909096469-     	db 9,"/CNI",9,9,"disable writing info to backup copy",13,10
  4593 000051BA 7361626C6520777269-
  4593 000051C3 74696E6720696E666F-
  4593 000051CC 20746F206261636B75-
  4593 000051D5 7020636F70790D0A   
  4594 000051DD 092F435309096F6E6C-     	db 9,"/CS",9,9,"only write backup copies if writing sectors (default)",13,10
  4594 000051E6 792077726974652062-
  4594 000051EF 61636B757020636F70-
  4594 000051F8 696573206966207772-
  4594 00005201 6974696E6720736563-
  4594 0000520A 746F72732028646566-
  4594 00005213 61756C74290D0A     
  4595 0000521A 092F43534209096F6E-     	db 9,"/CSB",9,9,"only write sector to backup copy if writing sector",13,10
  4595 00005223 6C7920777269746520-
  4595 0000522C 736563746F7220746F-
  4595 00005235 206261636B75702063-
  4595 0000523E 6F7079206966207772-
  4595 00005247 6974696E6720736563-
  4595 00005250 746F720D0A         
  4596 00005255 092F43534909096F6E-     	db 9,"/CSI",9,9,"only write info to backup copy if writing sector",13,10
  4596 0000525E 6C7920777269746520-
  4596 00005267 696E666F20746F2062-
  4596 00005270 61636B757020636F70-
  4596 00005279 792069662077726974-
  4596 00005282 696E6720736563746F-
  4596 0000528B 720D0A             
  4597                                  %endif
  4598 0000528E 00                      	asciz
  4599                                  
  4600 0000528F 416363657373206572-     .boot_access_error:	asciz "Access error.", 13,10
  4600 00005298 726F722E0D0A00     
  4601 0000529F 536563746F72207369-     .boot_sector_too_large:	asciz "Sector size too small (< 32 bytes).", 13,10
  4601 000052A8 7A6520746F6F20736D-
  4601 000052B1 616C6C20283C203332-
  4601 000052BA 206279746573292E0D-
  4601 000052C3 0A00               
  4602 000052C5 536563746F72207369-     .boot_sector_too_small:	asciz "Sector size too large (> 8192 bytes).", 13,10
  4602 000052CE 7A6520746F6F206C61-
  4602 000052D7 72676520283E203831-
  4602 000052E0 393220627974657329-
  4602 000052E9 2E0D0A00           
  4603 000052ED 536563746F72207369-     .boot_sector_not_power:	asciz "Sector size not a power of two.", 13,10
  4603 000052F6 7A65206E6F74206120-
  4603 000052FF 706F776572206F6620-
  4603 00005308 74776F2E0D0A00     
  4604 0000530F 4F7574206F66206D65-     .out_of_memory:		asciz "Out of memory.",13,10
  4604 00005318 6D6F72792E0D0A00   
  4605 00005320 537769746368206E6F-     .switch_not_supported:	asciz "Switch not supported.",13,10
  4605 00005329 7420737570706F7274-
  4605 00005332 65642E0D0A00       
  4606 00005338 537769746368202F4F-     .o_error:		asciz "Switch /O invalid content.",13,10
  4606 00005341 20696E76616C696420-
  4606 0000534A 636F6E74656E742E0D-
  4606 00005353 0A00               
  4607 00005355 496E76616C69642061-     .invalid_argument:	asciz "Invalid argument.",13,10
  4607 0000535E 7267756D656E742E0D-
  4607 00005367 0A00               
  4608 00005369 4E6F20647269766520-     .no_drive_specified:	asciz "No drive specified.",13,10
  4608 00005372 737065636966696564-
  4608 0000537B 2E0D0A00           
  4609 0000537F 4D756C7469706C6520-     .error_multiple_drives:	asciz "Multiple drives specified.",13,10
  4609 00005388 647269766573207370-
  4609 00005391 656369666965642E0D-
  4609 0000539A 0A00               
  4610                                  .drive_and_image_specified:
  4611 0000539C 447269766520616E64-     			asciz "Drive and FS image specified.",13,10
  4611 000053A5 20465320696D616765-
  4611 000053AE 207370656369666965-
  4611 000053B7 642E0D0A00         
  4612                                  .no_sector_file_specified:
  4613 000053BC 4E6F20626F6F742073-     		asciz "No boot sector file specified for /IB switch.",13,10
  4613 000053C5 6563746F722066696C-
  4613 000053CE 652073706563696669-
  4613 000053D7 656420666F72202F49-
  4613 000053E0 42207377697463682E-
  4613 000053E9 0D0A00             
  4614 000053EC 426F6F742073656374-     .bootfail_sig:	asciz "Boot sector signature missing (is not AA55h).",13,10
  4614 000053F5 6F72207369676E6174-
  4614 000053FE 757265206D69737369-
  4614 00005407 6E6720286973206E6F-
  4614 00005410 74204141353568292E-
  4614 00005419 0D0A00             
  4615 0000541C 42696720626F6F7420-     .bootfail_sig2:	asciz "Big boot sector signature missing (is not AA55h).",13,10
  4615 00005425 736563746F72207369-
  4615 0000542E 676E6174757265206D-
  4615 00005437 697373696E67202869-
  4615 00005440 73206E6F7420414135-
  4615 00005449 3568292E0D0A00     
  4616                                  .bootfail_secsizeinvalid:
  4617 00005450 536563746F72207369-     		asciz "Sector size is invalid (not a power of two).",13,10
  4617 00005459 7A6520697320696E76-
  4617 00005462 616C696420286E6F74-
  4617 0000546B 206120706F77657220-
  4617 00005474 6F662074776F292E0D-
  4617 0000547D 0A00               
  4618                                  .bootfail_secsizediffer:
  4619 0000547F 425042204270532064-     		asciz "BPB BpS differs from actual sector size.",13,10
  4619 00005488 696666657273206672-
  4619 00005491 6F6D2061637475616C-
  4619 0000549A 20736563746F722073-
  4619 000054A3 697A652E0D0A00     
  4620 000054AA 42616420616D6F756E-     .boot_badclusters:	asciz "Bad amount of clusters.",13,10
  4620 000054B3 74206F6620636C7573-
  4620 000054BC 746572732E0D0A00   
  4621 000054C4 42616420636C757374-     .boot_badchain:		asciz "Bad cluster chain.",13,10
  4621 000054CD 657220636861696E2E-
  4621 000054D6 0D0A00             
  4622                                  
  4623 000054D9 4572726F7220777269-     .image_fail.write:	asciz "Error writing image file, "
  4623 000054E2 74696E6720696D6167-
  4623 000054EB 652066696C652C2000 
  4624                                  .image_fail_enough.write:
  4625 000054F4 4572726F723A204469-     			asciz "Error: Did not write enough to image file.",13,10
  4625 000054FD 64206E6F7420777269-
  4625 00005506 746520656E6F756768-
  4625 0000550F 20746F20696D616765-
  4625 00005518 2066696C652E0D0A00 
  4626                                  .image_fail_seek.read:
  4627 00005521 4572726F723A204661-     .image_fail_seek.write:	asciz "Error: Failed to seek image file.",13,10
  4627 0000552A 696C656420746F2073-
  4627 00005533 65656B20696D616765-
  4627 0000553C 2066696C652E0D0A00 
  4628 00005545 4572726F7220726561-     .image_fail.read:	asciz "Error reading image file, "
  4628 0000554E 64696E6720696D6167-
  4628 00005557 652066696C652C2000 
  4629                                  .image_fail_enough.read:
  4630 00005560 4572726F723A204469-     			asciz "Error: Did not read enough from image file.",13,10
  4630 00005569 64206E6F7420726561-
  4630 00005572 6420656E6F75676820-
  4630 0000557B 66726F6D20696D6167-
  4630 00005584 652066696C652E0D0A-
  4630 0000558D 00                 
  4631 0000558E 4E6F204653494E464F-     .no_fsinfo:	asciz "No FSINFO sector found.",13,10
  4631 00005597 20736563746F722066-
  4631 000055A0 6F756E642E0D0A00   
  4632                                  .not_yet_non_fsinfo:
  4633 000055A8 464154333220776974-     		asciz "FAT32 with two sectors and not FSINFO not yet supported.",13,10
  4633 000055B1 682074776F20736563-
  4633 000055BA 746F727320616E6420-
  4633 000055C3 6E6F74204653494E46-
  4633 000055CC 4F206E6F7420796574-
  4633 000055D5 20737570706F727465-
  4633 000055DE 642E0D0A00         
  4634 000055E3 4572726F723A20536F-     .wrong_size:	asciz "Error: Source file has wrong size, expected 512 or (FAT32-only) 1024 bytes.",13,10
  4634 000055EC 757263652066696C65-
  4634 000055F5 206861732077726F6E-
  4634 000055FE 672073697A652C2065-
  4634 00005607 787065637465642035-
  4634 00005610 3132206F7220284641-
  4634 00005619 5433322D6F6E6C7929-
  4634 00005622 203130323420627974-
  4634 0000562B 65732E0D0A00       
  4635                                  .critical_fail_fsinfo_changed:
  4636 00005631 4661696C7572652074-     		asciz "Failure to write back original FSINFO!",13,10
  4636 0000563A 6F2077726974652062-
  4636 00005643 61636B206F72696769-
  4636 0000564C 6E616C204653494E46-
  4636 00005655 4F210D0A00         
  4637 0000565A 446574656374656420-     .is_fat12:	asciz "Detected FAT12 FS.",13,10
  4637 00005663 46415431322046532E-
  4637 0000566C 0D0A00             
  4638 0000566F 446574656374656420-     .is_fat16:	asciz "Detected FAT16 FS.",13,10
  4638 00005678 46415431362046532E-
  4638 00005681 0D0A00             
  4639 00005684 446574656374656420-     .is_fat32:	asciz "Detected FAT32 FS.",13,10
  4639 0000568D 46415433322046532E-
  4639 00005696 0D0A00             
  4640                                  %if !_FAT32 || !_FAT16 || !_FAT12
  4641                                  .not_supported_fat_type:
  4642                                  		asciz "This FAT type is not supported in this build.",13,10
  4643                                  %endif
  4644                                  
  4645                                  %if _NUM_DETECT_NAMES
  4646 00005699 00<rep 3h>              	align 4, db 0
  4647                                  load_kernel_name: equ $
  4648 0000569C 00<rep Ch>              	times 12 db 0
  4649                                  		; buffer for base name (8) + ext (3) + NUL (1) = 12
  4650                                   %if _NUM_REPLACEMENTS
  4651                                  .name_replacements:
  4652 000056A8 00<rep 30h>             	times 12 * _NUM_REPLACEMENTS db 0
  4653                                  		; name replacement buffers, 4 times same as load_kernel_name
  4654                                   %endif
  4655                                  	align 4, db 0
  4656                                  .foundname:
  4657 000056D8 00<rep Dh>              	times 8+1+3+1 db 0
  4658                                  		; buffer for base name (8) + dot (1) + ext (3) + NUL (1)
  4659 000056E5 00                      	align 2, db 0
  4660                                  .foundname_none:
  4661 000056E6 284E6F6E652900          	asciz "(None)"
  4662                                  .foundname_none_size: equ $ - .foundname_none
  4663 000056ED 00<rep 3h>              	align 4, db 0
  4664                                  .names:
  4665                                   %assign ii 1
  4666                                   %rep _NUM_DETECT_NAMES
  4667                                  	dw .name_ %+ ii, 0
  4668                                    %assign ii ii + 1
  4669                                   %endrep
  4667 000056F0 [0257]0000          <1>  dw .name_ %+ ii, 0
  4668                              <1>  %assign ii ii + 1
  4667 000056F4 [0B57]0000          <1>  dw .name_ %+ ii, 0
  4668                              <1>  %assign ii ii + 1
  4667 000056F8 [1457]0000          <1>  dw .name_ %+ ii, 0
  4668                              <1>  %assign ii ii + 1
  4667 000056FC [1D57]0000          <1>  dw .name_ %+ ii, 0
  4668                              <1>  %assign ii ii + 1
  4670 00005700 0000                    	dw 0
  4671                                   %assign ii 1
  4672                                   %rep _NUM_DETECT_NAMES
  4673                                    _autodigitsstrdef DEF, ii
  4674                                    %strcat string _DEF
  4675                                    %strlen ll string
  4676                                    %substr ones string ll
  4677                                    %if ll >= 2
  4678                                     %substr tens string ll - 1
  4679                                    %else
  4680                                     %define tens "0"
  4681                                    %endif
  4682                                    %deftok tokenones ones
  4683                                    %deftok tokentens tens
  4684                                    %if tokentens != 1 && tokenones == 1
  4685                                     %define suffix "st"
  4686                                    %elif tokentens != 1 && tokenones == 2
  4687                                     %define suffix "nd"
  4688                                    %elif tokentens != 1 && tokenones == 3
  4689                                     %define suffix "rd"
  4690                                    %else
  4691                                     %define suffix "th"
  4692                                    %endif
  4693                                  .name_ %+ ii:	asciz _DEF,suffix," name"
  4694                                    %assign ii ii + 1
  4695                                   %endrep
  4673                              <1>  _autodigitsstrdef DEF, ii
  4674                              <1>  %strcat string _DEF
  4675                              <1>  %strlen ll string
  4676                              <1>  %substr ones string ll
  4677                              <1>  %if ll >= 2
  4678                              <1>  %substr tens string ll - 1
  4679                              <1>  %else
  4680                              <1>  %define tens "0"
  4681                              <1>  %endif
  4682                              <1>  %deftok tokenones ones
  4683                              <1>  %deftok tokentens tens
  4684                              <1>  %if tokentens != 1 && tokenones == 1
  4685                              <1>  %define suffix "st"
  4686                              <1>  %elif tokentens != 1 && tokenones == 2
  4687                              <1>  %define suffix "nd"
  4688                              <1>  %elif tokentens != 1 && tokenones == 3
  4689                              <1>  %define suffix "rd"
  4690                              <1>  %else
  4691                              <1>  %define suffix "th"
  4692                              <1>  %endif
  4693 00005702 317374206E616D6500  <1> .name_ %+ ii: asciz _DEF,suffix," name"
  4694                              <1>  %assign ii ii + 1
  4673                              <1>  _autodigitsstrdef DEF, ii
  4674                              <1>  %strcat string _DEF
  4675                              <1>  %strlen ll string
  4676                              <1>  %substr ones string ll
  4677                              <1>  %if ll >= 2
  4678                              <1>  %substr tens string ll - 1
  4679                              <1>  %else
  4680                              <1>  %define tens "0"
  4681                              <1>  %endif
  4682                              <1>  %deftok tokenones ones
  4683                              <1>  %deftok tokentens tens
  4684                              <1>  %if tokentens != 1 && tokenones == 1
  4685                              <1>  %define suffix "st"
  4686                              <1>  %elif tokentens != 1 && tokenones == 2
  4687                              <1>  %define suffix "nd"
  4688                              <1>  %elif tokentens != 1 && tokenones == 3
  4689                              <1>  %define suffix "rd"
  4690                              <1>  %else
  4691                              <1>  %define suffix "th"
  4692                              <1>  %endif
  4693 0000570B 326E64206E616D6500  <1> .name_ %+ ii: asciz _DEF,suffix," name"
  4694                              <1>  %assign ii ii + 1
  4673                              <1>  _autodigitsstrdef DEF, ii
  4674                              <1>  %strcat string _DEF
  4675                              <1>  %strlen ll string
  4676                              <1>  %substr ones string ll
  4677                              <1>  %if ll >= 2
  4678                              <1>  %substr tens string ll - 1
  4679                              <1>  %else
  4680                              <1>  %define tens "0"
  4681                              <1>  %endif
  4682                              <1>  %deftok tokenones ones
  4683                              <1>  %deftok tokentens tens
  4684                              <1>  %if tokentens != 1 && tokenones == 1
  4685                              <1>  %define suffix "st"
  4686                              <1>  %elif tokentens != 1 && tokenones == 2
  4687                              <1>  %define suffix "nd"
  4688                              <1>  %elif tokentens != 1 && tokenones == 3
  4689                              <1>  %define suffix "rd"
  4690                              <1>  %else
  4691                              <1>  %define suffix "th"
  4692                              <1>  %endif
  4693 00005714 337264206E616D6500  <1> .name_ %+ ii: asciz _DEF,suffix," name"
  4694                              <1>  %assign ii ii + 1
  4673                              <1>  _autodigitsstrdef DEF, ii
  4674                              <1>  %strcat string _DEF
  4675                              <1>  %strlen ll string
  4676                              <1>  %substr ones string ll
  4677                              <1>  %if ll >= 2
  4678                              <1>  %substr tens string ll - 1
  4679                              <1>  %else
  4680                              <1>  %define tens "0"
  4681                              <1>  %endif
  4682                              <1>  %deftok tokenones ones
  4683                              <1>  %deftok tokentens tens
  4684                              <1>  %if tokentens != 1 && tokenones == 1
  4685                              <1>  %define suffix "st"
  4686                              <1>  %elif tokentens != 1 && tokenones == 2
  4687                              <1>  %define suffix "nd"
  4688                              <1>  %elif tokentens != 1 && tokenones == 3
  4689                              <1>  %define suffix "rd"
  4690                              <1>  %else
  4691                              <1>  %define suffix "th"
  4692                              <1>  %endif
  4693 0000571D 347468206E616D6500  <1> .name_ %+ ii: asciz _DEF,suffix," name"
  4694                              <1>  %assign ii ii + 1
  4696 00005726 3A2000                  .name_before:	asciz ": "
  4697 00005729 2200                    .name_quote:	asciz '"'
  4698 0000572B 0D0A00                  .name_after:	asciz 13,10
  4699 0000572E 4E6F206E616D652064-     .name_none:	asciz "No name detected.",13,10
  4699 00005737 657465637465642E0D-
  4699 00005740 0A00               
  4700                                  
  4701                                   %if _NUM_REPLACEMENTS
  4702 00005742 4E6F2000                .no_name_found_before:	asciz "No "
  4703 00005746 20666F72207265706C-     .no_name_found_after:	asciz " for replacement found!",13,10
  4703 0000574F 6163656D656E742066-
  4703 00005758 6F756E64210D0A00   
  4704                                  
  4705 00005760 5265706C6163696E67-     .replacing_before:	asciz "Replacing "
  4705 00005769 2000               
  4706 0000576B 2077697468202200        .replacing_between:	asciz " with ",'"'
  4707 00005773 222E0D0A00              .replacing_after:	asciz '".',13,10
  4708                                   %endif
  4709                                  %endif
  4710                                  
  4711                                  	align 2, db 0
  4712 00005778 464154313220-           .fat12sig:	fill 8, 32, db "FAT12"
  4712 00005778 <rep 3h>           
  4713 00005780 464154313620-           .fat16sig:	fill 8, 32, db "FAT16"
  4713 00005780 <rep 3h>           
  4714 00005788 464154333220-           .fat32sig:	fill 8, 32, db "FAT32"
  4714 00005788 <rep 3h>           
  4715                                  .sector_invalid_no_jump:
  4716 00005790 536563746F7220696E-     		asciz "Sector invalid, no jump instruction.",13,10
  4716 00005799 76616C69642C206E6F-
  4716 000057A2 206A756D7020696E73-
  4716 000057AB 7472756374696F6E2E-
  4716 000057B4 0D0A00             
  4717                                  .sector_invalid_too_short_jump:
  4718 000057B7 536563746F7220696E-     		asciz "Sector invalid, too short jump.",13,10
  4718 000057C0 76616C69642C20746F-
  4718 000057C9 6F2073686F7274206A-
  4718 000057D2 756D702E0D0A00     
  4719                                  .sector_invalid_too_long_jump:
  4720 000057D9 536563746F7220696E-     		asciz "Sector invalid, too long jump.",13,10
  4720 000057E2 76616C69642C20746F-
  4720 000057EB 6F206C6F6E67206A75-
  4720 000057F4 6D702E0D0A00       
  4721                                  .sector_valid:
  4722 000057FA 536563746F72207661-     		asciz "Sector valid, FS ID match and proper jump.",13,10
  4722 00005803 6C69642C2046532049-
  4722 0000580C 44206D617463682061-
  4722 00005815 6E642070726F706572-
  4722 0000581E 206A756D702E0D0A00 
  4723                                  .sector_invalid_no_id:
  4724 00005827 536563746F7220696E-     		asciz "Sector invalid, no FS ID match.",13,10
  4724 00005830 76616C69642C206E6F-
  4724 00005839 204653204944206D61-
  4724 00005842 7463682E0D0A00     
  4725                                  .allowing_sector_invalid:
  4726 00005849 416C6C6F77696E6720-     		asciz "Allowing invalid sector: "
  4726 00005852 696E76616C69642073-
  4726 0000585B 6563746F723A2000   
  4727                                  
  4728 00005863 4B45455000              .keep:			asciz "KEEP"
  4729 00005868 4155544F00              .auto:			asciz "AUTO"
  4730 0000586D 4155544F48444400        .autohdd:		asciz "AUTOHDD"
  4731 00005875 4E4F4E4500              .none:			asciz "NONE"
  4732 0000587A 496E76616C6964206E-     .error_invalid_number:	asciz "Invalid number.",13,10
  4732 00005883 756D6265722E0D0A00 
  4733 0000588C 205573696E67206669-     .using_fix_unit:	asciz " Using fixed unit of "
  4733 00005895 78656420756E697420-
  4733 0000589E 6F662000           
  4734 000058A2 682E0D0A00              .using_fix_unit_after:	asciz "h.",13,10
  4735 000058A7 4572726F723A20556E-     .unit_not_found:	asciz "Error: Unit selection code not found in sector.",13,10
  4735 000058B0 69742073656C656374-
  4735 000058B9 696F6E20636F646520-
  4735 000058C2 6E6F7420666F756E64-
  4735 000058CB 20696E20736563746F-
  4735 000058D4 722E0D0A00         
  4736 000058D9 556E69742073656C65-     .unit_not_found.keep:	asciz "Unit selection code not found in sector. Keeping as is.",13,10
  4736 000058E2 6374696F6E20636F64-
  4736 000058EB 65206E6F7420666F75-
  4736 000058F4 6E6420696E20736563-
  4736 000058FD 746F722E204B656570-
  4736 00005906 696E67206173206973-
  4736 0000590F 2E0D0A00           
  4737 00005913 4175746F20756E6974-     .unit_found.set_bpbn:	asciz "Auto unit selection found in sector."
  4737 0000591C 2073656C656374696F-
  4737 00005925 6E20666F756E642069-
  4737 0000592E 6E20736563746F722E-
  4737 00005937 00                 
  4738 00005938 466978656420756E69-     .unit_found.set_dl:	asciz "Fixed unit selection found in sector, unit "
  4738 00005941 742073656C65637469-
  4738 0000594A 6F6E20666F756E6420-
  4738 00005953 696E20736563746F72-
  4738 0000595C 2C20756E69742000   
  4739                                  .unit_found.set_dl.after:
  4740 00005964 682E00                  			asciz "h."
  4741                                  .lba_found.keeping:
  4742                                  .query_found.keeping:
  4743                                  .partinfo_found.keeping:
  4744 00005967 204B656570696E6720-     .unit_found.keeping:	asciz " Keeping as is.",13,10
  4744 00005970 61732069732E0D0A00 
  4745 00005979 205573696E67206175-     .using_auto_unit:	asciz " Using auto unit.",13,10
  4745 00005982 746F20756E69742E0D-
  4745 0000598B 0A00               
  4746                                  
  4747 0000598D 205573696E67206669-     .using_fix_partinfo:	asciz " Using fixed part info.",13,10
  4747 00005996 786564207061727420-
  4747 0000599F 696E666F2E0D0A00   
  4748 000059A7 4572726F723A205061-     .partinfo_not_found:	asciz "Error: Part info code not found in sector.",13,10
  4748 000059B0 727420696E666F2063-
  4748 000059B9 6F6465206E6F742066-
  4748 000059C2 6F756E6420696E2073-
  4748 000059CB 6563746F722E0D0A00 
  4749 000059D4 5061727420696E666F-     .partinfo_not_found.keep:asciz "Part info code not found in sector. Keeping as is.",13,10
  4749 000059DD 20636F6465206E6F74-
  4749 000059E6 20666F756E6420696E-
  4749 000059EF 20736563746F722E20-
  4749 000059F8 4B656570696E672061-
  4749 00005A01 732069732E0D0A00   
  4750 00005A09 4175746F2070617274-     .partinfo_found.mov:	asciz "Auto part info found in sector."
  4750 00005A12 20696E666F20666F75-
  4750 00005A1B 6E6420696E20736563-
  4750 00005A24 746F722E00         
  4751 00005A29 466978656420706172-     .partinfo_found.keep:	asciz "Fixed part info found in sector."
  4751 00005A32 7420696E666F20666F-
  4751 00005A3B 756E6420696E207365-
  4751 00005A44 63746F722E00       
  4752 00005A4A 205573696E67206175-     .using_auto_partinfo:	asciz " Using auto part info.",13,10
  4752 00005A53 746F20706172742069-
  4752 00005A5C 6E666F2E0D0A00     
  4753                                  
  4754 00005A63 205573696E67206669-     .using_fix_query:	asciz " Using fixed geometry.",13,10
  4754 00005A6C 7865642067656F6D65-
  4754 00005A75 7472792E0D0A00     
  4755 00005A7C 4572726F723A205175-     .query_not_found:	asciz "Error: Query geometry code not found in sector.",13,10
  4755 00005A85 6572792067656F6D65-
  4755 00005A8E 74727920636F646520-
  4755 00005A97 6E6F7420666F756E64-
  4755 00005AA0 20696E20736563746F-
  4755 00005AA9 722E0D0A00         
  4756 00005AAE 51756572792067656F-     .query_not_found.keep:	asciz "Query geometry code not found in sector. Keeping as is.",13,10
  4756 00005AB7 6D6574727920636F64-
  4756 00005AC0 65206E6F7420666F75-
  4756 00005AC9 6E6420696E20736563-
  4756 00005AD2 746F722E204B656570-
  4756 00005ADB 696E67206173206973-
  4756 00005AE4 2E0D0A00           
  4757 00005AE8 4175746F2071756572-     .query_found.query:	asciz "Auto query geometry found in sector."
  4757 00005AF1 792067656F6D657472-
  4757 00005AFA 7920666F756E642069-
  4757 00005B03 6E20736563746F722E-
  4757 00005B0C 00                 
  4758 00005B0D 46697865642067656F-     .query_found.keep:	asciz "Fixed geometry (disabled query) found in sector."
  4758 00005B16 6D6574727920286469-
  4758 00005B1F 7361626C6564207175-
  4758 00005B28 6572792920666F756E-
  4758 00005B31 6420696E2073656374-
  4758 00005B3A 6F722E00           
  4759 00005B3E 205573696E67206175-     .using_auto_query:	asciz " Using auto query geometry.",13,10
  4759 00005B47 746F20717565727920-
  4759 00005B50 67656F6D657472792E-
  4759 00005B59 0D0A00             
  4760                                  
  4761 00005B5C 205573696E67206E6F-     .using_none_lba:	asciz " Using no LBA.",13,10
  4761 00005B65 204C42412E0D0A00   
  4762 00005B6D 205573696E67206175-     .using_auto_lba:	asciz " Using auto LBA detection.",13,10
  4762 00005B76 746F204C4241206465-
  4762 00005B7F 74656374696F6E2E0D-
  4762 00005B88 0A00               
  4763 00005B8A 4572726F723A204C42-     .lba_not_found:		asciz "Error: LBA detection not found in sector.",13,10
  4763 00005B93 412064657465637469-
  4763 00005B9C 6F6E206E6F7420666F-
  4763 00005BA5 756E6420696E207365-
  4763 00005BAE 63746F722E0D0A00   
  4764 00005BB6 4C4241206465746563-     .lba_not_found.keep:	asciz "LBA detection not found in sector. Keeping as is.",13,10
  4764 00005BBF 74696F6E206E6F7420-
  4764 00005BC8 666F756E6420696E20-
  4764 00005BD1 736563746F722E204B-
  4764 00005BDA 656570696E67206173-
  4764 00005BE3 2069732E0D0A00     
  4765 00005BEA 20666F756E6420696E-     .lba_found_suffix:	asciz " found in sector."
  4765 00005BF3 20736563746F722E00 
  4766 00005BFC 0D0A4572726F723A20-     .lba_autohdd_not_found:	asciz 13,10,"Error: Cannot patch this LBA detection to auto detection for HDD only.",13,10
  4766 00005C05 43616E6E6F74207061-
  4766 00005C0E 746368207468697320-
  4766 00005C17 4C4241206465746563-
  4766 00005C20 74696F6E20746F2061-
  4766 00005C29 75746F206465746563-
  4766 00005C32 74696F6E20666F7220-
  4766 00005C3B 484444206F6E6C792E-
  4766 00005C44 0D0A00             
  4767 00005C47 205573696E67206175-     .using_autohdd_lba:	asciz " Using auto LBA detection (HDD only).",13,10
  4767 00005C50 746F204C4241206465-
  4767 00005C59 74656374696F6E2028-
  4767 00005C62 484444206F6E6C7929-
  4767 00005C6B 2E0D0A00           
  4768                                  
  4769                                  .switch_requires_filename:
  4770 00005C6F 537769746368207265-     			asciz "Switch requires a filename.",13,10
  4770 00005C78 717569726573206120-
  4770 00005C81 66696C656E616D652E-
  4770 00005C8A 0D0A00             
  4771                                  .switch_filename_missing_unquote:
  4772 00005C8D 537769746368206669-     			asciz "Switch filename missing ending quote.",13,10
  4772 00005C96 6C656E616D65206D69-
  4772 00005C9F 7373696E6720656E64-
  4772 00005CA8 696E672071756F7465-
  4772 00005CB1 2E0D0A00           
  4773                                  .switch_filename_empty:
  4774 00005CB5 537769746368206669-     			asciz "Switch filename is empty.",13,10
  4774 00005CBE 6C656E616D65206973-
  4774 00005CC7 20656D7074792E0D0A-
  4774 00005CD0 00                 
  4775                                  
  4776 00005CD1 56616C696420465349-     .info_valid:		asciz "Valid FSINFO entries detected.",13,10
  4776 00005CDA 4E464F20656E747269-
  4776 00005CE3 657320646574656374-
  4776 00005CEC 65642E0D0A00       
  4777 00005CF2 5761726E696E673A20-     .info_invalid_allowing:	asciz "Warning: Invalid FSINFO entries, allowing.",13,10
  4777 00005CFB 496E76616C69642046-
  4777 00005D04 53494E464F20656E74-
  4777 00005D0D 726965732C20616C6C-
  4777 00005D16 6F77696E672E0D0A00 
  4778 00005D1F 526573657474696E67-     .info_invalid_resetting:asciz "Resetting invalid FSINFO entries.",13,10
  4778 00005D28 20696E76616C696420-
  4778 00005D31 4653494E464F20656E-
  4778 00005D3A 74726965732E0D0A00 
  4779 00005D43 4E6F74207772697469-     .info_writing_not:	asciz "Not writing FSINFO.",13,10
  4779 00005D4C 6E67204653494E464F-
  4779 00005D55 2E0D0A00           
  4780                                  .info_writing_sector_file:
  4781 00005D59 57726974696E672046-     			asciz "Writing FSINFO to boot sector file.",13,10
  4781 00005D62 53494E464F20746F20-
  4781 00005D6B 626F6F742073656374-
  4781 00005D74 6F722066696C652E0D-
  4781 00005D7D 0A00               
  4782 00005D7F 57726974696E672046-     .info_writing_file:	asciz "Writing FSINFO to file.",13,10
  4782 00005D88 53494E464F20746F20-
  4782 00005D91 66696C652E0D0A00   
  4783 00005D99 57726974696E672046-     .info_writing_sector:	asciz "Writing FSINFO to sector.",13,10
  4783 00005DA2 53494E464F20746F20-
  4783 00005DAB 736563746F722E0D0A-
  4783 00005DB4 00                 
  4784 00005DB5 4E6F74207772697469-     .sector_writing_not:	asciz "Not writing boot sector.",13,10
  4784 00005DBE 6E6720626F6F742073-
  4784 00005DC7 6563746F722E0D0A00 
  4785 00005DD0 57726974696E672062-     .sector_writing_file:	asciz "Writing boot sector to file.",13,10
  4785 00005DD9 6F6F7420736563746F-
  4785 00005DE2 7220746F2066696C65-
  4785 00005DEB 2E0D0A00           
  4786 00005DEF 57726974696E672062-     .sector_writing_sector:	asciz "Writing boot sector to sector.",13,10
  4786 00005DF8 6F6F7420736563746F-
  4786 00005E01 7220746F2073656374-
  4786 00005E0A 6F722E0D0A00       
  4787 00005E10 4572726F7220776869-     .info_restoring_sector:	db "Error while writing boot sector,"
  4787 00005E19 6C652077726974696E-
  4787 00005E22 6720626F6F74207365-
  4787 00005E2B 63746F722C         
  4788 00005E30 20726573746F72696E-     			asciz " restoring FSINFO sector.",13,10
  4788 00005E39 67204653494E464F20-
  4788 00005E42 736563746F722E0D0A-
  4788 00005E4B 00                 
  4789 00005E4C 446574656374656420-     .backup:		asciz "Detected backup copy.",13,10
  4789 00005E55 6261636B757020636F-
  4789 00005E5E 70792E0D0A00       
  4790 00005E64 446574656374656420-     .no_backup:		asciz "Detected no backup copy.",13,10
  4790 00005E6D 6E6F206261636B7570-
  4790 00005E76 20636F70792E0D0A00 
  4791 00005E7F 446574656374656420-     .backup_no_info:	asciz "Detected backup copy without FSINFO.",13,10
  4791 00005E88 6261636B757020636F-
  4791 00005E91 707920776974686F75-
  4791 00005E9A 74204653494E464F2E-
  4791 00005EA3 0D0A00             
  4792 00005EA6 57726974696E672062-     .backup_writing_sector:	asciz "Writing boot sector to backup copy.",13,10
  4792 00005EAF 6F6F7420736563746F-
  4792 00005EB8 7220746F206261636B-
  4792 00005EC1 757020636F70792E0D-
  4792 00005ECA 0A00               
  4793 00005ECC 57726974696E672046-     .backup_writing_info:	asciz "Writing FSINFO to backup copy.",13,10
  4793 00005ED5 53494E464F20746F20-
  4793 00005EDE 6261636B757020636F-
  4793 00005EE7 70792E0D0A00       
  4794                                  .backup_not_writing_sector:
  4795 00005EED 4E6F74207772697469-     			asciz "Not writing boot sector to backup copy.",13,10
  4795 00005EF6 6E6720626F6F742073-
  4795 00005EFF 6563746F7220746F20-
  4795 00005F08 6261636B757020636F-
  4795 00005F11 70792E0D0A00       
  4796                                  .backup_not_writing_info:
  4797 00005F17 4E6F74207772697469-     			asciz "Not writing FSINFO to backup copy.",13,10
  4797 00005F20 6E67204653494E464F-
  4797 00005F29 20746F206261636B75-
  4797 00005F32 7020636F70792E0D0A-
  4797 00005F3B 00                 
  4798 00005F3C 4572726F7220776869-     .backup_error_sector:	asciz "Error while writing boot sector to backup copy.",13,10
  4798 00005F45 6C652077726974696E-
  4798 00005F4E 6720626F6F74207365-
  4798 00005F57 63746F7220746F2062-
  4798 00005F60 61636B757020636F70-
  4798 00005F69 792E0D0A00         
  4799 00005F6E 4572726F7220776869-     .backup_error_info:	asciz "Error while writing FSINFO to backup copy.",13,10
  4799 00005F77 6C652077726974696E-
  4799 00005F80 67204653494E464F20-
  4799 00005F89 746F206261636B7570-
  4799 00005F92 20636F70792E0D0A00 
  4800 00005F9B 4572726F723A204E6F-     .missing_backup_sector:	asciz "Error: No backup copy of boot sector available.",13,10
  4800 00005FA4 206261636B75702063-
  4800 00005FAD 6F7079206F6620626F-
  4800 00005FB6 6F7420736563746F72-
  4800 00005FBF 20617661696C61626C-
  4800 00005FC8 652E0D0A00         
  4801 00005FCD 4572726F723A204E6F-     .missing_backup_info:	asciz "Error: No backup copy of info sector available.",13,10
  4801 00005FD6 206261636B75702063-
  4801 00005FDF 6F7079206F6620696E-
  4801 00005FE8 666F20736563746F72-
  4801 00005FF1 20617661696C61626C-
  4801 00005FFA 652E0D0A00         
  4802 00005FFF 436F7079696E672073-     .copy_sector:		asciz "Copying sector loader from backup copy.",13,10
  4802 00006008 6563746F72206C6F61-
  4802 00006011 6465722066726F6D20-
  4802 0000601A 6261636B757020636F-
  4802 00006023 70792E0D0A00       
  4803 00006029 4B656570696E67206F-     .leave_sector:		asciz "Keeping original sector loader.",13,10
  4803 00006032 726967696E616C2073-
  4803 0000603B 6563746F72206C6F61-
  4803 00006044 6465722E0D0A00     
  4804 0000604B 5265706C6163696E67-     .replace_sector:	asciz "Replacing sector loader.",13,10
  4804 00006054 20736563746F72206C-
  4804 0000605D 6F616465722E0D0A00 
  4805 00006066 5265706C6163696E67-     .replace_sector_file:	asciz "Replacing sector loader from file.",13,10
  4805 0000606F 20736563746F72206C-
  4805 00006078 6F616465722066726F-
  4805 00006081 6D2066696C652E0D0A-
  4805 0000608A 00                 
  4806 0000608B 436F7079696E672046-     .copy_info:		asciz "Copying FSINFO from backup copy.",13,10
  4806 00006094 53494E464F2066726F-
  4806 0000609D 6D206261636B757020-
  4806 000060A6 636F70792E0D0A00   
  4807 000060AE 5A65726F696E672046-     .zero_info:		asciz "Zeroing FSINFO reserved fields.",13,10
  4807 000060B7 53494E464F20726573-
  4807 000060C0 657276656420666965-
  4807 000060C9 6C64732E0D0A00     
  4808 000060D0 4B656570696E67206F-     .leave_info:		asciz "Keeping original FSINFO.",13,10
  4808 000060D9 726967696E616C2046-
  4808 000060E2 53494E464F2E0D0A00 
  4809 000060EB 5265706C6163696E67-     .replace_info:		asciz "Replacing FSIBOOT.",13,10
  4809 000060F4 20465349424F4F542E-
  4809 000060FD 0D0A00             
  4810 00006100 5265706C6163696E67-     .replace_info_file:	asciz "Replacing FSIBOOT from file.",13,10
  4810 00006109 20465349424F4F5420-
  4810 00006112 66726F6D2066696C65-
  4810 0000611B 2E0D0A00           
  4811                                  
  4812 0000611F 4572726F72206F7065-     .error_file_open_write:	asciz "Error opening file for writing, "
  4812 00006128 6E696E672066696C65-
  4812 00006131 20666F722077726974-
  4812 0000613A 696E672C2000       
  4813 00006140 4572726F72206F7065-     .error_file_open_read:	asciz "Error opening file for reading, "
  4813 00006149 6E696E672066696C65-
  4813 00006152 20666F722072656164-
  4813 0000615B 696E672C2000       
  4814                                  .error_file_open_readwrite:
  4815 00006161 4572726F72206F7065-     			asciz "Error opening file for R/W, "
  4815 0000616A 6E696E672066696C65-
  4815 00006173 20666F7220522F572C-
  4815 0000617C 2000               
  4816 0000617E 4572726F7220777269-     .error_file_write:	asciz "Error writing file, "
  4816 00006187 74696E672066696C65-
  4816 00006190 2C2000             
  4817 00006193 4572726F7220726561-     .error_file_read:	asciz "Error reading file, "
  4817 0000619C 64696E672066696C65-
  4817 000061A5 2C2000             
  4818 000061A8 4572726F7220736565-     .error_file_seek:	asciz "Error seeking file, "
  4818 000061B1 6B696E672066696C65-
  4818 000061BA 2C2000             
  4819                                  symhint_store_string msg.dos_error_
  4820 000061BD 444F53206572726F72-     .dos_error_msg_1:	asciz "DOS error "
  4820 000061C6 2000               
  4821 000061C8 68202800                .dos_error_msg_2:	asciz "h ("
  4822 000061CC 292E0D0A00              .dos_error_msg_3:	asciz ").",13,10
  4823                                  
  4824 000061D1 4E6F206572726F7200      .dos_error_0:		asciz "No error"
  4825 000061DA 496E76616C69642066-     .dos_error_1:		asciz "Invalid function"
  4825 000061E3 756E6374696F6E00   
  4826 000061EB 46696C65206E6F7420-     .dos_error_2:		asciz "File not found"
  4826 000061F4 666F756E6400       
  4827 000061FA 50617468206E6F7420-     .dos_error_3:		asciz "Path not found"
  4827 00006203 666F756E6400       
  4828 00006209 4E6F2068616E646C65-     .dos_error_4:		asciz "No handles available"
  4828 00006212 7320617661696C6162-
  4828 0000621B 6C6500             
  4829 0000621E 416363657373206465-     .dos_error_5:		asciz "Access denied"
  4829 00006227 6E69656400         
  4830 0000622C 496E76616C69642068-     .dos_error_6:		asciz "Invalid handle"
  4830 00006235 616E646C6500       
  4831 0000623B 4D4342206465737472-     .dos_error_7:		asciz "MCB destroyed"
  4831 00006244 6F79656400         
  4832 00006249 4F7574206F66206D65-     .dos_error_8:		asciz "Out of memory"
  4832 00006252 6D6F727900         
  4833 00006257 4D434220696E76616C-     .dos_error_9:		asciz "MCB invalid"
  4833 00006260 696400             
  4834 00006263 456E7669726F6E6D65-     .dos_error_10:		asciz "Environment invalid"
  4834 0000626C 6E7420696E76616C69-
  4834 00006275 6400               
  4835 00006277 466F726D617420696E-     .dos_error_11:		asciz "Format invalid"
  4835 00006280 76616C696400       
  4836 00006286 41636365737320636F-     .dos_error_12:		asciz "Access code invalid"
  4836 0000628F 646520696E76616C69-
  4836 00006298 6400               
  4837 0000629A 4461746120696E7661-     .dos_error_13:		asciz "Data invalid"
  4837 000062A3 6C696400           
  4838 000062A7 4669787570206F7665-     .dos_error_14:		asciz "Fixup overflow"
  4838 000062B0 72666C6F7700       
  4839 000062B6 496E76616C69642064-     .dos_error_15:		asciz "Invalid drive"
  4839 000062BF 7269766500         
  4840 000062C4 417474656D70746564-     .dos_error_16:		asciz "Attempted to remove current directory"
  4840 000062CD 20746F2072656D6F76-
  4840 000062D6 652063757272656E74-
  4840 000062DF 206469726563746F72-
  4840 000062E8 7900               
  4841 000062EA 4E6F742073616D6520-     .dos_error_17:		asciz "Not same device"
  4841 000062F3 64657669636500     
  4842 000062FA 4E6F206D6F72652066-     .dos_error_18:		asciz "No more files"
  4842 00006303 696C657300         
  4843 00006308 4469736B2077726974-     .dos_error_19:		asciz "Disk write protected"
  4843 00006311 652070726F74656374-
  4843 0000631A 656400             
  4844 0000631D 556E6B6E6F776E2075-     .dos_error_20:		asciz "Unknown unit"
  4844 00006326 6E697400           
  4845 0000632A 4472697665206E6F74-     .dos_error_21:		asciz "Drive not ready"
  4845 00006333 20726561647900     
  4846 0000633A 556E6B6E6F776E2063-     .dos_error_22:		asciz "Unknown command"
  4846 00006343 6F6D6D616E6400     
  4847 0000634A 44617461206572726F-     .dos_error_23:		asciz "Data error"
  4847 00006353 7200               
  4848 00006355 426164207265717565-     .dos_error_24:		asciz "Bad request structure length"
  4848 0000635E 737420737472756374-
  4848 00006367 757265206C656E6774-
  4848 00006370 6800               
  4849 00006372 5365656B206572726F-     .dos_error_25:		asciz "Seek error"
  4849 0000637B 7200               
  4850 0000637D 556E6B6E6F776E206D-     .dos_error_26:		asciz "Unknown media type"
  4850 00006386 656469612074797065-
  4850 0000638F 00                 
  4851 00006390 536563746F72206E6F-     .dos_error_27:		asciz "Sector not found"
  4851 00006399 7420666F756E6400   
  4852 000063A1 5072696E746572206F-     .dos_error_28:		asciz "Printer out of paper"
  4852 000063AA 7574206F6620706170-
  4852 000063B3 657200             
  4853 000063B6 577269746520666175-     .dos_error_29:		asciz "Write fault"
  4853 000063BF 6C7400             
  4854 000063C2 52656164206661756C-     .dos_error_30:		asciz "Read fault"
  4854 000063CB 7400               
  4855 000063CD 47656E6572616C2066-     .dos_error_31:		asciz "General failure"
  4855 000063D6 61696C75726500     
  4856 000063DD 53686172696E672076-     .dos_error_32:		asciz "Sharing violation"
  4856 000063E6 696F6C6174696F6E00 
  4857 000063EF 4C6F636B2076696F6C-     .dos_error_33:		asciz "Lock violation"
  4857 000063F8 6174696F6E00       
  4858 000063FE 4469736B206368616E-     .dos_error_34:		asciz "Disk change invalid"
  4858 00006407 676520696E76616C69-
  4858 00006410 6400               
  4859 00006412 46434220756E617661-     .dos_error_35:		asciz "FCB unavailable"
  4859 0000641B 696C61626C6500     
  4860 00006422 53686172696E672062-     .dos_error_36:		asciz "Sharing buffer overflow"
  4860 0000642B 7566666572206F7665-
  4860 00006434 72666C6F7700       
  4861 0000643A 436F64652070616765-     .dos_error_37:		asciz "Code page mismatch"
  4861 00006443 206D69736D61746368-
  4861 0000644C 00                 
  4862 0000644D 43616E6E6F7420636F-     .dos_error_38:		asciz "Cannot complete file operation"
  4862 00006456 6D706C657465206669-
  4862 0000645F 6C65206F7065726174-
  4862 00006468 696F6E00           
  4863 0000646C 496E73756666696369-     .dos_error_39:		asciz "Insufficient disk space"
  4863 00006475 656E74206469736B20-
  4863 0000647E 737061636500       
  4864 00006484 556E6B6E6F776E2065-     .dos_error_unknown:	asciz "Unknown error"
  4864 0000648D 72726F7200         
  4865                                  
  4866                                  
  4867                                  	align 2, db 0
  4868                                  dos_error_table:
  4869                                  .:
  4870                                  %assign ii 0
  4871                                  %rep 40
  4872                                  	_autodigitsstrdef NUMBER, ii
  4873                                   %deftok _NUMBER _NUMBER
  4874                                  	dw msg.dos_error_ %+ _NUMBER
  4875                                   %assign ii ii + 1
  4876                                  %endrep
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 00006492 [D161]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 00006494 [DA61]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 00006496 [EB61]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 00006498 [FA61]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 0000649A [0962]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 0000649C [1E62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 0000649E [2C62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064A0 [3B62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064A2 [4962]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064A4 [5762]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064A6 [6362]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064A8 [7762]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064AA [8662]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064AC [9A62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064AE [A762]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064B0 [B662]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064B2 [C462]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064B4 [EA62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064B6 [FA62]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064B8 [0863]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064BA [1D63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064BC [2A63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064BE [3A63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064C0 [4A63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064C2 [5563]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064C4 [7263]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064C6 [7D63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064C8 [9063]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064CA [A163]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064CC [B663]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064CE [C263]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064D0 [CD63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064D2 [DD63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064D4 [EF63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064D6 [FE63]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064D8 [1264]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064DA [2264]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064DC [3A64]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064DE [4D64]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4872                              <1>  _autodigitsstrdef NUMBER, ii
  4873                              <1>  %deftok _NUMBER _NUMBER
  4874 000064E0 [6C64]              <1>  dw msg.dos_error_ %+ _NUMBER
  4875                              <1>  %assign ii ii + 1
  4877                                  .after_last:	equ ($ - .) >> 1
  4878                                  
  4879                                  
  4880                                  symhint_store_string dskerr
  4881                                  dskerrs:
  4882                                  .:
  4883                                  %assign ii 0
  4884                                  %rep 0Dh
  4885                                  	_autohexitsstrdef NUMBER, ii
  4886                                   %strcat _NUMBER "dskerr",_NUMBER
  4887                                   %deftok _NUMBER _NUMBER
  4888                                  	db _NUMBER - dskerrs
  4889                                   %assign ii ii + 1
  4890                                  %endrep
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E2 0D                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E3 21                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E4 34                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E5 44                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E6 54                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E7 94                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E8 65                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064E9 70                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064EA 83                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064EB 94                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064EC A2                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064ED AE                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4885                              <1>  _autohexitsstrdef NUMBER, ii
  4886                              <1>  %strcat _NUMBER "dskerr",_NUMBER
  4887                              <1>  %deftok _NUMBER _NUMBER
  4888 000064EE B9                  <1>  db _NUMBER - dskerrs
  4889                              <1>  %assign ii ii + 1
  4891                                  .after_last:	equ ($ - .)
  4892 000064EF 57726974652070726F-     dskerr0:	asciz "Write protect error"
  4892 000064F8 74656374206572726F-
  4892 00006501 7200               
  4893 00006503 556E6B6E6F776E2075-     dskerr1:	asciz "Unknown unit error"
  4893 0000650C 6E6974206572726F72-
  4893 00006515 00                 
  4894 00006516 4472697665206E6F74-     dskerr2:	asciz "Drive not ready"
  4894 0000651F 20726561647900     
  4895 00006526 556E6B6E6F776E2063-     dskerr3:	asciz "Unknown command"
  4895 0000652F 6F6D6D616E6400     
  4896 00006536 44617461206572726F-     dskerr4:	asciz "Data error (CRC)"
  4896 0000653F 7220284352432900   
  4897 00006547 5365656B206572726F-     dskerr6:	asciz "Seek error"
  4897 00006550 7200               
  4898 00006552 556E6B6E6F776E206D-     dskerr7:	asciz "Unknown media type"
  4898 0000655B 656469612074797065-
  4898 00006564 00                 
  4899 00006565 536563746F72206E6F-     dskerr8:	asciz "Sector not found"
  4899 0000656E 7420666F756E6400   
  4900                                  dskerr5:
  4901 00006576 556E6B6E6F776E2065-     dskerr9:	asciz "Unknown error"
  4901 0000657F 72726F7200         
  4902 00006584 577269746520666175-     dskerrA:	asciz "Write fault"
  4902 0000658D 6C7400             
  4903 00006590 52656164206661756C-     dskerrB:	asciz "Read fault"
  4903 00006599 7400               
  4904 0000659B 47656E6572616C2066-     dskerrC:	asciz "General failure"
  4904 000065A4 61696C75726500     
  4905 000065AB 207265616400            reading:	asciz " read"
  4906 000065B1 207772697400            writing:	asciz " writ"
  4907 000065B7 696E67206472697665-     drive:		db "ing drive "
  4907 000065C0 20                 
  4908 000065C1 5F0D0A00                driveno:	asciz "_",13,10
  4909                                  
  4910                                  
  4911                                  imsg:
  4912                                  %if _VDD
  4913 000065C5 44454258585644442E-     .vdd:		asciz "DEBXXVDD.DLL"
  4913 000065CE 444C4C00           
  4914 000065D2 446973706174636800      .dispatch:	asciz "Dispatch"
  4915 000065DB 496E697400              .init:		asciz "Init"
  4916                                  	align 2, db 0
  4917 000065E0 4D4F555345202020        .mouse:		db "MOUSE",32,32,32		; Looks like a device name
  4918 000065E8 416E64792057617473-     .andy:		db "Andy Watson"		; I don't know him and why he's inside the NTVDM mouse driver
  4918 000065F1 6F6E               
  4919                                  	endarea .andy
  4920 000065F3 57696E646F7773204E-     .ntdos:		db "Windows NT MS-DOS subsystem Mouse Driver"	; Int33.004D mouse driver copyright string (not ASCIZ)
  4920 000065FC 54204D532D444F5320-
  4920 00006605 73756273797374656D-
  4920 0000660E 204D6F757365204472-
  4920 00006617 69766572           
  4921                                  	endarea .ntdos
  4922                                  
  4923                                  		; INP:	-
  4924                                  		; OUT:	CY if not NTVDM
  4925                                  		;	NC if NTVDM
  4926                                  		;	ds = es = cs
  4927                                  		; CHG:	ax, bx, cx, dx, di, si, bp, es, ds
  4928                                  isnt:
  4929 0000661B B80258                  		mov ax, 5802h			; Get UMB link state
  4930 0000661E CD21                    		int 21h
  4931 00006620 30E4                    		xor ah, ah
  4932 00006622 50                      		push ax				; Save UMB link state
  4933 00006623 B80358                  		mov ax, 5803h			; Set UMB link state:
  4934 00006626 BB0100                  		mov bx, 1			;  Add UMBs to memory chain
  4935 00006629 CD21                    		int 21h
  4936 0000662B B452                    		mov ah, 52h
  4937 0000662D BBFFFF                  		mov bx, -1
  4938 00006630 CD21                    		int 21h				; Get list of lists
  4939 00006632 43                      		inc bx				; 0FFFFh ?
  4940 00006633 7503E98600              		jz .notnt			; invalid -->
  4941 00006638 268B47FD                		mov ax, word [es:bx-3]		; First MCB
  4942 0000663C 0E                      		push cs
  4943 0000663D 07                      		pop es				; reset es
  4944                                  .loop:
  4945 0000663E 8ED8                    		mov ds, ax			; ds = MCB
  4946 00006640 40                      		inc ax				; Now segment of memory block itself
  4947 00006641 31D2                    		xor dx, dx
  4948 00006643 31DB                    		xor bx, bx
  4949 00006645 803F5A                  		cmp byte [bx], 'Z'		; End of MCB chain?
  4950 00006648 7503                    		jne .notlast
  4951 0000664A 42                      		inc dx
  4952 0000664B EB05                    		jmp short .notchain
  4953                                   .notlast:
  4954 0000664D 803F4D                  		cmp byte [bx], 'M'		; Valid MCB chain?
  4955 00006650 756C                    		jne .error
  4956                                   .notchain:
  4957 00006652 8B4F03                  		mov cx, [bx+3]			; MCB size in paragraphs
  4958                                  				; ax = current memory block
  4959                                  				; cx = size of current memory block in paragraphs
  4960                                  				; dx = flag whether this is the last MCB
  4961                                  				; ds = current MCB (before memory block)
  4962 00006655 837F0108                		cmp word [bx+1], 8		; MCB owner DOS?
  4963 00006659 755D                    		jne .notfound_1
  4964 0000665B 817F085344              		cmp word [bx+8], "SD"		; MCB name "SD"?
  4965 00006660 7556                    		jne .notfound_1
  4966                                  .loopsub:
  4967 00006662 8ED8                    		mov ds, ax			; SD sub-segment inside memory block
  4968 00006664 40                      		inc ax
  4969 00006665 49                      		dec cx
  4970 00006666 8B6F03                  		mov bp, word [bx+3]		; Paragraphs 'til end of SD sub-segment
  4971                                  				; ax = current SD sub-segment
  4972                                  				; cx = paragraphs from SD sub-segment start (ax) to current memory block end
  4973                                  				; ds = current SD sub-MCB (like MCB, but for SD sub-segment)
  4974                                  				; bp = current SD sub-segment size in paragraphs
  4975 00006669 39E9                    		cmp cx, bp
  4976 0000666B 724B                    		jb .notfound_1			; Goes beyond memory block, invalid -->
  4977 0000666D 803F51                  		cmp byte [bx], 'Q'		; NTVDM type 51h sub-segment ?
  4978 00006670 753C                    		jne .notfound_2			; no -->
  4979 00006672 BE0800                  		mov si, 8			; Offset of device name (if SD device driver sub-segment)
  4980 00006675 BF[E065]                		mov di, imsg.mouse
  4981 00006678 51                      		push cx
  4982 00006679 89F1                    		mov cx, si			; length of name
  4983 0000667B F3A6                    		repe cmpsb			; blank-padded device name "MOUSE" ?
  4984 0000667D 59                      		pop cx
  4985 0000667E 752E                    		jne .notfound_2			;  Device name doesn't match, try next SD sub-segment
  4986 00006680 8CD8                    		mov ax, ds
  4987 00006682 40                      		inc ax
  4988 00006683 8ED8                    		mov ds, ax			; Segment of SD sub-segment
  4989                                  				; ds = current SD sub-segment
  4990 00006685 89E8                    		mov ax, bp			; Leave paragraph value in bp
  4991 00006687 A900F0                  		test ax, 0F000h			; Would *16 cause an overflow?
  4992 0000668A 7520                    		jnz .notfound_3			;  Then too large -->
  4993 0000668C 51                      		push cx
  4994 0000668D B104                    		mov cl, 4
  4995 0000668F D3E0                    		shl ax, cl			; *16
  4996 00006691 59                      		pop cx
  4997                                  				; ax = current SD sub-segment size in byte
  4998                                  .andy:
  4999 00006692 BF[E865]                		mov di, imsg.andy
  5000 00006695 51                      		push cx
  5001 00006696 B90B00                  		mov cx, imsg.andy_size
  5002 00006699 E82E00                  		call findstring			; String "Andy Watson"?
  5003 0000669C 59                      		pop cx
  5004 0000669D 720D                    		jc .notfound_3
  5005                                  .ntdos:
  5006 0000669F BF[F365]                		mov di, imsg.ntdos
  5007 000066A2 51                      		push cx
  5008 000066A3 B92800                  		mov cx, imsg.ntdos_size
  5009 000066A6 E82100                  		call findstring			; String "Windows NT MS-DOS subsystem Mouse Driver"?
  5010 000066A9 59                      		pop cx
  5011 000066AA 7313                    		jnc .found			; (NC)
  5012                                  .notfound_3:
  5013 000066AC 8CD8                    		mov ax, ds
  5014                                  .notfound_2:
  5015 000066AE 39E9                    		cmp cx, bp
  5016 000066B0 7406                    		je .notfound_1			; End of SD memory block, get next MCB
  5017 000066B2 01E8                    		add ax, bp			; Address next SD sub-MCB
  5018 000066B4 29E9                    		sub cx, bp
  5019 000066B6 EBAA                    		jmp short .loopsub		; Try next SD sub-segment
  5020                                  .notfound_1:
  5021 000066B8 01C8                    		add ax, cx			; Address next MCB
  5022 000066BA 85D2                    		test dx, dx			; Non-zero if 'Z' MCB
  5023 000066BC 7480                    		jz .loop			; If not at end of MCB chain, try next
  5024                                  		; jmp short .notnt		;  Otherwise, not found
  5025                                   .error:
  5026                                   .notnt:
  5027 000066BE F9                      		stc
  5028                                  .found:
  5029 000066BF 0E                      		push cs
  5030 000066C0 1F                      		pop ds				; restore ds
  5031                                  
  5032 000066C1 5B                      		pop bx				; saved UMB link state
  5033 000066C2 B80358                  		mov ax, 5803h
  5034 000066C5 9C                      		pushf
  5035 000066C6 CD21                    		int 21h				; Set UMB link state
  5036 000066C8 9D                      		popf
  5037 000066C9 C3                      		retn
  5038                                  
  5039                                  findstring:
  5040 000066CA 31F6                    		xor si, si
  5041                                  .loop:
  5042 000066CC 56                      		push si
  5043 000066CD 01CE                    		add si, cx
  5044 000066CF 7203                    		jc .notfound_c
  5045 000066D1 4E                      		dec si				; The largest offset we need for this compare
  5046 000066D2 39F0                    		cmp ax, si
  5047                                   .notfound_c:
  5048 000066D4 5E                      		pop si
  5049 000066D5 720D                    		jb .return			; Not found if at top of memory block -->
  5050 000066D7 57                      		push di
  5051 000066D8 56                      		push si
  5052 000066D9 51                      		push cx
  5053 000066DA F3A6                    		repe cmpsb			; String somewhere inside program?
  5054 000066DC 59                      		pop cx
  5055 000066DD 5E                      		pop si
  5056 000066DE 5F                      		pop di
  5057 000066DF 7403                    		je .return			;  Yes, proceed --> (if ZR, NC)
  5058 000066E1 46                      		inc si				; Increase pointer by one
  5059 000066E2 EBE8                    		jmp short .loop			;  Try next address
  5060                                  .return:
  5061 000066E4 C3                      		retn
  5062                                  %endif
  5063                                  
  5064                                  
  5065                                  initialise:
  5066                                  		; Check DOS version
  5067                                  %if _VDD
  5068 000066E5 55                      	push bp
  5069 000066E6 E832FF                  	call isnt		; NTVDM ?
  5070 000066E9 5D                      	pop bp
  5071 000066EA 7205                    	jc .isnotnt		; no -->
  5072 000066EC 800E[4646]02            	setopt [internalflags], runningnt
  5073                                  .isnotnt:
  5074                                  %endif
  5075                                  
  5076 000066F1 B80030                  	mov ax, 3000h		; check DOS version
  5077 000066F4 CD21                    	int 21h
  5078 000066F6 86C4                    	xchg al, ah
  5079 000066F8 3D1F03                  	cmp ax, ver(3,31)	; MS-DOS version > 3.30 ?
  5080 000066FB 7205                    	jb .notoldpacket	; no -->
  5081 000066FD 800E[4446]01            	setopt [internalflags], oldpacket	; assume Int25/Int26 packet method available
  5082                                  .notoldpacket:
  5083 00006702 50                      	push ax
  5084 00006703 31DB                    	xor bx, bx		; preset to invalid value
  5085 00006705 B80633                  	mov ax, 3306h
  5086 00006708 CD21                    	int 21h
  5087 0000670A 08C0                    	or al, al		; invalid, DOS 1.x error -->
  5088 0000670C 7402                    	jz .213306invalid
  5089 0000670E 3CFF                    	cmp al, -1		; invalid
  5090                                  .213306invalid:
  5091 00006710 58                      	pop ax
  5092 00006711 7407                    	je .useoldver
  5093 00006713 85DB                    	test bx, bx		; 0.0 ?
  5094 00006715 7403                    	jz .useoldver		; assume invalid -->
  5095 00006717 93                      	xchg ax, bx		; get version to ax
  5096 00006718 86C4                    	xchg al, ah		; strange Microsoft version format
  5097                                  .useoldver:
  5098 0000671A 3D0107                  	cmp ax, ver(7,01)	; MS-DOS version > 7.00 ?
  5099 0000671D 7205                    	jb .notnewpacket	; no -->
  5100 0000671F 800E[4446]03            	setopt [internalflags], newpacket| oldpacket	; assume both packet methods available
  5101                                  .notnewpacket:
  5102                                  %if _VDD
  5103 00006724 F606[4646]02            	testopt [internalflags], runningnt
  5104 00006729 7419                    	jz .novdd
  5105 0000672B BE[C565]                	mov si, imsg.vdd	; ds:si-> ASCIZ VDD filename
  5106 0000672E BB[D265]                	mov bx, imsg.dispatch	; ds:bx-> ASCIZ dispatching entry
  5107 00006731 BF[DB65]                	mov di, imsg.init	; es:di-> ASCIZ init entry
  5108 00006734 F8                      	clc			; !
  5109 00006735 C4C4580090              	RegisterModule		; register VDD
  5110 0000673A 7208                    	jc .novdd		; error ? -->
  5111 0000673C A3[5046]                	mov word [hVdd], ax
  5112 0000673F 800E[4446]05            	setopt [internalflags], ntpacket| oldpacket	; assume old packet method also available
  5113                                  .novdd:
  5114                                  %endif
  5115                                  
  5116 00006744 31C0                    	xor ax, ax
  5117 00006746 BB[4008]                	mov bx, first_sector_buffer	; ds:bx -> sector buffer
  5118 00006749 89DF                    	mov di, bx			; es:di -> sector buffer
  5119 0000674B B90110                  	mov cx, (8192 + 2) >> 1
  5120 0000674E F3AB                    	rep stosw			; fill buffer, di -> behind (first_sector_buffer+8192+2)
  5121 00006750 31D2                    	xor dx, dx
  5122 00006752 8A0E[5A46]              	mov cl, [drivenumber]
  5123 00006756 53                      	push bx
  5124 00006757 E897DD                  	call read_sector
  5125 0000675A 5B                      	pop bx
  5126 0000675B 726D                    	jc .access_error
  5127                                  
  5128 0000675D FD                      	std				; AMD erratum 109 handling not needed
  5129 0000675E 26C747FE5E5E            	mov word [es:bx - 2], 5E5Eh	; writes to unused word (1)
  5130 00006764 AF                      	scasw				; -> first_sector_buffer+8192 (at last word to sca)
  5131 00006765 B90110                  	mov cx, (8192 + 2) >> 1
  5132 00006768 31C0                    	xor ax, ax
  5133 0000676A F3AF                    	repe scasw
  5134 0000676C 83C704                  	add di, 4			; di -> first differing byte (from top)
  5135 0000676F FC                      	cld
  5136 00006770 57                      	 push di
  5137                                  
  5138 00006771 89DF                    	mov di, bx
  5139 00006773 B90110                  	mov cx, (8192 + 2) >> 1
  5140 00006776 48                      	dec ax				; = FFFFh
  5141 00006777 F3AB                    	rep stosw
  5142                                  
  5143 00006779 31C0                    	xor ax, ax
  5144 0000677B 31D2                    	xor dx, dx
  5145 0000677D 8A0E[5A46]              	mov cl, [drivenumber]
  5146 00006781 53                      	push bx
  5147 00006782 E86CDD                  	call read_sector
  5148 00006785 5B                      	pop bx
  5149 00006786 5A                      	 pop dx
  5150 00006787 7241                    	jc .access_error
  5151                                  
  5152 00006789 FD                      	std				; AMD erratum 109 handling not needed
  5153 0000678A AF                      	scasw				; di -> first_sector_buffer+8192 (last word to sca)
  5154 0000678B B8FFFF                  	mov ax, -1
  5155 0000678E B90110                  	mov cx, (8192 + 2) >> 1
  5156 00006791 F3AF                    	repe scasw
  5157                                  %if 0
  5158                                  AAAB
  5159                                     ^
  5160                                  	sca B, match
  5161                                    ^
  5162                                  	sca B, mismatch
  5163                                   ^
  5164                                  	stop
  5165                                  %endif
  5166 00006793 83C704                  	add di, 4			; di -> first differing byte (from top)
  5167 00006796 FC                      	cld
  5168                                  
  5169                                  %if 0
  5170                                  0000000000000
  5171                                  AAAAAAAA00000
  5172                                  	^
  5173                                  FFFFFFFFFFFFF
  5174                                  AAAAAAAA00FFF
  5175                                  	  ^
  5176                                  %endif
  5177 00006797 39FA                    	cmp dx, di			; choose the higher one
  5178 00006799 7302                    	jae @F
  5179 0000679B 89FA                    	mov dx, di
  5180                                  @@:
  5181 0000679D 29DA                    	sub dx, bx			; dx = sector size
  5182                                  
  5183 0000679F 81FA0220                	cmp dx, 8192 + 2
  5184 000067A3 732A                    	jae .sector_too_large
  5185 000067A5 B82000                  	mov ax, 32
  5186 000067A8 39C2                    	cmp dx, ax
  5187 000067AA 7228                    	jb .sector_too_small
  5188                                  @@:
  5189 000067AC 39C2                    	cmp dx, ax
  5190 000067AE 7409                    	je .got_match
  5191 000067B0 3D0020                  	cmp ax, 8192
  5192 000067B3 7324                    	jae .sector_not_power
  5193 000067B5 D1E0                    	shl ax, 1
  5194 000067B7 EBF3                    	jmp @B
  5195                                  
  5196                                  .got_match:
  5197 000067B9 8946DC                  	mov word [bp + ldBytesPerSector], ax
  5198 000067BC B104                    	mov cl, 4
  5199 000067BE D3E8                    	shr ax, cl
  5200 000067C0 8946EA                  	mov word [bp + ldParaPerSector], ax
  5201 000067C3 D1E8                    	shr ax, 1
  5202 000067C5 8946D4                  	mov word [bp + ldEntriesPerSector], ax
  5203 000067C8 F8                      	clc
  5204 000067C9 C3                      	retn
  5205                                  
  5206                                  
  5207                                  .access_error:
  5208 000067CA BA[8F52]                	mov dx, msg.boot_access_error
  5209 000067CD EB0D                    	jmp .error_common_j
  5210                                  .sector_too_large:
  5211 000067CF BA[9F52]                	mov dx, msg.boot_sector_too_large
  5212 000067D2 EB08                    	jmp .error_common_j
  5213                                  .sector_too_small:
  5214 000067D4 BA[C552]                	mov dx, msg.boot_sector_too_small
  5215 000067D7 EB03                    	jmp .error_common_j
  5216                                  .sector_not_power:
  5217 000067D9 BA[ED52]                	mov dx, msg.boot_sector_not_power
  5218                                  .error_common_j:
  5219 000067DC E8A2DB                  	call disp_msg_asciz
  5220 000067DF F9                      	stc
  5221 000067E0 C3                      	retn
  5222                                  
  5223 000067E1 00<rep Fh>              	align 16, db 0
  5224                                  	section BUFFERS
  5225                                  
  5226                                  	align 8, db 0
  5227                                  m_seek:
  5228 00000800 FFFFFFFFFFFFFFFF        	dq -1
  5229                                  m_offset:
  5230 00000808 0000000000000000        	dq 0
  5231                                  m_sector_size:
  5232 00000810 00020000                	dd 512
  5233                                  m_1:
  5234 00000814 01000000                	dd 1
  5235                                  m_1024:
  5236 00000818 00040000                	dd 1024
  5237                                  m_1024_times_1024:
  5238 0000081C 00001000                	dd 1024 * 1024
  5239                                  
  5240                                  	align 4, db 0
  5241 00000820 22A00000                cmd_line_flags:		dd clfWriteSectorToSector | clfWriteInfoToSector 			| clfWriteCopySectorIfSector | clfWriteCopyInfoIfSector
  5243                                  clfWriteSectorToFile:		equ   1
  5244                                  clfWriteSectorToSector:		equ   2
  5245                                  clfDontWriteSector:		equ   4
  5246                                  clfWriteSectorMask: 	equ clfWriteSectorToFile | clfWriteSectorToSector | clfDontWriteSector
  5248                                  clfDontWriteInfo:		equ   8
  5249                                  clfWriteInfoToFile:		equ  10h
  5250                                  clfWriteInfoToSector:		equ  20h
  5251                                  clfWriteInfoToSectorFile:	equ  40h
  5252                                  clfWriteInfoMask: 	equ clfWriteInfoToFile | clfWriteInfoToSector 		| clfWriteInfoToSectorFile | clfDontWriteInfo
  5255                                  clfReadSectorFile12:		equ  80h
  5256                                  clfReadSectorFile16:		equ 100h
  5257                                  clfReadSectorFile32:		equ 200h
  5258                                  clfAllowInvalidSector:		equ 400h
  5259                                  clfAllowInvalidInfo:		equ 800h
  5260                                  clfWriteCopySector:		equ 1000h
  5261                                  clfWriteCopySectorIfSector:	equ 2000h
  5262                                  clfWriteCopyInfo:		equ 4000h
  5263                                  clfWriteCopyInfoIfSector:	equ 8000h
  5264                                  clfLeaveSector:			equ  1_0000h
  5265                                  clfSectorFromCopy:		equ  2_0000h
  5266                                  clfLeaveInfo:			equ 10_0000h
  5267                                  clfInfoFromCopy:		equ 20_0000h
  5268                                  clfZeroInfo:			equ 40_0000h
  5269                                  clfSetOEMName:			equ 100_0000h
  5270                                  clfPreserveOEMName:		equ 200_0000h
  5271                                  
  5272                                  	align 4, db 0
  5273                                  cmd_line_readsector12_file:
  5274 00000824 0000                    .name:		dw 0
  5275 00000826 FFFF                    .handle:	dw -1
  5276                                  cmd_line_readsector16_file:
  5277 00000828 0000                    .name:		dw 0
  5278 0000082A FFFF                    .handle:	dw -1
  5279                                  cmd_line_readsector32_file:
  5280 0000082C 0000                    .name:		dw 0
  5281 0000082E FFFF                    .handle:	dw -1
  5282                                  cmd_line_sector_file:
  5283 00000830 0000                    .name:		dw 0
  5284 00000832 FFFF                    .handle:	dw -1
  5285                                  cmd_line_info_file:
  5286 00000834 0000                    .name:		dw 0
  5287 00000836 FFFF                    .handle:	dw -1
  5288                                  cmd_line_image_file:
  5289 00000838 0000                    .name:		dw 0
  5290 0000083A FFFF                    .handle:	dw -1
  5291                                  cmd_line_file_name_ofs:		equ 0
  5292                                  cmd_line_file_handle_ofs:	equ 2
  5293                                  
  5294                                  
  5295 0000083C 0000                    	dw 0		; insure there's an unused word in front of this (1)
  5296 0000083E 00<rep 2h>              	align 16, db 0
  5297                                  first_sector_buffer:
  5298                                  second_sector_buffer:	equ first_sector_buffer - LOADDATA2 + 16 + 8192
  5299                                  third_sector_buffer_512_bytes: 			equ second_sector_buffer + 8192
  5301                                  end:			equ third_sector_buffer_512_bytes + 512
  5302                                  stack_start:		equ end
  5303                                  stack_end:		equ stack_start + 4096
  5304                                  
